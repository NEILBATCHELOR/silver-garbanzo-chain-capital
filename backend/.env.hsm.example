# =====================================
# Chain Capital Backend - HSM Configuration
# Hardware Security Module Integration
# =====================================

# =============================================================================
# HSM PROVIDER CONFIGURATION
# Choose one: memory, aws-cloudhsm, azure-keyvault, google-cloud-kms
# =============================================================================

# HSM Provider Selection
HSM_PROVIDER=memory
HSM_REGION=us-east-1

# =============================================================================
# AWS CLOUDHSM CONFIGURATION
# FIPS 140-2 Level 3 Compliance
# =============================================================================

# AWS CloudHSM Cluster Configuration
AWS_CLOUDHSM_CLUSTER_ENDPOINT=cluster-abcdefghijk.cloudhsm.us-east-1.amazonaws.com
AWS_CLOUDHSM_CLUSTER_ID=cluster-abcdefghijk

# AWS Credentials
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_SESSION_TOKEN=your_aws_session_token
AWS_ACCOUNT_ID=123456789012

# Optional: CloudHSM Client Configuration
AWS_CLOUDHSM_CLIENT_CERT_PATH=/opt/cloudhsm/cert/client.crt
AWS_CLOUDHSM_CLIENT_KEY_PATH=/opt/cloudhsm/cert/client.key
AWS_CLOUDHSM_TRUSTED_CERT_PATH=/opt/cloudhsm/cert/trusted.crt

# =============================================================================
# AZURE KEY VAULT CONFIGURATION  
# FIPS 140-2 Level 2 Compliance
# =============================================================================

# Azure Key Vault URL
AZURE_KEY_VAULT_URL=https://your-vault-name.vault.azure.net/

# Managed Identity Configuration (recommended for Azure deployments)
AZURE_USE_MANAGED_IDENTITY=false

# Azure Service Principal Credentials (if not using managed identity)
AZURE_TENANT_ID=your-azure-tenant-id
AZURE_CLIENT_ID=your-azure-client-id
AZURE_CLIENT_SECRET=your-azure-client-secret
AZURE_SUBSCRIPTION_ID=your-azure-subscription-id

# Optional: Azure Key Vault Advanced Configuration
AZURE_KEY_VAULT_RESOURCE_GROUP=your-resource-group
AZURE_KEY_VAULT_LOCATION=eastus

# =============================================================================
# GOOGLE CLOUD KMS CONFIGURATION
# FIPS 140-2 Level 3 Compliance  
# =============================================================================

# Google Cloud Project Configuration
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_CLOUD_KMS_LOCATION=global
GOOGLE_CLOUD_KMS_KEY_RING_ID=wallet-keys

# Protection Level: SOFTWARE or HSM
GOOGLE_CLOUD_KMS_PROTECTION_LEVEL=HSM

# Google Cloud Credentials
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# Optional: Additional Google Cloud Configuration
GOOGLE_CLOUD_KMS_REGION=us-central1
GOOGLE_CLOUD_KMS_ZONE=us-central1-a

# =============================================================================
# HSM OPERATION CONFIGURATION
# =============================================================================

# Operation Timeouts (milliseconds)
HSM_OPERATION_TIMEOUT=30000
HSM_CONNECTION_TIMEOUT=10000
HSM_RETRY_ATTEMPTS=3

# Security Configuration  
HSM_ENABLE_FALLBACK=true
HSM_AUDIT_LOGGING=true
HSM_COMPLIANCE_LEVEL=3

# Key Generation Settings
HSM_DEFAULT_KEY_TYPE=secp256k1
HSM_KEY_SIZE=256
HSM_KEY_USAGE=SIGN_VERIFY

# =============================================================================
# DEVELOPMENT CONFIGURATION
# Memory-based operations for development/testing
# =============================================================================

# Development Mode Settings (when HSM_PROVIDER=memory)
DEV_KEY_GENERATION_ENTROPY=high
DEV_ENCRYPTION_STRENGTH=256
DEV_ENABLE_KEY_ROTATION=true

# =============================================================================
# MONITORING AND ALERTING
# =============================================================================

# HSM Health Check Configuration
HSM_HEALTH_CHECK_INTERVAL=300000
HSM_HEALTH_CHECK_TIMEOUT=10000
HSM_METRICS_COLLECTION=true

# Alert Thresholds
HSM_LATENCY_ALERT_THRESHOLD=5000
HSM_ERROR_RATE_ALERT_THRESHOLD=0.01
HSM_AVAILABILITY_ALERT_THRESHOLD=0.999

# =============================================================================
# COMPLIANCE AND AUDIT
# =============================================================================

# Audit Configuration
AUDIT_LOG_LEVEL=info
AUDIT_LOG_HSM_OPERATIONS=true
AUDIT_LOG_KEY_OPERATIONS=true
AUDIT_LOG_COMPLIANCE_EVENTS=true

# Compliance Reporting
COMPLIANCE_REPORTING_ENABLED=true
COMPLIANCE_FIPS_140_2_REQUIRED=true
COMPLIANCE_COMMON_CRITERIA_LEVEL=EAL4+

# Data Retention
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years for financial compliance
HSM_KEY_ROTATION_DAYS=90
HSM_BACKUP_RETENTION_DAYS=2555

# =============================================================================
# COST OPTIMIZATION
# =============================================================================

# Development/Staging Cost Optimization
STAGING_USE_HSM=false
DEVELOPMENT_USE_HSM=false
TEST_USE_HSM=false

# Production HSM Usage
PRODUCTION_USE_HSM=true
PRODUCTION_HSM_PROVIDER=aws-cloudhsm

# =============================================================================
# INTEGRATION CONFIGURATION
# =============================================================================

# Database Integration
HSM_METADATA_STORAGE=enabled
HSM_KEY_METADATA_ENCRYPTION=true

# Wallet Service Integration
WALLET_DEFAULT_HSM_ENABLED=true
WALLET_HSM_FALLBACK_ENABLED=true
WALLET_HSM_MIGRATION_ENABLED=true

# =============================================================================
# EXAMPLE CONFIGURATIONS BY ENVIRONMENT
# =============================================================================

# DEVELOPMENT ENVIRONMENT
# HSM_PROVIDER=memory
# NODE_ENV=development
# WALLET_DEFAULT_HSM_ENABLED=false

# STAGING ENVIRONMENT  
# HSM_PROVIDER=azure-keyvault
# AZURE_KEY_VAULT_URL=https://staging-vault.vault.azure.net/
# AZURE_USE_MANAGED_IDENTITY=true
# NODE_ENV=staging

# PRODUCTION ENVIRONMENT
# HSM_PROVIDER=aws-cloudhsm
# AWS_CLOUDHSM_CLUSTER_ENDPOINT=cluster-prod.cloudhsm.us-east-1.amazonaws.com
# HSM_ENABLE_FALLBACK=false
# NODE_ENV=production

# =============================================================================
# SECURITY NOTES
# =============================================================================

# IMPORTANT SECURITY CONSIDERATIONS:
#
# 1. NEVER commit real credentials to version control
# 2. Use environment-specific .env files (.env.development, .env.production)
# 3. Rotate HSM credentials regularly (90 days recommended)
# 4. Monitor HSM operations for suspicious activity
# 5. Test HSM failover procedures regularly
# 6. Implement proper backup and recovery procedures
# 7. Ensure compliance with relevant regulations (SOX, PCI DSS, etc.)
#
# HSM PROVIDER SELECTION GUIDE:
#
# - AWS CloudHSM: Best for AWS-native deployments, highest security (Level 3)
# - Azure Key Vault: Best for Azure deployments, good balance of cost/security
# - Google Cloud KMS: Best for Google Cloud deployments, good integration
# - Memory: Development only, not suitable for production
#
# COST CONSIDERATIONS:
#
# - AWS CloudHSM: ~$1,800/month + operations
# - Azure Key Vault HSM: ~$1,000/month + operations  
# - Google Cloud KMS: ~$1-6/key/month + operations
# - Memory: $0 (development only)

# =============================================================================
# END OF HSM CONFIGURATION
# =============================================================================
