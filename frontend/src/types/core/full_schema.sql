--
-- PostgreSQL database dump
--

-- Dumped from database version 15.8
-- Dumped by pg_dump version 15.13 (Homebrew)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: public; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA public;


--
-- Name: SCHEMA public; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON SCHEMA public IS 'Enhanced DFNS RAMP Network Integration - Schema updated on June 11, 2025';


--
-- Name: LimitType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."LimitType" AS ENUM (
    'POSITION_SIZE',
    'DAILY_LOSS',
    'VAR_LIMIT',
    'CONCENTRATION',
    'LEVERAGE'
);


--
-- Name: OrderType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."OrderType" AS ENUM (
    'MARKET',
    'LIMIT',
    'STOP',
    'STOP_LIMIT'
);


--
-- Name: TradeSide; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."TradeSide" AS ENUM (
    'BUY',
    'SELL'
);


--
-- Name: TradeStatus; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."TradeStatus" AS ENUM (
    'PENDING',
    'PARTIALLY_FILLED',
    'FILLED',
    'CANCELLED',
    'REJECTED',
    'SETTLED'
);


--
-- Name: UserRole; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."UserRole" AS ENUM (
    'ADMIN',
    'TRADER',
    'RISK_MANAGER',
    'COMPLIANCE',
    'SETTLEMENT'
);


--
-- Name: compliance_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.compliance_status AS ENUM (
    'compliant',
    'non_compliant',
    'pending_review'
);


--
-- Name: document_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.document_status AS ENUM (
    'pending',
    'approved',
    'rejected',
    'expired',
    'active',
    'pending_review'
);


--
-- Name: document_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.document_type AS ENUM (
    'commercial_register',
    'certificate_incorporation',
    'memorandum_articles',
    'director_list',
    'shareholder_register',
    'financial_statements',
    'regulatory_status',
    'qualification_summary',
    'business_description',
    'organizational_chart',
    'key_people_cv',
    'aml_kyc_description',
    'passport',
    'drivers_license',
    'national_id',
    'utility_bill',
    'bank_statement',
    'proof_of_income',
    'proof_of_address',
    'employment_letter',
    'tax_return',
    'social_security'
);


--
-- Name: TYPE document_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TYPE public.document_type IS 'Document types supporting both business/organizational documents and personal identity verification documents';


--
-- Name: execution_mode; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.execution_mode AS ENUM (
    'automatic',
    'manual',
    'batched'
);


--
-- Name: individual_document_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.individual_document_type AS ENUM (
    'passport',
    'drivers_license',
    'national_id',
    'state_id',
    'voter_id',
    'proof_of_address',
    'utility_bill',
    'bank_statement',
    'lease_agreement',
    'mortgage_statement',
    'phone_bill',
    'internet_bill',
    'insurance_statement',
    'investment_agreement',
    'accreditation_letter',
    'tax_document',
    'w2_form',
    'tax_return',
    'income_statement',
    'employment_letter',
    'pay_stub',
    'financial_statement',
    'power_of_attorney',
    'trust_document',
    'beneficial_ownership',
    'source_of_funds',
    'source_of_wealth',
    'articles_of_incorporation',
    'bylaws',
    'operating_agreement',
    'certificate_of_good_standing',
    'tax_exemption_letter',
    'audit_report',
    'board_resolution',
    'legal_opinion',
    'prospectus',
    'offering_memorandum',
    'regulatory_filing',
    'compliance_certificate',
    'other'
);


--
-- Name: TYPE individual_document_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TYPE public.individual_document_type IS 'Document types for individual/personal KYC and AML verification';


--
-- Name: issuer_document_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.issuer_document_type AS ENUM (
    'issuer_creditworthiness',
    'project_security_type',
    'offering_details',
    'term_sheet',
    'special_rights',
    'underwriters',
    'use_of_proceeds',
    'financial_highlights',
    'timing',
    'risk_factors'
);


--
-- Name: issuer_role; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.issuer_role AS ENUM (
    'admin',
    'editor',
    'viewer',
    'compliance_officer'
);


--
-- Name: kyc_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.kyc_status AS ENUM (
    'approved',
    'pending',
    'failed',
    'not_started',
    'expired'
);


--
-- Name: pool_type_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.pool_type_enum AS ENUM (
    'Total Pool',
    'Tranche'
);


--
-- Name: processing_date_mode_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.processing_date_mode_enum AS ENUM (
    'fixed',
    'same_day',
    'offset'
);


--
-- Name: product_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.product_status AS ENUM (
    'Active',
    'Called',
    'Matured',
    'Redeemed',
    'Expired',
    'Suspended',
    'Delisted',
    'Open',
    'Closed'
);


--
-- Name: profile_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.profile_type AS ENUM (
    'service provider',
    'issuer',
    'investor',
    'super admin'
);


--
-- Name: project_duration; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.project_duration AS ENUM (
    '1m',
    '3m',
    '6m',
    '9m',
    '12m',
    '1y',
    '2y',
    '3y',
    '5y',
    '10y',
    '20y',
    '30y'
);


--
-- Name: stablecoin_collateral_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.stablecoin_collateral_type AS ENUM (
    'Fiat',
    'Crypto',
    'Commodity',
    'Algorithmic',
    'Hybrid',
    'None'
);


--
-- Name: submission_date_mode_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.submission_date_mode_enum AS ENUM (
    'fixed',
    'relative'
);


--
-- Name: token_config_mode_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.token_config_mode_enum AS ENUM (
    'min',
    'max',
    'basic',
    'advanced'
);


--
-- Name: token_standard_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.token_standard_enum AS ENUM (
    'ERC-20',
    'ERC-721',
    'ERC-1155',
    'ERC-1400',
    'ERC-3525',
    'ERC-4626'
);


--
-- Name: token_status_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.token_status_enum AS ENUM (
    'DRAFT',
    'UNDER REVIEW',
    'APPROVED',
    'READY TO MINT',
    'MINTED',
    'DEPLOYED',
    'PAUSED',
    'DISTRIBUTED',
    'REJECTED'
);


--
-- Name: workflow_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.workflow_status AS ENUM (
    'pending',
    'completed',
    'rejected'
);


--
-- Name: add_investors_to_group(text, text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_investors_to_group(p_group_id text, p_investor_ids text[]) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  sync_timestamp timestamp with time zone := NOW();
  v_investor_id text;
BEGIN
  -- Validate input
  IF p_group_id IS NULL THEN
    RAISE EXCEPTION 'Group ID cannot be NULL';
  END IF;

  IF p_investor_ids IS NULL OR array_length(p_investor_ids, 1) IS NULL THEN
    RAISE EXCEPTION 'Investor IDs array cannot be NULL or empty';
  END IF;

  -- Add to the investor_group_members table (old)
  FOREACH v_investor_id IN ARRAY p_investor_ids
  LOOP
    INSERT INTO investor_group_members (group_id, investor_id, created_at)
    VALUES (p_group_id, v_investor_id, sync_timestamp)
    ON CONFLICT (group_id, investor_id) DO NOTHING;
  END LOOP;

  -- Try to add to investor_groups_investors table (new)
  -- This might fail due to RLS but we'll continue anyway
  BEGIN
    FOREACH v_investor_id IN ARRAY p_investor_ids
    LOOP
      INSERT INTO investor_groups_investors (id, group_id, investor_id, created_at)
      VALUES (gen_random_uuid()::text, p_group_id, v_investor_id, sync_timestamp)
      ON CONFLICT (group_id, investor_id) DO NOTHING;
    END LOOP;
  EXCEPTION WHEN OTHERS THEN
    -- Log the error but continue - we at least added to the old table
    RAISE NOTICE 'Error adding to investor_groups_investors: %', SQLERRM;
  END;

  -- Update the group member count
  UPDATE investor_groups
  SET 
    member_count = (SELECT get_unique_member_count(p_group_id)),
    updated_at = sync_timestamp
  WHERE id::text = p_group_id;
END;
$$;


--
-- Name: add_policy_approver(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  INSERT INTO policy_rule_approvers (policy_rule_id, user_id, created_by, status)
  VALUES (p_policy_id, p_user_id::UUID, p_created_by, 'pending')
  ON CONFLICT (policy_rule_id, user_id) 
  DO UPDATE SET status = 'pending', timestamp = now();
END;
$$;


--
-- Name: add_policy_approver(text, text, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_policy_approver(policy_id text, user_id text, created_by text, status_val text DEFAULT 'pending'::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    INSERT INTO policy_rule_approvers (
        policy_rule_id,
        user_id,
        created_by,
        status,
        created_at
    ) VALUES (
        safe_uuid_cast(policy_id),
        safe_uuid_cast(user_id),
        safe_uuid_cast(created_by),
        status_val,
        now()
    );
    RETURN;
EXCEPTION WHEN others THEN
    RAISE EXCEPTION 'Failed to add policy approver: %', SQLERRM;
END;
$$;


--
-- Name: add_policy_approver_with_cast(text, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  -- Insert with explicit casting to UUID type
  INSERT INTO policy_rule_approvers (policy_rule_id, user_id, created_by, status)
  VALUES (
    safe_cast_to_uuid(policy_id), 
    safe_cast_to_uuid(user_id), 
    safe_cast_to_uuid(created_by_id),
    'pending'
  )
  ON CONFLICT (policy_rule_id, user_id)
  DO UPDATE SET status = 'pending', timestamp = now();
  
  RETURN true;
EXCEPTION WHEN OTHERS THEN
  RAISE NOTICE 'Error in add_policy_approver_with_cast: %', SQLERRM;
  RETURN false;
END;
$$;


--
-- Name: add_rule_to_approval_queue(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_rule_to_approval_queue() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    approver_id uuid;
BEGIN
    -- When a rule is created or updated
    IF (TG_OP = 'INSERT' OR (TG_OP = 'UPDATE' AND (OLD.status != 'pending_approval' OR OLD.status IS NULL))) THEN
        -- Get approvers from rule_details
        IF NEW.rule_details->'approvers' IS NOT NULL AND jsonb_array_length(NEW.rule_details->'approvers') > 0 THEN
            -- Set status to pending_approval
            NEW.status := 'pending_approval';
            
            -- For each approver, add to policy_rule_approvers
            FOR approver_id IN 
                SELECT (jsonb_array_elements(NEW.rule_details->'approvers')->>'id')::uuid
            LOOP
                INSERT INTO public.policy_rule_approvers
                    (policy_rule_id, user_id, created_by, status)
                VALUES
                    (NEW.rule_id, 
                     approver_id, 
                     NEW.created_by,  -- Now created_by is already UUID
                     'pending')
                ON CONFLICT (policy_rule_id, user_id) 
                DO UPDATE SET status = 'pending', timestamp = now();
            END LOOP;
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: add_table_to_realtime(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_table_to_realtime(table_name text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- This function is just a placeholder
  -- The actual ALTER PUBLICATION is done in the migration
  RETURN;
END;
$$;


--
-- Name: add_template_to_approval_queue(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_template_to_approval_queue() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    approver_id uuid;
BEGIN
    -- When a template is created or updated
    IF (TG_OP = 'INSERT' OR (TG_OP = 'UPDATE' AND (OLD.status != 'pending_approval' OR OLD.status IS NULL))) THEN
        -- Get approvers from template_data
        IF NEW.template_data->'approvers' IS NOT NULL AND jsonb_array_length(NEW.template_data->'approvers') > 0 THEN
            -- Set status to pending_approval
            NEW.status := 'pending_approval';
            
            -- For each approver, add to policy_template_approvers
            FOR approver_id IN 
                SELECT (jsonb_array_elements(NEW.template_data->'approvers')->>'id')::uuid
            LOOP
                INSERT INTO public.policy_template_approvers
                    (template_id, user_id, created_by, status)
                VALUES
                    (NEW.template_id, 
                     approver_id, 
                     (CASE 
                         WHEN NEW.created_by::text = 'admin-bypass' 
                         THEN 'f3aa3707-c54e-428d-b630-e15088d7b55d'
                         ELSE NEW.created_by::text
                     END)::uuid,
                     'pending')
                ON CONFLICT (template_id, user_id) 
                DO UPDATE SET status = 'pending', timestamp = now();
            END LOOP;
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: address_has_contract_role(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.address_has_contract_role(p_address_id uuid, p_contract_role text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_roles JSONB;
BEGIN
  v_roles := get_contract_roles_for_address(p_address_id);
  RETURN v_roles @> jsonb_build_array(p_contract_role);
END;
$$;


--
-- Name: admin_set_profile_type(uuid, public.profile_type); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.admin_set_profile_type(user_auth_id uuid, new_profile_type public.profile_type) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  UPDATE public.profiles
  SET 
    profile_type = new_profile_type,
    updated_at = NOW()
  WHERE id = user_auth_id;
  
  IF NOT FOUND THEN
    RAISE EXCEPTION 'User with auth ID % not found', user_auth_id;
  END IF;
END;
$$;


--
-- Name: analyze_activity_indexes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.analyze_activity_indexes() RETURNS TABLE(index_name text, scans bigint, usage text)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    indexrelname::TEXT,  -- Index name
    idx_scan,           -- Scan count
    CASE 
      WHEN idx_scan = 0 THEN 'UNUSED'
      WHEN idx_scan < 100 THEN 'LOW'
      WHEN idx_scan < 1000 THEN 'MEDIUM'
      ELSE 'HIGH'
    END::TEXT
  FROM pg_stat_user_indexes 
  WHERE relname = 'audit_logs'  -- FIXED: Use relname instead of tablename
  ORDER BY idx_scan DESC;
END;
$$;


--
-- Name: analyze_table_for_audit(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.analyze_table_for_audit(table_name_param text) RETURNS TABLE(table_name text, has_created_at boolean, has_updated_at boolean, has_user_id boolean, has_project_id boolean, has_id boolean, column_count integer, estimated_audit_entries integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    col_exists_created boolean := false;
    col_exists_updated boolean := false;
    col_exists_user boolean := false;
    col_exists_project boolean := false;
    col_exists_id boolean := false;
    col_count integer := 0;
    row_count bigint := 0;
    update_estimate integer := 0;
BEGIN
    -- Check for required columns
    SELECT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_schema = 'public' 
        AND table_name = table_name_param 
        AND column_name = 'created_at'
    ) INTO col_exists_created;
    
    SELECT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_schema = 'public' 
        AND table_name = table_name_param 
        AND column_name = 'updated_at'
    ) INTO col_exists_updated;
    
    SELECT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_schema = 'public' 
        AND table_name = table_name_param 
        AND column_name = 'user_id'
    ) INTO col_exists_user;
    
    SELECT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_schema = 'public' 
        AND table_name = table_name_param 
        AND column_name = 'project_id'
    ) INTO col_exists_project;
    
    SELECT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_schema = 'public' 
        AND table_name = table_name_param 
        AND column_name = 'id'
    ) INTO col_exists_id;
    
    -- Get column count
    SELECT COUNT(*) INTO col_count
    FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = table_name_param;
    
    -- Get row count and estimate audit entries
    EXECUTE format('SELECT COUNT(*) FROM %I', table_name_param) INTO row_count;
    
    -- Estimate audit entries (1 for create + 30% for updates)
    estimated_audit_entries := row_count;
    IF col_exists_updated THEN
        estimated_audit_entries := row_count + (row_count * 0.3)::integer;
    END IF;
    
    -- Return results
    table_name := table_name_param;
    has_created_at := col_exists_created;
    has_updated_at := col_exists_updated;
    has_user_id := col_exists_user;
    has_project_id := col_exists_project;
    has_id := col_exists_id;
    column_count := col_count;
    
    RETURN NEXT;
END;
$$;


--
-- Name: apply_audit_trigger_to_table(text); Type: PROCEDURE; Schema: public; Owner: -
--

CREATE PROCEDURE public.apply_audit_trigger_to_table(IN table_name text)
    LANGUAGE plpgsql
    AS $$
BEGIN
  EXECUTE format('
    DROP TRIGGER IF EXISTS %I_audit_trigger ON %I;
    CREATE TRIGGER %I_audit_trigger
    AFTER INSERT OR UPDATE OR DELETE ON %I
    FOR EACH ROW EXECUTE FUNCTION log_database_changes();
  ', table_name, table_name, table_name, table_name);
END;
$$;


--
-- Name: archive_old_moonpay_compliance_alerts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.archive_old_moonpay_compliance_alerts() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    archived_count INTEGER;
BEGIN
    -- This could move old alerts to an archive table or mark them as archived
    UPDATE moonpay_compliance_alerts 
    SET metadata = jsonb_set(
        COALESCE(metadata, '{}'::jsonb),
        '{archived}',
        'true'::jsonb
    )
    WHERE status = 'resolved' 
    AND resolved_at < NOW() - INTERVAL '1 year'
    AND NOT COALESCE((metadata->>'archived')::boolean, false);
    
    GET DIAGNOSTICS archived_count = ROW_COUNT;
    RETURN archived_count;
END;
$$;


--
-- Name: assign_redemption_approvers(uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    approver_record RECORD;
    user_record RECORD;
BEGIN
    -- Clear any existing assignments for this redemption request
    DELETE FROM redemption_approver_assignments 
    WHERE redemption_request_id = p_redemption_request_id;
    
    -- Insert approver assignments based on approval config
    FOR approver_record IN 
        SELECT * FROM approval_config_approvers 
        WHERE approval_config_id = p_approval_config_id
    LOOP
        IF approver_record.approver_type = 'user' THEN
            -- Direct user assignment
            INSERT INTO redemption_approver_assignments (
                redemption_request_id,
                approval_config_id,
                approver_user_id
            ) VALUES (
                p_redemption_request_id,
                p_approval_config_id,
                approver_record.approver_user_id
            );
        ELSIF approver_record.approver_type = 'role' THEN
            -- Assign all users with this role
            FOR user_record IN
                SELECT u.id
                FROM users u
                JOIN user_roles ur ON u.id = ur.user_id
                WHERE ur.role_id = approver_record.approver_role_id
                  AND u.status IS DISTINCT FROM 'inactive'
            LOOP
                INSERT INTO redemption_approver_assignments (
                    redemption_request_id,
                    approval_config_id,
                    approver_user_id
                ) VALUES (
                    p_redemption_request_id,
                    p_approval_config_id,
                    user_record.id
                ) ON CONFLICT (redemption_request_id, approver_user_id) DO NOTHING;
            END LOOP;
        END IF;
    END LOOP;
    
    RETURN TRUE;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'Error assigning redemption approvers: %', SQLERRM;
        RETURN FALSE;
END;
$$;


--
-- Name: audit_investor_approval_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.audit_investor_approval_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF (TG_OP = 'UPDATE' AND NEW.status != OLD.status) THEN
        INSERT INTO audit_logs (
            entity_id,
            entity_type,
            action,
            user_id,
            details,
            status,
            created_at
        ) VALUES (
            NEW.id,
            'investor_approval',
            'status_change',
            auth.uid(),
            jsonb_build_object(
                'old_status', OLD.status,
                'new_status', NEW.status,
                'investor_id', NEW.investor_id,
                'approval_type', NEW.approval_type
            ),
            'success',
            now()
        );
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: backup_trigger_definitions(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.backup_trigger_definitions() RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Create backup table for trigger definitions
  CREATE TABLE IF NOT EXISTS trigger_backup_pre_migration AS
  SELECT 
    trigger_name,
    event_object_table,
    event_manipulation,
    action_statement,
    now() as backup_date
  FROM information_schema.triggers 
  WHERE event_object_schema = 'public'
    AND (trigger_name LIKE '%audit%' 
         OR trigger_name LIKE '%log%' 
         OR action_statement LIKE '%log_%'
         OR action_statement LIKE '%audit%');
         
  RAISE NOTICE 'Trigger definitions backed up to trigger_backup_pre_migration table';
END;
$$;


--
-- Name: begin_transaction(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.begin_transaction() RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- PostgreSQL transactions are automatically started with each connection
    -- This function validates we're in a valid state to begin operations
    RETURN true;
EXCEPTION
    WHEN OTHERS THEN
        RETURN false;
END;
$$;


--
-- Name: calculate_batch_climate_risk(uuid[], jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb DEFAULT '{}'::jsonb) RETURNS TABLE(receivable_id uuid, risk_score integer, discount_rate numeric, status text, error_message text)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  rec_id UUID;
  calc_result RECORD;
  payer_data RECORD;
  asset_data RECORD;
  composite_risk NUMERIC;
  calculated_discount NUMERIC;
  current_timestamp TIMESTAMPTZ := NOW();
BEGIN
  -- Process each receivable in the batch
  FOREACH rec_id IN ARRAY p_receivable_ids
  LOOP
    BEGIN
      -- Get receivable with payer and asset data
      SELECT 
        r.receivable_id,
        r.amount,
        r.due_date,
        p.credit_rating,
        p.financial_health_score,
        p.payment_history,
        COALESCE(a.capacity_mw, 0) as asset_capacity
      INTO calc_result
      FROM climate_receivables r
      LEFT JOIN climate_payers p ON r.payer_id = p.payer_id
      LEFT JOIN energy_assets a ON r.asset_id = a.id
      WHERE r.receivable_id = rec_id;

      IF NOT FOUND THEN
        -- Return error for missing receivable
        SELECT rec_id, NULL, NULL, 'error', 'Receivable not found';
        CONTINUE;
      END IF;

      -- Calculate composite risk score (simplified business logic)
      composite_risk := 
        CASE 
          WHEN calc_result.credit_rating IN ('AAA', 'AA') THEN 15
          WHEN calc_result.credit_rating IN ('A', 'BBB') THEN 35
          WHEN calc_result.credit_rating IN ('BB', 'B') THEN 60
          ELSE 85
        END +
        CASE 
          WHEN calc_result.financial_health_score >= 80 THEN -10
          WHEN calc_result.financial_health_score >= 60 THEN 0
          ELSE 15
        END;

      -- Cap risk score between 5 and 95
      composite_risk := GREATEST(5, LEAST(composite_risk, 95));

      -- Calculate discount rate based on risk
      calculated_discount := 2.0 + (composite_risk / 100.0) * 6.0;

      -- Insert or update risk calculation
      INSERT INTO climate_risk_calculations (
        receivable_id,
        calculated_at,
        production_risk_score,
        production_risk_factors,
        production_risk_confidence,
        credit_risk_score,
        credit_risk_factors,
        credit_risk_confidence,
        policy_risk_score,
        policy_risk_factors,
        policy_risk_confidence,
        composite_risk_score,
        composite_risk_level,
        composite_risk_confidence,
        discount_rate_calculated,
        recommendations,
        alerts,
        next_review_date,
        project_id
      ) VALUES (
        rec_id,
        current_timestamp,
        25.0, -- Placeholder production risk
        ARRAY['asset_capacity', 'seasonal_variation'],
        85.0,
        composite_risk * 0.6, -- Credit component
        ARRAY['credit_rating', 'financial_health'],
        90.0,
        composite_risk * 0.2, -- Policy component  
        ARRAY['regulatory_environment'],
        70.0,
        composite_risk,
        CASE 
          WHEN composite_risk <= 20 THEN 'Low'
          WHEN composite_risk <= 40 THEN 'Medium'
          WHEN composite_risk <= 60 THEN 'High'
          ELSE 'Very High'
        END,
        85.0,
        calculated_discount,
        ARRAY['Monitor credit rating changes', 'Review quarterly'],
        '[]'::jsonb,
        current_timestamp + INTERVAL '90 days',
        calc_result.project_id
      )
      ON CONFLICT (receivable_id) DO UPDATE SET
        calculated_at = EXCLUDED.calculated_at,
        composite_risk_score = EXCLUDED.composite_risk_score,
        composite_risk_level = EXCLUDED.composite_risk_level,
        discount_rate_calculated = EXCLUDED.discount_rate_calculated,
        updated_at = current_timestamp;

      -- Update the receivable with calculated values
      UPDATE climate_receivables 
      SET 
        risk_score = composite_risk::INTEGER,
        discount_rate = calculated_discount,
        updated_at = current_timestamp
      WHERE receivable_id = rec_id;

      -- Return success result
      SELECT rec_id, composite_risk::INTEGER, calculated_discount, 'success', NULL;

    EXCEPTION
      WHEN OTHERS THEN
        -- Return error result but continue with batch
        SELECT rec_id, NULL, NULL, 'error', SQLERRM;
        CONTINUE;
    END;
  END LOOP;

  RETURN;
END;
$$;


--
-- Name: calculate_daily_compliance_metrics(date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_daily_compliance_metrics(target_date date) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_total INTEGER;
    v_compliant INTEGER;
    v_partial INTEGER;
    v_noncompliant INTEGER;
    v_violations INTEGER;
    v_reports INTEGER;
    v_avg_score NUMERIC;
BEGIN
    -- Calculate metrics for the specified date
    SELECT 
        COUNT(*),
        COUNT(*) FILTER (WHERE (compliance_status->>'level') = 'full'),
        COUNT(*) FILTER (WHERE (compliance_status->>'level') = 'partial'),
        COUNT(*) FILTER (WHERE (compliance_status->>'level') = 'non-compliant')
    INTO v_total, v_compliant, v_partial, v_noncompliant
    FROM compliance_audit_logs
    WHERE DATE(created_at) = target_date;
    
    -- Count violations
    SELECT COUNT(*)
    INTO v_violations
    FROM compliance_violations
    WHERE DATE(created_at) = target_date;
    
    -- Count reports
    SELECT COUNT(*)
    INTO v_reports
    FROM compliance_reports
    WHERE DATE(created_at) = target_date;
    
    -- Calculate average compliance score
    SELECT AVG((compliance_status->>'score')::NUMERIC)
    INTO v_avg_score
    FROM compliance_audit_logs
    WHERE DATE(created_at) = target_date
      AND compliance_status->>'score' IS NOT NULL;
    
    -- Insert or update metrics
    INSERT INTO compliance_metrics (
        metric_date,
        total_operations,
        compliant_operations,
        partial_compliance,
        non_compliant,
        violations_count,
        reports_generated,
        avg_compliance_score
    ) VALUES (
        target_date,
        v_total,
        v_compliant,
        v_partial,
        v_noncompliant,
        v_violations,
        v_reports,
        v_avg_score
    )
    ON CONFLICT (metric_date) DO UPDATE SET
        total_operations = EXCLUDED.total_operations,
        compliant_operations = EXCLUDED.compliant_operations,
        partial_compliance = EXCLUDED.partial_compliance,
        non_compliant = EXCLUDED.non_compliant,
        violations_count = EXCLUDED.violations_count,
        reports_generated = EXCLUDED.reports_generated,
        avg_compliance_score = EXCLUDED.avg_compliance_score,
        created_at = NOW();
END;
$$;


--
-- Name: calculate_daily_nav(uuid, date); Type: PROCEDURE; Schema: public; Owner: -
--

CREATE PROCEDURE public.calculate_daily_nav(IN p_project_id uuid, IN p_date date)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_product RECORD; -- Dynamic per type
  v_nav NUMERIC(18,6); -- Computed NAV
  v_total_assets NUMERIC(78,18); -- Summed assets
  v_asset_name TEXT; -- Name from product table
  v_total_liabilities NUMERIC(78,18) := 0; -- Example: defaults to 0; compute as needed
  v_outstanding_shares NUMERIC(78,18); -- From token views or product
BEGIN
  -- Loop over products for project (union across all product tables for comprehensive coverage)
  FOR v_product IN 
    SELECT id, 'asset_backed' AS type FROM asset_backed_products WHERE project_id = p_project_id
    UNION SELECT id, 'bond' AS type FROM bond_products WHERE project_id = p_project_id
    UNION SELECT id, 'collectible' AS type FROM collectibles_products WHERE project_id = p_project_id
    UNION SELECT id, 'commodity' AS type FROM commodities_products WHERE project_id = p_project_id
    UNION SELECT id, 'climate_receivable' AS type FROM climate_receivables WHERE project_id = p_project_id
    UNION SELECT id, 'digital_fund' AS type FROM digital_tokenised_fund_products WHERE project_id = p_project_id
    UNION SELECT id, 'energy' AS type FROM energy_assets WHERE project_id = p_project_id
    UNION SELECT id, 'equity' AS type FROM equity_products WHERE project_id = p_project_id
    UNION SELECT id, 'fund' AS type FROM funds_products WHERE project_id = p_project_id
    UNION SELECT id, 'infrastructure' AS type FROM infrastructure_products WHERE project_id = p_project_id
    UNION SELECT id, 'private_debt' AS type FROM private_debt_products WHERE project_id = p_project_id
    UNION SELECT id, 'private_equity' AS type FROM private_equity_products WHERE project_id = p_project_id
    UNION SELECT id, 'real_estate' AS type FROM real_estate_products WHERE project_id = p_project_id
    UNION SELECT id, 'structured' AS type FROM structured_products WHERE project_id = p_project_id
    -- Add stablecoin subtypes if separate tables exist; otherwise handle via digital_fund or JSON
    UNION SELECT id, 'stablecoin_fiat' AS type FROM stablecoin_products WHERE project_id = p_project_id AND collateral_type = 'Fiat'
    UNION SELECT id, 'stablecoin_crypto' AS type FROM stablecoin_products WHERE project_id = p_project_id AND collateral_type = 'Crypto'
    UNION SELECT id, 'stablecoin_commodity' AS type FROM stablecoin_products WHERE project_id = p_project_id AND collateral_type = 'Commodity'
    UNION SELECT id, 'stablecoin_algorithmic' AS type FROM stablecoin_products WHERE project_id = p_project_id AND collateral_type = 'Algorithmic'
    UNION SELECT id, 'stablecoin_rebasing' AS type FROM stablecoin_products WHERE project_id = p_project_id AND collateral_type = 'Rebasing' -- Adjust if rebasing is a flag
  LOOP
    -- Compute values based on product type (specialist logic per type; examples based on schema fields/oracles with 2025-09-03 market data)
    CASE v_product.type
      WHEN 'asset_backed' THEN
        -- Specialist: Discounted cash flows, adjust for delinquency/recovery
        SELECT asset_type, current_balance, (current_balance * (1 + (interest_rate / 100)) * (recovery_rate_percentage / 100)), total_supply::NUMERIC(78,18)
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM asset_backed_products abp
        LEFT JOIN token_erc20_view tv ON abp.id::text = tv.token_id
        WHERE abp.id = v_product.id;
        -- Adjust for delinquency
        IF delinquency_status > 0 THEN v_total_assets := v_total_assets * (1 - (delinquency_status / 100)); END IF;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'bond' THEN
        -- Specialist: Mark-to-market with yield adjustment (using ~4.28% for corporate/10Y Treasury on 2025-09-03)
        SELECT issuer_name, face_value, (face_value * (1 + (yield_to_maturity / 100))), outstanding_supply::NUMERIC(78,18)
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM bond_products bp
        LEFT JOIN token_erc20_view tv ON bp.id::text = tv.token_id
        WHERE bp.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'collectible' THEN
        -- Specialist: Appraisal-based for uniques
        SELECT description, current_value, current_value, 1 -- Often 1 share
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM collectibles_products cp
        WHERE cp.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'commodity' THEN
        -- Specialist: Contract size with liquidity adjustment (e.g., gold ~3537 USD/oz, oil ~65 USD/bbl on 2025-09-03)
        SELECT commodity_name, (contract_size * liquidity_metric), (contract_size * liquidity_metric), total_supply::NUMERIC(78,18)
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM commodities_products cp
        LEFT JOIN token_erc20_view tv ON cp.id::text = tv.token_id
        WHERE cp.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'climate_receivable' THEN
        -- Specialist: Discounted green cash flows
        SELECT receivable_type, amount, (amount / (1 + (discount_rate / 100))), 1
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM climate_receivables cr
        WHERE cr.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'digital_fund' THEN
        -- Specialist: Mirror underlying with on-chain adjustments
        SELECT fund_name, total_value, total_value / outstanding_units, outstanding_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM digital_tokenised_fund_products dtf
        LEFT JOIN token_erc20_view tv ON dtf.id::text = tv.token_id
        WHERE dtf.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'energy' THEN
        -- Specialist: Capacity-based with market price (e.g., natural gas ~2.99 USD/MMBtu on 2025-09-03)
        SELECT asset_name, (capacity * production_rate * market_price), (capacity * production_rate * market_price), total_supply::NUMERIC(78,18)
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM energy_assets ea
        LEFT JOIN token_erc20_view tv ON ea.id::text = tv.token_id
        WHERE ea.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'equity' THEN
        -- Specialist: Market cap or multiples (e.g., S&P 500 ~6415 on 2025-09-03)
        SELECT company_name, (shares_outstanding * current_share_price), (shares_outstanding * current_share_price), shares_outstanding
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM equity_products ep
        WHERE ep.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'fund' THEN
        -- Specialist: Weighted holdings (e.g., MMFs with compliance; yields: Treasuries ~4.13-4.30%, Repos ~4.25%, Commercial Paper ~4.23%, CDs ~4.00-5.00%, Corporate ~4.28-6.00%, Municipal ~2.19-4.62% on 2025-09-03)
        SELECT fund_name, SUM(ah.value * (1 + (ah.oracle_price / 100))), SUM(ah.value * (1 + (ah.oracle_price / 100))) / total_units, total_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM funds_products fp
        LEFT JOIN asset_holdings ah ON fp.id = ah.asset_id
        LEFT JOIN token_erc20_view tv ON fp.id::text = tv.token_id
        WHERE fp.id = v_product.id AND (ah.maturity_date - p_date) <= 397 -- MMF maturity limit
        GROUP BY fp.fund_name, fp.total_units, tv.total_supply;
        -- Example MMF WAM check (simplified); raise error if >60
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares); -- Aim ~1.00

      WHEN 'infrastructure' THEN
        -- Specialist: Revenue projections with depreciation
        SELECT project_name, (project_value - depreciation_accumulated), (project_value - depreciation_accumulated), total_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM infrastructure_products ip
        WHERE ip.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'private_debt' THEN
        -- Specialist: Amortized + interest minus impairments
        SELECT debt_type, (principal_amount * (1 + (interest_rate / 100)) - impairment_amount), (principal_amount * (1 + (interest_rate / 100)) - impairment_amount), outstanding_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM private_debt_products pdp
        WHERE pdp.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'private_equity' THEN
        -- Specialist: Appraisal-based
        SELECT company_name, current_valuation, current_valuation / shares_outstanding, shares_outstanding
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM private_equity_products pep
        WHERE pep.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'real_estate' THEN
        -- Specialist: Cap rate on NOI (e.g., indices ~370.9 Dow Jones US Real Estate, +2.9% YoY house prices on 2025-09-03)
        SELECT property_name, (net_operating_income / cap_rate), (net_operating_income / cap_rate), total_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM real_estate_products rep
        WHERE rep.id = v_product.id;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'structured' THEN
        -- Specialist: Sum underlying with risk adjustments
        SELECT product_name, SUM(underlying_value) * (1 - risk_factor), SUM(underlying_value) * (1 - risk_factor), total_units
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM structured_products sp
        LEFT JOIN asset_holdings ah ON sp.id = ah.asset_id -- Assume holdings for underlyings
        WHERE sp.id = v_product.id
        GROUP BY sp.product_name, sp.total_units;
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      WHEN 'stablecoin_fiat' OR 'stablecoin_crypto' OR 'stablecoin_commodity' OR 'stablecoin_algorithmic' OR 'stablecoin_rebasing' THEN
        -- Specialist: Peg stability; over-collateral for crypto/commodity (USDT/USDC ~1.00 peg on 2025-09-03)
        SELECT stablecoin_name, collateral_value, 1.00, total_supply::NUMERIC(78,18) -- Aim for peg ~1.00
        INTO v_asset_name, v_total_assets, v_nav, v_outstanding_shares
        FROM stablecoin_products scp
        LEFT JOIN token_erc20_view tv ON scp.id::text = tv.token_id
        WHERE scp.id = v_product.id;
        -- For crypto: Ensure over-collateral (e.g., if collateral_value / total_supply < 1.5, flag)
        IF v_product.type = 'stablecoin_rebasing' THEN v_outstanding_shares := v_outstanding_shares * rebasing_factor; END IF; -- Rebase adjustment
        v_nav := COALESCE(v_nav, (v_total_assets - v_total_liabilities) / v_outstanding_shares);

      ELSE
        -- Default/fallback (aggregate from holdings if possible)
        v_asset_name := 'Unknown Asset';
        SELECT SUM(ah.value), COUNT(ah.id)
        INTO v_total_assets, v_outstanding_shares
        FROM asset_holdings ah
        WHERE ah.asset_id = v_product.id;
        v_outstanding_shares := GREATEST(v_outstanding_shares, 1); -- Avoid division by zero
        v_nav := (v_total_assets - v_total_liabilities) / v_outstanding_shares;
    END CASE;

    -- Insert with computed values
    INSERT INTO asset_nav_data (asset_id, project_id, date, nav, total_assets, asset_name, total_liabilities, outstanding_shares, source)
    VALUES (v_product.id, p_project_id, p_date, v_nav, v_total_assets, v_asset_name, v_total_liabilities, v_outstanding_shares, 'calculated')
    ON CONFLICT (asset_id, date) DO UPDATE SET 
      nav = EXCLUDED.nav, 
      total_assets = EXCLUDED.total_assets, 
      asset_name = EXCLUDED.asset_name, 
      total_liabilities = EXCLUDED.total_liabilities, 
      outstanding_shares = EXCLUDED.outstanding_shares,
      updated_at = NOW(); -- Update timestamp
  END LOOP;
END;
$$;


--
-- Name: calculate_nav_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_nav_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Retrieve the most recent previous NAV for the same asset before the current date
  SELECT nav INTO NEW.previous_nav
  FROM public.asset_nav_data
  WHERE asset_id = NEW.asset_id
    AND date < NEW.date
  ORDER BY date DESC
  LIMIT 1;

  -- Calculate changes if a previous NAV exists
  IF NEW.previous_nav IS NOT NULL THEN
    NEW.change_amount := NEW.nav - NEW.previous_nav;
    IF NEW.previous_nav != 0 THEN
      NEW.change_percent := (NEW.change_amount / NEW.previous_nav) * 100;
    ELSE
      NEW.change_percent := NULL;
    END IF;
  ELSE
    NEW.change_amount := NULL;
    NEW.change_percent := NULL;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: calculate_portfolio_climate_valuation(uuid[], text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text DEFAULT 'comprehensive'::text) RETURNS TABLE(portfolio_summary jsonb, individual_valuations jsonb[])
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  rec_id UUID;
  valuation_result JSONB;
  all_valuations JSONB[] := '{}';
  total_recommended_value NUMERIC := 0;
  total_risk_adjusted_value NUMERIC := 0;
  total_receivables INTEGER := 0;
  avg_risk_score NUMERIC := 0;
  portfolio_confidence NUMERIC := 0;
BEGIN
  -- Calculate valuation for each receivable
  FOREACH rec_id IN ARRAY p_receivable_ids
  LOOP
    BEGIN
      WITH receivable_data AS (
        SELECT 
          r.receivable_id,
          r.amount,
          r.due_date,
          r.risk_score,
          r.discount_rate,
          rc.composite_risk_score,
          rc.composite_risk_confidence
        FROM climate_receivables r
        LEFT JOIN climate_risk_calculations rc ON r.receivable_id = rc.receivable_id
        WHERE r.receivable_id = rec_id
      ),
      valuation_calc AS (
        SELECT 
          receivable_id,
          amount,
          risk_score,
          discount_rate,
          -- Risk-adjusted value calculation
          amount * (100 - COALESCE(risk_score, 50)) / 100.0 as risk_adjusted_value,
          -- NPV calculation  
          amount / POWER(1 + COALESCE(discount_rate, 5.0) / 100.0, 
                        EXTRACT(DAYS FROM due_date - CURRENT_DATE) / 365.0) as npv_value,
          COALESCE(composite_risk_confidence, 75.0) as confidence_level
        FROM receivable_data
      )
      SELECT jsonb_build_object(
        'receivableId', receivable_id,
        'recommendedValue', LEAST(risk_adjusted_value, npv_value),
        'riskAdjustedValue', risk_adjusted_value,
        'cashFlowNPV', npv_value,
        'riskScore', COALESCE(risk_score, 50),
        'confidenceLevel', confidence_level,
        'methodology', 'Portfolio Risk-Adjusted NPV',
        'lastUpdated', NOW(),
        'factors', jsonb_build_object(
          'creditRisk', COALESCE(risk_score, 50) * 0.6,
          'marketRisk', COALESCE(risk_score, 50) * 0.3,
          'operationalRisk', COALESCE(risk_score, 50) * 0.1
        )
      ) INTO valuation_result
      FROM valuation_calc;

      -- Add to results array
      all_valuations := all_valuations || valuation_result;
      
      -- Update running totals
      total_recommended_value := total_recommended_value + (valuation_result->>'recommendedValue')::NUMERIC;
      total_risk_adjusted_value := total_risk_adjusted_value + (valuation_result->>'riskAdjustedValue')::NUMERIC;
      total_receivables := total_receivables + 1;
      avg_risk_score := avg_risk_score + (valuation_result->>'riskScore')::NUMERIC;
      portfolio_confidence := portfolio_confidence + (valuation_result->>'confidenceLevel')::NUMERIC;

    EXCEPTION
      WHEN OTHERS THEN
        -- Continue with other receivables even if one fails
        CONTINUE;
    END;
  END LOOP;

  -- Calculate portfolio averages
  IF total_receivables > 0 THEN
    avg_risk_score := avg_risk_score / total_receivables;
    portfolio_confidence := portfolio_confidence / total_receivables;
  END IF;

  -- Return portfolio summary and individual valuations
  SELECT 
    jsonb_build_object(
      'totalReceivables', total_receivables,
      'totalValue', total_recommended_value,
      'averageRiskScore', ROUND(avg_risk_score, 1),
      'portfolioConfidence', ROUND(portfolio_confidence, 1),
      'valuationDate', NOW(),
      'attribution', jsonb_build_object(
        'assetSelection', 0.02,
        'timing', -0.005,
        'totalAlpha', 0.015
      )
    ),
    all_valuations;

  RETURN;
END;
$$;


--
-- Name: calculate_project_weighted_nav(uuid, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) RETURNS numeric
    LANGUAGE plpgsql STABLE
    AS $$
DECLARE
    weighted_nav NUMERIC(18,6);
BEGIN
    SELECT 
        CASE 
            WHEN SUM(total_assets) = 0 THEN 0
            ELSE SUM(nav * total_assets) / SUM(total_assets)
        END
    INTO weighted_nav
    FROM asset_nav_data
    WHERE project_id = p_project_id
    AND date = p_date
    AND validated = true;
    
    RETURN COALESCE(weighted_nav, 0);
END;
$$;


--
-- Name: FUNCTION calculate_project_weighted_nav(p_project_id uuid, p_date date); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) IS 'Calculates the asset-weighted average NAV for all validated assets in a project on a specific date';


--
-- Name: check_all_approvals(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_all_approvals() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    total_approvers INT;
    approved_count INT;
    min_required INT;
    rule_record RECORD;
    template_record RECORD;
BEGIN
    -- Count total approvers for this rule/template
    SELECT COUNT(*) INTO total_approvers 
    FROM policy_rule_approvers 
    WHERE policy_rule_id = NEW.policy_rule_id;
    
    -- Count approved approvers
    SELECT COUNT(*) INTO approved_count 
    FROM policy_rule_approvers 
    WHERE policy_rule_id = NEW.policy_rule_id AND status = 'approved';
    
    -- Check what kind of entity this is
    SELECT * INTO rule_record FROM rules WHERE rule_id = NEW.policy_rule_id;
    IF rule_record IS NOT NULL THEN
        -- It's a rule
        -- Get minimum required approvals if specified in rule details
        IF rule_record.rule_details->'requiredApprovals' IS NOT NULL THEN
            min_required := (rule_record.rule_details->>'requiredApprovals')::int;
        ELSE 
            -- Default to all approvers
            min_required := total_approvers;
        END IF;
        
        -- If enough approvals, update rule status
        IF approved_count >= min_required THEN
            UPDATE rules SET status = 'active' WHERE rule_id = NEW.policy_rule_id;
        END IF;
    ELSE
        -- Check if it's a template
        SELECT * INTO template_record FROM policy_templates WHERE template_id = NEW.policy_rule_id;
        IF template_record IS NOT NULL THEN
            -- It's a template
            -- Get minimum required approvals if specified in template data
            IF template_record.template_data->'requiredApprovals' IS NOT NULL THEN
                min_required := (template_record.template_data->>'requiredApprovals')::int;
            ELSE 
                -- Default to all approvers
                min_required := total_approvers;
            END IF;
            
            -- If enough approvals, update template status
            IF approved_count >= min_required THEN
                UPDATE policy_templates SET status = 'active' WHERE template_id = NEW.policy_rule_id;
            END IF;
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: check_document_expiry(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_document_expiry() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    IF NEW.expiry_date IS NOT NULL AND NEW.expiry_date <= now() THEN
        UPDATE documents
        SET status = 'expired'
        WHERE id = NEW.id;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: check_duplicate_wallet(uuid, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN EXISTS (
        SELECT 1 FROM project_credentials 
        WHERE project_id = p_project_id 
        AND network = p_network 
        AND credential_type = p_credential_type 
        AND is_active = true 
        AND revoked_at IS NULL
    );
END;
$$;


--
-- Name: FUNCTION check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) IS 'Check if wallet already exists for project+network combination';


--
-- Name: check_existing_signature(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_existing_signature(p_proposal_id uuid, p_signer_address text) RETURNS TABLE(id uuid, proposal_id uuid, signer_address text, signature text, signature_type text, signed_at timestamp with time zone, is_valid boolean)
    LANGUAGE sql SECURITY DEFINER
    AS $$
  SELECT 
    id,
    proposal_id,
    signer_address,
    signature,
    signature_type,
    signed_at,
    is_valid
  FROM public.proposal_signatures
  WHERE proposal_signatures.proposal_id = p_proposal_id
    AND proposal_signatures.signer_address = p_signer_address
  LIMIT 1;
$$;


--
-- Name: check_expired_proposals(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_expired_proposals() RETURNS void
    LANGUAGE plpgsql
    SET search_path TO ''
    AS $$
begin
  update multi_sig_proposals
  set status = 'expired',
      updated_at = now()
  where status = 'pending'
    and expires_at < now();
end;
$$;


--
-- Name: check_issuer_document_duplicates(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_issuer_document_duplicates() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Check if a document with same issuer_id, document_type, and document_name already exists
  IF EXISTS (
    SELECT 1 FROM issuer_documents 
    WHERE issuer_id = NEW.issuer_id 
    AND document_type = NEW.document_type 
    AND document_name = NEW.document_name 
    AND status = 'active'
    AND id != COALESCE(NEW.id, '00000000-0000-0000-0000-000000000000'::uuid)
  ) THEN
    RAISE EXCEPTION 'Document with name "%" and type "%" already exists for this issuer', NEW.document_name, NEW.document_type;
  END IF;
  
  RETURN NEW;
END;
$$;


--
-- Name: check_permission(text, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_permission(p_role_name text, p_resource text, p_action text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_role_id UUID;
  v_permission_id UUID;
  v_has_permission BOOLEAN;
BEGIN
  -- Get the role ID
  SELECT id INTO v_role_id
  FROM roles
  WHERE name = p_role_name;
  
  -- If role doesn't exist, return false
  IF v_role_id IS NULL THEN
    RETURN FALSE;
  END IF;
  
  -- Get the permission ID
  SELECT id INTO v_permission_id
  FROM permissions
  WHERE resource = p_resource AND action = p_action;
  
  -- If permission doesn't exist, return false
  IF v_permission_id IS NULL THEN
    RETURN FALSE;
  END IF;
  
  -- Check if the role has this permission
  SELECT EXISTS (
    SELECT 1
    FROM role_permissions
    WHERE role_id = v_role_id
      AND permission_id = v_permission_id
      AND effect = 'allow'
  ) INTO v_has_permission;
  
  RETURN v_has_permission;
END;
$$;


--
-- Name: check_redemption_eligibility(uuid, uuid, numeric, text, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text DEFAULT NULL::text, p_product_id uuid DEFAULT NULL::uuid) RETURNS TABLE(eligible boolean, reason text, max_amount numeric, window_id uuid, distribution_ids uuid[], validation_details jsonb)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_total_available NUMERIC := 0;
    v_eligibility_record RECORD;
    v_validation JSONB := '{}';
    v_distribution_ids UUID[];
BEGIN
    -- Check if redemptions are open globally
    SELECT INTO v_eligibility_record *
    FROM redemption_rules rr 
    WHERE rr.project_id = p_project_id
      AND (p_product_type IS NULL OR rr.product_type = p_product_type)
      AND (p_product_id IS NULL OR rr.product_id = p_product_id)
    ORDER BY rr.created_at DESC
    LIMIT 1;
    
    -- Principle 1: Check if redemptions are open
    IF NOT FOUND OR v_eligibility_record.is_redemption_open = false THEN
        RETURN QUERY SELECT 
            false,
            'Redemptions are currently closed for this project/product',
            0::NUMERIC,
            NULL::UUID,
            ARRAY[]::UUID[],
            '{"principle_violated": 1, "reason": "redemptions_closed"}'::JSONB;
        RETURN;
    END IF;
    
    -- Principle 2: Check date eligibility
    IF v_eligibility_record.open_after_date IS NOT NULL AND v_eligibility_record.open_after_date > NOW() THEN
        RETURN QUERY SELECT 
            false,
            'Redemption period opens on ' || v_eligibility_record.open_after_date::text,
            0::NUMERIC,
            NULL::UUID,
            ARRAY[]::UUID[],
            jsonb_build_object(
                'principle_violated', 2, 
                'reason', 'not_yet_open',
                'open_date', v_eligibility_record.open_after_date
            );
        RETURN;
    END IF;
    
    -- Principle 3: Check distribution limits and calculate available amounts
    SELECT 
        COALESCE(SUM(re.max_redeemable_amount), 0),
        ARRAY_AGG(re.distribution_id)
    INTO v_total_available, v_distribution_ids
    FROM redemption_eligibility re
    WHERE re.investor_id = p_investor_id
      AND re.project_id = p_project_id
      AND re.is_eligible_now = true
      AND (p_product_type IS NULL OR re.product_type = p_product_type)
      AND (p_product_id IS NULL OR re.product_id = p_product_id);
    
    -- Check if investor has any distributions
    IF v_total_available = 0 OR v_distribution_ids IS NULL THEN
        RETURN QUERY SELECT 
            false,
            'No eligible distributions found for redemption',
            0::NUMERIC,
            NULL::UUID,
            ARRAY[]::UUID[],
            '{"principle_violated": 3, "reason": "no_distributions"}'::JSONB;
        RETURN;
    END IF;
    
    -- Check if requested amount exceeds limits
    IF p_requested_amount > v_total_available THEN
        RETURN QUERY SELECT 
            false,
            'Requested amount exceeds maximum redeemable amount',
            v_total_available,
            NULL::UUID,
            v_distribution_ids,
            jsonb_build_object(
                'principle_violated', 3, 
                'reason', 'amount_exceeds_limit',
                'requested', p_requested_amount,
                'available', v_total_available
            );
        RETURN;
    END IF;
    
    -- All checks passed
    v_validation := jsonb_build_object(
        'all_principles_satisfied', true,
        'continuous_redemption', v_eligibility_record.allow_continuous_redemption,
        'max_percentage', v_eligibility_record.max_redemption_percentage
    );
    
    RETURN QUERY SELECT 
        true,
        'Eligible for redemption',
        v_total_available,
        NULL::UUID,
        v_distribution_ids,
        v_validation;
    RETURN;
END;
$$;


--
-- Name: check_role_exists(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_role_exists() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- First check if the role exists directly in the roles table
  IF EXISTS (SELECT 1 FROM roles WHERE name = NEW.role) THEN
    RETURN NEW;
  END IF;
  
  -- If not found directly, try to normalize common role formats
  -- This handles cases like 'Super Admin' vs 'superAdmin' vs 'super_admin'
  DECLARE
    normalized_role TEXT;
  BEGIN
    -- Simple normalization for common patterns
    -- Convert spaces to camelCase
    IF NEW.role LIKE '% %' THEN
      normalized_role := regexp_replace(
        regexp_replace(
          initcap(NEW.role), 
          ' ([A-Za-z])',
          '\1',
          'g'
        ),
        '^([A-Z])',
        lower(substring(NEW.role from 1 for 1)),
        'g'
      );
    -- Convert snake_case to camelCase
    ELSIF NEW.role LIKE '%_%' THEN
      normalized_role := regexp_replace(
        regexp_replace(
          initcap(replace(NEW.role, '_', ' ')), 
          ' ([A-Za-z])',
          '\1',
          'g'
        ),
        '^([A-Z])',
        lower(substring(replace(NEW.role, '_', ' ') from 1 for 1)),
        'g'
      );
    ELSE
      normalized_role := NEW.role;
    END IF;
    
    -- Check if normalized role exists
    IF EXISTS (SELECT 1 FROM roles WHERE name = normalized_role) THEN
      -- Update to the normalized version
      NEW.role := normalized_role;
      RETURN NEW;
    END IF;
    
    -- Last resort: Check for similar roles using pattern matching
    IF EXISTS (SELECT 1 FROM roles WHERE 
               lower(name) LIKE lower(NEW.role) || '%' OR 
               lower(name) LIKE '%' || lower(NEW.role) || '%') THEN
      -- Get the first matching role
      SELECT name INTO normalized_role FROM roles WHERE 
        lower(name) LIKE lower(NEW.role) || '%' OR 
        lower(name) LIKE '%' || lower(NEW.role) || '%'
      LIMIT 1;
      
      -- Update to the matched role
      NEW.role := normalized_role;
      RETURN NEW;
    END IF;
  END;
  
  -- If no existing role could be found or matched, try to add this role to the roles table
  -- This auto-creates missing roles to prevent constraint violations
  INSERT INTO roles (name, description, priority, created_at, updated_at)
  VALUES (
    NEW.role, 
    'Automatically created role from user_roles insert', 
    100, -- default priority
    NOW(),
    NOW()
  );
  
  RETURN NEW;
END;
$$;


--
-- Name: check_user_permission(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_user_permission(user_id uuid, permission text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  has_permission BOOLEAN := FALSE;
  super_admin_exists BOOLEAN := FALSE;
BEGIN
  -- Check if user has Super Admin role (handles multiple roles)
  SELECT EXISTS (
    SELECT 1
    FROM public.user_roles ur
    JOIN public.roles r ON ur.role_id = r.id
    WHERE ur.user_id = check_user_permission.user_id
    AND r.name = 'Super Admin'
  ) INTO super_admin_exists;
  
  -- Super Admin has all permissions
  IF super_admin_exists THEN
    RETURN TRUE;
  END IF;
  
  -- Check specific permission (handles multiple roles)
  SELECT EXISTS (
    SELECT 1
    FROM public.user_roles ur
    JOIN public.role_permissions rp ON ur.role_id = rp.role_id
    WHERE ur.user_id = check_user_permission.user_id
    AND rp.permission_name = check_user_permission.permission
  ) INTO has_permission;
  
  RETURN has_permission;
EXCEPTION
  WHEN OTHERS THEN
    RAISE NOTICE 'Error in check_user_permission: %', SQLERRM;
    RETURN FALSE;
END;
$$;


--
-- Name: FUNCTION check_user_permission(user_id uuid, permission text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.check_user_permission(user_id uuid, permission text) IS 'Check if a user has a specific permission, with support for multiple roles';


--
-- Name: cleanup_expired_asset_cache(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_asset_cache() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM moonpay_asset_cache WHERE expires_at < NOW();
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_expired_cache(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_cache() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
  deleted_count INTEGER;
BEGIN
  DELETE FROM climate_market_data_cache WHERE expires_at < NOW();
  GET DIAGNOSTICS deleted_count = ROW_COUNT;
  RETURN deleted_count;
END;
$$;


--
-- Name: FUNCTION cleanup_expired_cache(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.cleanup_expired_cache() IS 'Removes expired cache entries - run periodically';


--
-- Name: cleanup_expired_cache_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_cache_data() RETURNS integer
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  deleted_count INTEGER := 0;
  temp_count INTEGER;
BEGIN
  -- Clean up external API cache
  DELETE FROM external_api_cache WHERE expires_at < NOW();
  GET DIAGNOSTICS temp_count = ROW_COUNT;
  deleted_count := deleted_count + temp_count;

  -- Clean up weather cache (if exists)
  BEGIN
    DELETE FROM weather_cache WHERE expires_at < NOW();
    GET DIAGNOSTICS temp_count = ROW_COUNT;
    deleted_count := deleted_count + temp_count;
  EXCEPTION WHEN others THEN
    -- Table doesn't exist yet, skip
    NULL;
  END;

  -- Clean up user data cache (if exists)
  BEGIN
    DELETE FROM climate_user_data_cache WHERE expires_at < NOW();
    GET DIAGNOSTICS temp_count = ROW_COUNT;
    deleted_count := deleted_count + temp_count;
  EXCEPTION WHEN others THEN
    -- Table doesn't exist yet, skip
    NULL;
  END;

  RETURN deleted_count;
END;
$$;


--
-- Name: FUNCTION cleanup_expired_cache_data(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.cleanup_expired_cache_data() IS 'Clean up expired cache entries to maintain performance';


--
-- Name: cleanup_expired_transaction_drafts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_transaction_drafts() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM wallet_transaction_drafts 
    WHERE expires_at < CURRENT_TIMESTAMP;
    
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_old_moonpay_policy_logs(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_moonpay_policy_logs() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM moonpay_policy_logs 
    WHERE created_at < NOW() - (retention_period_days * INTERVAL '1 day');
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_old_validation_logs(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_validation_logs() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM restriction_validation_logs 
    WHERE validated_at < CURRENT_TIMESTAMP - INTERVAL '30 days';
    
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_old_webhook_events(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_webhook_events() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM moonpay_webhook_events 
    WHERE processed = true 
    AND received_at < NOW() - INTERVAL '30 days';
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_orphaned_policy_approvers(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_orphaned_policy_approvers() RETURNS integer
    LANGUAGE plpgsql
    AS $$
        DECLARE
          deleted_count INTEGER;
        BEGIN
          WITH deleted AS (
            DELETE FROM policy_rule_approvers
            WHERE NOT EXISTS (
              SELECT 1 FROM rules WHERE rule_id = policy_rule_approvers.policy_rule_id
            )
            RETURNING *
          )
          SELECT COUNT(*) INTO deleted_count FROM deleted;
          
          RETURN deleted_count;
        END;
        $$;


--
-- Name: climate_receivables_health_check(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.climate_receivables_health_check() RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  result JSONB;
  receivables_count INTEGER;
  recent_calculations_count INTEGER;
  projections_count INTEGER;
BEGIN
  -- Check receivables table
  SELECT COUNT(*) INTO receivables_count 
  FROM climate_receivables 
  WHERE created_at > NOW() - INTERVAL '30 days';

  -- Check recent risk calculations
  SELECT COUNT(*) INTO recent_calculations_count 
  FROM climate_risk_calculations 
  WHERE calculated_at > NOW() - INTERVAL '7 days';

  -- Check cash flow projections
  SELECT COUNT(*) INTO projections_count 
  FROM climate_cash_flow_projections 
  WHERE created_at > NOW() - INTERVAL '7 days';

  result := jsonb_build_object(
    'status', 'healthy',
    'timestamp', NOW(),
    'metrics', jsonb_build_object(
      'recent_receivables', receivables_count,
      'recent_calculations', recent_calculations_count,
      'recent_projections', projections_count
    ),
    'services', jsonb_build_object(
      'database', 'operational',
      'risk_calculation', CASE WHEN recent_calculations_count > 0 THEN 'active' ELSE 'idle' END,
      'cash_flow_forecasting', CASE WHEN projections_count > 0 THEN 'active' ELSE 'idle' END
    )
  );

  RETURN result;
END;
$$;


--
-- Name: column_exists(text, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.column_exists(p_schema_name text, p_table_name text, p_column_name text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
    DECLARE
      exists boolean;
    BEGIN
      SELECT COUNT(*) > 0 INTO exists
      FROM information_schema.columns
      WHERE table_schema = p_schema_name
      AND table_name = p_table_name
      AND column_name = p_column_name;
      
      RETURN exists;
    END;
    $$;


--
-- Name: commit_transaction(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.commit_transaction() RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- In PostgreSQL with Supabase, commits happen automatically
    -- This function validates the transaction can be committed
    RETURN true;
EXCEPTION
    WHEN OTHERS THEN
        RETURN false;
END;
$$;


--
-- Name: create_audit_trigger(text, boolean); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_audit_trigger(table_name text, is_high_volume boolean DEFAULT false) RETURNS void
    LANGUAGE plpgsql
    AS $$
    DECLARE
      trigger_name text;
      trigger_condition text;
      has_significance boolean;
      has_importance boolean;
    BEGIN
      trigger_name := 'audit_' || table_name || '_trigger';
      
      -- Check if the table has relevant filtering columns
      has_significance := column_exists('public', table_name, 'is_significant');
      has_importance := column_exists('public', table_name, 'importance');
      
      -- Set up the condition
      IF is_high_volume THEN
        IF has_significance THEN
          trigger_condition := 'WHEN (NEW.is_significant = true OR OLD.is_significant = true)';
        ELSIF has_importance THEN
          trigger_condition := 'WHEN (NEW.importance > 5 OR OLD.importance > 5)';
        ELSE
          trigger_condition := '';
        END IF;
      ELSE
        trigger_condition := '';
      END IF;

      -- Drop the trigger if it exists
      EXECUTE 'DROP TRIGGER IF EXISTS ' || trigger_name || ' ON ' || table_name;
      
      -- Create the new trigger
      EXECUTE 'CREATE TRIGGER ' || trigger_name || 
              ' AFTER INSERT OR UPDATE OR DELETE ON ' || table_name || 
              ' FOR EACH ROW ' || trigger_condition || 
              ' EXECUTE FUNCTION log_table_change()';
              
      -- We'll skip logging to avoid circular dependencies
      RAISE NOTICE 'Created audit trigger for %', table_name;
    END;
    $$;


--
-- Name: create_document_version(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_document_version() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    IF (TG_OP = 'UPDATE' AND (OLD.file_path != NEW.file_path OR OLD.file_url != NEW.file_url)) THEN
        INSERT INTO document_versions (
            document_id,
            version_number,
            file_path,
            file_url,
            uploaded_by,
            metadata
        ) VALUES (
            NEW.id,
            NEW.version,
            NEW.file_path,
            NEW.file_url,
            NEW.uploaded_by,
            NEW.metadata
        );
        NEW.version = OLD.version + 1;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: create_project_with_cap_table(jsonb, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_project_with_cap_table(project_data jsonb, cap_table_name text) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    SET statement_timeout TO '60s'
    AS $$
DECLARE
  created_project JSONB;
  project_id UUID;
  duration_value TEXT;
  sub_start_date TEXT;
  sub_end_date TEXT;
  trans_start_date TEXT;
  maturity_date_value TEXT;
BEGIN
  -- Handle the duration field and date fields specially
  duration_value := project_data->>'duration';
  sub_start_date := project_data->>'subscription_start_date';
  sub_end_date := project_data->>'subscription_end_date';
  trans_start_date := project_data->>'transaction_start_date';
  maturity_date_value := project_data->>'maturity_date';
  
  -- Insert the project
  INSERT INTO projects (
    name,
    description,
    project_type,
    token_symbol,
    target_raise,
    authorized_shares,
    share_price,
    company_valuation,
    legal_entity,
    jurisdiction,
    tax_id,
    status,
    is_primary,
    investment_status,
    estimated_yield_percentage,
    duration,
    subscription_start_date,
    subscription_end_date,
    transaction_start_date,
    maturity_date,
    currency,
    minimum_investment,
    total_notional,
    created_at,
    updated_at
  )
  VALUES (
    project_data->>'name',
    project_data->>'description',
    project_data->>'project_type',
    project_data->>'token_symbol',
    (project_data->>'target_raise')::numeric,
    (project_data->>'authorized_shares')::integer,
    (project_data->>'share_price')::numeric,
    (project_data->>'company_valuation')::numeric,
    project_data->>'legal_entity',
    project_data->>'jurisdiction',
    project_data->>'tax_id',
    project_data->>'status',
    (project_data->>'is_primary')::boolean,
    COALESCE(project_data->>'investment_status', 'Open'),
    (project_data->>'estimated_yield_percentage')::numeric,
    CASE
      WHEN duration_value IS NULL OR duration_value = '' THEN NULL
      ELSE duration_value::public.project_duration
    END,
    CASE
      WHEN sub_start_date IS NULL OR sub_start_date = '' THEN NULL
      ELSE sub_start_date::timestamp with time zone
    END,
    CASE
      WHEN sub_end_date IS NULL OR sub_end_date = '' THEN NULL
      ELSE sub_end_date::timestamp with time zone
    END,
    CASE
      WHEN trans_start_date IS NULL OR trans_start_date = '' THEN NULL
      ELSE trans_start_date::timestamp with time zone
    END,
    CASE
      WHEN maturity_date_value IS NULL OR maturity_date_value = '' THEN NULL
      ELSE maturity_date_value::timestamp with time zone
    END,
    COALESCE(project_data->>'currency', 'USD'),
    (project_data->>'minimum_investment')::numeric,
    (project_data->>'total_notional')::numeric,
    COALESCE((project_data->>'created_at')::timestamp with time zone, now()),
    COALESCE((project_data->>'updated_at')::timestamp with time zone, now())
  )
  RETURNING id INTO project_id;

  -- Create a cap table for this project
  INSERT INTO cap_tables (
    project_id,
    name,
    created_at,
    updated_at,
    description
  )
  VALUES (
    project_id,
    cap_table_name,
    COALESCE((project_data->>'created_at')::timestamp with time zone, now()),
    COALESCE((project_data->>'updated_at')::timestamp with time zone, now()),
    NULL
  );

  -- Get the created project to return
  SELECT row_to_json(p)::jsonb INTO created_project
  FROM projects p
  WHERE p.id = project_id;

  RETURN created_project;
END;
$$;


--
-- Name: create_selective_audit_trigger(text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_selective_audit_trigger(p_table text, p_condition text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_trigger_name text;
  v_condition text;
BEGIN
  -- Create simple trigger name
  v_trigger_name := 'audit_' || p_table || '_trigger';
  
  -- Set condition
  IF p_condition IS NULL THEN
    v_condition := '';
  ELSE
    v_condition := ' WHEN ' || p_condition;
  END IF;
  
  -- Drop trigger if exists
  EXECUTE 'DROP TRIGGER IF EXISTS ' || v_trigger_name || ' ON ' || p_table;
  
  -- Create trigger with condition
  EXECUTE 'CREATE TRIGGER ' || v_trigger_name || 
          ' AFTER INSERT OR UPDATE OR DELETE ON ' || p_table || 
          ' FOR EACH ROW' || v_condition || 
          ' EXECUTE FUNCTION log_table_change()';
          
  RAISE NOTICE 'Created selective trigger on high-volume table %', p_table;
EXCEPTION WHEN OTHERS THEN
  RAISE NOTICE 'Error creating selective trigger for %: %', p_table, SQLERRM;
END;
$$;


--
-- Name: create_token_version(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_token_version() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    last_version INTEGER;
BEGIN
    -- Find the highest version number for this token
    SELECT COALESCE(MAX(version), 0) INTO last_version
    FROM token_versions
    WHERE token_id = NEW.id;

    -- Create a new version record
    INSERT INTO token_versions (
        token_id, 
        version, 
        data, 
        created_at, 
        created_by,
        blocks,
        decimals,
        metadata,
        name,
        standard,
        symbol
    ) VALUES (
        NEW.id,
        last_version + 1,
        to_jsonb(NEW),
        now(),
        current_setting('request.jwt.claims', true)::json->>'sub',
        NEW.blocks,
        NEW.decimals,
        NEW.metadata,
        NEW.name,
        NEW.standard,
        NEW.symbol
    );
    
    RETURN NEW;
END;
$$;


--
-- Name: create_transaction_events_table(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_transaction_events_table() RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Table is created in the migration, this is just a placeholder
  -- for the API to call to ensure the table exists
  RETURN;
END;
$$;


--
-- Name: decrement_shares_outstanding(uuid, numeric, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid DEFAULT NULL::uuid) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF p_project_id IS NOT NULL THEN
    IF NOT EXISTS (
      SELECT 1 FROM fund_products 
      WHERE id = p_fund_id AND project_id = p_project_id
    ) THEN
      RAISE EXCEPTION 'Fund % does not belong to project %', p_fund_id, p_project_id;
    END IF;
  END IF;

  UPDATE fund_products
  SET 
    shares_outstanding = COALESCE(shares_outstanding, 0) - p_shares,
    updated_at = NOW()
  WHERE id = p_fund_id;
  
  UPDATE fund_products
  SET shares_outstanding = 0
  WHERE id = p_fund_id AND shares_outstanding < 0;
END;
$$;


--
-- Name: FUNCTION decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) IS 'Safely decrements shares_outstanding with project validation and zero floor';


--
-- Name: delete_project_cascade(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.delete_project_cascade(project_id uuid) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  -- Delete cap_tables (no child tables to worry about)
  DELETE FROM cap_tables WHERE cap_tables.project_id = delete_project_cascade.project_id;
  
  -- Delete subscription-related records
  -- First delete children of subscriptions
  DELETE FROM token_allocations WHERE subscription_id IN (
    SELECT id FROM subscriptions WHERE subscriptions.project_id = delete_project_cascade.project_id
  );
  DELETE FROM distributions WHERE subscription_id IN (
    SELECT id FROM subscriptions WHERE subscriptions.project_id = delete_project_cascade.project_id
  );
  DELETE FROM invoices WHERE subscription_id IN (
    SELECT id FROM subscriptions WHERE subscriptions.project_id = delete_project_cascade.project_id
  );
  
  -- Then delete subscriptions
  DELETE FROM subscriptions WHERE subscriptions.project_id = delete_project_cascade.project_id;
  
  -- Delete all product types
  DELETE FROM structured_products WHERE structured_products.project_id = delete_project_cascade.project_id;
  DELETE FROM equity_products WHERE equity_products.project_id = delete_project_cascade.project_id;
  DELETE FROM commodities_products WHERE commodities_products.project_id = delete_project_cascade.project_id;
  DELETE FROM fund_products WHERE fund_products.project_id = delete_project_cascade.project_id;
  DELETE FROM bond_products WHERE bond_products.project_id = delete_project_cascade.project_id;
  DELETE FROM quantitative_investment_strategies_products WHERE quantitative_investment_strategies_products.project_id = delete_project_cascade.project_id;
  DELETE FROM private_equity_products WHERE private_equity_products.project_id = delete_project_cascade.project_id;
  DELETE FROM private_debt_products WHERE private_debt_products.project_id = delete_project_cascade.project_id;
  DELETE FROM real_estate_products WHERE real_estate_products.project_id = delete_project_cascade.project_id;
  DELETE FROM energy_products WHERE energy_products.project_id = delete_project_cascade.project_id;
  DELETE FROM infrastructure_products WHERE infrastructure_products.project_id = delete_project_cascade.project_id;
  DELETE FROM collectibles_products WHERE collectibles_products.project_id = delete_project_cascade.project_id;
  DELETE FROM asset_backed_products WHERE asset_backed_products.project_id = delete_project_cascade.project_id;
  DELETE FROM digital_tokenized_fund_products WHERE digital_tokenized_fund_products.project_id = delete_project_cascade.project_id;
  DELETE FROM stablecoin_products WHERE stablecoin_products.project_id = delete_project_cascade.project_id;
  
  -- Delete other project-related records (only tables that actually exist)
  DELETE FROM issuer_detail_documents WHERE issuer_detail_documents.project_id = delete_project_cascade.project_id;
  DELETE FROM token_deployment_history WHERE token_deployment_history.project_id = delete_project_cascade.project_id;
  DELETE FROM investor_groups WHERE investor_groups.project_id = delete_project_cascade.project_id;
  DELETE FROM token_templates WHERE token_templates.project_id = delete_project_cascade.project_id;
  DELETE FROM tokens WHERE tokens.project_id = delete_project_cascade.project_id;
  DELETE FROM compliance_checks WHERE compliance_checks.project_id = delete_project_cascade.project_id;
  DELETE FROM project_wallets WHERE project_wallets.project_id = delete_project_cascade.project_id;
  DELETE FROM project_organization_assignments WHERE project_organization_assignments.project_id = delete_project_cascade.project_id;
  DELETE FROM notification_settings WHERE notification_settings.project_id = delete_project_cascade.project_id;
  DELETE FROM documents WHERE documents.project_id = delete_project_cascade.project_id;
  
  -- Finally delete the project
  DELETE FROM projects WHERE projects.id = delete_project_cascade.project_id;
END;
$$;


--
-- Name: FUNCTION delete_project_cascade(project_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.delete_project_cascade(project_id uuid) IS 'Safely deletes a project and all related data in proper order to maintain referential integrity';


--
-- Name: delete_user_with_privileges(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.delete_user_with_privileges(p_user_id uuid) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
    -- Delete from user_roles
    DELETE FROM user_roles WHERE user_id = p_user_id;
    
    -- Delete from any other related tables that might have foreign keys
    -- For example:
    -- DELETE FROM user_preferences WHERE user_id = p_user_id;
    -- DELETE FROM user_logs WHERE user_id = p_user_id;
    
    -- Finally delete from users table
    DELETE FROM users WHERE id = p_user_id;
    
    -- Return success
    RETURN true;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'Error deleting user %: %', p_user_id, SQLERRM;
        RETURN false;
END;
$$;


--
-- Name: disable_rls_for_deletion(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.disable_rls_for_deletion() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Temporarily disable RLS
  ALTER TABLE users DISABLE ROW LEVEL SECURITY;
  ALTER TABLE user_roles DISABLE ROW LEVEL SECURITY;
  ALTER TABLE user_sessions DISABLE ROW LEVEL SECURITY;
  RETURN OLD;
END;
$$;


--
-- Name: enable_rls_after_deletion(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.enable_rls_after_deletion() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Re-enable RLS
  ALTER TABLE users ENABLE ROW LEVEL SECURITY;
  ALTER TABLE user_roles ENABLE ROW LEVEL SECURITY;
  ALTER TABLE user_sessions ENABLE ROW LEVEL SECURITY;
  RETURN OLD;
END;
$$;


--
-- Name: exec(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.exec(query text) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  result JSONB;
BEGIN
  -- Execute the provided query
  EXECUTE query;
  
  -- Return success message
  result := jsonb_build_object('success', true, 'message', 'Query executed successfully');
  
  RETURN result;
EXCEPTION WHEN OTHERS THEN
  -- Return error details on failure
  result := jsonb_build_object(
    'success', false,
    'message', 'Query execution failed',
    'error', SQLERRM,
    'detail', SQLSTATE
  );
  
  RETURN result;
END;
$$;


--
-- Name: FUNCTION exec(query text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.exec(query text) IS 'Executes arbitrary SQL. Use with caution and proper permissions.';


--
-- Name: execute_safely(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.execute_safely(p_statement text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  success BOOLEAN := TRUE;
BEGIN
  BEGIN
    EXECUTE p_statement;
    EXCEPTION WHEN OTHERS THEN
      RAISE WARNING 'Error executing statement: %', SQLERRM;
      RAISE WARNING 'Statement was: %', p_statement;
      success := FALSE;
  END;
  RETURN success;
END;
$$;


--
-- Name: extract_severity_from_metadata(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.extract_severity_from_metadata() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- If severity column is NULL but exists in metadata, extract it
    IF NEW.severity IS NULL AND 
       NEW.metadata IS NOT NULL AND 
       NEW.metadata->>'severity' IS NOT NULL THEN
        NEW.severity := NEW.metadata->>'severity';
    END IF;
    
    -- If category column is NULL but exists in metadata, extract it
    IF NEW.category IS NULL AND 
       NEW.metadata IS NOT NULL AND 
       NEW.metadata->>'category' IS NOT NULL THEN
        NEW.category := NEW.metadata->>'category';
    END IF;
    
    -- If ip_address column is NULL but exists in metadata, extract it
    IF NEW.ip_address IS NULL AND 
       NEW.metadata IS NOT NULL AND 
       NEW.metadata->>'ip_address' IS NOT NULL THEN
        NEW.ip_address := NEW.metadata->>'ip_address';
    END IF;
    
    -- If user_agent column is NULL but exists in metadata, extract it
    IF NEW.user_agent IS NULL AND 
       NEW.metadata IS NOT NULL AND 
       NEW.metadata->>'user_agent' IS NOT NULL THEN
        NEW.user_agent := NEW.metadata->>'user_agent';
    END IF;
    
    -- If duration column is NULL but exists in metadata, extract it
    IF NEW.duration IS NULL AND 
       NEW.metadata IS NOT NULL AND 
       NEW.metadata->>'duration' IS NOT NULL THEN
        BEGIN
            NEW.duration := (NEW.metadata->>'duration')::INTEGER;
        EXCEPTION WHEN OTHERS THEN
            -- If conversion fails, leave as NULL
            NEW.duration := NULL;
        END;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: get_activity_counts_by_timeframe(timestamp without time zone, timestamp without time zone, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text DEFAULT 'day'::text) RETURNS TABLE(time_bucket timestamp without time zone, activity_count bigint)
    LANGUAGE plpgsql
    AS $$
    BEGIN
      RETURN QUERY
      SELECT 
        date_trunc(p_interval, timestamp) AS time_bucket,
        COUNT(*) AS activity_count
      FROM 
        audit_logs
      WHERE 
        timestamp BETWEEN p_start_time AND p_end_time
      GROUP BY 
        time_bucket
      ORDER BY 
        time_bucket;
    END;
    $$;


--
-- Name: get_activity_distribution_by_category(timestamp without time zone, timestamp without time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone) RETURNS TABLE(category text, activity_count bigint, percentage numeric)
    LANGUAGE plpgsql
    AS $$
    DECLARE
      total_count bigint;
    BEGIN
      -- Get total count for percentage calculation
      SELECT COUNT(*) INTO total_count 
      FROM audit_logs
      WHERE timestamp BETWEEN p_start_time AND p_end_time;
      
      RETURN QUERY
      SELECT 
        COALESCE(category, 'uncategorized') AS category,
        COUNT(*) AS activity_count,
        CASE 
          WHEN total_count > 0 THEN (COUNT(*) * 100.0 / total_count)::numeric 
          ELSE 0 
        END AS percentage
      FROM 
        audit_logs
      WHERE 
        timestamp BETWEEN p_start_time AND p_end_time
      GROUP BY 
        category
      ORDER BY 
        activity_count DESC;
    END;
    $$;


--
-- Name: get_activity_hierarchy(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_activity_hierarchy(root_id uuid) RETURNS TABLE(id uuid, action character varying, activity_timestamp timestamp with time zone, status character varying, level integer)
    LANGUAGE sql
    AS $$
WITH RECURSIVE activity_tree AS (
    -- Base case: start with the root activity
    SELECT 
        id, 
        action, 
        timestamp as activity_timestamp, 
        status, 
        0 as level
    FROM 
        audit_logs
    WHERE 
        id = root_id
    
    UNION ALL
    
    -- Recursive case: add child activities
    SELECT 
        a.id, 
        a.action, 
        a.timestamp as activity_timestamp, 
        a.status, 
        at.level + 1
    FROM 
        audit_logs a
    JOIN 
        activity_tree at ON a.parent_id = at.id
)
SELECT * FROM activity_tree ORDER BY level, activity_timestamp;
$$;


--
-- Name: get_addresses_for_contract_role(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text DEFAULT NULL::text) RETURNS TABLE(address_id uuid, blockchain text, address text, signing_method text, contract_roles jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    ra.id,
    ra.blockchain,
    ra.address,
    ra.signing_method,
    ra.contract_roles
  FROM role_addresses ra
  WHERE ra.role_id = p_role_id
    AND (
      -- Address has empty contract_roles (inherits all from role_contracts)
      jsonb_array_length(ra.contract_roles) = 0
      OR 
      -- Address explicitly has this contract role
      ra.contract_roles @> jsonb_build_array(p_contract_role)
    )
    AND (p_blockchain IS NULL OR ra.blockchain = p_blockchain);
END;
$$;


--
-- Name: get_all_table_schemas(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_all_table_schemas() RETURNS TABLE(table_name text, column_name text, data_type text, is_nullable text, column_default text)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    t.table_name::TEXT,
    c.column_name::TEXT,
    c.data_type::TEXT,
    c.is_nullable::TEXT,
    c.column_default::TEXT
  FROM information_schema.tables t
  JOIN information_schema.columns c 
    ON t.table_name = c.table_name
  WHERE t.table_schema = 'public'
    AND t.table_type = 'BASE TABLE'
  ORDER BY t.table_name, c.ordinal_position;
END;
$$;


--
-- Name: FUNCTION get_all_table_schemas(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_all_table_schemas() IS 'Returns schema information for all tables to enable universal database auditing';


--
-- Name: get_applicable_spread(uuid, text, text, numeric, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text DEFAULT 'buy'::text) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_spread_bps INTEGER;
BEGIN
    SELECT 
        CASE 
            WHEN p_direction = 'buy' THEN buy_spread_bps
            ELSE sell_spread_bps
        END INTO v_spread_bps
    FROM psp_fiat_crypto_spreads
    WHERE project_id = p_project_id
        AND crypto_asset = p_crypto_asset
        AND (network = p_network OR network IS NULL)
        AND p_amount >= tier_min
        AND (tier_max IS NULL OR p_amount < tier_max)
        AND is_active = true
    ORDER BY tier_min DESC
    LIMIT 1;
    
    -- Return 0 if no spread found
    RETURN COALESCE(v_spread_bps, 0);
END;
$$;


--
-- Name: FUNCTION get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text) IS 'Returns the applicable spread in basis points for a given transaction amount and asset';


--
-- Name: get_audit_repopulation_summary(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_audit_repopulation_summary() RETURNS TABLE(metric text, value text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    total_tables integer;
    tables_with_timestamps integer;
    current_audit_entries bigint;
    estimated_new_entries bigint;
    total_records bigint;
BEGIN
    -- Get total tables
    SELECT COUNT(*) INTO total_tables
    FROM information_schema.tables
    WHERE table_schema = 'public'
    AND table_type = 'BASE TABLE'
    AND table_name != 'audit_logs';
    
    -- Get tables with timestamps
    SELECT COUNT(DISTINCT table_name) INTO tables_with_timestamps
    FROM information_schema.columns
    WHERE table_schema = 'public'
    AND column_name IN ('created_at', 'updated_at');
    
    -- Get current audit entries
    SELECT COUNT(*) INTO current_audit_entries
    FROM audit_logs;
    
    -- Estimate new entries and total records
    SELECT 
        SUM(estimated_audit_entries),
        SUM(row_count)
    INTO estimated_new_entries, total_records
    FROM get_table_row_counts() t
    JOIN LATERAL analyze_table_for_audit(t.table_name) a ON true;
    
    -- Return results
    metric := 'Total Tables'; value := total_tables::text; RETURN NEXT;
    metric := 'Tables with Timestamps'; value := tables_with_timestamps::text; RETURN NEXT;
    metric := 'Current Audit Entries'; value := current_audit_entries::text; RETURN NEXT;
    metric := 'Total Records'; value := total_records::text; RETURN NEXT;
    metric := 'Estimated New Audit Entries'; value := estimated_new_entries::text; RETURN NEXT;
    metric := 'Estimated Final Audit Entries'; value := (current_audit_entries + estimated_new_entries)::text; RETURN NEXT;
    
    RETURN;
END;
$$;


--
-- Name: get_audit_statistics(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_audit_statistics(p_hours_back integer DEFAULT 24) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  result JSONB;
  since_time TIMESTAMP;
BEGIN
  since_time := NOW() - (p_hours_back || ' hours')::INTERVAL;
  
  WITH stats AS (
    SELECT 
      COUNT(*) as total_events,
      COUNT(DISTINCT entity_type) as tables_affected,
      COUNT(DISTINCT user_id) as unique_users,
      COUNT(CASE WHEN action LIKE '%create%' OR action LIKE '%insert%' THEN 1 END) as creates,
      COUNT(CASE WHEN action LIKE '%read%' OR action LIKE '%select%' THEN 1 END) as reads,
      COUNT(CASE WHEN action LIKE '%update%' OR action LIKE '%modify%' THEN 1 END) as updates,
      COUNT(CASE WHEN action LIKE '%delete%' OR action LIKE '%remove%' THEN 1 END) as deletes,
      COUNT(CASE WHEN is_automated = true THEN 1 END) as automated_operations,
      COUNT(CASE WHEN severity = 'high' THEN 1 END) as high_severity,
      COUNT(CASE WHEN severity = 'medium' THEN 1 END) as medium_severity,
      COUNT(CASE WHEN severity = 'low' THEN 1 END) as low_severity
    FROM audit_logs 
    WHERE timestamp >= since_time
  ),
  top_tables AS (
    SELECT jsonb_agg(
      jsonb_build_object(
        'table', entity_type,
        'count', cnt
      ) ORDER BY cnt DESC
    ) as top_tables
    FROM (
      SELECT entity_type, COUNT(*) as cnt
      FROM audit_logs 
      WHERE timestamp >= since_time
        AND entity_type IS NOT NULL
      GROUP BY entity_type
      ORDER BY cnt DESC
      LIMIT 10
    ) t
  ),
  top_users AS (
    SELECT jsonb_agg(
      jsonb_build_object(
        'user', username,
        'count', cnt
      ) ORDER BY cnt DESC
    ) as top_users
    FROM (
      SELECT username, COUNT(*) as cnt
      FROM audit_logs 
      WHERE timestamp >= since_time
        AND username IS NOT NULL
        AND is_automated = false
      GROUP BY username
      ORDER BY cnt DESC
      LIMIT 10
    ) u
  )
  SELECT jsonb_build_object(
    'period_hours', p_hours_back,
    'total_events', COALESCE(s.total_events, 0),
    'tables_affected', COALESCE(s.tables_affected, 0),
    'unique_users', COALESCE(s.unique_users, 0),
    'operations', jsonb_build_object(
      'creates', COALESCE(s.creates, 0),
      'reads', COALESCE(s.reads, 0),
      'updates', COALESCE(s.updates, 0),
      'deletes', COALESCE(s.deletes, 0)
    ),
    'automation', jsonb_build_object(
      'automated_operations', COALESCE(s.automated_operations, 0),
      'manual_operations', COALESCE(s.total_events - s.automated_operations, 0)
    ),
    'severity_distribution', jsonb_build_object(
      'high', COALESCE(s.high_severity, 0),
      'medium', COALESCE(s.medium_severity, 0),
      'low', COALESCE(s.low_severity, 0)
    ),
    'top_tables', COALESCE(tt.top_tables, '[]'::jsonb),
    'top_users', COALESCE(tu.top_users, '[]'::jsonb),
    'generated_at', NOW()
  ) INTO result
  FROM stats s
  CROSS JOIN top_tables tt
  CROSS JOIN top_users tu;
  
  RETURN result;
END;
$$;


--
-- Name: FUNCTION get_audit_statistics(p_hours_back integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_audit_statistics(p_hours_back integer) IS 'Returns comprehensive audit statistics for the specified time period';


--
-- Name: get_contract_roles_for_address(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_contract_roles_for_address(p_address_id uuid) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_role_id UUID;
  v_address_roles JSONB;
  v_all_role_contracts JSONB;
BEGIN
  -- Get the address's role_id and contract_roles
  SELECT role_id, contract_roles 
  INTO v_role_id, v_address_roles
  FROM role_addresses 
  WHERE id = p_address_id;

  -- If address has specific contract roles, return them
  IF jsonb_array_length(v_address_roles) > 0 THEN
    RETURN v_address_roles;
  END IF;

  -- Otherwise, return all contract roles from role_contracts
  SELECT contract_roles 
  INTO v_all_role_contracts
  FROM role_contracts 
  WHERE role_id = v_role_id;

  RETURN COALESCE(v_all_role_contracts, '[]'::jsonb);
END;
$$;


--
-- Name: get_enhanced_risk_assessment(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  receivable_data RECORD;
  latest_calculation RECORD;
  result JSONB;
BEGIN
  -- Get receivable and payer data
  SELECT 
    r.*,
    p.name as payer_name, 
    p.credit_rating, 
    p.financial_health_score, 
    p.payment_history, 
    p.esg_score
  INTO receivable_data
  FROM climate_receivables r
  LEFT JOIN climate_payers p ON r.payer_id = p.payer_id
  WHERE r.receivable_id = p_receivable_id;

  IF NOT FOUND THEN
    RETURN jsonb_build_object('error', 'Receivable not found');
  END IF;

  -- Get latest risk calculation
  SELECT *
  INTO latest_calculation
  FROM climate_risk_calculations
  WHERE receivable_id = p_receivable_id
  ORDER BY calculation_date DESC
  LIMIT 1;

  -- Build result
  result := jsonb_build_object(
    'receivable_id', receivable_data.receivable_id,
    'payer_id', receivable_data.payer_id,
    'payer_name', receivable_data.payer_name,
    'credit_profile', jsonb_build_object(
      'credit_rating', receivable_data.credit_rating,
      'financial_health_score', receivable_data.financial_health_score,
      'payment_history', receivable_data.payment_history,
      'esg_score', receivable_data.esg_score
    ),
    'latest_calculation', CASE 
      WHEN latest_calculation IS NOT NULL THEN
        jsonb_build_object(
          'risk_score', COALESCE(latest_calculation.credit_risk_score, latest_calculation.risk_score),
          'discount_rate', COALESCE(latest_calculation.discount_rate_calculated, latest_calculation.discount_rate),
          'confidence_level', COALESCE(latest_calculation.credit_risk_confidence, 85.0),
          'data_completeness', COALESCE(latest_calculation.data_completeness, 'basic'),
          'calculation_date', latest_calculation.calculation_date,
          'market_adjustments', COALESCE(latest_calculation.market_adjustments, '{}'),
          'user_data_sources', COALESCE(latest_calculation.user_data_sources, '[]'),
          'recommendations', COALESCE(latest_calculation.recommendations, '[]')
        )
      ELSE NULL
    END
  );

  RETURN result;
END;
$$;


--
-- Name: FUNCTION get_enhanced_risk_assessment(p_receivable_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) IS 'Get comprehensive risk assessment for a receivable - fixes missing function error';


--
-- Name: get_factory_address(text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_factory_address(p_network text, p_environment text) RETURNS text
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
  RETURN (
    SELECT contract_address
    FROM contract_masters
    WHERE network = p_network
      AND environment = p_environment
      AND contract_type = 'factory'
      AND is_active = TRUE
    ORDER BY deployed_at DESC
    LIMIT 1
  );
END;
$$;


--
-- Name: get_fund_project_id(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_fund_project_id(p_fund_id uuid) RETURNS uuid
    LANGUAGE plpgsql STABLE
    AS $$
DECLARE
  v_project_id UUID;
BEGIN
  SELECT project_id INTO v_project_id
  FROM fund_products
  WHERE id = p_fund_id;
  
  RETURN v_project_id;
END;
$$;


--
-- Name: FUNCTION get_fund_project_id(p_fund_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_fund_project_id(p_fund_id uuid) IS 'Returns the project_id for a given fund_product_id';


--
-- Name: get_investor_mmf_shares(uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid) RETURNS TABLE(total_shares numeric, total_invested numeric, average_nav numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    COALESCE(SUM(shares_calculated), 0) as total_shares,
    COALESCE(SUM(fiat_amount), 0) as total_invested,
    CASE 
      WHEN COALESCE(SUM(shares_calculated), 0) > 0 
      THEN COALESCE(SUM(fiat_amount), 0) / COALESCE(SUM(shares_calculated), 1)
      ELSE 0
    END as average_nav
  FROM subscriptions
  WHERE investor_id = p_investor_id
  AND product_id = p_fund_id
  AND confirmed = true;
END;
$$;


--
-- Name: get_investor_mmf_shares_by_project(uuid, uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid) RETURNS TABLE(total_shares numeric, total_invested numeric, average_nav numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    COALESCE(SUM(shares_calculated), 0) as total_shares,
    COALESCE(SUM(fiat_amount), 0) as total_invested,
    CASE 
      WHEN COALESCE(SUM(shares_calculated), 0) > 0 
      THEN COALESCE(SUM(fiat_amount), 0) / COALESCE(SUM(shares_calculated), 1)
      ELSE 0
    END as average_nav
  FROM subscriptions
  WHERE investor_id = p_investor_id
  AND product_id = p_fund_id
  AND project_id = p_project_id
  AND confirmed = true;
END;
$$;


--
-- Name: get_master_address(text, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_master_address(p_network text, p_environment text, p_standard text) RETURNS text
    LANGUAGE plpgsql STABLE
    AS $$
DECLARE
  v_contract_type TEXT;
BEGIN
  v_contract_type := CASE p_standard
    WHEN 'ERC-20' THEN 'erc20_master'
    WHEN 'ERC-721' THEN 'erc721_master'
    WHEN 'ERC-1155' THEN 'erc1155_master'
    WHEN 'ERC-3525' THEN 'erc3525_master'
    WHEN 'ERC-4626' THEN 'erc4626_master'
    WHEN 'ERC-1400' THEN 'erc1400_master'
    ELSE NULL
  END;
  
  IF v_contract_type IS NULL THEN
    RAISE EXCEPTION 'Unknown token standard: %', p_standard;
  END IF;
  
  RETURN (
    SELECT contract_address
    FROM contract_masters
    WHERE network = p_network
      AND environment = p_environment
      AND contract_type = v_contract_type
      AND is_active = TRUE
    ORDER BY deployed_at DESC
    LIMIT 1
  );
END;
$$;


--
-- Name: get_mmf_holdings_summary(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) RETURNS TABLE(total_holdings integer, total_amortized_cost numeric, total_market_value numeric, holding_types character varying[])
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    COUNT(*)::INTEGER as total_holdings,
    COALESCE(SUM(amortized_cost), 0) as total_amortized_cost,
    COALESCE(SUM(market_value), 0) as total_market_value,
    ARRAY_AGG(DISTINCT holding_type) as holding_types
  FROM mmf_holdings
  WHERE fund_product_id = p_fund_id
  AND status = 'active';
END;
$$;


--
-- Name: FUNCTION get_mmf_holdings_summary(p_fund_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) IS 'Returns summary statistics for MMF holdings';


--
-- Name: get_mmf_nav(uuid, timestamp with time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone DEFAULT now()) RETURNS TABLE(stable_nav numeric, shadow_nav numeric, deviation_from_stable numeric, wam integer, wal integer, daily_liquid_percentage numeric, weekly_liquid_percentage numeric)
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    mnh.stable_nav,
    mnh.market_based_nav as shadow_nav,
    mnh.deviation_from_stable,
    mnh.weighted_average_maturity_days as wam,
    mnh.weighted_average_life_days as wal,
    mnh.daily_liquid_assets_percentage,
    mnh.weekly_liquid_assets_percentage
  FROM mmf_nav_history mnh
  WHERE mnh.fund_product_id = p_fund_id
  AND mnh.valuation_date <= p_as_of_date
  ORDER BY mnh.valuation_date DESC
  LIMIT 1;
END;
$$;


--
-- Name: FUNCTION get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone) IS 'Returns latest MMF NAV metrics as of a specific date';


--
-- Name: get_moonpay_webhook_stats(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_moonpay_webhook_stats() RETURNS TABLE(total_webhooks bigint, active_webhooks bigint, failed_webhooks bigint, avg_success_rate numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT 
        COUNT(*) as total_webhooks,
        COUNT(*) FILTER (WHERE status = 'active') as active_webhooks,
        COUNT(*) FILTER (WHERE status = 'failed') as failed_webhooks,
        CASE 
            WHEN SUM(delivery_attempts_count) > 0 THEN
                ROUND(
                    (SUM(successful_deliveries_count)::NUMERIC / SUM(delivery_attempts_count)) * 100,
                    2
                )
            ELSE 0
        END as avg_success_rate
    FROM moonpay_webhook_config;
END;
$$;


--
-- Name: get_payer_risk_assessment(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  payer_data RECORD;
  recent_calculations JSONB;
  result JSONB;
BEGIN
  -- Get payer data
  SELECT *
  INTO payer_data
  FROM climate_payers
  WHERE payer_id = p_payer_id;

  IF NOT FOUND THEN
    RETURN jsonb_build_object('error', 'Payer not found');
  END IF;

  -- Get recent risk calculations for this payer
  SELECT jsonb_agg(
    jsonb_build_object(
      'calculation_id', calculation_id,
      'receivable_id', receivable_id,
      'risk_score', COALESCE(credit_risk_score, risk_score),
      'discount_rate', COALESCE(discount_rate_calculated, discount_rate),
      'confidence_level', COALESCE(credit_risk_confidence, 85.0),
      'data_completeness', COALESCE(data_completeness, 'basic'),
      'calculation_date', COALESCE(calculation_date, created_at)
    )
  )
  INTO recent_calculations
  FROM (
    SELECT *
    FROM climate_risk_calculations
    WHERE payer_id = p_payer_id
    ORDER BY COALESCE(calculation_date, created_at) DESC
    LIMIT 5
  ) recent;

  -- Build result
  result := jsonb_build_object(
    'payer_id', payer_data.payer_id,
    'payer_name', payer_data.name,
    'credit_rating', payer_data.credit_rating,
    'financial_health_score', payer_data.financial_health_score,
    'payment_history', payer_data.payment_history,
    'esg_score', payer_data.esg_score,
    'recent_calculations', COALESCE(recent_calculations, '[]'::jsonb),
    'last_updated', payer_data.updated_at
  );

  RETURN result;
END;
$$;


--
-- Name: FUNCTION get_payer_risk_assessment(p_payer_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) IS 'Get payer risk profile with calculation history';


--
-- Name: get_payer_risk_assessment_with_user_data(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  payer_data RECORD;
  user_data_sources JSONB;
  recent_calculations JSONB;
  result JSONB;
BEGIN
  -- Get payer data
  SELECT *
  INTO payer_data
  FROM climate_payers
  WHERE payer_id = p_payer_id;

  IF NOT FOUND THEN
    RETURN jsonb_build_object('error', 'Payer not found');
  END IF;

  -- Get user data sources for this payer (if table exists)
  BEGIN
    SELECT jsonb_agg(
      jsonb_build_object(
        'source_id', uds.source_id,
        'source_name', uds.source_name,
        'source_type', uds.source_type,
        'processing_status', uds.processing_status,
        'data_quality_score', COALESCE(udc.data_quality_score, 0),
        'last_processed', uds.last_processed
      )
    )
    INTO user_data_sources
    FROM climate_user_data_sources uds
    LEFT JOIN climate_user_data_cache udc ON uds.source_id = udc.source_id AND udc.entity_id = p_payer_id::text
    WHERE uds.is_active = true 
      AND uds.processing_status = 'completed'
      AND uds.source_type IN ('credit_report', 'financial_statement');
  EXCEPTION WHEN others THEN
    user_data_sources := '[]'::jsonb;
  END;

  -- Get recent risk calculations for this payer
  SELECT jsonb_agg(
    jsonb_build_object(
      'calculation_id', calculation_id,
      'receivable_id', receivable_id,
      'risk_score', COALESCE(credit_risk_score, risk_score),
      'discount_rate', COALESCE(discount_rate_calculated, discount_rate),
      'confidence_level', COALESCE(credit_risk_confidence, 85.0),
      'data_completeness', COALESCE(data_completeness, 'basic'),
      'calculation_date', COALESCE(calculation_date, created_at)
    )
  )
  INTO recent_calculations
  FROM (
    SELECT *
    FROM climate_risk_calculations
    WHERE payer_id = p_payer_id
    ORDER BY COALESCE(calculation_date, created_at) DESC
    LIMIT 5
  ) recent;

  -- Build result
  result := jsonb_build_object(
    'payer_id', payer_data.payer_id,
    'payer_name', payer_data.name,
    'credit_rating', payer_data.credit_rating,
    'financial_health_score', payer_data.financial_health_score,
    'payment_history', payer_data.payment_history,
    'esg_score', payer_data.esg_score,
    'user_data_sources', COALESCE(user_data_sources, '[]'::jsonb),
    'recent_calculations', COALESCE(recent_calculations, '[]'::jsonb),
    'last_updated', payer_data.updated_at
  );

  RETURN result;
END;
$$;


--
-- Name: FUNCTION get_payer_risk_assessment_with_user_data(p_payer_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) IS 'Get payer risk profile enhanced with user uploaded data';


--
-- Name: get_product_id_for_project(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_product_id_for_project(p_project_id uuid) RETURNS uuid
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_project_type TEXT;
    v_table_name TEXT;
    v_product_id UUID;
    v_sql TEXT;
BEGIN
    -- Get the project type
    SELECT project_type INTO v_project_type 
    FROM projects 
    WHERE id = p_project_id;
    
    IF v_project_type IS NULL THEN
        RETURN NULL;
    END IF;
    
    -- Get the appropriate product table name
    v_table_name := get_product_table_name(v_project_type);
    
    IF v_table_name IS NULL THEN
        RETURN NULL;
    END IF;
    
    -- Build dynamic SQL to query the product table
    v_sql := format('SELECT id FROM %I WHERE project_id = $1', v_table_name);
    
    -- Execute the dynamic query
    EXECUTE v_sql USING p_project_id INTO v_product_id;
    
    RETURN v_product_id;
EXCEPTION
    WHEN OTHERS THEN
        RETURN NULL; -- Return NULL if table doesn't exist or query fails
END;
$_$;


--
-- Name: FUNCTION get_product_id_for_project(p_project_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_product_id_for_project(p_project_id uuid) IS 'Retrieves the product_id for a given project by querying the appropriate product table.';


--
-- Name: get_product_table_name(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_product_table_name(p_product_type text) RETURNS text
    LANGUAGE plpgsql IMMUTABLE
    AS $$
BEGIN
    RETURN CASE p_product_type
        WHEN 'fund' THEN 'fund_products'
        WHEN 'bond' THEN 'bond_products'
        WHEN 'equity' THEN 'equity_products'
        WHEN 'commodity' THEN 'commodities_products'
        WHEN 'structured' THEN 'structured_products'
        WHEN 'quantitative' THEN 'quantitative_investment_strategies_products'
        WHEN 'private_equity' THEN 'private_equity_products'
        WHEN 'private_debt' THEN 'private_debt_products'
        WHEN 'real_estate' THEN 'real_estate_products'
        WHEN 'energy' THEN 'energy_products'
        WHEN 'infrastructure' THEN 'infrastructure_products'
        WHEN 'collectible' THEN 'collectibles_products'
        WHEN 'asset_backed' THEN 'asset_backed_products'
        WHEN 'digital_fund' THEN 'digital_tokenized_fund_products'
        WHEN 'stablecoin' THEN 'stablecoin_products'
        ELSE NULL
    END;
END;
$$;


--
-- Name: get_project_target_raise(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_project_target_raise(p_project_id uuid) RETURNS numeric
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_project_type TEXT;
    v_table_name TEXT;
    v_product_target_raise NUMERIC;
    v_project_target_raise NUMERIC;
    v_sql TEXT;
BEGIN
    -- Get project type and fallback target_raise
    SELECT project_type, target_raise 
    INTO v_project_type, v_project_target_raise
    FROM projects 
    WHERE id = p_project_id;
    
    IF v_project_type IS NULL THEN
        RETURN NULL;
    END IF;
    
    -- Get the appropriate product table name
    v_table_name := get_product_table_name(v_project_type);
    
    IF v_table_name IS NULL THEN
        -- No product table mapping, return project target_raise
        RETURN v_project_target_raise;
    END IF;
    
    -- Build dynamic SQL to get target_raise from product table
    v_sql := format('SELECT target_raise FROM %I WHERE project_id = $1', v_table_name);
    
    -- Execute the dynamic query
    BEGIN
        EXECUTE v_sql USING p_project_id INTO v_product_target_raise;
    EXCEPTION
        WHEN OTHERS THEN
            v_product_target_raise := NULL;
    END;
    
    -- Return product target_raise if available, otherwise project target_raise
    RETURN COALESCE(v_product_target_raise, v_project_target_raise);
END;
$_$;


--
-- Name: get_proposal_by_id(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_proposal_by_id(proposal_id_param uuid) RETURNS TABLE(id uuid, wallet_id uuid, transaction_hash text, raw_transaction jsonb, chain_type text, status text, signatures_collected integer, signatures_required integer, expires_at timestamp with time zone, executed_at timestamp with time zone, execution_hash text, created_by uuid, created_at timestamp with time zone, on_chain_tx_id integer, on_chain_tx_hash text, submitted_on_chain boolean, to_address text, value text, data text, blockchain text)
    LANGUAGE sql SECURITY DEFINER
    AS $$
  SELECT 
    id,
    wallet_id,
    transaction_hash,
    raw_transaction,
    chain_type,
    status,
    signatures_collected,
    signatures_required,
    expires_at,
    executed_at,
    execution_hash,
    created_by,
    created_at,
    on_chain_tx_id,
    on_chain_tx_hash,
    submitted_on_chain,
    to_address,
    value,
    data,
    blockchain
  FROM public.multi_sig_proposals
  WHERE multi_sig_proposals.id = proposal_id_param
  LIMIT 1;
$$;


--
-- Name: get_proposal_signatures(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_proposal_signatures(p_proposal_id uuid) RETURNS TABLE(id uuid, proposal_id uuid, signer_address text, signature text, signature_type text, signed_at timestamp with time zone, is_valid boolean, on_chain_confirmation_tx text, confirmed_on_chain boolean)
    LANGUAGE sql SECURITY DEFINER
    AS $$
  SELECT 
    id,
    proposal_id,
    signer_address,
    signature,
    signature_type,
    signed_at,
    is_valid,
    on_chain_confirmation_tx,
    confirmed_on_chain
  FROM public.proposal_signatures
  WHERE proposal_signatures.proposal_id = p_proposal_id
    AND proposal_signatures.is_valid = true;
$$;


--
-- Name: get_proposals_for_wallet(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_proposals_for_wallet(p_wallet_id uuid) RETURNS TABLE(id uuid, wallet_id uuid, transaction_hash text, raw_transaction jsonb, chain_type text, status text, signatures_collected integer, signatures_required integer, expires_at timestamp with time zone, executed_at timestamp with time zone, execution_hash text, created_by uuid, created_at timestamp with time zone, updated_at timestamp with time zone, on_chain_tx_id integer, on_chain_tx_hash text, submitted_on_chain boolean, project_id uuid, submitted_by text, title text, description text, to_address text, value text, token_address text, data text, blockchain text)
    LANGUAGE sql SECURITY DEFINER
    AS $$
  SELECT 
    id,
    wallet_id,
    transaction_hash,
    raw_transaction,
    chain_type,
    status,
    signatures_collected,
    signatures_required,
    expires_at,
    executed_at,
    execution_hash,
    created_by,
    created_at,
    updated_at,
    on_chain_tx_id,
    on_chain_tx_hash,
    submitted_on_chain,
    project_id,
    submitted_by,
    title,
    description,
    to_address,
    value,
    token_address,
    data,
    blockchain
  FROM public.multi_sig_proposals
  WHERE multi_sig_proposals.wallet_id = p_wallet_id
  ORDER BY created_at DESC;
$$;


--
-- Name: get_recent_activities(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_recent_activities(days_back integer DEFAULT 30) RETURNS TABLE(id uuid, activity_time timestamp with time zone, action text, source text, entity_type text, entity_id text, user_id uuid, username text, status text, details text)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    a.id,
    a.timestamp,
    a.action,
    a.source,
    a.entity_type,
    a.entity_id,
    a.user_id,
    a.username,
    a.status,
    a.details
  FROM audit_logs a
  WHERE a.timestamp >= (CURRENT_TIMESTAMP - (days_back || ' days')::INTERVAL)
  ORDER BY a.timestamp DESC;
END;
$$;


--
-- Name: get_redemption_capacity(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_redemption_capacity(p_redemption_rule_id uuid) RETURNS TABLE(target_raise_amount numeric, total_redeemed_amount numeric, available_capacity numeric, capacity_percentage numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_target_raise NUMERIC;
    v_total_redeemed NUMERIC;
    v_project_id UUID;
BEGIN
    -- Get target_raise_amount and project_id for this redemption rule
    SELECT rr.target_raise_amount, rr.project_id
    INTO v_target_raise, v_project_id
    FROM redemption_rules rr 
    WHERE rr.id = p_redemption_rule_id;
    
    -- Calculate total redeemed amount from redemption_requests using project_id relationship
    -- Fixed: Use 'token_amount' instead of 'amount' and project_id instead of redemption_rule_id
    BEGIN
        SELECT COALESCE(SUM(
            CASE 
                WHEN status IN ('completed', 'processed', 'settled', 'approved') THEN token_amount
                ELSE 0
            END
        ), 0)
        INTO v_total_redeemed
        FROM redemption_requests rreq
        WHERE rreq.project_id = v_project_id;
    EXCEPTION
        WHEN undefined_table THEN
            v_total_redeemed := 0;
        WHEN OTHERS THEN
            v_total_redeemed := 0;
    END;
    
    -- Return capacity calculation
    RETURN QUERY SELECT 
        v_target_raise as target_raise_amount,
        v_total_redeemed as total_redeemed_amount,
        GREATEST(0, COALESCE(v_target_raise, 0) - COALESCE(v_total_redeemed, 0)) as available_capacity,
        CASE 
            WHEN v_target_raise IS NULL OR v_target_raise = 0 THEN NULL
            ELSE ROUND((COALESCE(v_total_redeemed, 0) / v_target_raise) * 100, 2)
        END as capacity_percentage;
END;
$$;


--
-- Name: get_redemption_rule_product_details(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_redemption_rule_product_details(p_redemption_rule_id uuid) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_result JSONB;
BEGIN
    SELECT product_details 
    INTO v_result
    FROM redemption_rules_with_product_details 
    WHERE id = p_redemption_rule_id;
    
    RETURN COALESCE(v_result, '{}'::jsonb);
END;
$$;


--
-- Name: get_redemption_rules_by_product_type(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_redemption_rules_by_product_type(p_product_type text) RETURNS TABLE(redemption_rule_id uuid, project_name text, product_name text, product_status text, redemption_type text, is_redemption_open boolean, product_details jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT 
        rr.id as redemption_rule_id,
        rr.project_name,
        rr.product_name,
        rr.product_status,
        rr.redemption_type,
        rr.is_redemption_open,
        rr.product_details
    FROM redemption_rules_with_product_details rr
    WHERE rr.product_type = p_product_type
    ORDER BY rr.created_at DESC;
END;
$$;


--
-- Name: get_redemption_rules_near_capacity(numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_redemption_rules_near_capacity(p_threshold_percentage numeric DEFAULT 80) RETURNS TABLE(redemption_rule_id uuid, project_name text, product_name text, target_raise_amount numeric, capacity_percentage numeric, available_capacity numeric, capacity_status text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT 
        rr.id as redemption_rule_id,
        rr.project_name,
        rr.product_name,
        rr.target_raise_amount,
        rr.capacity_percentage,
        rr.available_capacity,
        rr.capacity_status
    FROM redemption_rules_with_product_details rr
    WHERE rr.target_raise_amount IS NOT NULL
        AND rr.capacity_percentage >= p_threshold_percentage
    ORDER BY rr.capacity_percentage DESC, rr.target_raise_amount DESC;
END;
$$;


--
-- Name: get_supabase_function_url(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_supabase_function_url() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  -- This will be set via environment variable
  -- Return the base URL for Supabase functions
  RETURN current_setting('app.supabase_url', true) || '/functions/v1';
EXCEPTION
  WHEN OTHERS THEN
    RETURN NULL;
END;
$$;


--
-- Name: get_table_row_counts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_table_row_counts() RETURNS TABLE(table_name text, row_count bigint)
    LANGUAGE plpgsql
    AS $$
DECLARE
    table_record RECORD;
    sql_query text;
    result_count bigint;
BEGIN
    -- Loop through all tables in public schema
    FOR table_record IN 
        SELECT t.table_name
        FROM information_schema.tables t
        WHERE t.table_schema = 'public'
        AND t.table_type = 'BASE TABLE'
        AND t.table_name != 'audit_logs'
        ORDER BY t.table_name
    LOOP
        -- Build dynamic query to count rows
        sql_query := format('SELECT COUNT(*) FROM %I', table_record.table_name);
        
        -- Execute the query and get count
        EXECUTE sql_query INTO result_count;
        
        -- Return the table name and count
        table_name := table_record.table_name;
        row_count := result_count;
        RETURN NEXT;
    END LOOP;
    
    RETURN;
END;
$$;


--
-- Name: get_token_extensions(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_token_extensions(p_token_id uuid) RETURNS TABLE(extension_type text, extension_address text, configuration jsonb, attached_at timestamp with time zone)
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    te.extension_type,
    te.extension_address,
    te.configuration,
    te.attached_at
  FROM token_extensions te
  WHERE te.token_id = p_token_id
    AND te.is_active = TRUE
  ORDER BY te.attached_at;
END;
$$;


--
-- Name: get_token_whitelist_addresses(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_token_whitelist_addresses(p_token_id uuid) RETURNS TABLE(address text, source text, is_active boolean, approved_date timestamp with time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Return addresses from token_whitelists table
  RETURN QUERY
  SELECT 
    tw.wallet_address as address,
    'whitelist_table'::TEXT as source,
    tw.is_active,
    tw.approval_date as approved_date
  FROM token_whitelists tw
  WHERE tw.token_id = p_token_id AND tw.is_active = true;
  
  -- TODO: Add logic to extract addresses from JSONB whitelist_config fields
  -- This would require knowing the token standard and parsing the appropriate properties table
END;
$$;


--
-- Name: get_total_redemption_capacity(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_total_redemption_capacity() RETURNS TABLE(total_target_raise numeric, total_redeemed numeric, total_available_capacity numeric, overall_usage_percentage numeric, active_rules_count bigint, rules_with_limits_count bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT 
        SUM(rr.target_raise_amount) as total_target_raise,
        SUM(rr.total_redeemed_amount) as total_redeemed,
        SUM(rr.available_capacity) as total_available_capacity,
        CASE 
            WHEN SUM(rr.target_raise_amount) > 0 THEN 
                ROUND((SUM(rr.total_redeemed_amount) / SUM(rr.target_raise_amount)) * 100, 2)
            ELSE NULL
        END as overall_usage_percentage,
        COUNT(*) as active_rules_count,
        COUNT(CASE WHEN rr.target_raise_amount IS NOT NULL THEN 1 END) as rules_with_limits_count
    FROM redemption_rules_with_product_details rr
    WHERE rr.is_redemption_open = true;
END;
$$;


--
-- Name: get_unique_group_memberships(text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_unique_group_memberships(investor_ids text[]) RETURNS TABLE(group_id text, investor_count bigint)
    LANGUAGE sql SECURITY DEFINER
    AS $$
  WITH combined_memberships AS (
    -- Get memberships from the new table
    SELECT group_id, investor_id
    FROM investor_groups_investors
    WHERE investor_id::text = ANY(investor_ids)
    
    UNION
    
    -- Get memberships from the old table
    SELECT group_id, investor_id
    FROM investor_group_members
    WHERE investor_id::text = ANY(investor_ids)
  )
  
  -- Count distinct investors per group
  SELECT 
    group_id,
    COUNT(DISTINCT investor_id) AS investor_count
  FROM 
    combined_memberships
  GROUP BY 
    group_id;
$$;


--
-- Name: get_unique_member_count(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_unique_member_count(group_id_param text) RETURNS integer
    LANGUAGE sql SECURITY DEFINER
    AS $$
  WITH combined_memberships AS (
    -- Get memberships from the new table
    SELECT investor_id
    FROM investor_groups_investors
    WHERE group_id::text = group_id_param
    
    UNION
    
    -- Get memberships from the old table
    SELECT investor_id
    FROM investor_group_members
    WHERE group_id::text = group_id_param
  )
  
  -- Count distinct investors
  SELECT 
    COUNT(DISTINCT investor_id)
  FROM 
    combined_memberships;
$$;


--
-- Name: get_user_profile(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_profile(user_auth_id uuid) RETURNS TABLE(auth_id uuid, user_id uuid, profile_type public.profile_type, first_name text, last_name text, email text, name text, status text, created_at timestamp with time zone, updated_at timestamp with time zone)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    p.id as auth_id,
    p.user_id,
    p.profile_type,
    p.first_name,
    p.last_name,
    au.email,
    u.name,
    u.status,
    p.created_at,
    p.updated_at
  FROM public.profiles p
  LEFT JOIN auth.users au ON au.id = p.id
  LEFT JOIN public.users u ON u.id = p.user_id
  WHERE p.id = user_auth_id;
END;
$$;


--
-- Name: get_user_project_ids(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_project_ids(user_auth_id uuid) RETURNS TABLE(project_id uuid)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT p.id
  FROM projects p
  INNER JOIN organizations o ON p.organization_id = o.id
  INNER JOIN user_organization_roles uor ON uor.organization_id = o.id
  INNER JOIN users u ON u.id = uor.user_id
  WHERE u.auth_id = user_auth_id;
END;
$$;


--
-- Name: FUNCTION get_user_project_ids(user_auth_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_user_project_ids(user_auth_id uuid) IS 'Helper function to get project IDs accessible by a user through their organization roles';


--
-- Name: get_users_by_role_for_approval(text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_by_role_for_approval(role_names text[]) RETURNS TABLE(user_id uuid, user_name text, user_email text, role_name text, role_id uuid)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    RETURN QUERY
    SELECT 
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        r.name as role_name,
        r.id as role_id
    FROM users u
    JOIN user_roles ur ON u.id = ur.user_id
    JOIN roles r ON ur.role_id = r.id
    WHERE r.name = ANY(role_names)
      AND u.status IS DISTINCT FROM 'inactive'
    ORDER BY u.name;
END;
$$;


--
-- Name: get_users_with_any_permission(text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_with_any_permission(permission_names text[]) RETURNS TABLE(user_id uuid, name text, email text, role text)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT DISTINCT
    u.id as user_id,
    u.name,
    u.email,
    r.name as role
  FROM auth.users u
  JOIN user_roles ur ON u.id = ur.user_id
  JOIN roles r ON ur.role_id = r.id
  JOIN role_permissions rp ON r.id = rp.role_id
  WHERE 
    rp.permission_name = ANY(permission_names) AND
    u.deleted_at IS NULL
  ORDER BY u.name;
END;
$$;


--
-- Name: get_users_with_permission(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_with_permission(permission_name text) RETURNS TABLE(user_id uuid, name text, email text, role text)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  -- Get users with Super Admin role (they have all permissions)
  SELECT 
    u.id,
    u.name,
    u.email,
    r.name AS role
  FROM
    public.users u
    JOIN public.user_roles ur ON u.id = ur.user_id
    JOIN public.roles r ON ur.role_id = r.id
  WHERE
    r.name = 'Super Admin'
  
  UNION
  
  -- Get users with the specific permission
  SELECT
    u.id,
    u.name,
    u.email,
    r.name AS role
  FROM
    public.users u
    JOIN public.user_roles ur ON u.id = ur.user_id
    JOIN public.roles r ON ur.role_id = r.id
    JOIN public.role_permissions rp ON r.id = rp.role_id
  WHERE
    rp.permission_name = permission_name;
EXCEPTION
  WHEN OTHERS THEN
    RAISE NOTICE 'Error in get_users_with_permission: %', SQLERRM;
    RETURN;
END;
$$;


--
-- Name: get_users_with_permission_simple(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_with_permission_simple(p_permission_id text) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT user_id::text
    FROM users_with_permissions
    WHERE permission_id = p_permission_id;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'Error in get_users_with_permission_simple: %', SQLERRM;
        -- Return empty result set on error
        RETURN;
END;
$$;


--
-- Name: get_wallet_signers(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_wallet_signers(p_wallet_id uuid) RETURNS text[]
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN (
    SELECT ARRAY_AGG(ra.address)
    FROM multi_sig_wallet_owners mwo
    JOIN roles r ON r.id = mwo.role_id
    JOIN role_addresses ra ON ra.role_id = r.id
    JOIN multi_sig_wallets msw ON msw.id = mwo.wallet_id
    WHERE mwo.wallet_id = p_wallet_id
      AND ra.blockchain = msw.blockchain
  );
END;
$$;


--
-- Name: handle_auth_user_created(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_auth_user_created() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  INSERT INTO public.auth_events (user_id, event_type, metadata)
  VALUES (NEW.id, 'user_created', json_build_object('email', NEW.email));
  RETURN NEW;
END;
$$;


--
-- Name: handle_new_auth_user(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_new_auth_user() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Check if the public.users record exists before creating profile
  IF EXISTS (SELECT 1 FROM public.users WHERE id = NEW.id) THEN
    INSERT INTO public.profiles (id, user_id, created_at, updated_at)
    VALUES (
      gen_random_uuid(),
      NEW.id,
      NOW(),
      NOW()
    )
    ON CONFLICT (user_id) DO NOTHING;
  END IF;
  
  RETURN NEW;
END;
$$;


--
-- Name: handle_rule_rejection(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_rule_rejection() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- If status is changed to rejected
    IF NEW.status = 'rejected' THEN
        -- Check what kind of entity this is
        IF EXISTS (SELECT 1 FROM rules WHERE rule_id = NEW.policy_rule_id) THEN
            -- It's a rule - update its status
            UPDATE rules 
            SET status = 'rejected' 
            WHERE rule_id = NEW.policy_rule_id;
        ELSIF EXISTS (SELECT 1 FROM policy_templates WHERE template_id = NEW.policy_rule_id) THEN
            -- It's a template - update its status
            UPDATE policy_templates 
            SET status = 'rejected' 
            WHERE template_id = NEW.policy_rule_id;
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: handle_token_allocation_deletion(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_token_allocation_deletion() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- If allocation was already distributed, don't allow deletion
  IF OLD.distributed = true THEN
    RAISE EXCEPTION 'Cannot delete token allocation that has already been distributed';
  END IF;
  
  -- Update the subscriptions table to mark as not allocated
  UPDATE subscriptions 
  SET allocated = false,
      updated_at = NOW()
  WHERE id = OLD.subscription_id;
  
  RETURN OLD;
END;
$$;


--
-- Name: handle_token_distribution(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_token_distribution() RETURNS trigger
    LANGUAGE plpgsql
    AS $_$
DECLARE
  tx_proposal transaction_proposals%ROWTYPE;
  investor_wallet text;
BEGIN
  -- Only process when distributed is changed from false to true
  IF (OLD.distributed = false AND NEW.distributed = true) THEN
    -- Find the transaction proposal using distribution_tx_hash if it exists
    IF NEW.distribution_tx_hash IS NOT NULL THEN
      SELECT * INTO tx_proposal 
      FROM transaction_proposals 
      WHERE id::text = NEW.distribution_tx_hash::text
         OR (NEW.distribution_tx_hash ~ '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$' AND id = NEW.distribution_tx_hash::uuid)
      LIMIT 1;
    END IF;
    
    -- Get investor wallet address
    SELECT wallet_address INTO investor_wallet 
    FROM investors 
    WHERE investor_id = NEW.investor_id;
    
    -- Insert record into distributions table
    INSERT INTO distributions (
      token_allocation_id,
      investor_id,
      subscription_id,
      project_id,
      token_type,
      token_amount,
      distribution_date,
      distribution_tx_hash,
      wallet_id,
      blockchain,
      token_address,
      token_symbol,
      to_address,
      notes,
      remaining_amount
    ) VALUES (
      NEW.id,
      NEW.investor_id,
      NEW.subscription_id,
      NEW.project_id,
      NEW.token_type,
      NEW.token_amount,
      COALESCE(NEW.distribution_date, now()),
      COALESCE(NEW.distribution_tx_hash, ''),
      tx_proposal.wallet_id,
      COALESCE(tx_proposal.blockchain, 'ethereum'),
      tx_proposal.token_address,
      COALESCE(NEW.symbol, tx_proposal.token_symbol),
      COALESCE(tx_proposal.to_address, investor_wallet, ''),
      NEW.notes,
      NEW.token_amount
    );
  END IF;
  
  RETURN NEW;
END;
$_$;


--
-- Name: handle_user_deletion(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_user_deletion() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Temporarily disable RLS
  ALTER TABLE users DISABLE ROW LEVEL SECURITY;
  ALTER TABLE user_roles DISABLE ROW LEVEL SECURITY;
  ALTER TABLE user_sessions DISABLE ROW LEVEL SECURITY;
  
  -- Delete from user_roles first
  DELETE FROM user_roles WHERE user_id = OLD.id;
  
  -- Delete from user_sessions
  DELETE FROM user_sessions WHERE user_id = OLD.id;
  
  -- Set auth_events user_id to null
  UPDATE auth_events SET user_id = NULL WHERE user_id = OLD.id;
  
  -- Re-enable RLS
  ALTER TABLE users ENABLE ROW LEVEL SECURITY;
  ALTER TABLE user_roles ENABLE ROW LEVEL SECURITY;
  ALTER TABLE user_sessions ENABLE ROW LEVEL SECURITY;
  
  RETURN OLD;
END;
$$;


--
-- Name: increment_on_chain_confirmations(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.increment_on_chain_confirmations(p_transaction_id uuid) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  UPDATE multi_sig_on_chain_transactions
  SET num_confirmations = num_confirmations + 1
  WHERE id = p_transaction_id;
END;
$$;


--
-- Name: increment_shares_outstanding(uuid, numeric, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid DEFAULT NULL::uuid) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF p_project_id IS NOT NULL THEN
    IF NOT EXISTS (
      SELECT 1 FROM fund_products 
      WHERE id = p_fund_id AND project_id = p_project_id
    ) THEN
      RAISE EXCEPTION 'Fund % does not belong to project %', p_fund_id, p_project_id;
    END IF;
  END IF;

  UPDATE fund_products
  SET 
    shares_outstanding = COALESCE(shares_outstanding, 0) + p_shares,
    updated_at = NOW()
  WHERE id = p_fund_id;
END;
$$;


--
-- Name: FUNCTION increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) IS 'Safely increments shares_outstanding with project validation';


--
-- Name: insert_energy_asset_safe(character varying, character varying, character varying, numeric, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid DEFAULT NULL::uuid) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_asset_id UUID;
    v_existing_count INTEGER;
BEGIN
    -- Check if asset already exists
    SELECT COUNT(*) INTO v_existing_count
    FROM energy_assets
    WHERE name = p_name 
      AND type = p_type 
      AND location = p_location 
      AND capacity = p_capacity;
    
    -- If asset exists, return existing asset_id
    IF v_existing_count > 0 THEN
        SELECT asset_id INTO v_asset_id
        FROM energy_assets
        WHERE name = p_name 
          AND type = p_type 
          AND location = p_location 
          AND capacity = p_capacity
        LIMIT 1;
        
        RETURN v_asset_id;
    END IF;
    
    -- Insert new asset
    INSERT INTO energy_assets (name, type, location, capacity, owner_id)
    VALUES (p_name, p_type, p_location, p_capacity, p_owner_id)
    RETURNING asset_id INTO v_asset_id;
    
    RETURN v_asset_id;
END;
$$;


--
-- Name: insert_policy_approver(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  INSERT INTO policy_rule_approvers (policy_rule_id, user_id, created_by, status)
  VALUES (p_policy_id, p_user_id::UUID, p_created_by::UUID, 'pending')
  ON CONFLICT (policy_rule_id, user_id) 
  DO UPDATE SET status = 'pending', timestamp = now();
END;
$$;


--
-- Name: insert_proposal_signature(uuid, text, text, text, boolean); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean DEFAULT true) RETURNS TABLE(id uuid, proposal_id uuid, signer_address text, signature text, signature_type text, signed_at timestamp with time zone, is_valid boolean, on_chain_confirmation_tx text, confirmed_on_chain boolean)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  INSERT INTO public.proposal_signatures (
    proposal_id,
    signer_address,
    signature,
    signature_type,
    is_valid
  ) VALUES (
    p_proposal_id,
    p_signer_address,
    p_signature,
    p_signature_type,
    p_is_valid
  )
  RETURNING 
    proposal_signatures.id,
    proposal_signatures.proposal_id,
    proposal_signatures.signer_address,
    proposal_signatures.signature,
    proposal_signatures.signature_type,
    proposal_signatures.signed_at,
    proposal_signatures.is_valid,
    proposal_signatures.on_chain_confirmation_tx,
    proposal_signatures.confirmed_on_chain;
END;
$$;


--
-- Name: insert_token_properties(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.insert_token_properties() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    CASE NEW.standard
        WHEN 'ERC-20' THEN
            INSERT INTO "public"."token_erc20_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        WHEN 'ERC-721' THEN
            INSERT INTO "public"."token_erc721_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        WHEN 'ERC-1155' THEN
            INSERT INTO "public"."token_erc1155_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        WHEN 'ERC-1400' THEN
            INSERT INTO "public"."token_erc1400_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        WHEN 'ERC-3525' THEN
            INSERT INTO "public"."token_erc3525_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        WHEN 'ERC-4626' THEN
            INSERT INTO "public"."token_erc4626_properties" ("token_id") 
            VALUES (NEW.id)
            ON CONFLICT ("token_id") DO NOTHING;
        ELSE
            -- Do nothing for unknown standards
    END CASE;
    RETURN NEW;
END;
$$;


--
-- Name: is_address_whitelisted(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_address_whitelisted(p_token_id uuid, p_address text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  is_whitelisted BOOLEAN := FALSE;
BEGIN
  -- Check in token_whitelists table
  SELECT EXISTS(
    SELECT 1 FROM token_whitelists 
    WHERE token_id = p_token_id 
    AND wallet_address = p_address 
    AND is_active = true
  ) INTO is_whitelisted;
  
  IF is_whitelisted THEN
    RETURN TRUE;
  END IF;
  
  -- TODO: Add logic to check JSONB whitelist_config fields
  -- This would require joining with the appropriate ERC properties table
  
  RETURN FALSE;
END;
$$;


--
-- Name: link_redemption_request_to_window(uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.link_redemption_request_to_window(request_id uuid, window_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Update the redemption request with window link
    UPDATE redemption_requests 
    SET redemption_window_id = window_id,
        updated_at = NOW()
    WHERE id = request_id;
    
    -- Statistics will be automatically updated by trigger
    RETURN FOUND;
END;
$$;


--
-- Name: list_tables(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.list_tables() RETURNS TABLE(table_name text)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT tablename::text
  FROM pg_catalog.pg_tables
  WHERE schemaname = 'public'
  ORDER BY tablename;
END;
$$;


--
-- Name: log_approval_config_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_approval_config_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO approval_config_history (
            approval_config_id,
            change_type,
            new_data,
            changed_by
        ) VALUES (
            NEW.id,
            'created',
            to_jsonb(NEW),
            NEW.created_by
        );
        RETURN NEW;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO approval_config_history (
            approval_config_id,
            change_type,
            old_data,
            new_data,
            changed_by
        ) VALUES (
            NEW.id,
            'updated',
            to_jsonb(OLD),
            to_jsonb(NEW),
            NEW.last_modified_by
        );
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO approval_config_history (
            approval_config_id,
            change_type,
            old_data,
            changed_by
        ) VALUES (
            OLD.id,
            'deleted',
            to_jsonb(OLD),
            NULL
        );
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$;


--
-- Name: log_approver_assignment_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_approver_assignment_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO approval_config_history (
            approval_config_id,
            change_type,
            new_data,
            changed_by
        ) VALUES (
            NEW.approval_config_id,
            'approver_added',
            jsonb_build_object(
                'approver_type', NEW.approver_type,
                'approver_user_id', NEW.approver_user_id,
                'approver_role_id', NEW.approver_role_id
            ),
            NEW.created_by
        );
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO approval_config_history (
            approval_config_id,
            change_type,
            old_data,
            changed_by
        ) VALUES (
            OLD.approval_config_id,
            'approver_removed',
            jsonb_build_object(
                'approver_type', OLD.approver_type,
                'approver_user_id', OLD.approver_user_id,
                'approver_role_id', OLD.approver_role_id
            ),
            NULL
        );
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$;


--
-- Name: log_audit(text, uuid, text, text, text, text, jsonb, jsonb, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text DEFAULT NULL::text, p_details text DEFAULT NULL::text, p_status text DEFAULT 'Success'::text, p_metadata jsonb DEFAULT NULL::jsonb, p_old_data jsonb DEFAULT NULL::jsonb, p_new_data jsonb DEFAULT NULL::jsonb) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_audit_id UUID;
  v_user_email TEXT;
  v_username TEXT;
BEGIN
  -- Get user email and name
  SELECT email, name INTO v_user_email, v_username
  FROM users
  WHERE id = p_user_id;
  
  -- Insert audit log
  INSERT INTO audit_logs (
    action,
    user_id,
    user_email,
    username,
    entity_type,
    entity_id,
    details,
    status,
    metadata,
    old_data,
    new_data
  ) VALUES (
    p_action,
    p_user_id,
    v_user_email,
    v_username,
    p_entity_type,
    p_entity_id,
    p_details,
    p_status,
    p_metadata,
    p_old_data,
    p_new_data
  )
  RETURNING id INTO v_audit_id;
  
  RETURN v_audit_id;
END;
$$;


--
-- Name: log_auth_event(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_auth_event() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  INSERT INTO auth_events (user_id, event_type, ip_address, user_agent, metadata)
  VALUES (
    NEW.id,
    TG_ARGV[0],
    current_setting('request.headers')::json->>'x-forwarded-for',
    current_setting('request.headers')::json->>'user-agent',
    json_build_object('email', NEW.email, 'created_at', NEW.created_at)
  );
  RETURN NEW;
END;
$$;


--
-- Name: log_database_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_database_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  action_name TEXT;
  entity_name TEXT;
BEGIN
  -- Set the entity name based on the table
  entity_name := TG_TABLE_NAME;
  
  -- Set action based on operation type
  CASE 
    WHEN TG_OP = 'INSERT' THEN action_name := 'create_' || entity_name;
    WHEN TG_OP = 'UPDATE' THEN action_name := 'update_' || entity_name;
    WHEN TG_OP = 'DELETE' THEN action_name := 'delete_' || entity_name;
  END CASE;

  -- Insert audit log entry
  INSERT INTO audit_logs (
    action,
    action_type,
    entity_type,
    entity_id,
    details,
    old_data,
    new_data,
    status,
    is_automated,
    source,
    timestamp
  ) VALUES (
    action_name,
    'system',
    entity_name,
    CASE 
      WHEN TG_OP = 'DELETE' THEN OLD.id::text
      ELSE NEW.id::text
    END,
    'Automatic system record of data change',
    CASE WHEN TG_OP = 'DELETE' OR TG_OP = 'UPDATE' THEN to_jsonb(OLD) ELSE NULL END,
    CASE WHEN TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN to_jsonb(NEW) ELSE NULL END,
    'success',
    TRUE,
    'database_trigger',
    NOW()
  );
  
  RETURN NULL;
END;
$$;


--
-- Name: log_database_operation(text, text, text, uuid, jsonb, jsonb, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid DEFAULT NULL::uuid, p_old_data jsonb DEFAULT NULL::jsonb, p_new_data jsonb DEFAULT NULL::jsonb, p_metadata jsonb DEFAULT NULL::jsonb) RETURNS uuid
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  audit_id UUID;
  user_name TEXT;
BEGIN
  -- Generate audit ID
  audit_id := gen_random_uuid();
  
  -- Get username if user_id provided
  IF p_user_id IS NOT NULL THEN
    SELECT COALESCE(name, email, 'Unknown User') INTO user_name
    FROM auth.users 
    WHERE id = p_user_id;
  ELSE
    user_name := 'System';
  END IF;
  
  -- Insert audit log
  INSERT INTO audit_logs (
    id,
    timestamp,
    action,
    entity_type,
    entity_id,
    user_id,
    username,
    details,
    category,
    severity,
    status,
    metadata,
    old_data,
    new_data,
    is_automated,
    created_at
  ) VALUES (
    audit_id,
    NOW(),
    LOWER(p_operation),
    p_table_name,
    p_record_id,
    p_user_id,
    user_name,
    CASE 
      WHEN p_operation = 'CREATE' THEN 'Created new record in ' || p_table_name
      WHEN p_operation = 'UPDATE' THEN 'Updated record ' || p_record_id || ' in ' || p_table_name
      WHEN p_operation = 'DELETE' THEN 'Deleted record ' || p_record_id || ' from ' || p_table_name
      WHEN p_operation = 'READ' THEN 'Accessed record ' || p_record_id || ' in ' || p_table_name
      ELSE 'Performed ' || p_operation || ' on ' || p_table_name
    END,
    'system',
    CASE 
      WHEN p_operation = 'DELETE' THEN 'high'
      WHEN p_operation = 'UPDATE' THEN 'medium'
      ELSE 'low'
    END,
    'success',
    COALESCE(p_metadata, '{}'::jsonb) || jsonb_build_object(
      'table_name', p_table_name,
      'operation_type', p_operation,
      'automated', (p_user_id IS NULL),
      'tracked_by', 'UniversalDatabaseAuditService'
    ),
    p_old_data,
    p_new_data,
    (p_user_id IS NULL),
    NOW()
  );
  
  RETURN audit_id;
END;
$$;


--
-- Name: FUNCTION log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb) IS 'Logs database operations for audit tracking without triggers';


--
-- Name: log_table_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_table_change() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    DECLARE
      old_data jsonb;
      new_data jsonb;
      action_name text;
      entity_name text;
      change_data jsonb;
    BEGIN
      -- Set the action name based on operation type
      IF (TG_OP = 'INSERT') THEN
        action_name := 'create';
        old_data := null;
        new_data := to_jsonb(NEW);
        change_data := new_data;
      ELSIF (TG_OP = 'UPDATE') THEN
        action_name := 'update';
        old_data := to_jsonb(OLD);
        new_data := to_jsonb(NEW);
        -- Calculate changes by comparing old and new data
        SELECT jsonb_object_agg(key, value) INTO change_data
        FROM jsonb_each(new_data) 
        WHERE NOT new_data->key = old_data->key OR old_data->key IS NULL;
      ELSIF (TG_OP = 'DELETE') THEN
        action_name := 'delete';
        old_data := to_jsonb(OLD);
        new_data := null;
        change_data := old_data;
      END IF;
      
      -- Extract the entity name from trigger name 
      entity_name := TG_TABLE_NAME;
      
      -- Insert into audit_logs table
      INSERT INTO audit_logs (
        action,
        action_type,
        entity_type,
        entity_id,
        old_data,
        new_data,
        changes,
        details,
        status,
        source,
        timestamp
      ) VALUES (
        entity_name || '_' || action_name,
        'database',
        entity_name,
        CASE 
          WHEN TG_OP = 'DELETE' THEN (old_data->>'id')::text
          ELSE (new_data->>'id')::text
        END,
        old_data,
        new_data,
        change_data,
        'Automated audit log for ' || entity_name || ' ' || action_name,
        'success',
        'database_trigger',
        NOW()
      );
      
      -- Return the appropriate row based on operation
      IF (TG_OP = 'DELETE') THEN
        RETURN OLD;
      ELSE
        RETURN NEW;
      END IF;
    END;
    $$;


--
-- Name: log_user_action(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_user_action() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  entity_id TEXT;
  action_type TEXT;
  table_exists BOOLEAN;
BEGIN
  -- Check if audit_logs table exists
  SELECT EXISTS (
    SELECT FROM information_schema.tables 
    WHERE table_schema = 'public' 
    AND table_name = 'audit_logs'
  ) INTO table_exists;
  
  -- If audit_logs table doesn't exist, just return and do nothing
  IF NOT table_exists THEN
    RETURN COALESCE(new, old);
  END IF;

  -- Determine the action type
  IF TG_OP = 'INSERT' THEN
    action_type := 'create';
  ELSIF TG_OP = 'UPDATE' THEN
    action_type := 'update';
  ELSIF TG_OP = 'DELETE' THEN
    action_type := 'delete';
  END IF;
  
  -- Get the entity ID based on the table's primary key column
  IF TG_TABLE_NAME = 'policy_templates' THEN
    IF TG_OP = 'DELETE' THEN
      entity_id := old.template_id::text;
    ELSE
      entity_id := new.template_id::text;
    END IF;
  ELSIF TG_TABLE_NAME = 'rules' THEN
    IF TG_OP = 'DELETE' THEN
      entity_id := old.rule_id::text;
    ELSE
      entity_id := new.rule_id::text;
    END IF;
  ELSE
    -- Default fallback for other tables with 'id' column
    IF TG_OP = 'DELETE' THEN
      BEGIN
        entity_id := old.id::text;
      EXCEPTION WHEN undefined_column THEN
        entity_id := 'unknown';
      END;
    ELSE
      BEGIN
        entity_id := new.id::text;
      EXCEPTION WHEN undefined_column THEN
        entity_id := 'unknown';
      END;
    END IF;
  END IF;
  
  -- Use TRY-CATCH to prevent errors during insert
  BEGIN
    -- Insert action into audit_logs table
    INSERT INTO audit_logs (
      action_type,
      entity_type,
      entity_id,
      user_id,
      changes,
      occurred_at
    ) VALUES (
      action_type,
      TG_TABLE_NAME,
      entity_id,
      COALESCE(auth.uid()::text, 'system'),
      CASE
        WHEN TG_OP = 'INSERT' THEN to_jsonb(new)
        WHEN TG_OP = 'UPDATE' THEN jsonb_build_object('old', to_jsonb(old), 'new', to_jsonb(new))
        WHEN TG_OP = 'DELETE' THEN to_jsonb(old)
        ELSE NULL
      END,
      NOW()
    );
  EXCEPTION
    WHEN OTHERS THEN
      -- Log error but continue (don't let trigger failure block main operation)
      RAISE NOTICE 'Failed to log action: %', SQLERRM;
  END;
  
  RETURN COALESCE(new, old);
END;
$$;


--
-- Name: FUNCTION log_user_action(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.log_user_action() IS 'This function handles audit logging for various tables, with special handling for token_templates';


--
-- Name: log_wallet_access(uuid, uuid, text, boolean, text, text, text, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean DEFAULT true, p_error_message text DEFAULT NULL::text, p_ip_address text DEFAULT NULL::text, p_user_agent text DEFAULT NULL::text, p_metadata jsonb DEFAULT NULL::jsonb) RETURNS uuid
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  v_log_id UUID;
BEGIN
  INSERT INTO wallet_access_logs (
    wallet_id,
    accessed_by,
    action,
    success,
    error_message,
    ip_address,
    user_agent,
    metadata
  ) VALUES (
    p_wallet_id,
    p_accessed_by,
    p_action,
    p_success,
    p_error_message,
    p_ip_address,
    p_user_agent,
    p_metadata
  ) RETURNING id INTO v_log_id;
  
  RETURN v_log_id;
END;
$$;


--
-- Name: FUNCTION log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb) IS 'Helper function to log wallet access with all relevant details';


--
-- Name: migrate_token_json_to_tables(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.migrate_token_json_to_tables() RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    token_record RECORD;
BEGIN
    -- Process ERC20 tokens
    FOR token_record IN SELECT * FROM "public"."tokens" WHERE standard = 'ERC-20' LOOP
        INSERT INTO "public"."token_erc20_properties" (
            token_id, 
            initial_supply, 
            cap, 
            is_mintable, 
            is_burnable, 
            is_pausable,
            token_type,
            access_control,
            allow_management,
            permit,
            snapshot,
            fee_on_transfer,
            rebasing,
            governance_features
        ) VALUES (
            token_record.id,
            token_record.total_supply,
            (token_record.blocks->>'cap')::text,
            (token_record.blocks->>'is_mintable')::boolean,
            (token_record.blocks->>'is_burnable')::boolean,
            (token_record.blocks->>'is_pausable')::boolean,
            (token_record.metadata->>'tokenType')::text,
            (token_record.blocks->>'access_control')::text,
            (token_record.blocks->>'allowance_management')::boolean,
            (token_record.blocks->>'permit')::boolean,
            (token_record.blocks->>'snapshot')::boolean,
            token_record.blocks->'fee_on_transfer',
            token_record.blocks->'rebasing',
            token_record.blocks->'governance_features'
        ) ON CONFLICT (token_id) DO UPDATE SET
            initial_supply = EXCLUDED.initial_supply,
            cap = EXCLUDED.cap,
            is_mintable = EXCLUDED.is_mintable,
            is_burnable = EXCLUDED.is_burnable,
            is_pausable = EXCLUDED.is_pausable,
            token_type = EXCLUDED.token_type,
            access_control = EXCLUDED.access_control,
            allow_management = EXCLUDED.allow_management,
            permit = EXCLUDED.permit,
            snapshot = EXCLUDED.snapshot,
            fee_on_transfer = EXCLUDED.fee_on_transfer,
            rebasing = EXCLUDED.rebasing,
            governance_features = EXCLUDED.governance_features;
    END LOOP;
    
    -- Process ERC721 tokens
    FOR token_record IN SELECT * FROM "public"."tokens" WHERE standard = 'ERC-721' LOOP
        INSERT INTO "public"."token_erc721_properties" (
            token_id,
            base_uri,
            metadata_storage,
            max_supply,
            has_royalty,
            royalty_percentage,
            royalty_receiver,
            is_burnable,
            is_pausable,
            asset_type,
            minting_method,
            auto_increment_ids,
            enumerable,
            uri_storage,
            access_control,
            updatable_uris,
            sales_config,
            whitelist_config,
            permission_config
        ) VALUES (
            token_record.id,
            (token_record.blocks->>'base_uri')::text,
            (token_record.blocks->>'metadata_storage')::text,
            (token_record.blocks->>'max_supply')::text,
            (token_record.blocks->>'has_royalty')::boolean,
            (token_record.blocks->>'royalty_percentage')::text,
            (token_record.blocks->>'royalty_receiver')::text,
            (token_record.blocks->>'is_burnable')::boolean,
            (token_record.blocks->>'is_pausable')::boolean,
            (token_record.blocks->>'asset_type')::text,
            (token_record.blocks->>'minting_method')::text,
            (token_record.blocks->>'auto_increment_ids')::boolean,
            (token_record.blocks->>'enumerable')::boolean,
            (token_record.blocks->>'uri_storage')::text,
            (token_record.blocks->>'access_control')::text,
            (token_record.blocks->>'updatable_uris')::boolean,
            token_record.blocks->'sales_config',
            token_record.blocks->'whitelist_config',
            token_record.blocks->'permission_config'
        ) ON CONFLICT (token_id) DO UPDATE SET
            base_uri = EXCLUDED.base_uri,
            metadata_storage = EXCLUDED.metadata_storage,
            max_supply = EXCLUDED.max_supply,
            has_royalty = EXCLUDED.has_royalty,
            royalty_percentage = EXCLUDED.royalty_percentage,
            royalty_receiver = EXCLUDED.royalty_receiver,
            is_burnable = EXCLUDED.is_burnable,
            is_pausable = EXCLUDED.is_pausable,
            asset_type = EXCLUDED.asset_type,
            minting_method = EXCLUDED.minting_method,
            auto_increment_ids = EXCLUDED.auto_increment_ids,
            enumerable = EXCLUDED.enumerable,
            uri_storage = EXCLUDED.uri_storage,
            access_control = EXCLUDED.access_control,
            updatable_uris = EXCLUDED.updatable_uris,
            sales_config = EXCLUDED.sales_config,
            whitelist_config = EXCLUDED.whitelist_config,
            permission_config = EXCLUDED.permission_config;

        -- Migrate token attributes array
        IF token_record.blocks->'token_attributes' IS NOT NULL AND jsonb_array_length(token_record.blocks->'token_attributes') > 0 THEN
            FOR i IN 0..jsonb_array_length(token_record.blocks->'token_attributes')-1 LOOP
                INSERT INTO "public"."token_erc721_attributes" (
                    token_id,
                    trait_type,
                    values
                ) VALUES (
                    token_record.id,
                    (token_record.blocks->'token_attributes'->i->>'trait_type')::text,
                    (SELECT array_agg(v.value) 
                     FROM jsonb_array_elements_text(token_record.blocks->'token_attributes'->i->'values') as v(value))
                );
            END LOOP;
        END IF;
    END LOOP;

    -- Process other token standards similarly...
    -- (Add more token migration logic here - would need similar blocks for each token standard)
END;
$$;


--
-- Name: migrate_wallet_keys_to_vault(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.migrate_wallet_keys_to_vault() RETURNS TABLE(migrated_count integer, error_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    wallet_record RECORD;
    new_private_key_id uuid;
    new_mnemonic_id uuid;
    new_public_key_id uuid;
    migrated integer := 0;
    errors integer := 0;
BEGIN
    -- Migrate investor wallets (wallets table)
    FOR wallet_record IN 
        SELECT id, private_key, mnemonic, public_key, wallet_address, wallet_type
        FROM public.wallets 
        WHERE (private_key IS NOT NULL OR mnemonic IS NOT NULL OR public_key IS NOT NULL)
        AND (private_key_vault_id IS NULL OR mnemonic_vault_id IS NULL OR public_key_vault_id IS NULL)
    LOOP
        BEGIN
            -- Migrate private key
            IF wallet_record.private_key IS NOT NULL AND wallet_record.private_key_vault_id IS NULL THEN
                INSERT INTO public.key_vault_keys (key_id, encrypted_key, key_type, wallet_id, metadata)
                VALUES (
                    wallet_record.wallet_address || '_private_key',
                    wallet_record.private_key,
                    'private_key',
                    wallet_record.id,
                    jsonb_build_object('wallet_type', wallet_record.wallet_type, 'migrated_from', 'wallets', 'migrated_at', now())
                )
                RETURNING id INTO new_private_key_id;
                
                UPDATE public.wallets 
                SET private_key_vault_id = new_private_key_id
                WHERE id = wallet_record.id;
            END IF;
            
            -- Migrate mnemonic
            IF wallet_record.mnemonic IS NOT NULL AND wallet_record.mnemonic_vault_id IS NULL THEN
                INSERT INTO public.key_vault_keys (key_id, encrypted_key, key_type, wallet_id, metadata)
                VALUES (
                    wallet_record.wallet_address || '_mnemonic',
                    wallet_record.mnemonic,
                    'mnemonic',
                    wallet_record.id,
                    jsonb_build_object('wallet_type', wallet_record.wallet_type, 'migrated_from', 'wallets', 'migrated_at', now())
                )
                RETURNING id INTO new_mnemonic_id;
                
                UPDATE public.wallets 
                SET mnemonic_vault_id = new_mnemonic_id
                WHERE id = wallet_record.id;
            END IF;
            
            -- Migrate public key
            IF wallet_record.public_key IS NOT NULL AND wallet_record.public_key_vault_id IS NULL THEN
                INSERT INTO public.key_vault_keys (key_id, encrypted_key, key_type, wallet_id, metadata)
                VALUES (
                    wallet_record.wallet_address || '_public_key',
                    wallet_record.public_key,
                    'public_key',
                    wallet_record.id,
                    jsonb_build_object('wallet_type', wallet_record.wallet_type, 'migrated_from', 'wallets', 'migrated_at', now())
                )
                RETURNING id INTO new_public_key_id;
                
                UPDATE public.wallets 
                SET public_key_vault_id = new_public_key_id
                WHERE id = wallet_record.id;
            END IF;
            
            migrated := migrated + 1;
            
        EXCEPTION WHEN OTHERS THEN
            errors := errors + 1;
            RAISE NOTICE 'Error migrating wallet %: %', wallet_record.id, SQLERRM;
        END;
    END LOOP;
    
    RETURN QUERY SELECT migrated, errors;
END;
$$;


--
-- Name: FUNCTION migrate_wallet_keys_to_vault(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.migrate_wallet_keys_to_vault() IS 'Migrates existing wallet keys to key_vault_keys table. Run manually when ready to migrate.';


--
-- Name: prevent_duplicate_lifecycle_events(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.prevent_duplicate_lifecycle_events() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Check if a similar event was created in the last 5 seconds
  IF EXISTS (
    SELECT 1 FROM product_lifecycle_events
    WHERE product_id = NEW.product_id
      AND event_type = NEW.event_type
      AND created_at > (NEW.created_at - INTERVAL '5 seconds')
      AND created_at < NEW.created_at
      AND id != NEW.id
  ) THEN
    RAISE EXCEPTION 'Duplicate event detected: A similar event was created within the last 5 seconds';
  END IF;
  
  RETURN NEW;
END;
$$;


--
-- Name: projects_audit_function(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.projects_audit_function() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF (TG_OP = 'DELETE') THEN
        INSERT INTO audit_logs (action, entity_type, entity_id, old_data, timestamp)
        VALUES ('DELETE', 'project', OLD.id, row_to_json(OLD), NOW());
        RETURN OLD;
    ELSIF (TG_OP = 'UPDATE') THEN
        INSERT INTO audit_logs (action, entity_type, entity_id, old_data, new_data, timestamp)
        VALUES ('UPDATE', 'project', NEW.id, row_to_json(OLD), row_to_json(NEW), NOW());
        RETURN NEW;
    ELSIF (TG_OP = 'INSERT') THEN
        INSERT INTO audit_logs (action, entity_type, entity_id, new_data, timestamp)
        VALUES ('INSERT', 'project', NEW.id, row_to_json(NEW), NOW());
        RETURN NEW;
    END IF;
    RETURN NULL;
END;
$$;


--
-- Name: projects_audit_trigger(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.projects_audit_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Log project changes for compliance tracking
    INSERT INTO audit_logs (table_name, record_id, action, old_values, new_values, changed_by, changed_at)
    VALUES (
        'projects',
        COALESCE(NEW.id, OLD.id),
        TG_OP,
        CASE WHEN TG_OP = 'DELETE' THEN row_to_json(OLD) ELSE NULL END,
        CASE WHEN TG_OP != 'DELETE' THEN row_to_json(NEW) ELSE NULL END,
        current_user,
        now()
    );
    
    RETURN COALESCE(NEW, OLD);
END;
$$;


--
-- Name: purge_duplicate_lifecycle_events(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.purge_duplicate_lifecycle_events() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
  deleted_count INTEGER := 0;
  duplicate_record RECORD;
BEGIN
  -- Find duplicates
  FOR duplicate_record IN (
    SELECT 
      id,
      product_id,
      event_type,
      created_at,
      ROW_NUMBER() OVER (
        PARTITION BY product_id, event_type, 
        FLOOR(EXTRACT(EPOCH FROM created_at) / 5)  -- 5-second window
        ORDER BY created_at
      ) AS row_num
    FROM product_lifecycle_events
  )
  LOOP
    -- Delete all rows except the first one in each group
    IF duplicate_record.row_num > 1 THEN
      DELETE FROM product_lifecycle_events WHERE id = duplicate_record.id;
      deleted_count := deleted_count + 1;
    END IF;
  END LOOP;
  
  RETURN deleted_count;
END;
$$;


--
-- Name: reconcile_redemption_statistics(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.reconcile_redemption_statistics() RETURNS TABLE(window_id uuid, window_name text, before_requests integer, after_requests integer, before_value numeric, after_value numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    window_record RECORD;
BEGIN
    FOR window_record IN 
        SELECT rw.id, rw.name, rw.current_requests, rw.total_request_value
        FROM redemption_windows rw
        WHERE rw.is_active = true
    LOOP
        -- Store before values
        window_id := window_record.id;
        window_name := window_record.name;
        before_requests := window_record.current_requests;
        before_value := window_record.total_request_value;
        
        -- Update statistics
        PERFORM update_redemption_window_statistics(window_record.id);
        
        -- Get after values
        SELECT rw.current_requests, rw.total_request_value
        INTO after_requests, after_value
        FROM redemption_windows rw
        WHERE rw.id = window_record.id;
        
        RETURN NEXT;
    END LOOP;
END;
$$;


--
-- Name: refresh_activity_metrics(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.refresh_activity_metrics() RETURNS text
    LANGUAGE plpgsql
    AS $$
BEGIN
  REFRESH MATERIALIZED VIEW activity_metrics_daily;
  REFRESH MATERIALIZED VIEW activity_metrics_hourly;
  REFRESH MATERIALIZED VIEW user_activity_summary;
  
  RETURN 'SUCCESS: All views refreshed at ' || CURRENT_TIMESTAMP;
END;
$$;


--
-- Name: refresh_all_redemption_window_statistics(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.refresh_all_redemption_window_statistics() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    window_record RECORD;
    updated_count INTEGER := 0;
BEGIN
    -- Update statistics for all redemption windows
    FOR window_record IN 
        SELECT DISTINCT id FROM redemption_windows 
        WHERE is_active = true
    LOOP
        PERFORM update_redemption_window_statistics(window_record.id);
        updated_count := updated_count + 1;
    END LOOP;

    RAISE INFO 'Refreshed statistics for % redemption windows', updated_count;
    RETURN updated_count;
END;
$$;


--
-- Name: remove_investors_from_group(text, text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.remove_investors_from_group(p_group_id text, p_investor_ids text[]) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  sync_timestamp timestamp with time zone := NOW();
BEGIN
  -- Validate input
  IF p_group_id IS NULL THEN
    RAISE EXCEPTION 'Group ID cannot be NULL';
  END IF;

  IF p_investor_ids IS NULL OR array_length(p_investor_ids, 1) IS NULL THEN
    RAISE EXCEPTION 'Investor IDs array cannot be NULL or empty';
  END IF;

  -- Remove from the investor_group_members table (old)
  DELETE FROM investor_group_members
  WHERE group_id::text = p_group_id
  AND investor_id::text = ANY(p_investor_ids);

  -- Try to remove from investor_groups_investors table (new)
  -- This might fail due to RLS but we'll continue anyway
  BEGIN
    DELETE FROM investor_groups_investors
    WHERE group_id::text = p_group_id
    AND investor_id::text = ANY(p_investor_ids);
  EXCEPTION WHEN OTHERS THEN
    -- Log the error but continue - we at least removed from the old table
    RAISE NOTICE 'Error removing from investor_groups_investors: %', SQLERRM;
  END;

  -- Update the group member count
  UPDATE investor_groups
  SET 
    member_count = (SELECT get_unique_member_count(p_group_id)),
    updated_at = sync_timestamp
  WHERE id::text = p_group_id;
END;
$$;


--
-- Name: reserve_redemption_amounts(uuid[], numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_distribution RECORD;
    v_remaining_to_reserve NUMERIC := p_total_amount;
    v_amount_to_reserve NUMERIC;
BEGIN
    -- Handle null or empty array
    IF p_distribution_ids IS NULL OR array_length(p_distribution_ids, 1) IS NULL THEN
        RETURN false;
    END IF;
    
    -- Loop through distributions and reserve amounts
    FOR v_distribution IN 
        SELECT * FROM distributions 
        WHERE id = ANY(p_distribution_ids)
        ORDER BY distribution_date ASC
    LOOP
        EXIT WHEN v_remaining_to_reserve <= 0;
        
        v_amount_to_reserve := LEAST(
            v_remaining_to_reserve, 
            v_distribution.remaining_amount - COALESCE(v_distribution.redemption_locked_amount, 0)
        );
        
        IF v_amount_to_reserve > 0 THEN
            UPDATE distributions 
            SET 
                redemption_locked_amount = COALESCE(redemption_locked_amount, 0) + v_amount_to_reserve,
                updated_at = NOW()
            WHERE id = v_distribution.id;
            
            v_remaining_to_reserve := v_remaining_to_reserve - v_amount_to_reserve;
        END IF;
    END LOOP;
    
    RETURN v_remaining_to_reserve = 0;
END;
$$;


--
-- Name: rollback_transaction(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.rollback_transaction() RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Raise exception to trigger rollback in the client transaction
    RAISE EXCEPTION 'ROLLBACK_REQUESTED' USING ERRCODE = 'P0001';
    RETURN false; -- Never reached
END;
$$;


--
-- Name: safe_cast_to_uuid(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.safe_cast_to_uuid(input text) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
  result uuid;
BEGIN
  -- Check if it's already a valid UUID
  BEGIN
    result := input::uuid;
    RETURN result;
  EXCEPTION WHEN others THEN
    -- If it's the special admin value, return a specific UUID
    IF input = 'admin-bypass' THEN
      RETURN '00000000-0000-0000-0000-000000000000'::uuid;
    END IF;
    
    -- Otherwise, generate a new UUID
    RETURN gen_random_uuid();
  END;
END;
$$;


--
-- Name: safe_uuid_cast(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.safe_uuid_cast(text_id text) RETURNS uuid
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    result UUID;
BEGIN
    -- Try to cast to UUID directly
    BEGIN
        result := text_id::UUID;
        RETURN result;
    EXCEPTION WHEN others THEN
        -- If it fails, generate a deterministic UUID v5
        -- For admin bypass use a special UUID
        IF text_id = 'admin-bypass' THEN
            RETURN '00000000-0000-0000-0000-000000000000'::UUID;
        ELSE
            -- Generate a new UUID (in production you might want to use a deterministic algorithm)
            RETURN gen_random_uuid();
        END IF;
    END;
END;
$$;


--
-- Name: save_consensus_config(text, integer, text[]); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  v_config_id UUID;
  v_existing_id UUID;
BEGIN
  -- Check if we already have a config with this consensus type
  SELECT id INTO v_existing_id 
  FROM approval_configs 
  WHERE consensus_type = p_consensus_type;
  
  IF v_existing_id IS NOT NULL THEN
    -- Update existing record
    UPDATE approval_configs
    SET 
      required_approvals = p_required_approvals,
      eligible_roles = p_eligible_roles,
      updated_at = now()
    WHERE id = v_existing_id;
  ELSE
    -- Create a new standalone consensus config entry
    INSERT INTO consensus_settings (
      consensus_type,
      required_approvals,
      eligible_roles
    ) VALUES (
      p_consensus_type,
      p_required_approvals,
      p_eligible_roles
    );
  END IF;

  RETURN TRUE;
EXCEPTION
  WHEN OTHERS THEN
    RAISE NOTICE 'Error in save_consensus_config: %', SQLERRM;
    RETURN FALSE;
END;
$$;


--
-- Name: save_enhanced_risk_calculation(uuid, integer, numeric, numeric, jsonb, jsonb, character varying, text, jsonb, jsonb, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric DEFAULT 85.0, p_market_adjustments jsonb DEFAULT '{}'::jsonb, p_user_data_sources jsonb DEFAULT '[]'::jsonb, p_data_completeness character varying DEFAULT 'basic'::character varying, p_methodology text DEFAULT ''::text, p_factors_considered jsonb DEFAULT '[]'::jsonb, p_policy_impacts jsonb DEFAULT '[]'::jsonb, p_recommendations jsonb DEFAULT '[]'::jsonb) RETURNS uuid
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  calculation_id UUID;
  payer_id_val UUID;
BEGIN
  -- Get payer_id from receivable
  SELECT payer_id INTO payer_id_val
  FROM climate_receivables
  WHERE receivable_id = p_receivable_id;

  -- Insert risk calculation
  INSERT INTO climate_risk_calculations (
    receivable_id,
    payer_id,
    credit_risk_score,
    credit_risk_confidence,
    discount_rate_calculated,
    market_adjustments,
    user_data_sources,
    data_completeness,
    methodology_used,
    factors_considered,
    policy_impact_assessment,
    recommendations,
    calculation_date
  ) VALUES (
    p_receivable_id,
    payer_id_val,
    p_risk_score,
    p_confidence_level,
    p_discount_rate,
    p_market_adjustments,
    p_user_data_sources,
    p_data_completeness,
    p_methodology,
    p_factors_considered,
    p_policy_impacts,
    p_recommendations,
    NOW()
  ) RETURNING calculation_id INTO calculation_id;

  -- Update receivable with latest risk data
  UPDATE climate_receivables
  SET 
    risk_score = p_risk_score,
    discount_rate = p_discount_rate,
    updated_at = NOW()
  WHERE receivable_id = p_receivable_id;

  RETURN calculation_id;
END;
$$;


--
-- Name: FUNCTION save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb) IS 'Save enhanced risk calculation with market data';


--
-- Name: set_distribution_standard(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_distribution_standard() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  fallback_standard public.token_standard_enum;
BEGIN
  -- Step 1: Try to get it from token_allocations
  IF NEW.standard IS NULL THEN
    SELECT ta.standard
    INTO NEW.standard
    FROM public.token_allocations ta
    WHERE ta.id = NEW.token_allocation_id;

    -- Step 2: If still null, try to get from tokens via token_id
    IF NEW.standard IS NULL THEN
      SELECT t.standard
      INTO fallback_standard
      FROM public.tokens t
      JOIN public.token_allocations ta ON ta.token_id = t.id
      WHERE ta.id = NEW.token_allocation_id;

      NEW.standard := fallback_standard;
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: set_redemption_product_type_on_insert(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_redemption_product_type_on_insert() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Auto-populate all fields from associated project
    IF NEW.project_id IS NOT NULL THEN
        SELECT 
            p.project_type, 
            p.organization_id,
            get_product_id_for_project(p.id),
            get_project_target_raise(p.id)
        INTO 
            NEW.product_type, 
            NEW.organization_id,
            NEW.product_id,
            NEW.target_raise_amount
        FROM projects p
        WHERE p.id = NEW.project_id;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: set_token_allocation_standard(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_token_allocation_standard() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
begin
  -- Only attempt to update if token_id is present and standard is null
  if (NEW.token_id is not null and NEW.standard is null) then
    select t.standard into NEW.standard
    from public.tokens t
    where t.id = NEW.token_id;
  end if;
  return NEW;
end;
$$;


--
-- Name: set_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$;


--
-- Name: sidebar_config_matches_user(uuid[], public.profile_type[], uuid[], public.profile_type); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Check if user has any of the required roles
    IF config_role_ids IS NOT NULL AND array_length(config_role_ids, 1) > 0 THEN
        IF NOT (config_role_ids && user_role_ids) THEN
            RETURN FALSE;
        END IF;
    END IF;
    
    -- Check if user has required profile type
    IF config_profile_enums IS NOT NULL AND array_length(config_profile_enums, 1) > 0 THEN
        IF user_profile_type IS NULL OR NOT (user_profile_type = ANY(config_profile_enums)) THEN
            RETURN FALSE;
        END IF;
    END IF;
    
    RETURN TRUE;
END;
$$;


--
-- Name: sync_credential_vault_storage(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_credential_vault_storage() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Handle INSERT operations
    IF TG_OP = 'INSERT' THEN
        -- Insert corresponding record in credential_vault_storage
        INSERT INTO credential_vault_storage (
            id,
            credential_id,
            vault_id,
            encrypted_private_key,
            encryption_method,
            access_level,
            backup_created,
            created_at,
            updated_at
        ) VALUES (
            gen_random_uuid(),
            NEW.id,
            COALESCE(NEW.key_vault_id, 'vault_' || NEW.id),
            '', -- Will be populated by application
            'AES256',
            'standard',
            false,
            NOW(),
            NOW()
        )
        ON CONFLICT (credential_id) DO NOTHING; -- Prevent duplicates if record already exists
        
        RETURN NEW;
    END IF;
    
    -- Handle UPDATE operations
    IF TG_OP = 'UPDATE' THEN
        -- Update corresponding record in credential_vault_storage
        UPDATE credential_vault_storage 
        SET 
            vault_id = COALESCE(NEW.key_vault_id, 'vault_' || NEW.id),
            updated_at = NOW(),
            -- If credential is being revoked, mark it in vault storage
            revoked_at = CASE 
                WHEN NEW.revoked_at IS NOT NULL AND OLD.revoked_at IS NULL 
                THEN NEW.revoked_at 
                ELSE revoked_at 
            END,
            revoked_by = CASE 
                WHEN NEW.revoked_at IS NOT NULL AND OLD.revoked_at IS NULL 
                THEN NEW.created_by 
                ELSE revoked_by 
            END
        WHERE credential_id = NEW.id;
        
        -- If no record exists in vault storage, create one
        IF NOT FOUND THEN
            INSERT INTO credential_vault_storage (
                id,
                credential_id,
                vault_id,
                encrypted_private_key,
                encryption_method,
                access_level,
                backup_created,
                created_at,
                updated_at
            ) VALUES (
                gen_random_uuid(),
                NEW.id,
                COALESCE(NEW.key_vault_id, 'vault_' || NEW.id),
                '',
                'AES256',
                'standard',
                false,
                NOW(),
                NOW()
            );
        END IF;
        
        RETURN NEW;
    END IF;
    
    -- Handle DELETE operations
    IF TG_OP = 'DELETE' THEN
        -- Mark as revoked in vault storage (don't delete for audit trail)
        UPDATE credential_vault_storage 
        SET 
            revoked_at = NOW(),
            updated_at = NOW()
        WHERE credential_id = OLD.id;
        
        RETURN OLD;
    END IF;
    
    RETURN NULL;
END;
$$;


--
-- Name: sync_group_memberships(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_group_memberships(group_id_param text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  sync_timestamp timestamp with time zone := NOW();
BEGIN
  -- Validate input
  IF group_id_param IS NULL THEN
    RAISE EXCEPTION 'group_id_param cannot be NULL';
  END IF;

  -- First sync from old to new table for this group
  BEGIN
    INSERT INTO investor_groups_investors (id, group_id, investor_id, created_at)
    SELECT 
      gen_random_uuid()::text, -- Generate UUID for new records
      old.group_id,
      old.investor_id,
      COALESCE(old.created_at, sync_timestamp)
    FROM 
      investor_group_members old
    WHERE 
      old.group_id::text = group_id_param AND
      old.investor_id IS NOT NULL AND
      NOT EXISTS (
        SELECT 1 
        FROM investor_groups_investors new
        WHERE 
          new.group_id::text = old.group_id::text AND 
          new.investor_id::text = old.investor_id::text
      )
    ON CONFLICT (group_id, investor_id) DO NOTHING;
  EXCEPTION WHEN OTHERS THEN
    -- Log the error but continue with the next step
    RAISE NOTICE 'Error syncing from old to new table: %', SQLERRM;
  END;
  
  -- Then sync from new to old table for this group
  BEGIN
    INSERT INTO investor_group_members (group_id, investor_id, created_at)
    SELECT 
      new.group_id,
      new.investor_id,
      COALESCE(new.created_at, sync_timestamp)
    FROM 
      investor_groups_investors new
    WHERE 
      new.group_id::text = group_id_param AND
      new.investor_id IS NOT NULL AND
      NOT EXISTS (
        SELECT 1 
        FROM investor_group_members old
        WHERE 
          old.group_id::text = new.group_id::text AND 
          old.investor_id::text = new.investor_id::text
      )
    ON CONFLICT (group_id, investor_id) DO NOTHING;
  EXCEPTION WHEN OTHERS THEN
    -- Log the error but continue with the next step
    RAISE NOTICE 'Error syncing from new to old table: %', SQLERRM;
  END;
  
  -- Update the group member count
  BEGIN
    UPDATE investor_groups g
    SET 
      member_count = (
        SELECT get_unique_member_count(g.id::text)
      ),
      updated_at = sync_timestamp
    WHERE 
      g.id::text = group_id_param;
  EXCEPTION WHEN OTHERS THEN
    -- Log the error
    RAISE NOTICE 'Error updating group member count: %', SQLERRM;
  END;
END;
$$;


--
-- Name: sync_investor_group_memberships(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_investor_group_memberships() RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  sync_timestamp timestamp with time zone := NOW();
  v_group_id text;
  groups_cursor CURSOR FOR SELECT id FROM investor_groups WHERE id IS NOT NULL;
BEGIN
  -- Process one group at a time to avoid timeouts
  OPEN groups_cursor;
  LOOP
    FETCH groups_cursor INTO v_group_id;
    EXIT WHEN NOT FOUND;
    
    -- Call the single group sync function for each group
    PERFORM sync_group_memberships(v_group_id::text);
  END LOOP;
  CLOSE groups_cursor;
END;
$$;


--
-- Name: sync_redemption_product_type(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_redemption_product_type() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Update all redemption rules associated with this project
    UPDATE redemption_rules 
    SET product_type = NEW.project_type,
        organization_id = NEW.organization_id,
        product_id = get_product_id_for_project(NEW.id),
        target_raise_amount = get_project_target_raise(NEW.id),
        updated_at = NOW()
    WHERE project_id = NEW.id;
    
    RETURN NEW;
END;
$$;


--
-- Name: sync_redemption_rules_on_product_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_redemption_rules_on_product_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Update redemption rules when product records change
    IF TG_OP = 'INSERT' THEN
        UPDATE redemption_rules 
        SET product_id = NEW.id,
            updated_at = NOW()
        WHERE project_id = NEW.project_id 
            AND product_id IS NULL;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE redemption_rules 
        SET product_id = NULL,
            updated_at = NOW()
        WHERE product_id = OLD.id;
        RETURN OLD;
    END IF;
    
    RETURN NULL;
END;
$$;


--
-- Name: sync_redemption_target_raise_on_product_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_redemption_target_raise_on_product_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'UPDATE' AND (OLD.target_raise IS DISTINCT FROM NEW.target_raise) THEN
        -- Update redemption rules when product target_raise changes
        UPDATE redemption_rules 
        SET target_raise_amount = NEW.target_raise,
            updated_at = NOW()
        WHERE product_id = NEW.id;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: sync_user_to_profile(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_user_to_profile() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  -- When public.users is inserted/updated with auth_id, update profiles.user_id
  IF NEW.auth_id IS NOT NULL THEN
    UPDATE public.profiles
    SET user_id = NEW.id,
        updated_at = NOW()
    WHERE id = NEW.auth_id;
  END IF;
  
  RETURN NEW;
END;
$$;


--
-- Name: table_exists(text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.table_exists(p_schema_name text, p_table_name text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
    DECLARE
      exists boolean;
    BEGIN
      SELECT COUNT(*) > 0 INTO exists
      FROM information_schema.tables
      WHERE table_schema = p_schema_name
      AND table_name = p_table_name;
      
      RETURN exists;
    END;
    $$;


--
-- Name: track_system_process(text, text, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.track_system_process(process_name text, description text DEFAULT NULL::text, metadata jsonb DEFAULT NULL::jsonb) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
    process_id UUID;
BEGIN
    -- Create a new system process record
    INSERT INTO system_processes (
        id,
        process_name,
        description,
        status,
        start_time,
        metadata
    ) VALUES (
        uuid_generate_v4(),
        process_name,
        description,
        'running',
        NOW(),
        metadata
    ) RETURNING id INTO process_id;
    
    -- Return the created process ID
    RETURN process_id;
END;
$$;


--
-- Name: trigger_set_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_set_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: trigger_update_redemption_statistics(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_update_redemption_statistics() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    affected_window_id UUID;
BEGIN
    -- Handle INSERT/UPDATE
    IF TG_OP IN ('INSERT', 'UPDATE') THEN
        -- Update statistics for the new/updated window
        IF NEW.window_id IS NOT NULL THEN
            PERFORM update_redemption_window_statistics(NEW.window_id);
        END IF;
        
        IF NEW.redemption_window_id IS NOT NULL THEN
            PERFORM update_redemption_window_statistics(NEW.redemption_window_id);
        END IF;
        
        -- If UPDATE, also update the old window if it changed
        IF TG_OP = 'UPDATE' THEN
            IF OLD.window_id IS NOT NULL AND OLD.window_id != COALESCE(NEW.window_id, OLD.window_id) THEN
                PERFORM update_redemption_window_statistics(OLD.window_id);
            END IF;
            
            IF OLD.redemption_window_id IS NOT NULL AND OLD.redemption_window_id != COALESCE(NEW.redemption_window_id, OLD.redemption_window_id) THEN
                PERFORM update_redemption_window_statistics(OLD.redemption_window_id);
            END IF;
        END IF;
        
        RETURN NEW;
    END IF;
    
    -- Handle DELETE
    IF TG_OP = 'DELETE' THEN
        IF OLD.window_id IS NOT NULL THEN
            PERFORM update_redemption_window_statistics(OLD.window_id);
        END IF;
        
        IF OLD.redemption_window_id IS NOT NULL THEN
            PERFORM update_redemption_window_statistics(OLD.redemption_window_id);
        END IF;
        
        RETURN OLD;
    END IF;
    
    RETURN NULL;
END;
$$;


--
-- Name: universal_update_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.universal_update_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION universal_update_timestamp(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.universal_update_timestamp() IS 'Universal function for updating timestamp columns. Replaces multiple individual timestamp functions.';


--
-- Name: update_blackout_periods_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_blackout_periods_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_bulk_operation_progress(text, double precision, integer, integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer DEFAULT NULL::integer, p_failed_count integer DEFAULT NULL::integer, p_status character varying DEFAULT NULL::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_result BOOLEAN;
BEGIN
    UPDATE bulk_operations
    SET 
        progress = p_progress,
        processed_count = COALESCE(p_processed_count, processed_count),
        failed_count = COALESCE(p_failed_count, failed_count),
        status = COALESCE(p_status, status),
        metadata = jsonb_set(
            COALESCE(metadata, '{}'::jsonb),
            '{last_updated}',
            to_jsonb(NOW())
        )
    WHERE id = p_operation_id;
    
    GET DIAGNOSTICS v_result = ROW_COUNT;
    RETURN v_result > 0;
END;
$$;


--
-- Name: update_cache_access(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_cache_access() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.hit_count = OLD.hit_count + 1;
  NEW.last_accessed = NOW();
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_carbon_market_prices_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_carbon_market_prices_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_climate_cash_flow_projections(jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_climate_cash_flow_projections(p_projections jsonb) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
  projection JSONB;
  inserted_count INTEGER := 0;
  updated_count INTEGER := 0;
  error_count INTEGER := 0;
  result JSONB;
BEGIN
  -- Process each projection in the array
  FOR projection IN SELECT * FROM jsonb_array_elements(p_projections)
  LOOP
    BEGIN
      -- Insert or update projection
      INSERT INTO climate_cash_flow_projections (
        projection_date,
        projected_amount,
        source_type,
        entity_id,
        created_at,
        updated_at
      ) VALUES (
        (projection->>'projection_date')::DATE,
        (projection->>'projected_amount')::NUMERIC,
        projection->>'source_type',
        CASE 
          WHEN projection->>'entity_id' IS NOT NULL 
          THEN (projection->>'entity_id')::UUID 
          ELSE NULL 
        END,
        NOW(),
        NOW()
      )
      ON CONFLICT (projection_date, source_type) DO UPDATE SET
        projected_amount = EXCLUDED.projected_amount,
        updated_at = NOW();

      IF TG_OP = 'INSERT' THEN
        inserted_count := inserted_count + 1;
      ELSE
        updated_count := updated_count + 1;
      END IF;

    EXCEPTION
      WHEN OTHERS THEN
        error_count := error_count + 1;
        CONTINUE;
    END;
  END LOOP;

  result := jsonb_build_object(
    'success', TRUE,
    'inserted_count', inserted_count,
    'updated_count', updated_count,
    'error_count', error_count,
    'timestamp', NOW()
  );

  RETURN result;
END;
$$;


--
-- Name: update_climate_risk_calculations_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_climate_risk_calculations_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$;


--
-- Name: update_consensus_settings_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_consensus_settings_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_credential_vault_storage_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_credential_vault_storage_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$;


--
-- Name: update_distribution_remaining_amount(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_distribution_remaining_amount() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Update the remaining amount in the distribution
  UPDATE distributions
  SET 
    remaining_amount = remaining_amount - NEW.amount_redeemed,
    fully_redeemed = CASE WHEN (remaining_amount - NEW.amount_redeemed) <= 0 THEN true ELSE false END,
    updated_at = now()
  WHERE id = NEW.distribution_id;
  
  RETURN NEW;
END;
$$;


--
-- Name: update_energy_assets_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_energy_assets_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_group_member_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_group_member_count() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Update the member count based on both tables
  IF TG_OP = 'INSERT' OR TG_OP = 'DELETE' THEN
    -- Get the relevant group_id based on whether we're processing an insert or delete
    DECLARE
      group_id_val uuid;
    BEGIN
      IF TG_OP = 'INSERT' THEN
        group_id_val := NEW.group_id;
      ELSE -- DELETE
        group_id_val := OLD.group_id;
      END IF;
      
      -- Update the count considering both tables
      UPDATE public.investor_groups
      SET 
        member_count = (
          WITH combined_investors AS (
            -- Get all investor_ids from investor_groups_investors
            SELECT investor_id 
            FROM public.investor_groups_investors
            WHERE group_id = group_id_val
            UNION
            -- Get all investor_ids from investor_group_members
            SELECT investor_id
            FROM public.investor_group_members
            WHERE group_id = group_id_val
          )
          -- Count distinct investor_ids
          SELECT COUNT(DISTINCT investor_id) 
          FROM combined_investors
        ),
        updated_at = NOW()
      WHERE id = group_id_val;
    END;
  END IF;
  
  -- Return appropriate record
  IF TG_OP = 'INSERT' THEN
    RETURN NEW;
  ELSIF TG_OP = 'DELETE' THEN
    RETURN OLD;
  END IF;
  RETURN NULL;
END;
$$;


--
-- Name: update_individual_documents_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_individual_documents_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_modified_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_modified_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_oracle_prices(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_oracle_prices() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Example: For Treasuries, set oracle_price to 4.13% (2025-09-03 data); in prod, call API
  IF NEW.holding_type = 'Government Securities' THEN NEW.oracle_price := 4.13; END IF;  -- From search
  NEW.last_oracle_update := NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_project_organization_assignments_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_project_organization_assignments_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_proposal_execution(uuid, text, timestamp with time zone, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  UPDATE multi_sig_proposals
  SET 
    status = p_status,
    executed_at = p_executed_at,
    execution_hash = p_execution_hash,
    updated_at = NOW()
  WHERE id = p_proposal_id;
END;
$$;


--
-- Name: update_proposal_on_chain_submission(uuid, integer, text, boolean, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean DEFAULT true, p_status text DEFAULT 'submitted'::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  UPDATE public.multi_sig_proposals
  SET 
    on_chain_tx_id = p_on_chain_tx_id,
    on_chain_tx_hash = p_on_chain_tx_hash,
    submitted_on_chain = p_submitted_on_chain,
    status = p_status,
    updated_at = NOW()
  WHERE id = p_proposal_id;
END;
$$;


--
-- Name: update_proposal_signature_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_proposal_signature_count() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  v_proposal_id uuid;
  v_signature_count integer;
BEGIN
  -- Get the proposal_id from NEW or OLD
  v_proposal_id := COALESCE(NEW.proposal_id, OLD.proposal_id);
  
  -- Count valid signatures (this read should work as SECURITY DEFINER runs as postgres)
  SELECT COUNT(*) INTO v_signature_count
  FROM public.proposal_signatures
  WHERE proposal_id = v_proposal_id
    AND is_valid = true;
  
  -- Update the proposal - bypassing RLS by using a direct UPDATE in SECURITY DEFINER context
  -- The key is that this runs as the function owner (postgres) who has full access
  UPDATE public.multi_sig_proposals
  SET 
    signatures_collected = v_signature_count,
    updated_at = NOW()
  WHERE id = v_proposal_id;
  
  -- Return appropriate record
  IF (TG_OP = 'DELETE') THEN
    RETURN OLD;
  ELSE
    RETURN NEW;
  END IF;
END;
$$;


--
-- Name: update_proposal_signature_count(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_proposal_signature_count(proposal_id_param uuid, signature_count integer) RETURNS void
    LANGUAGE sql SECURITY DEFINER
    AS $$
  UPDATE public.multi_sig_proposals
  SET signatures_collected = signature_count
  WHERE id = proposal_id_param;
$$;


--
-- Name: update_proposal_status(uuid, text, timestamp with time zone, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone DEFAULT NULL::timestamp with time zone, p_execution_hash text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  UPDATE public.multi_sig_proposals
  SET 
    status = p_status,
    executed_at = COALESCE(p_executed_at, executed_at),
    execution_hash = COALESCE(p_execution_hash, execution_hash),
    updated_at = NOW()
  WHERE id = p_proposal_id;
END;
$$;


--
-- Name: update_redemption_approvers_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_redemption_approvers_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_redemption_window_statistics(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_redemption_window_statistics(window_uuid uuid) RETURNS void
    LANGUAGE plpgsql
    AS $_$
DECLARE
    total_requests_count INTEGER := 0;
    total_value NUMERIC := 0;
    approved_count INTEGER := 0;
    rejected_count INTEGER := 0;
    pending_count INTEGER := 0;
    calculated_approved_value NUMERIC := 0;  -- Renamed to avoid collision
    calculated_rejected_value NUMERIC := 0;  -- Renamed to avoid collision
    calculated_pending_value NUMERIC := 0;   -- Renamed to avoid collision
BEGIN
    -- Calculate statistics from redemption_requests
    SELECT 
        COUNT(*) as total_count,
        COALESCE(SUM(COALESCE(usdc_amount, token_amount, 0)), 0) as total_amount,
        COUNT(*) FILTER (WHERE status = 'approved') as approved_total,
        COUNT(*) FILTER (WHERE status = 'rejected') as rejected_total,
        COUNT(*) FILTER (WHERE status IN ('pending', 'submitted', 'processing')) as pending_total,
        COALESCE(SUM(COALESCE(usdc_amount, token_amount, 0)) FILTER (WHERE status = 'approved'), 0) as approved_amount,
        COALESCE(SUM(COALESCE(usdc_amount, token_amount, 0)) FILTER (WHERE status = 'rejected'), 0) as rejected_amount,
        COALESCE(SUM(COALESCE(usdc_amount, token_amount, 0)) FILTER (WHERE status IN ('pending', 'submitted', 'processing')), 0) as pending_amount
    INTO 
        total_requests_count, total_value, approved_count, rejected_count, pending_count,
        calculated_approved_value, calculated_rejected_value, calculated_pending_value
    FROM redemption_requests 
    WHERE (window_id = window_uuid OR redemption_window_id = window_uuid);

    -- Update redemption_windows table
    UPDATE redemption_windows 
    SET 
        current_requests = total_requests_count,
        total_request_value = total_value,
        approved_requests = approved_count,
        rejected_requests = rejected_count,
        queued_requests = pending_count,
        approved_value = calculated_approved_value,
        rejected_value = calculated_rejected_value,
        queued_value = calculated_pending_value,
        updated_at = NOW(),
        last_status_change_at = NOW()
    WHERE id = window_uuid;

    -- Log the update for audit purposes
    RAISE INFO 'Updated redemption window % with % requests, $% total value', 
               window_uuid, total_requests_count, total_value;

END;
$_$;


--
-- Name: update_redemption_window_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_redemption_window_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    
    -- Track status changes
    IF OLD.status IS DISTINCT FROM NEW.status OR 
       OLD.submission_status IS DISTINCT FROM NEW.submission_status OR 
       OLD.processing_status IS DISTINCT FROM NEW.processing_status THEN
        NEW.last_status_change_at = now();
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: update_restriction_rules_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_restriction_rules_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_ripple_payments_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_ripple_payments_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_ripple_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_ripple_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_rules_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_rules_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_security_events_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_security_events_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_settlement_operations_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_settlement_operations_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_settlement_status(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_settlement_status() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    
    -- Auto-complete settlement when both burn and transfer are confirmed
    IF NEW.burn_status = 'confirmed' AND NEW.transfer_status = 'confirmed' AND NEW.status != 'completed' THEN
        NEW.status = 'completed';
        NEW.actual_completion = NOW();
    END IF;
    
    -- Mark as failed if either operation fails
    IF (NEW.burn_status = 'failed' OR NEW.transfer_status = 'failed') AND NEW.status != 'failed' THEN
        NEW.status = 'failed';
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: update_sidebar_configurations_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_sidebar_configurations_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_sidebar_items_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_sidebar_items_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_sidebar_sections_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_sidebar_sections_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_signature_migrations_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_signature_migrations_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_smart_contract_wallet_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_smart_contract_wallet_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_stripe_conversion_transactions_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_stripe_conversion_transactions_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_stripe_stablecoin_accounts_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_stripe_stablecoin_accounts_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_system_process_progress(text, double precision, integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer DEFAULT NULL::integer, p_status character varying DEFAULT NULL::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_result BOOLEAN;
BEGIN
    UPDATE system_processes
    SET 
        progress = p_progress,
        metadata = jsonb_set(
            COALESCE(metadata, '{}'::jsonb),
            '{processed_count}',
            COALESCE(to_jsonb(p_processed_count), COALESCE(metadata->'processed_count', '0'::jsonb))
        ),
        status = COALESCE(p_status, status),
        updated_at = NOW()
    WHERE id = p_process_id;
    
    GET DIAGNOSTICS v_result = ROW_COUNT;
    RETURN v_result > 0;
END;
$$;


--
-- Name: update_system_process_status(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_system_process_status(process_id uuid, new_status text, error_details text DEFAULT NULL::text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    updated_rows INTEGER;
BEGIN
    -- Update the system process status
    UPDATE system_processes
    SET 
        status = new_status,
        end_time = CASE WHEN new_status IN ('completed', 'failed', 'cancelled') THEN NOW() ELSE end_time END,
        error_details = CASE WHEN new_status = 'failed' THEN error_details ELSE NULL END
    WHERE 
        id = process_id
    RETURNING 1 INTO updated_rows;
    
    -- Return true if the update was successful
    RETURN updated_rows = 1;
END;
$$;


--
-- Name: update_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_timestamp_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_timestamp_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
   NEW.updated_at = now(); 
   RETURN NEW;
END;
$$;


--
-- Name: update_token_exchange_configs_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_token_exchange_configs_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_token_modules_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_token_modules_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_total_assets(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_total_assets() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  UPDATE public.asset_nav_data
  SET total_assets = (SELECT SUM(value) FROM public.asset_holdings WHERE asset_id = NEW.asset_id),
      updated_at = NOW()
  WHERE asset_id = NEW.asset_id AND date = CURRENT_DATE;  -- Respects unique_asset_date
  RETURN NEW;
END;
$$;


--
-- Name: update_trade_finance_rewards_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_trade_finance_rewards_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_transfer_operations_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_transfer_operations_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_user_addresses_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_addresses_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_user_contract_roles_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_contract_roles_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_user_role(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_role(p_user_id uuid, p_role text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- First check if the role exists in roles table
  IF NOT EXISTS (SELECT 1 FROM roles WHERE name = p_role) THEN
    RAISE EXCEPTION 'Role "%" does not exist in the roles table', p_role;
  END IF;

  -- Delete any existing roles
  DELETE FROM user_roles WHERE user_id = p_user_id;
  
  -- Add the new role
  INSERT INTO user_roles (user_id, role, created_at, updated_at)
  VALUES (p_user_id, p_role, NOW(), NOW());
END;
$$;


--
-- Name: update_user_sidebar_preferences_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_sidebar_preferences_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


--
-- Name: update_wallet_locks_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_wallet_locks_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_wallet_signatories_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_wallet_signatories_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$;


--
-- Name: update_wallet_transaction_drafts_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_wallet_transaction_drafts_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_whitelist_entries_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_whitelist_entries_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$;


--
-- Name: upsert_address_selection(uuid, uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text DEFAULT 'transfer_tab'::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  INSERT INTO recent_address_selections (user_id, project_id, address, selected_at, context)
  VALUES (p_user_id, p_project_id, LOWER(p_address), now(), p_context)
  ON CONFLICT (user_id, COALESCE(project_id, '00000000-0000-0000-0000-000000000000'::uuid), LOWER(address))
  DO UPDATE SET 
    selected_at = now(),
    context = p_context,
    updated_at = now();
END;
$$;


--
-- Name: FUNCTION upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text) IS 'Upserts address selection, updating selected_at timestamp if already exists';


--
-- Name: upsert_policy_template_approver(uuid, uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text DEFAULT 'pending'::text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- First try to update any existing record
  UPDATE policy_template_approvers
  SET 
    created_by = p_created_by,
    status = p_status,
    timestamp = NOW()
  WHERE 
    template_id = p_template_id AND
    user_id = p_user_id;
    
  -- If no record was updated, insert a new one
  IF NOT FOUND THEN
    INSERT INTO policy_template_approvers (
      template_id, 
      user_id, 
      created_by, 
      status, 
      timestamp
    ) VALUES (
      p_template_id,
      p_user_id,
      p_created_by,
      p_status,
      NOW()
    );
  END IF;
END;
$$;


--
-- Name: FUNCTION upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text) IS 'Safely adds or updates approvers for a policy template without creating duplicates.';


--
-- Name: user_has_delete_permission(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.user_has_delete_permission(p_user_id uuid) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    -- Check if the current user has the necessary role permissions
    RETURN EXISTS (
        SELECT 1
        FROM user_roles ur
        WHERE ur.user_id = auth.uid()
        AND ur.role IN ('superAdmin', 'owner', 'complianceManager', 'admin', 'Super Admin', 'Owner', 'Compliance Manager')
    );
END;
$$;


--
-- Name: validate_blockchain_address(text, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_blockchain_address(blockchain text, address text) RETURNS boolean
    LANGUAGE plpgsql
    AS $_$
BEGIN
  -- Ethereum, Polygon, Avalanche, Optimism, Base, ZkSync, Arbitrum, Mantle, Hedera (EVM-compatible)
  IF blockchain IN ('ethereum', 'polygon', 'avalanche', 'optimism', 'base', 'zksync', 'arbitrum', 'mantle', 'hedera') THEN
    RETURN address ~* '^0x[a-fA-F0-9]{40}$';
  -- Bitcoin
  ELSIF blockchain = 'bitcoin' THEN
    RETURN address ~* '^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,62}$';
  -- Ripple (XRP)
  ELSIF blockchain = 'ripple' THEN
    RETURN address ~* '^r[a-zA-Z0-9]{24,34}$';
  -- Solana
  ELSIF blockchain = 'solana' THEN
    RETURN address ~* '^[1-9A-HJ-NP-Za-km-z]{32,44}$';
  -- Aptos
  ELSIF blockchain = 'aptos' THEN
    RETURN address ~* '^0x[a-fA-F0-9]{1,64}$';
  -- Sui
  ELSIF blockchain = 'sui' THEN
    RETURN address ~* '^0x[a-fA-F0-9]{1,64}$';
  -- Stellar
  ELSIF blockchain = 'stellar' THEN
    RETURN address ~* '^G[A-Z0-9]{55}$';
  -- NEAR
  ELSIF blockchain = 'near' THEN
    RETURN address ~* '^[a-z0-9_-]{2,64}(\.near)?$';
  -- Default case for unsupported blockchains
  ELSE
    RETURN TRUE; -- Allow any address format for unsupported blockchains
  END IF;
END;
$_$;


--
-- Name: validate_document_config(jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_document_config(config jsonb) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE
    AS $$
BEGIN
  IF config IS NULL THEN
    RETURN TRUE;
  END IF;
  
  -- Must have documents array
  IF NOT (config ? 'documents') THEN
    RETURN FALSE;
  END IF;
  
  -- documents must be an array
  IF jsonb_typeof(config->'documents') != 'array' THEN
    RETURN FALSE;
  END IF;
  
  RETURN TRUE;
END;
$$;


--
-- Name: validate_geographic_restriction(uuid, character, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric DEFAULT NULL::numeric) RETURNS TABLE(is_allowed boolean, restriction_type text, max_ownership_percentage numeric, requires_enhanced_dd boolean, blocking_reason text)
    LANGUAGE plpgsql
    AS $$
DECLARE
  restriction_record RECORD;
  token_record RECORD;
  jurisdiction_record RECORD;
BEGIN
  -- Get token settings
  SELECT use_geographic_restrictions, default_restriction_policy 
  INTO token_record
  FROM public.tokens t
  LEFT JOIN public.token_erc20_properties erc20 ON t.id = erc20.token_id AND t.standard = 'ERC-20'
  LEFT JOIN public.token_erc721_properties erc721 ON t.id = erc721.token_id AND t.standard = 'ERC-721'
  LEFT JOIN public.token_erc1155_properties erc1155 ON t.id = erc1155.token_id AND t.standard = 'ERC-1155'
  LEFT JOIN public.token_erc1400_properties erc1400 ON t.id = erc1400.token_id AND t.standard = 'ERC-1400'
  LEFT JOIN public.token_erc3525_properties erc3525 ON t.id = erc3525.token_id AND t.standard = 'ERC-3525'
  LEFT JOIN public.token_erc4626_properties erc4626 ON t.id = erc4626.token_id AND t.standard = 'ERC-4626'
  WHERE t.id = p_token_id;

  -- If geographic restrictions not enabled, use default policy
  IF NOT COALESCE(token_record.use_geographic_restrictions, false) THEN
    RETURN QUERY SELECT 
      CASE WHEN COALESCE(token_record.default_restriction_policy, 'allowed') = 'allowed' THEN true ELSE false END,
      'none'::TEXT,
      NULL::NUMERIC,
      false,
      CASE WHEN COALESCE(token_record.default_restriction_policy, 'allowed') = 'blocked' 
           THEN 'Geographic restrictions not configured' 
           ELSE NULL END;
    RETURN;
  END IF;

  -- Get jurisdiction info
  SELECT sanctions_risk_level, is_ofac_sanctioned, is_eu_sanctioned, is_un_sanctioned
  INTO jurisdiction_record
  FROM public.geographic_jurisdictions
  WHERE country_code = p_investor_country_code;

  -- Check for auto-sanctions blocking
  IF COALESCE(jurisdiction_record.is_ofac_sanctioned, false) OR 
     COALESCE(jurisdiction_record.is_eu_sanctioned, false) OR 
     COALESCE(jurisdiction_record.is_un_sanctioned, false) THEN
    RETURN QUERY SELECT 
      false,
      'blocked'::TEXT,
      NULL::NUMERIC,
      false,
      'Country is subject to international sanctions';
    RETURN;
  END IF;

  -- Check specific restriction rules
  SELECT * INTO restriction_record
  FROM public.token_geographic_restrictions
  WHERE token_id = p_token_id 
    AND country_code = p_investor_country_code
    AND (effective_date IS NULL OR effective_date <= CURRENT_DATE)
    AND (expiry_date IS NULL OR expiry_date > CURRENT_DATE);

  -- If specific rule exists, apply it
  IF FOUND THEN
    CASE restriction_record.restriction_type
      WHEN 'blocked' THEN
        RETURN QUERY SELECT 
          false,
          'blocked'::TEXT,
          restriction_record.max_ownership_percentage,
          false,
          'Country is blocked for this token';
      WHEN 'allowed' THEN
        RETURN QUERY SELECT 
          true,
          'allowed'::TEXT,
          restriction_record.max_ownership_percentage,
          false,
          NULL::TEXT;
      WHEN 'limited' THEN
        RETURN QUERY SELECT 
          true,
          'limited'::TEXT,
          restriction_record.max_ownership_percentage,
          false,
          NULL::TEXT;
      WHEN 'enhanced_dd' THEN
        RETURN QUERY SELECT 
          true,
          'enhanced_dd'::TEXT,
          restriction_record.max_ownership_percentage,
          true,
          NULL::TEXT;
      ELSE
        RETURN QUERY SELECT 
          false,
          'unknown'::TEXT,
          NULL::NUMERIC,
          false,
          'Unknown restriction type';
    END CASE;
  ELSE
    -- No specific rule, use default policy
    RETURN QUERY SELECT 
      CASE WHEN COALESCE(token_record.default_restriction_policy, 'allowed') = 'allowed' THEN true ELSE false END,
      'default'::TEXT,
      NULL::NUMERIC,
      false,
      CASE WHEN COALESCE(token_record.default_restriction_policy, 'allowed') = 'blocked' 
           THEN 'Country not in allowed list' 
           ELSE NULL END;
  END IF;

END;
$$;


--
-- Name: FUNCTION validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric) IS 'Validates if an investor from a specific country can invest in a token';


--
-- Name: validate_project_type(text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_project_type(p_project_type text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    valid_types text[] := ARRAY[
        -- Traditional Assets
        'structured_products',
        'equity', 
        'commodities',
        'funds_etfs_etps',
        'bonds',
        'quantitative_investment_strategies',
        -- Alternative Assets
        'private_equity',
        'private_debt',
        'real_estate',
        'energy',
        'infrastructure',
        'collectibles',
        'receivables',
        'solar_wind_climate',
        -- Digital Assets
        'digital_tokenised_fund',
        'fiat_backed_stablecoin',
        'crypto_backed_stablecoin',
        'commodity_backed_stablecoin',
        'algorithmic_stablecoin',
        'rebasing_stablecoin'
    ];
BEGIN
    RETURN p_project_type = ANY(valid_types);
END;
$$;


--
-- Name: FUNCTION validate_project_type(p_project_type text); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_project_type(p_project_type text) IS 'Validates project type against allowed values for Traditional, Alternative, and Digital assets including all stablecoin types';


--
-- Name: validate_redemption_amount(uuid, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric) RETURNS TABLE(is_valid boolean, error_message text, available_capacity numeric, target_raise_amount numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_capacity_info RECORD;
BEGIN
    -- Get current capacity information
    SELECT * INTO v_capacity_info
    FROM get_redemption_capacity(p_redemption_rule_id);
    
    -- Check if target_raise is set
    IF v_capacity_info.target_raise_amount IS NULL THEN
        RETURN QUERY SELECT 
            TRUE as is_valid,
            NULL as error_message,
            NULL as available_capacity,
            NULL as target_raise_amount;
        RETURN;
    END IF;
    
    -- Check if requested amount exceeds available capacity
    IF p_requested_amount > v_capacity_info.available_capacity THEN
        RETURN QUERY SELECT 
            FALSE as is_valid,
            format('Requested amount %s exceeds available capacity %s (%.2f%% of target raise already redeemed)', 
                   p_requested_amount::TEXT, 
                   v_capacity_info.available_capacity::TEXT,
                   v_capacity_info.capacity_percentage) as error_message,
            v_capacity_info.available_capacity,
            v_capacity_info.target_raise_amount;
        RETURN;
    END IF;
    
    -- Validation passed
    RETURN QUERY SELECT 
        TRUE as is_valid,
        format('Valid redemption: %s of %s available (%.2f%% capacity remaining)', 
               p_requested_amount::TEXT, 
               v_capacity_info.available_capacity::TEXT,
               100 - COALESCE(v_capacity_info.capacity_percentage, 0)) as error_message,
        v_capacity_info.available_capacity,
        v_capacity_info.target_raise_amount;
END;
$$;


--
-- Name: validate_subscription_project_consistency(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_subscription_project_consistency() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_fund_project_id UUID;
BEGIN
  -- Skip if no product_id
  IF NEW.product_id IS NULL THEN
    RETURN NEW;
  END IF;
  
  -- Get the project_id from fund_products
  SELECT project_id INTO v_fund_project_id
  FROM fund_products
  WHERE id = NEW.product_id;
  
  -- If fund not found, raise error
  IF v_fund_project_id IS NULL THEN
    RAISE EXCEPTION 'Product % not found in fund_products', NEW.product_id;
  END IF;
  
  -- If project_id doesn't match, raise error
  IF NEW.project_id IS NOT NULL AND NEW.project_id != v_fund_project_id THEN
    RAISE EXCEPTION 'Project ID mismatch: subscription project_id (%) does not match fund project_id (%)', 
      NEW.project_id, v_fund_project_id;
  END IF;
  
  -- Auto-set project_id if not provided
  IF NEW.project_id IS NULL THEN
    NEW.project_id := v_fund_project_id;
  END IF;
  
  RETURN NEW;
END;
$$;


--
-- Name: FUNCTION validate_subscription_project_consistency(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_subscription_project_consistency() IS 'Ensures subscription project_id matches the fund_products project_id';


--
-- Name: validate_token_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_token_data() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Ensure blocks has required fields based on token standard
    IF NEW.standard = 'ERC-20' AND NOT (NEW.blocks->>'name' IS NOT NULL AND NEW.blocks->>'symbol' IS NOT NULL) THEN
        RAISE EXCEPTION 'ERC-20 tokens require name and symbol in blocks data';
    END IF;
    
    -- Other validations as needed
    
    RETURN NEW;
END;
$$;


--
-- Name: validate_token_exists(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_token_exists() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Check if the token_id exists in tokens table
    IF NOT EXISTS (SELECT 1 FROM tokens WHERE id = NEW.token_id) THEN
        RAISE EXCEPTION 'Token with id % does not exist in tokens table', NEW.token_id;
    END IF;
    
    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION validate_token_exists(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_token_exists() IS 'Validates that token_id exists in tokens table before insert/update operations';


--
-- Name: validate_vesting_config(jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_vesting_config(config jsonb) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE
    AS $$
BEGIN
  IF config IS NULL THEN
    RETURN TRUE;
  END IF;
  
  -- Must have schedules array
  IF NOT (config ? 'schedules') THEN
    RETURN FALSE;
  END IF;
  
  -- schedules must be an array
  IF jsonb_typeof(config->'schedules') != 'array' THEN
    RETURN FALSE;
  END IF;
  
  RETURN TRUE;
END;
$$;


--
-- Name: validate_wallet_address(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_wallet_address() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF NOT validate_blockchain_address(NEW.blockchain, NEW.address) THEN
    RAISE EXCEPTION 'Invalid address format for blockchain %', NEW.blockchain;
  END IF;
  RETURN NEW;
END;
$$;


--
-- Name: validate_whitelist_config_permissive(jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_whitelist_config_permissive(config jsonb) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- If config is NULL, it's valid (optional field)
  IF config IS NULL THEN
    RETURN TRUE;
  END IF;
  
  -- Must be an object (allow empty objects)
  IF jsonb_typeof(config) != 'object' THEN
    RETURN FALSE;
  END IF;
  
  -- If it's an empty object, it's valid
  IF config = '{}'::jsonb THEN
    RETURN TRUE;
  END IF;
  
  -- If enabled field exists, it must be boolean
  IF config ? 'enabled' AND jsonb_typeof(config->'enabled') != 'boolean' THEN
    RETURN FALSE;
  END IF;
  
  -- If addresses field exists, it must be an array
  IF config ? 'addresses' AND jsonb_typeof(config->'addresses') != 'array' THEN
    RETURN FALSE;
  END IF;
  
  -- If whitelistType field exists, it must be a string
  IF config ? 'whitelistType' AND jsonb_typeof(config->'whitelistType') != 'string' THEN
    RETURN FALSE;
  END IF;
  
  RETURN TRUE;
END;
$$;


--
-- Name: FUNCTION validate_whitelist_config_permissive(config jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_whitelist_config_permissive(config jsonb) IS 'Permissive validation for whitelist configuration JSON structure across all ERC standards - allows empty objects and flexible structure';


--
-- Name: verify_multi_sig_proposals_access(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.verify_multi_sig_proposals_access() RETURNS TABLE(table_exists boolean, row_count bigint, has_permissions boolean)
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
  RETURN QUERY
  SELECT 
    EXISTS(SELECT FROM pg_tables WHERE schemaname = 'public' AND tablename = 'multi_sig_proposals') as table_exists,
    (SELECT COUNT(*) FROM public.multi_sig_proposals) as row_count,
    has_table_privilege('authenticated', 'public.multi_sig_proposals', 'SELECT') as has_permissions;
END;
$$;


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: abs_cash_flows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.abs_cash_flows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_backed_product_id uuid NOT NULL,
    abs_tranche_id uuid,
    payment_date timestamp with time zone NOT NULL,
    is_actual boolean DEFAULT false,
    collection_period_start timestamp with time zone NOT NULL,
    collection_period_end timestamp with time zone NOT NULL,
    beginning_pool_balance numeric(20,2) NOT NULL,
    principal_collections numeric(20,2) NOT NULL,
    scheduled_principal numeric(20,2),
    unscheduled_principal numeric(20,2),
    interest_collections numeric(20,2) NOT NULL,
    fees_collections numeric(20,2),
    recoveries numeric(20,2),
    total_collections numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    servicing_fee numeric(20,2),
    trustee_fee numeric(20,2),
    other_fees numeric(20,2),
    net_available_funds numeric(20,2),
    senior_interest_paid numeric(20,2),
    senior_principal_paid numeric(20,2),
    mezzanine_interest_paid numeric(20,2),
    mezzanine_principal_paid numeric(20,2),
    subordinated_interest_paid numeric(20,2),
    subordinated_principal_paid numeric(20,2),
    equity_distribution numeric(20,2),
    reserve_account_deposit numeric(20,2),
    reserve_account_withdrawal numeric(20,2),
    ending_reserve_balance numeric(20,2),
    ending_pool_balance numeric(20,2) NOT NULL,
    pool_factor numeric(5,4),
    losses numeric(20,2),
    cumulative_losses numeric(20,2),
    delinquencies numeric(20,2),
    prepayment_rate numeric(5,2),
    default_rate numeric(5,2),
    waterfall_distribution jsonb,
    trigger_breaches jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE abs_cash_flows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.abs_cash_flows IS 'Actual and projected cash flow waterfalls';


--
-- Name: abs_collateral_pools; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.abs_collateral_pools (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_backed_product_id uuid NOT NULL,
    pool_cut_off_date timestamp with time zone NOT NULL,
    reporting_period_end timestamp with time zone NOT NULL,
    total_pool_balance numeric(20,2) NOT NULL,
    number_of_loans integer NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    collateral_type character varying(50) NOT NULL,
    weighted_average_coupon numeric(5,4),
    weighted_average_maturity_months integer,
    weighted_average_fico_score integer,
    weighted_average_ltv numeric(5,2),
    weighted_average_dti numeric(5,2),
    weighted_average_seasoning_months integer,
    geographic_concentration jsonb,
    top_10_obligors_percentage numeric(5,2),
    concentration_limits_compliant boolean DEFAULT true,
    current_performing_balance numeric(20,2),
    delinquent_30_days_balance numeric(20,2),
    delinquent_60_days_balance numeric(20,2),
    delinquent_90_days_balance numeric(20,2),
    delinquent_120_plus_days_balance numeric(20,2),
    defaulted_balance numeric(20,2),
    delinquency_rate numeric(5,2),
    default_rate numeric(5,2),
    cumulative_loss_rate numeric(5,2),
    recovery_rate numeric(5,2),
    loss_severity numeric(5,2),
    prepayment_rate numeric(5,2),
    abs_prepayment_speed integer,
    pool_factor numeric(5,4),
    advance_rate numeric(5,2),
    excess_spread numeric(5,4),
    reserve_account_balance numeric(20,2),
    reserve_account_target numeric(20,2),
    is_reserve_account_funded boolean,
    servicer_name character varying(255),
    servicer_rating character varying(10),
    servicing_fee_rate numeric(5,4),
    trustee_name character varying(255),
    static_pool_performance jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE abs_collateral_pools; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.abs_collateral_pools IS 'Underlying collateral pool composition';


--
-- Name: abs_loss_projections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.abs_loss_projections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_backed_product_id uuid NOT NULL,
    projection_date timestamp with time zone NOT NULL,
    scenario_name character varying(100) NOT NULL,
    scenario_description text,
    projection_horizon_months integer NOT NULL,
    projected_cumulative_loss_rate numeric(5,2) NOT NULL,
    projected_cumulative_losses numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    expected_default_rate numeric(5,2),
    expected_recovery_rate numeric(5,2),
    expected_loss_severity numeric(5,2),
    expected_losses_by_year jsonb,
    peak_loss_year integer,
    peak_loss_amount numeric(20,2),
    time_to_peak_losses_months integer,
    tail_losses numeric(20,2),
    economic_assumptions jsonb,
    unemployment_rate_assumption numeric(5,2),
    home_price_index_assumption numeric(5,2),
    interest_rate_assumption numeric(5,4),
    macroeconomic_scenario character varying(50),
    collateral_performance_assumptions jsonb,
    loss_timing_assumptions text,
    confidence_level numeric(5,2),
    loss_distribution jsonb,
    tranche_coverage jsonb,
    first_loss_tranche character varying(10),
    attachment_point numeric(5,2),
    detachment_point numeric(5,2),
    expected_tranche_losses jsonb,
    stress_test_results jsonb,
    model_used character varying(100),
    model_version character varying(20),
    model_assumptions text,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE abs_loss_projections; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.abs_loss_projections IS 'Expected loss scenarios and stress tests';


--
-- Name: abs_prepayment_speeds; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.abs_prepayment_speeds (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_backed_product_id uuid NOT NULL,
    observation_date timestamp with time zone NOT NULL,
    prepayment_type character varying(50) NOT NULL,
    prepayment_rate numeric(5,2) NOT NULL,
    single_monthly_mortality numeric(5,4),
    constant_prepayment_rate numeric(5,2),
    abs_prepayment_speed integer,
    psa_percentage integer,
    voluntary_prepayments numeric(20,2),
    involuntary_prepayments numeric(20,2),
    total_prepayments numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    prepayment_drivers jsonb,
    interest_rate_environment numeric(5,4),
    refinancing_incentive numeric(5,4),
    burnout_factor numeric(5,4),
    seasonal_factors jsonb,
    projected_prepayment_rate numeric(5,2),
    prepayment_sensitivity jsonb,
    model_used character varying(100),
    model_assumptions text,
    historical_average_3m numeric(5,2),
    historical_average_12m numeric(5,2),
    historical_average_life numeric(5,2),
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE abs_prepayment_speeds; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.abs_prepayment_speeds IS 'Historical and projected prepayment rates';


--
-- Name: abs_tranches; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.abs_tranches (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_backed_product_id uuid NOT NULL,
    tranche_name character varying(100) NOT NULL,
    tranche_class character varying(10) NOT NULL,
    seniority_level integer NOT NULL,
    is_senior boolean DEFAULT false,
    is_mezzanine boolean DEFAULT false,
    is_subordinated boolean DEFAULT false,
    is_equity boolean DEFAULT false,
    original_principal numeric(20,2) NOT NULL,
    current_principal numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    coupon_rate numeric(5,4) NOT NULL,
    coupon_type character varying(50),
    reference_rate character varying(50),
    spread_bps integer,
    payment_frequency character varying(20),
    first_payment_date timestamp with time zone NOT NULL,
    legal_final_maturity timestamp with time zone NOT NULL,
    expected_maturity_date timestamp with time zone,
    weighted_average_life numeric(5,2),
    credit_enhancement_percentage numeric(5,2),
    subordination_percentage numeric(5,2),
    over_collateralization_percentage numeric(5,2),
    credit_rating_moodys character varying(10),
    credit_rating_sp character varying(10),
    credit_rating_fitch character varying(10),
    rating_date timestamp with time zone,
    is_investment_grade boolean,
    enhancement_triggers jsonb,
    payment_priority integer,
    principal_payment_method character varying(50),
    call_provisions jsonb,
    is_callable boolean DEFAULT false,
    call_date timestamp with time zone,
    call_price numeric(5,2),
    prepayment_lockout_end timestamp with time zone,
    yield_to_maturity numeric(5,4),
    yield_to_call numeric(5,4),
    duration numeric(5,2),
    convexity numeric(10,4),
    price_as_of_date timestamp with time zone,
    current_price numeric(20,8),
    status character varying(20) DEFAULT 'performing'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE abs_tranches; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.abs_tranches IS 'ABS tranche structure and payment terms';


--
-- Name: distributions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.distributions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_allocation_id uuid NOT NULL,
    investor_id uuid NOT NULL,
    subscription_id uuid NOT NULL,
    project_id uuid,
    token_type text NOT NULL,
    token_amount numeric NOT NULL,
    distribution_date timestamp with time zone NOT NULL,
    distribution_tx_hash text NOT NULL,
    wallet_id uuid,
    blockchain text NOT NULL,
    token_address text,
    token_symbol text,
    to_address text NOT NULL,
    status text DEFAULT 'confirmed'::text NOT NULL,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    remaining_amount numeric NOT NULL,
    fully_redeemed boolean DEFAULT false NOT NULL,
    standard public.token_standard_enum,
    redemption_status text,
    redemption_percentage_used numeric DEFAULT 0,
    redemption_locked_amount numeric DEFAULT 0,
    CONSTRAINT distributions_remaining_amount_check CHECK ((remaining_amount >= (0)::numeric)),
    CONSTRAINT distributions_token_amount_check CHECK ((token_amount > (0)::numeric))
);


--
-- Name: TABLE distributions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.distributions IS 'Records of confirmed token distributions with blockchain transaction data';


--
-- Name: redemption_rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_rules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    rule_id uuid,
    redemption_type text NOT NULL,
    require_multi_sig_approval boolean DEFAULT true,
    required_approvers integer DEFAULT 2,
    total_approvers integer DEFAULT 3,
    notify_investors boolean DEFAULT true,
    settlement_method text DEFAULT 'stablecoin'::text,
    immediate_execution boolean,
    use_latest_nav boolean,
    allow_any_time_redemption boolean,
    repurchase_frequency text,
    lock_up_period integer,
    submission_window_days integer,
    lock_tokens_on_request boolean,
    use_window_nav boolean,
    enable_pro_rata_distribution boolean,
    queue_unprocessed_requests boolean,
    enable_admin_override boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    organization_id uuid,
    product_type text,
    product_id uuid,
    is_redemption_open boolean DEFAULT false,
    open_after_date timestamp with time zone,
    allow_continuous_redemption boolean DEFAULT false,
    max_redemption_percentage numeric,
    redemption_eligibility_rules jsonb DEFAULT '{}'::jsonb,
    target_raise_amount numeric,
    redemption_window_id uuid,
    approval_config_id uuid,
    CONSTRAINT redemption_rules_max_percentage_check CHECK (((max_redemption_percentage IS NULL) OR (max_redemption_percentage <= (100)::numeric) OR (target_raise_amount IS NULL))),
    CONSTRAINT redemption_rules_product_type_check CHECK ((product_type = ANY (ARRAY['structured_products'::text, 'equity'::text, 'commodities'::text, 'funds_etfs_etps'::text, 'bonds'::text, 'quantitative_investment_strategies'::text, 'private_equity'::text, 'private_debt'::text, 'real_estate'::text, 'energy'::text, 'infrastructure'::text, 'collectibles'::text, 'receivables'::text, 'solar_wind_climate'::text, 'digital_tokenised_fund'::text, 'fiat_backed_stablecoin'::text, 'crypto_backed_stablecoin'::text, 'commodity_backed_stablecoin'::text, 'algorithmic_stablecoin'::text, 'rebasing_stablecoin'::text]))),
    CONSTRAINT redemption_rules_redemption_type_check CHECK ((redemption_type = ANY (ARRAY['standard'::text, 'interval'::text]))),
    CONSTRAINT redemption_rules_settlement_method_check CHECK ((settlement_method = ANY (ARRAY['stablecoin'::text, 'fiat'::text, 'hybrid'::text])))
);


--
-- Name: COLUMN redemption_rules.product_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_rules.product_type IS 'Automatically synchronized with projects.project_type via triggers. Represents the financial product category for this redemption rule.';


--
-- Name: COLUMN redemption_rules.product_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_rules.product_id IS 'Foreign key to the specific product record in the appropriate product table based on project_type. Automatically managed via triggers.';


--
-- Name: COLUMN redemption_rules.target_raise_amount; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_rules.target_raise_amount IS 'Maximum redeemable amount (100% of product/project target_raise). Auto-synced from product tables.';


--
-- Name: redemption_eligibility; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.redemption_eligibility AS
 SELECT d.id AS distribution_id,
    d.investor_id,
    d.project_id,
    d.token_amount AS total_distributed,
    d.remaining_amount,
    d.redemption_percentage_used,
    d.fully_redeemed,
    rr.id AS rule_id,
    rr.is_redemption_open,
    rr.open_after_date,
    rr.allow_continuous_redemption,
    rr.max_redemption_percentage,
    rr.lock_up_period,
    rr.product_type,
    rr.product_id,
    NULL::uuid AS active_window_id,
    NULL::timestamp without time zone AS window_start,
    NULL::timestamp without time zone AS window_end,
    NULL::timestamp without time zone AS submission_start_date,
    NULL::timestamp without time zone AS submission_end_date,
    NULL::text AS window_status,
        CASE
            WHEN d.fully_redeemed THEN false
            WHEN (rr.is_redemption_open = false) THEN false
            WHEN ((rr.open_after_date IS NOT NULL) AND (rr.open_after_date > now())) THEN false
            WHEN (rr.allow_continuous_redemption = true) THEN true
            ELSE false
        END AS is_eligible_now,
        CASE
            WHEN (rr.max_redemption_percentage IS NOT NULL) THEN LEAST(d.remaining_amount, ((d.token_amount * rr.max_redemption_percentage) / (100)::numeric))
            ELSE d.remaining_amount
        END AS max_redeemable_amount,
        CASE
            WHEN d.fully_redeemed THEN 'Distribution fully redeemed'::text
            WHEN (rr.is_redemption_open = false) THEN 'Redemptions are closed'::text
            WHEN ((rr.open_after_date IS NOT NULL) AND (rr.open_after_date > now())) THEN ('Redemption period not yet open until '::text || (rr.open_after_date)::text)
            WHEN (rr.allow_continuous_redemption = false) THEN 'Window-based redemption configured but no active window management'::text
            ELSE 'Eligible'::text
        END AS eligibility_reason
   FROM (public.distributions d
     LEFT JOIN public.redemption_rules rr ON ((rr.project_id = d.project_id)))
  WHERE (d.remaining_amount > (0)::numeric);


--
-- Name: active_redemption_opportunities; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.active_redemption_opportunities AS
 SELECT re.project_id,
    re.investor_id,
    re.product_type,
    re.product_id,
    count(re.distribution_id) AS eligible_distributions,
    sum(re.total_distributed) AS total_distributed_amount,
    sum(re.remaining_amount) AS total_remaining_amount,
    sum(re.max_redeemable_amount) AS total_max_redeemable,
    array_agg(re.distribution_id) AS distribution_ids,
    min(re.window_start) AS earliest_window_start,
    max(re.window_end) AS latest_window_end,
    bool_and(re.is_eligible_now) AS all_eligible,
    string_agg(DISTINCT re.eligibility_reason, '; '::text) AS combined_reasons
   FROM public.redemption_eligibility re
  WHERE (re.is_eligible_now = true)
  GROUP BY re.project_id, re.investor_id, re.product_type, re.product_id;


--
-- Name: audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audit_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "timestamp" timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    action text NOT NULL,
    username text DEFAULT 'system'::text,
    details text DEFAULT 'system action'::text,
    status text DEFAULT 'Success'::text,
    signature text,
    verified boolean DEFAULT false,
    user_email text,
    user_id uuid,
    entity_type text,
    entity_id text,
    old_data jsonb,
    new_data jsonb,
    metadata jsonb,
    project_id uuid,
    action_type text,
    changes jsonb,
    occurred_at timestamp with time zone DEFAULT now(),
    system_process_id uuid,
    batch_operation_id uuid,
    severity text DEFAULT 'info'::text,
    duration integer,
    source text,
    is_automated boolean DEFAULT false,
    category character varying,
    parent_id uuid,
    correlation_id character varying,
    session_id character varying,
    ip_address character varying,
    user_agent character varying,
    api_version character varying,
    request_id character varying,
    importance integer DEFAULT 1
);


--
-- Name: TABLE audit_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.audit_logs IS '@omit create,update,delete
Retention policy: 90 days';


--
-- Name: activity_analytics; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.activity_analytics AS
 SELECT audit_logs.id,
    audit_logs.action,
    audit_logs.action_type AS source,
    audit_logs.category,
    audit_logs.severity,
    audit_logs."timestamp",
    audit_logs.user_id,
    audit_logs.user_email,
    audit_logs.entity_type,
    audit_logs.entity_id,
    audit_logs.status,
    audit_logs.duration,
    audit_logs.system_process_id,
    audit_logs.batch_operation_id,
    audit_logs.project_id,
    audit_logs.correlation_id,
    audit_logs.ip_address,
    audit_logs.session_id
   FROM public.audit_logs;


--
-- Name: alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.alerts (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    severity text NOT NULL,
    service text NOT NULL,
    title text NOT NULL,
    description text,
    status text DEFAULT 'OPEN'::text NOT NULL,
    assignee text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT alerts_severity_check CHECK ((severity = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text]))),
    CONSTRAINT alerts_status_check CHECK ((status = ANY (ARRAY['OPEN'::text, 'ACKNOWLEDGED'::text, 'RESOLVED'::text])))
);


--
-- Name: approval_config_approvers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_config_approvers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    approval_config_id uuid NOT NULL,
    approver_type text NOT NULL,
    approver_user_id uuid,
    approver_role_id uuid,
    is_required boolean DEFAULT true,
    order_priority integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    CONSTRAINT approval_config_approvers_approver_type_check CHECK ((approver_type = ANY (ARRAY['user'::text, 'role'::text]))),
    CONSTRAINT check_approver_reference CHECK ((((approver_type = 'user'::text) AND (approver_user_id IS NOT NULL) AND (approver_role_id IS NULL)) OR ((approver_type = 'role'::text) AND (approver_role_id IS NOT NULL) AND (approver_user_id IS NULL))))
);


--
-- Name: TABLE approval_config_approvers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.approval_config_approvers IS 'Junction table linking approval configs to specific users or roles as approvers';


--
-- Name: approval_config_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_config_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    approval_config_id uuid NOT NULL,
    change_type text NOT NULL,
    old_data jsonb,
    new_data jsonb,
    changed_by uuid,
    change_reason text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT approval_config_history_change_type_check CHECK ((change_type = ANY (ARRAY['created'::text, 'updated'::text, 'deleted'::text, 'approver_added'::text, 'approver_removed'::text])))
);


--
-- Name: TABLE approval_config_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.approval_config_history IS 'Audit trail for changes to approval configurations';


--
-- Name: approval_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    permission_id uuid NOT NULL,
    required_approvals integer DEFAULT 2 NOT NULL,
    eligible_roles text[] NOT NULL,
    auto_approval_conditions jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    consensus_type text DEFAULT '2of3'::text NOT NULL,
    config_name text,
    config_description text,
    approval_mode text DEFAULT 'mixed'::text,
    requires_all_approvers boolean DEFAULT false,
    auto_approve_threshold integer DEFAULT 0,
    escalation_config jsonb,
    notification_config jsonb,
    active boolean DEFAULT true,
    created_by uuid,
    last_modified_by uuid,
    CONSTRAINT approval_configs_approval_mode_check CHECK ((approval_mode = ANY (ARRAY['role_based'::text, 'user_specific'::text, 'mixed'::text])))
);


--
-- Name: COLUMN approval_configs.approval_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.approval_configs.approval_mode IS 'Determines if config uses role-based, user-specific, or mixed approver assignment';


--
-- Name: COLUMN approval_configs.requires_all_approvers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.approval_configs.requires_all_approvers IS 'If true, ALL configured approvers must approve; overrides consensus_type';


--
-- Name: COLUMN approval_configs.auto_approve_threshold; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.approval_configs.auto_approve_threshold IS 'Automatic approval if request amount is below this threshold';


--
-- Name: roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.roles (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    description text NOT NULL,
    priority integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.users (
    id uuid NOT NULL,
    name text NOT NULL,
    email text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    public_key text,
    encrypted_private_key text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    auth_id uuid
);


--
-- Name: approval_configs_with_approvers; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.approval_configs_with_approvers AS
 SELECT ac.id,
    ac.permission_id,
    ac.config_name,
    ac.config_description,
    ac.approval_mode,
    ac.required_approvals,
    ac.requires_all_approvers,
    ac.consensus_type,
    ac.eligible_roles,
    ac.auto_approval_conditions,
    ac.auto_approve_threshold,
    ac.escalation_config,
    ac.notification_config,
    ac.active,
    ac.created_at,
    ac.updated_at,
    ac.created_by,
    ac.last_modified_by,
    COALESCE(json_agg(
        CASE
            WHEN (aca.approver_type = 'user'::text) THEN json_build_object('type', 'user', 'id', aca.approver_user_id, 'name', u.name, 'email', u.email, 'is_required', aca.is_required, 'order_priority', aca.order_priority)
            WHEN (aca.approver_type = 'role'::text) THEN json_build_object('type', 'role', 'id', aca.approver_role_id, 'name', r.name, 'description', r.description, 'is_required', aca.is_required, 'order_priority', aca.order_priority)
            ELSE NULL::json
        END ORDER BY aca.order_priority, aca.created_at) FILTER (WHERE (aca.id IS NOT NULL)), '[]'::json) AS configured_approvers,
    count(aca.id) AS approver_count
   FROM (((public.approval_configs ac
     LEFT JOIN public.approval_config_approvers aca ON ((ac.id = aca.approval_config_id)))
     LEFT JOIN public.users u ON ((aca.approver_user_id = u.id)))
     LEFT JOIN public.roles r ON ((aca.approver_role_id = r.id)))
  GROUP BY ac.id, ac.permission_id, ac.config_name, ac.config_description, ac.approval_mode, ac.required_approvals, ac.requires_all_approvers, ac.consensus_type, ac.eligible_roles, ac.auto_approval_conditions, ac.auto_approve_threshold, ac.escalation_config, ac.notification_config, ac.active, ac.created_at, ac.updated_at, ac.created_by, ac.last_modified_by;


--
-- Name: VIEW approval_configs_with_approvers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.approval_configs_with_approvers IS 'Consolidated view of approval configs with their configured approvers';


--
-- Name: approval_delegations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_delegations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    delegator_id uuid NOT NULL,
    delegate_id uuid NOT NULL,
    scope text DEFAULT 'all'::text,
    start_date timestamp with time zone DEFAULT now(),
    end_date timestamp with time zone,
    is_active boolean DEFAULT true,
    conditions jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT approval_delegations_check CHECK ((delegator_id <> delegate_id))
);


--
-- Name: approval_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_notifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    channel text NOT NULL,
    success boolean NOT NULL,
    sent_at timestamp with time zone NOT NULL,
    error text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: approval_processes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_processes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    workflow_id uuid NOT NULL,
    status text NOT NULL,
    required_approvals integer DEFAULT 2 NOT NULL,
    current_approvals integer DEFAULT 0,
    pending_approvers uuid[] DEFAULT ARRAY[]::uuid[],
    started_at timestamp with time zone DEFAULT now(),
    deadline timestamp with time zone,
    completed_at timestamp with time zone,
    escalation_level integer DEFAULT 0,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT approval_processes_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text, 'escalated'::text, 'expired'::text])))
);


--
-- Name: approval_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    action character varying(100) NOT NULL,
    resource character varying(100) NOT NULL,
    resource_id character varying(100) NOT NULL,
    requested_by uuid NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    approvers uuid[] NOT NULL,
    approved_by uuid[] DEFAULT '{}'::uuid[] NOT NULL,
    rejected_by uuid[] DEFAULT '{}'::uuid[] NOT NULL,
    required_approvals integer DEFAULT 2 NOT NULL,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT approval_requests_status_check CHECK (((status)::text = ANY (ARRAY[('pending'::character varying)::text, ('approved'::character varying)::text, ('rejected'::character varying)::text])))
);


--
-- Name: approval_signatures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_signatures (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    signature text NOT NULL,
    approver_id uuid NOT NULL,
    request_id uuid,
    message text NOT NULL,
    verified boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: approval_workflows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approval_workflows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    token_id uuid,
    type text NOT NULL,
    required_approvals integer NOT NULL,
    approvers jsonb NOT NULL,
    thresholds jsonb NOT NULL,
    escalation_rules jsonb,
    timeouts jsonb,
    status text DEFAULT 'active'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: asset_backed_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.asset_backed_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_number character varying(50),
    asset_type character varying(100),
    origination_date timestamp with time zone,
    original_amount numeric,
    maturity_date timestamp with time zone,
    interest_rate numeric,
    accrual_type character varying(50),
    lien_position character varying(50),
    payment_frequency character varying(50),
    current_balance numeric,
    modification_indicator boolean,
    prepayment_penalty numeric,
    delinquency_status integer,
    repurchase_amount numeric,
    demand_resolution_date timestamp with time zone,
    repurchaser text,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    debtor_credit_quality character varying,
    collection_period_days integer,
    recovery_rate_percentage numeric,
    diversification_metrics character varying
);


--
-- Name: TABLE asset_backed_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.asset_backed_products IS 'Asset-backed securities and receivables products with unique constraint on project_id to ensure one product per project';


--
-- Name: asset_holdings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.asset_holdings (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    asset_id uuid NOT NULL,
    holding_type text NOT NULL,
    quantity numeric(78,18) NOT NULL,
    value numeric(78,18) NOT NULL,
    maturity_date date,
    credit_rating text,
    source text DEFAULT 'oracle'::text NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    oracle_price numeric(78,18) DEFAULT 0,
    last_oracle_update timestamp with time zone DEFAULT now(),
    CONSTRAINT asset_holdings_source_check CHECK ((source = ANY (ARRAY['manual'::text, 'oracle'::text, 'calculated'::text, 'administrator'::text]))),
    CONSTRAINT chk_holdings_quantity_positive CHECK (((quantity IS NULL) OR (quantity > (0)::numeric))),
    CONSTRAINT mmf_maturity_check CHECK (
CASE
    WHEN (holding_type = ANY (ARRAY['Government Securities'::text, 'Repos'::text, 'Commercial Paper'::text, 'CDs'::text, 'Corporate Debt'::text, 'Municipal Debt'::text])) THEN ((maturity_date - CURRENT_DATE) <= 397)
    ELSE true
END),
    CONSTRAINT positive_quantity CHECK ((quantity > (0)::numeric)),
    CONSTRAINT positive_value CHECK ((value > (0)::numeric))
);


--
-- Name: asset_nav_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.asset_nav_data (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    asset_id uuid NOT NULL,
    project_id uuid NOT NULL,
    date date NOT NULL,
    nav numeric(18,6) NOT NULL,
    total_assets numeric(78,18) NOT NULL,
    asset_name text NOT NULL,
    total_liabilities numeric(78,18) DEFAULT 0 NOT NULL,
    outstanding_shares numeric(78,18) NOT NULL,
    previous_nav numeric(18,6),
    change_amount numeric(18,6),
    change_percent numeric(8,4),
    source text DEFAULT 'manual'::text NOT NULL,
    validated boolean DEFAULT false,
    validated_by uuid,
    validated_at timestamp with time zone,
    notes text,
    calculation_method text,
    market_conditions text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    calculated_nav numeric(18,6) GENERATED ALWAYS AS (
CASE
    WHEN (total_assets > total_liabilities) THEN ((total_assets - total_liabilities) / outstanding_shares)
    ELSE NULL::numeric
END) STORED,
    identifier text,
    token_id uuid,
    token_parity_percentage numeric,
    CONSTRAINT asset_nav_data_source_check CHECK ((source = ANY (ARRAY['manual'::text, 'oracle'::text, 'calculated'::text, 'administrator'::text]))),
    CONSTRAINT non_negative_liabilities CHECK ((total_liabilities >= (0)::numeric)),
    CONSTRAINT positive_assets CHECK ((total_assets > (0)::numeric)),
    CONSTRAINT positive_nav CHECK ((nav > (0)::numeric)),
    CONSTRAINT positive_shares CHECK ((outstanding_shares > (0)::numeric))
);


--
-- Name: auction_comparables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.auction_comparables (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    date timestamp with time zone NOT NULL,
    auction_house text NOT NULL,
    lot_number text,
    hammer_price numeric NOT NULL,
    estimate_low numeric,
    estimate_high numeric,
    currency text DEFAULT 'USD'::text NOT NULL,
    premium numeric DEFAULT 0 NOT NULL,
    similarity numeric NOT NULL,
    description text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT auction_comparables_estimate_high_check CHECK ((estimate_high >= (0)::numeric)),
    CONSTRAINT auction_comparables_estimate_low_check CHECK ((estimate_low >= (0)::numeric)),
    CONSTRAINT auction_comparables_hammer_price_check CHECK ((hammer_price >= (0)::numeric)),
    CONSTRAINT auction_comparables_premium_check CHECK ((premium >= (0)::numeric)),
    CONSTRAINT auction_comparables_similarity_check CHECK (((similarity >= (0)::numeric) AND (similarity <= (100)::numeric)))
);


--
-- Name: audit_coverage; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.audit_coverage AS
 SELECT tgt.tgname AS trigger_name,
    nsp.nspname AS schema_name,
    cls.relname AS table_name,
    p.proname AS function_name
   FROM (((pg_trigger tgt
     JOIN pg_class cls ON ((tgt.tgrelid = cls.oid)))
     JOIN pg_namespace nsp ON ((cls.relnamespace = nsp.oid)))
     JOIN pg_proc p ON ((tgt.tgfoid = p.oid)))
  WHERE ((p.proname = 'log_table_change'::name) AND (nsp.nspname <> ALL (ARRAY['pg_catalog'::name, 'information_schema'::name])))
  ORDER BY nsp.nspname, cls.relname;


--
-- Name: auth_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.auth_events (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid,
    event_type text NOT NULL,
    ip_address text,
    user_agent text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: authorized_activities; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.authorized_activities (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    activity_name text NOT NULL,
    category text,
    active boolean DEFAULT true,
    authorized_at timestamp with time zone,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: authorized_signatories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.authorized_signatories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    role text NOT NULL,
    active boolean DEFAULT true,
    digital_signature text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: batch_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.batch_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_operation_id uuid NOT NULL,
    operation_index integer NOT NULL,
    target_address text NOT NULL,
    value text NOT NULL,
    call_data text NOT NULL,
    success boolean DEFAULT false,
    return_data text,
    gas_used bigint,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE batch_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.batch_operations IS 'Individual operations within batched user operations';


--
-- Name: COLUMN batch_operations.operation_index; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.batch_operations.operation_index IS 'Index of operation within the batch (0-based)';


--
-- Name: COLUMN batch_operations.success; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.batch_operations.success IS 'Whether this individual operation succeeded';


--
-- Name: benchmark_index_mappings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benchmark_index_mappings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    benchmark_name character varying(100) NOT NULL,
    ticker_symbol character varying(20) NOT NULL,
    provider character varying(50) DEFAULT 'yahoo_finance'::character varying,
    asset_class character varying(50),
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE benchmark_index_mappings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benchmark_index_mappings IS 'Benchmark index to ticker symbol mappings';


--
-- Name: blacklisted_addresses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.blacklisted_addresses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    address text NOT NULL,
    reason text,
    severity text,
    added_by uuid,
    added_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT blacklisted_addresses_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: blackout_periods; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.blackout_periods (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone NOT NULL,
    reason text,
    affected_operations text[] DEFAULT ARRAY['redemption'::text],
    created_by uuid,
    active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT valid_date_range CHECK ((end_date > start_date)),
    CONSTRAINT valid_operations CHECK ((affected_operations <@ ARRAY['redemption'::text, 'transfer'::text, 'mint'::text, 'burn'::text]))
);


--
-- Name: TABLE blackout_periods; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.blackout_periods IS 'Manages blackout periods during which certain operations (like redemptions) are not allowed';


--
-- Name: COLUMN blackout_periods.affected_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.blackout_periods.affected_operations IS 'Array of operations affected by this blackout period (redemption, transfer, mint, burn)';


--
-- Name: COLUMN blackout_periods.active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.blackout_periods.active IS 'Whether this blackout period is currently active and should be enforced';


--
-- Name: bond_amortization_schedule; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_amortization_schedule (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    payment_date date NOT NULL,
    principal_payment numeric(20,2) NOT NULL,
    beginning_balance numeric(20,2) NOT NULL,
    ending_balance numeric(20,2) NOT NULL,
    payment_status character varying(20) DEFAULT 'scheduled'::character varying NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_amortization_schedule_beginning_balance_check CHECK ((beginning_balance > (0)::numeric)),
    CONSTRAINT bond_amortization_schedule_ending_balance_check CHECK ((ending_balance >= (0)::numeric)),
    CONSTRAINT bond_amortization_schedule_payment_status_check CHECK (((payment_status)::text = ANY (ARRAY[('scheduled'::character varying)::text, ('paid'::character varying)::text, ('prepaid'::character varying)::text, ('missed'::character varying)::text]))),
    CONSTRAINT bond_amortization_schedule_principal_payment_check CHECK ((principal_payment > (0)::numeric)),
    CONSTRAINT bond_amortization_valid_balance CHECK ((ending_balance = (beginning_balance - principal_payment)))
);


--
-- Name: bond_call_put_schedules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_call_put_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    option_type character varying(10) NOT NULL,
    option_date date NOT NULL,
    call_price numeric(10,4),
    put_price numeric(10,4),
    notice_days integer,
    option_style character varying(20) NOT NULL,
    is_make_whole boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_call_put_call_price_required CHECK (((((option_type)::text = 'call'::text) AND (call_price IS NOT NULL)) OR ((option_type)::text <> 'call'::text))),
    CONSTRAINT bond_call_put_put_price_required CHECK (((((option_type)::text = 'put'::text) AND (put_price IS NOT NULL)) OR ((option_type)::text <> 'put'::text))),
    CONSTRAINT bond_call_put_schedules_call_price_check CHECK ((call_price > (0)::numeric)),
    CONSTRAINT bond_call_put_schedules_notice_days_check CHECK ((notice_days >= 0)),
    CONSTRAINT bond_call_put_schedules_option_style_check CHECK (((option_style)::text = ANY (ARRAY[('american'::character varying)::text, ('european'::character varying)::text, ('bermudan'::character varying)::text, ('make_whole'::character varying)::text]))),
    CONSTRAINT bond_call_put_schedules_option_type_check CHECK (((option_type)::text = ANY (ARRAY[('call'::character varying)::text, ('put'::character varying)::text]))),
    CONSTRAINT bond_call_put_schedules_put_price_check CHECK ((put_price > (0)::numeric))
);


--
-- Name: bond_coupon_payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_coupon_payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    payment_date date NOT NULL,
    coupon_amount numeric(20,2) NOT NULL,
    payment_status character varying(20) DEFAULT 'scheduled'::character varying NOT NULL,
    actual_payment_date date,
    accrual_start_date date NOT NULL,
    accrual_end_date date NOT NULL,
    days_in_period integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_coupon_paid_requires_actual_date CHECK (((((payment_status)::text = 'paid'::text) AND (actual_payment_date IS NOT NULL)) OR ((payment_status)::text <> 'paid'::text))),
    CONSTRAINT bond_coupon_payments_coupon_amount_check CHECK ((coupon_amount > (0)::numeric)),
    CONSTRAINT bond_coupon_payments_days_in_period_check CHECK (((days_in_period > 0) AND (days_in_period <= 366))),
    CONSTRAINT bond_coupon_payments_payment_status_check CHECK (((payment_status)::text = ANY (ARRAY[('scheduled'::character varying)::text, ('paid'::character varying)::text, ('missed'::character varying)::text, ('deferred'::character varying)::text]))),
    CONSTRAINT bond_coupon_reasonable_payment_date CHECK ((abs(EXTRACT(day FROM ((payment_date)::timestamp without time zone - (accrual_end_date)::timestamp without time zone))) <= (7)::numeric)),
    CONSTRAINT bond_coupon_valid_accrual_period CHECK ((accrual_start_date < accrual_end_date))
);


--
-- Name: TABLE bond_coupon_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bond_coupon_payments IS 'Scheduled and historical coupon payments for cash flow projection';


--
-- Name: CONSTRAINT bond_coupon_reasonable_payment_date ON bond_coupon_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT bond_coupon_reasonable_payment_date ON public.bond_coupon_payments IS 'Ensures payment_date is within 7 days of accrual_end_date to allow for settlement periods';


--
-- Name: bond_covenants; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_covenants (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    covenant_type character varying(50) NOT NULL,
    covenant_description text NOT NULL,
    financial_ratio character varying(50),
    threshold_value numeric(20,4),
    test_frequency character varying(20),
    last_test_date date,
    compliance_status character varying(20),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_covenants_compliance_status_check CHECK (((compliance_status)::text = ANY (ARRAY[('compliant'::character varying)::text, ('breach'::character varying)::text, ('waived'::character varying)::text, ('cured'::character varying)::text]))),
    CONSTRAINT bond_covenants_covenant_type_check CHECK (((covenant_type)::text = ANY (ARRAY[('financial_ratio'::character varying)::text, ('negative_pledge'::character varying)::text, ('cross_default'::character varying)::text, ('change_of_control'::character varying)::text, ('restricted_payments'::character varying)::text]))),
    CONSTRAINT bond_covenants_test_frequency_check CHECK (((test_frequency)::text = ANY (ARRAY[('quarterly'::character varying)::text, ('annually'::character varying)::text, ('event_driven'::character varying)::text])))
);


--
-- Name: bond_credit_ratings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_credit_ratings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    rating_agency character varying(20) NOT NULL,
    rating character varying(10) NOT NULL,
    rating_outlook character varying(20),
    rating_date date NOT NULL,
    previous_rating character varying(10),
    rating_action character varying(20),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_credit_ratings_rating_action_check CHECK (((rating_action)::text = ANY (ARRAY[('upgrade'::character varying)::text, ('downgrade'::character varying)::text, ('affirmed'::character varying)::text, ('withdrawn'::character varying)::text]))),
    CONSTRAINT bond_credit_ratings_rating_agency_check CHECK (((rating_agency)::text = ANY (ARRAY[('SP'::character varying)::text, ('Moodys'::character varying)::text, ('Fitch'::character varying)::text, ('DBRS'::character varying)::text]))),
    CONSTRAINT bond_credit_ratings_rating_outlook_check CHECK (((rating_outlook)::text = ANY (ARRAY[('positive'::character varying)::text, ('stable'::character varying)::text, ('negative'::character varying)::text, ('developing'::character varying)::text])))
);


--
-- Name: bond_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    event_type character varying(50) NOT NULL,
    event_date date NOT NULL,
    announcement_date date,
    event_description text NOT NULL,
    financial_impact numeric(20,2),
    requires_revaluation boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_events_announcement_before_event CHECK (((announcement_date IS NULL) OR (announcement_date <= event_date))),
    CONSTRAINT bond_events_event_type_check CHECK (((event_type)::text = ANY (ARRAY[('tender_offer'::character varying)::text, ('exchange_offer'::character varying)::text, ('defeasance'::character varying)::text, ('covenant_modification'::character varying)::text, ('rating_change'::character varying)::text, ('default'::character varying)::text, ('restructuring'::character varying)::text, ('merger'::character varying)::text, ('spinoff'::character varying)::text])))
);


--
-- Name: bond_market_prices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_market_prices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    price_date date NOT NULL,
    price_time time without time zone,
    clean_price numeric(10,4) NOT NULL,
    dirty_price numeric(10,4) NOT NULL,
    bid_price numeric(10,4),
    ask_price numeric(10,4),
    mid_price numeric(10,4),
    ytm numeric(8,4),
    spread_to_benchmark numeric(8,4),
    data_source character varying(50) NOT NULL,
    is_official_close boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_market_prices_bid_price_check CHECK ((bid_price > (0)::numeric)),
    CONSTRAINT bond_market_prices_check CHECK ((dirty_price >= clean_price)),
    CONSTRAINT bond_market_prices_check1 CHECK ((ask_price >= bid_price)),
    CONSTRAINT bond_market_prices_clean_price_check CHECK ((clean_price > (0)::numeric)),
    CONSTRAINT bond_market_prices_data_source_check CHECK (((data_source)::text = ANY (ARRAY[('bloomberg'::character varying)::text, ('reuters'::character varying)::text, ('ice'::character varying)::text, ('tradeweb'::character varying)::text, ('markit'::character varying)::text, ('internal_pricing'::character varying)::text, ('vendor'::character varying)::text]))),
    CONSTRAINT bond_market_prices_ytm_check CHECK ((ytm > (0)::numeric))
);


--
-- Name: TABLE bond_market_prices; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bond_market_prices IS 'Historical and current market prices for mark-to-market valuation';


--
-- Name: bond_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    bond_isin_cusip text,
    issuer_name text,
    coupon_rate numeric,
    face_value numeric,
    credit_rating character varying(10),
    bond_type text,
    callable_flag boolean,
    call_put_dates timestamp with time zone[],
    yield_to_maturity numeric,
    duration numeric,
    currency character varying(10),
    issue_date timestamp with time zone,
    maturity_date timestamp with time zone,
    status character varying(50),
    coupon_payment_history jsonb,
    redemption_call_date timestamp with time zone,
    accrued_interest numeric,
    coupon_frequency character varying(50),
    callable_features boolean,
    call_date timestamp with time zone,
    call_price numeric,
    security_collateral text,
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    bond_identifier text,
    isin text,
    cusip text,
    sedol text,
    asset_name text,
    issuer_type character varying(50),
    seniority character varying(50),
    day_count_convention character varying(20) DEFAULT 'actual_actual'::character varying,
    purchase_price numeric(20,2),
    purchase_date date,
    current_price numeric(20,2),
    accounting_treatment text,
    puttable boolean DEFAULT false,
    convertible boolean DEFAULT false
);


--
-- Name: TABLE bond_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bond_products IS 'Bond products table. Each project can have multiple bonds (one-to-many relationship).';


--
-- Name: COLUMN bond_products.project_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.bond_products.project_id IS 'Foreign key to projects table. A project can have multiple bonds (one-to-many relationship).';


--
-- Name: bond_sinking_fund; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bond_sinking_fund (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bond_product_id uuid NOT NULL,
    payment_date date NOT NULL,
    required_amount numeric(20,2) NOT NULL,
    actual_amount numeric(20,2),
    redemption_price numeric(10,4) NOT NULL,
    payment_status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bond_sinking_fund_check CHECK ((actual_amount >= required_amount)),
    CONSTRAINT bond_sinking_fund_payment_status_check CHECK (((payment_status)::text = ANY (ARRAY[('pending'::character varying)::text, ('completed'::character varying)::text, ('deferred'::character varying)::text, ('waived'::character varying)::text]))),
    CONSTRAINT bond_sinking_fund_redemption_price_check CHECK ((redemption_price > (0)::numeric)),
    CONSTRAINT bond_sinking_fund_required_amount_check CHECK ((required_amount > (0)::numeric))
);


--
-- Name: bulk_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bulk_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    completed_at timestamp with time zone,
    created_by uuid,
    metadata jsonb,
    operation_type text,
    status text,
    tags text[],
    target_ids uuid[],
    created_at timestamp with time zone DEFAULT now(),
    progress double precision DEFAULT 0,
    processed_count integer DEFAULT 0,
    failed_count integer DEFAULT 0,
    error_details jsonb
);


--
-- Name: TABLE bulk_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bulk_operations IS 'Tracks bulk operations performed in the system';


--
-- Name: bundler_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bundler_configurations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bundler_name text NOT NULL,
    bundler_address text NOT NULL,
    entry_point_address text NOT NULL,
    chain_id integer NOT NULL,
    rpc_url text NOT NULL,
    max_bundle_size integer DEFAULT 10,
    max_bundle_wait_time integer DEFAULT 5000,
    min_priority_fee bigint DEFAULT 1000000000,
    is_active boolean DEFAULT true,
    supported_entry_points jsonb DEFAULT '[]'::jsonb,
    gas_price_multiplier numeric(3,2) DEFAULT 1.1,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE bundler_configurations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bundler_configurations IS 'Configuration settings for different bundler services';


--
-- Name: bundler_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.bundler_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bundle_hash text NOT NULL,
    bundler_address text NOT NULL,
    entry_point_address text NOT NULL,
    chain_id integer NOT NULL,
    user_operations jsonb DEFAULT '[]'::jsonb NOT NULL,
    transaction_hash text,
    block_number bigint,
    gas_used bigint,
    gas_price bigint,
    status text DEFAULT 'pending'::text,
    bundle_size integer DEFAULT 0 NOT NULL,
    total_gas_limit bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    submitted_at timestamp with time zone,
    included_at timestamp with time zone,
    failure_reason text,
    CONSTRAINT bundler_operations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'submitted'::text, 'included'::text, 'failed'::text])))
);


--
-- Name: TABLE bundler_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.bundler_operations IS 'Tracks EIP-4337 bundler operations and transaction bundling status';


--
-- Name: cap_table_investors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cap_table_investors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    cap_table_id uuid NOT NULL,
    investor_id uuid,
    investor_name text NOT NULL,
    investor_email text,
    investor_type text,
    shares_owned bigint DEFAULT 0 NOT NULL,
    share_class text,
    investment_date timestamp with time zone,
    investment_amount numeric(20,2),
    percentage_ownership numeric(5,2),
    vesting_schedule jsonb,
    notes text,
    status text DEFAULT 'active'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cap_table_investors; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cap_table_investors IS 'Stores individual investor holdings in cap tables';


--
-- Name: cap_tables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cap_tables (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    description text,
    project_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: carbon_market_prices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.carbon_market_prices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid,
    current_price numeric NOT NULL,
    voluntary_market_price numeric NOT NULL,
    compliance_market_price numeric NOT NULL,
    future_price numeric,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    as_of_date timestamp with time zone NOT NULL,
    source character varying(100) NOT NULL,
    liquidity_score numeric,
    market_type character varying(50),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT carbon_market_prices_compliance_market_price_check CHECK ((compliance_market_price >= (0)::numeric)),
    CONSTRAINT carbon_market_prices_current_price_check CHECK ((current_price >= (0)::numeric)),
    CONSTRAINT carbon_market_prices_future_price_check CHECK ((future_price >= (0)::numeric)),
    CONSTRAINT carbon_market_prices_liquidity_score_check CHECK (((liquidity_score >= (0)::numeric) AND (liquidity_score <= (1)::numeric))),
    CONSTRAINT carbon_market_prices_market_type_check CHECK (((market_type)::text = ANY (ARRAY[('voluntary'::character varying)::text, ('compliance'::character varying)::text, ('hybrid'::character varying)::text]))),
    CONSTRAINT carbon_market_prices_voluntary_market_price_check CHECK ((voluntary_market_price >= (0)::numeric))
);


--
-- Name: TABLE carbon_market_prices; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.carbon_market_prices IS 'Carbon credit market pricing data including voluntary, compliance, current, and future prices with liquidity scores';


--
-- Name: carbon_offsets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.carbon_offsets (
    offset_id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    type character varying(50) NOT NULL,
    amount numeric(15,2) NOT NULL,
    price_per_ton numeric(10,2) NOT NULL,
    total_value numeric(15,2) NOT NULL,
    verification_standard character varying(100),
    verification_date date,
    expiration_date date,
    status character varying(50) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: cf_allocations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cf_allocations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    composite_fund_id uuid NOT NULL,
    asset_class character varying(50) NOT NULL,
    asset_subclass character varying(50),
    target_allocation_percentage numeric(5,2) NOT NULL,
    minimum_allocation_percentage numeric(5,2),
    maximum_allocation_percentage numeric(5,2),
    current_allocation_percentage numeric(5,2) NOT NULL,
    current_market_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    allocation_drift numeric(5,2),
    drift_percentage numeric(5,2),
    is_within_tolerance boolean DEFAULT true,
    rebalancing_threshold_percentage numeric(5,2),
    strategic_rationale text,
    benchmark_index character varying(50),
    tracking_error numeric(5,2),
    effective_date timestamp with time zone NOT NULL,
    last_rebalance_date timestamp with time zone,
    next_review_date timestamp with time zone,
    allocation_policy_document_url text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cf_allocations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cf_allocations IS 'Target and actual asset class allocations for composite funds';


--
-- Name: cf_cash_flows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cf_cash_flows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    composite_fund_id uuid NOT NULL,
    cash_flow_date timestamp with time zone NOT NULL,
    cash_flow_type character varying(50) NOT NULL,
    amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    investor_id uuid,
    investor_name character varying(255),
    number_of_shares numeric(20,6),
    share_price numeric(20,8),
    asset_class_affected character varying(50),
    allocation_method character varying(50),
    related_transaction_id character varying(100),
    payment_method character varying(50),
    transaction_reference character varying(100),
    bank_account_last_4 character varying(4),
    processing_time_days integer,
    fees_charged numeric(20,2),
    fee_percentage numeric(5,2),
    tax_withholding numeric(20,2),
    net_cash_flow numeric(20,2),
    fund_nav_before numeric(20,2),
    fund_nav_after numeric(20,2),
    impact_on_allocations jsonb,
    reinvestment_plan text,
    redemption_impact_analysis text,
    status character varying(20) DEFAULT 'completed'::character varying,
    failure_reason text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cf_cash_flows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cf_cash_flows IS 'Subscriptions, redemptions, and cash movements';


--
-- Name: cf_holdings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cf_holdings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    composite_fund_id uuid NOT NULL,
    asset_class character varying(50) NOT NULL,
    asset_subclass character varying(50),
    holding_type character varying(50) NOT NULL,
    product_id uuid,
    product_type character varying(50),
    ticker_symbol character varying(50),
    isin character varying(50),
    cusip character varying(50),
    security_name character varying(255) NOT NULL,
    quantity numeric(20,6) NOT NULL,
    average_cost numeric(20,8),
    total_cost_basis numeric(20,2),
    current_price numeric(20,8) NOT NULL,
    current_market_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    fx_rate_to_base numeric(20,8),
    unrealized_gain_loss numeric(20,2),
    unrealized_gain_loss_percentage numeric(5,2),
    weight_in_portfolio numeric(5,2),
    weight_in_asset_class numeric(5,2),
    acquisition_date timestamp with time zone NOT NULL,
    last_rebalance_date timestamp with time zone,
    accrued_income numeric(20,2),
    dividend_yield numeric(5,2),
    maturity_date timestamp with time zone,
    credit_rating character varying(10),
    country_exposure character varying(3),
    sector_exposure character varying(50),
    esg_score integer,
    liquidity_classification character varying(20),
    days_to_liquidate_estimate integer,
    is_restricted boolean DEFAULT false,
    restriction_reason text,
    restriction_end_date timestamp with time zone,
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cf_holdings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cf_holdings IS 'Individual holdings within composite funds';


--
-- Name: cf_performance_attribution; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cf_performance_attribution (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    composite_fund_id uuid NOT NULL,
    period_start_date timestamp with time zone NOT NULL,
    period_end_date timestamp with time zone NOT NULL,
    attribution_level character varying(50) NOT NULL,
    asset_class character varying(50),
    holding_id uuid,
    security_name character varying(255),
    beginning_market_value numeric(20,2) NOT NULL,
    ending_market_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    net_cash_flow numeric(20,2),
    total_return numeric(20,2),
    total_return_percentage numeric(5,2),
    capital_appreciation numeric(20,2),
    income_return numeric(20,2),
    fx_impact numeric(20,2),
    allocation_effect numeric(20,2),
    selection_effect numeric(20,2),
    interaction_effect numeric(20,2),
    benchmark_return numeric(5,2),
    benchmark_index character varying(50),
    active_return numeric(5,2),
    tracking_error numeric(5,2),
    information_ratio numeric(5,2),
    sharpe_ratio numeric(5,2),
    sortino_ratio numeric(5,2),
    max_drawdown numeric(5,2),
    volatility numeric(5,2),
    beta numeric(5,4),
    alpha numeric(5,2),
    contribution_to_return numeric(20,2),
    contribution_percentage numeric(5,2),
    top_contributors jsonb,
    top_detractors jsonb,
    sector_attribution jsonb,
    country_attribution jsonb,
    risk_attribution jsonb,
    calculation_methodology character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cf_performance_attribution; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cf_performance_attribution IS 'Performance attribution analysis by asset class';


--
-- Name: cf_rebalancing_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cf_rebalancing_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    composite_fund_id uuid NOT NULL,
    rebalancing_date timestamp with time zone NOT NULL,
    rebalancing_type character varying(50) NOT NULL,
    trigger_reason text,
    pre_rebalance_nav numeric(20,2) NOT NULL,
    post_rebalance_nav numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    allocations_before jsonb NOT NULL,
    allocations_after jsonb NOT NULL,
    target_allocations jsonb,
    trades_executed jsonb NOT NULL,
    total_trades integer,
    total_buy_value numeric(20,2),
    total_sell_value numeric(20,2),
    net_cash_flow numeric(20,2),
    transaction_costs numeric(20,2),
    transaction_cost_bps integer,
    market_impact_estimate numeric(20,2),
    tax_implications numeric(20,2),
    execution_quality_score integer,
    slippage numeric(20,2),
    days_to_complete integer,
    completion_date timestamp with time zone,
    portfolio_manager character varying(255),
    approval_status character varying(20) DEFAULT 'approved'::character varying,
    approved_by character varying(255),
    approval_date timestamp with time zone,
    performance_impact jsonb,
    variance_from_plan jsonb,
    lessons_learned text,
    status character varying(20) DEFAULT 'completed'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE cf_rebalancing_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cf_rebalancing_events IS 'Portfolio rebalancing history and trades';


--
-- Name: climate_market_data_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_market_data_cache (
    cache_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    cache_key character varying(100) NOT NULL,
    data jsonb NOT NULL,
    cached_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone NOT NULL,
    hit_count integer DEFAULT 0,
    last_accessed timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE climate_market_data_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.climate_market_data_cache IS 'Caches government API data to avoid CORS issues and reduce API calls';


--
-- Name: climate_cache_performance; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.climate_cache_performance AS
 SELECT climate_market_data_cache.cache_key,
    climate_market_data_cache.hit_count,
    climate_market_data_cache.cached_at,
    climate_market_data_cache.expires_at,
    climate_market_data_cache.last_accessed,
    (EXTRACT(epoch FROM (climate_market_data_cache.expires_at - climate_market_data_cache.cached_at)) / (3600)::numeric) AS ttl_hours,
    (EXTRACT(epoch FROM (now() - climate_market_data_cache.last_accessed)) / (60)::numeric) AS minutes_since_access,
        CASE
            WHEN (climate_market_data_cache.expires_at > now()) THEN 'valid'::text
            ELSE 'expired'::text
        END AS status
   FROM public.climate_market_data_cache
  ORDER BY climate_market_data_cache.hit_count DESC, climate_market_data_cache.last_accessed DESC;


--
-- Name: VIEW climate_cache_performance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.climate_cache_performance IS 'Monitoring view for cache hit rates and performance';


--
-- Name: climate_cash_flow_projections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_cash_flow_projections (
    projection_id uuid DEFAULT gen_random_uuid() NOT NULL,
    projection_date date NOT NULL,
    projected_amount numeric(15,2) NOT NULL,
    source_type character varying(50) NOT NULL,
    entity_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: climate_cash_flow_forecast; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.climate_cash_flow_forecast AS
 SELECT climate_cash_flow_projections.projection_date,
    sum(climate_cash_flow_projections.projected_amount) AS total_projected,
    climate_cash_flow_projections.source_type
   FROM public.climate_cash_flow_projections
  GROUP BY climate_cash_flow_projections.projection_date, climate_cash_flow_projections.source_type
  ORDER BY climate_cash_flow_projections.projection_date;


--
-- Name: climate_incentives; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_incentives (
    incentive_id uuid DEFAULT gen_random_uuid() NOT NULL,
    type character varying(50) NOT NULL,
    amount numeric(15,2) NOT NULL,
    status character varying(50) NOT NULL,
    asset_id uuid,
    receivable_id uuid,
    expected_receipt_date date,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: COLUMN climate_incentives.project_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.climate_incentives.project_id IS 'Links to projects.id for project-based filtering';


--
-- Name: climate_investor_pools; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_investor_pools (
    investor_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    investment_amount numeric(15,2) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: climate_pool_receivables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_pool_receivables (
    pool_id uuid NOT NULL,
    receivable_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: climate_receivables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_receivables (
    receivable_id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid,
    payer_id uuid,
    amount numeric(15,2) NOT NULL,
    due_date date NOT NULL,
    risk_score integer,
    discount_rate numeric(5,2),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    climate_nav_value numeric(15,2),
    monte_carlo_nav_value numeric(15,2),
    nav_variance_percentage numeric(6,4),
    nav_reconciliation_status text,
    investment_recommendation text,
    recommendation_confidence numeric(4,3),
    target_price numeric(15,2),
    climate_nav_last_calculated timestamp with time zone,
    CONSTRAINT climate_receivables_investment_recommendation_check CHECK ((investment_recommendation = ANY (ARRAY['BUY'::text, 'HOLD'::text, 'SELL'::text, 'UNDER_REVIEW'::text]))),
    CONSTRAINT climate_receivables_nav_reconciliation_status_check CHECK ((nav_reconciliation_status = ANY (ARRAY['LOW_VARIANCE'::text, 'MEDIUM_VARIANCE'::text, 'HIGH_VARIANCE'::text, 'REQUIRES_REVIEW'::text]))),
    CONSTRAINT climate_receivables_risk_score_check CHECK (((risk_score >= 0) AND (risk_score <= 100)))
);


--
-- Name: COLUMN climate_receivables.climate_nav_value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.climate_receivables.climate_nav_value IS 'Climate-specific NAV using LCOE/PPA/Carbon methodology';


--
-- Name: COLUMN climate_receivables.nav_variance_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.climate_receivables.nav_variance_percentage IS 'Variance between Climate NAV and Monte Carlo NAV methods';


--
-- Name: climate_tokenization_pools; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_tokenization_pools (
    pool_id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    total_value numeric(15,2) NOT NULL,
    risk_profile character varying(50),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: climate_investor_pool_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.climate_investor_pool_summary AS
 SELECT ipa.investor_id,
    ipa.pool_id,
    ctp.name AS pool_name,
    ipa.investment_amount,
    sum(cr.amount) AS total_receivables,
    avg(cr.risk_score) AS avg_risk_score
   FROM (((public.climate_investor_pools ipa
     JOIN public.climate_tokenization_pools ctp ON ((ipa.pool_id = ctp.pool_id)))
     JOIN public.climate_pool_receivables cpr ON ((ctp.pool_id = cpr.pool_id)))
     JOIN public.climate_receivables cr ON ((cpr.receivable_id = cr.receivable_id)))
  GROUP BY ipa.investor_id, ipa.pool_id, ctp.name, ipa.investment_amount;


--
-- Name: climate_nav_calculations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_nav_calculations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    receivable_id uuid NOT NULL,
    asset_id uuid,
    calculation_type text NOT NULL,
    lcoe_capex numeric(15,2),
    lcoe_opex_annual numeric(12,2),
    lcoe_maintenance_costs jsonb,
    lcoe_tax_credits jsonb,
    lcoe_calculated numeric(10,4),
    lcoe_competitiveness text,
    ppa_contract_type text,
    ppa_base_rate numeric(10,4),
    ppa_escalation_rate numeric(6,4),
    ppa_market_comparison numeric(10,4),
    ppa_counterparty_rating text,
    ppa_risk_premium numeric(6,4),
    carbon_credits_annual integer,
    carbon_price_current numeric(8,2),
    carbon_verification_standard text,
    additionality_financial boolean,
    additionality_regulatory boolean,
    additionality_common_practice boolean,
    additionality_barrier boolean,
    additionality_premium_percentage numeric(5,2),
    climate_nav_value numeric(15,2),
    monte_carlo_nav_value numeric(15,2),
    valuation_variance numeric(6,4),
    recommended_value numeric(15,2),
    investment_recommendation text,
    confidence_level numeric(4,3),
    calculation_methodology text,
    data_sources jsonb,
    risk_adjustments jsonb,
    created_at timestamp with time zone DEFAULT now(),
    calculated_by text,
    CONSTRAINT climate_nav_calculations_calculation_type_check CHECK ((calculation_type = ANY (ARRAY['LCOE_BENCHMARK'::text, 'PPA_ANALYSIS'::text, 'CARBON_CREDIT'::text, 'INTEGRATED_VALUATION'::text]))),
    CONSTRAINT climate_nav_calculations_carbon_verification_standard_check CHECK ((carbon_verification_standard = ANY (ARRAY['VCS'::text, 'CDM'::text, 'GOLD_STANDARD'::text, 'CAR'::text]))),
    CONSTRAINT climate_nav_calculations_lcoe_competitiveness_check CHECK ((lcoe_competitiveness = ANY (ARRAY['EXCELLENT'::text, 'GOOD'::text, 'MARKET'::text, 'POOR'::text]))),
    CONSTRAINT climate_nav_calculations_ppa_contract_type_check CHECK ((ppa_contract_type = ANY (ARRAY['FIXED'::text, 'ESCALATING'::text, 'INDEXED'::text])))
);


--
-- Name: TABLE climate_nav_calculations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.climate_nav_calculations IS 'Historical climate NAV calculations with detailed methodology tracking';


--
-- Name: climate_payers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_payers (
    payer_id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    credit_rating character varying(10),
    financial_health_score integer,
    payment_history jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    esg_score integer,
    CONSTRAINT climate_payers_esg_score_check CHECK (((esg_score >= 0) AND (esg_score <= 100))),
    CONSTRAINT climate_payers_financial_health_score_check CHECK (((financial_health_score >= 0) AND (financial_health_score <= 100)))
);


--
-- Name: climate_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_policies (
    policy_id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    impact_level character varying(50),
    effective_date date NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: climate_policy_impacts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_policy_impacts (
    impact_id uuid DEFAULT gen_random_uuid() NOT NULL,
    policy_id uuid,
    receivable_id uuid,
    asset_id uuid,
    impact_description text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: climate_pool_energy_assets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_pool_energy_assets (
    pool_id uuid NOT NULL,
    asset_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    project_id uuid
);


--
-- Name: climate_pool_incentives; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_pool_incentives (
    pool_id uuid NOT NULL,
    incentive_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    project_id uuid
);


--
-- Name: climate_pool_recs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_pool_recs (
    pool_id uuid NOT NULL,
    rec_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    project_id uuid
);


--
-- Name: climate_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_reports (
    report_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    report_type character varying(50) NOT NULL,
    generated_by uuid,
    parameters jsonb NOT NULL,
    file_path text NOT NULL,
    file_size bigint,
    status character varying(20) DEFAULT 'pending'::character varying,
    created_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone,
    download_count integer DEFAULT 0
);


--
-- Name: climate_risk_calculations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_risk_calculations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    receivable_id uuid NOT NULL,
    calculated_at timestamp with time zone DEFAULT now() NOT NULL,
    production_risk_score numeric(5,4) NOT NULL,
    production_risk_factors text[] DEFAULT '{}'::text[] NOT NULL,
    production_risk_confidence numeric(5,4) NOT NULL,
    last_weather_update timestamp with time zone,
    credit_risk_score numeric(5,4) NOT NULL,
    credit_risk_factors text[] DEFAULT '{}'::text[] NOT NULL,
    credit_risk_confidence numeric(5,4) NOT NULL,
    last_credit_update timestamp with time zone,
    policy_risk_score numeric(5,4) NOT NULL,
    policy_risk_factors text[] DEFAULT '{}'::text[] NOT NULL,
    policy_risk_confidence numeric(5,4) NOT NULL,
    last_policy_update timestamp with time zone,
    composite_risk_score numeric(5,4) NOT NULL,
    composite_risk_level text NOT NULL,
    composite_risk_confidence numeric(5,4) NOT NULL,
    discount_rate_calculated numeric(8,4) NOT NULL,
    discount_rate_previous numeric(8,4),
    discount_rate_change numeric(8,4),
    discount_rate_reason text,
    recommendations text[] DEFAULT '{}'::text[] NOT NULL,
    alerts jsonb DEFAULT '[]'::jsonb NOT NULL,
    next_review_date timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    project_id uuid,
    market_adjustments jsonb DEFAULT '{}'::jsonb,
    user_data_sources jsonb DEFAULT '[]'::jsonb,
    data_completeness character varying(20) DEFAULT 'basic'::character varying,
    methodology_used text,
    factors_considered jsonb DEFAULT '[]'::jsonb,
    policy_impact_assessment jsonb DEFAULT '[]'::jsonb,
    calculation_date timestamp with time zone DEFAULT now(),
    CONSTRAINT climate_risk_calculations_composite_risk_confidence_check CHECK (((composite_risk_confidence >= (0)::numeric) AND (composite_risk_confidence <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_composite_risk_level_check CHECK ((composite_risk_level = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text]))),
    CONSTRAINT climate_risk_calculations_composite_risk_score_check CHECK (((composite_risk_score >= (0)::numeric) AND (composite_risk_score <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_credit_risk_confidence_check CHECK (((credit_risk_confidence >= (0)::numeric) AND (credit_risk_confidence <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_credit_risk_score_check CHECK (((credit_risk_score >= (0)::numeric) AND (credit_risk_score <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_data_completeness_check CHECK (((data_completeness)::text = ANY (ARRAY[('basic'::character varying)::text, ('enhanced'::character varying)::text, ('comprehensive'::character varying)::text]))),
    CONSTRAINT climate_risk_calculations_policy_risk_confidence_check CHECK (((policy_risk_confidence >= (0)::numeric) AND (policy_risk_confidence <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_policy_risk_score_check CHECK (((policy_risk_score >= (0)::numeric) AND (policy_risk_score <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_production_risk_confidence_check CHECK (((production_risk_confidence >= (0)::numeric) AND (production_risk_confidence <= (1)::numeric))),
    CONSTRAINT climate_risk_calculations_production_risk_score_check CHECK (((production_risk_score >= (0)::numeric) AND (production_risk_score <= (1)::numeric)))
);


--
-- Name: TABLE climate_risk_calculations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.climate_risk_calculations IS 'Automated risk calculation results for climate receivables including production, credit, and policy risk components. Access controlled by authentication status.';


--
-- Name: climate_risk_factors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_risk_factors (
    factor_id uuid DEFAULT gen_random_uuid() NOT NULL,
    receivable_id uuid,
    production_risk numeric(5,2),
    credit_risk numeric(5,2),
    policy_risk numeric(5,2),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: token_climate_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_climate_properties (
    token_id uuid NOT NULL,
    pool_id uuid,
    average_risk_score numeric(5,2),
    discounted_value numeric(15,2),
    discount_amount numeric(15,2),
    average_discount_rate numeric(5,2),
    security_interest_details text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tokens (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    name text NOT NULL,
    symbol text NOT NULL,
    decimals integer DEFAULT 18 NOT NULL,
    standard public.token_standard_enum NOT NULL,
    blocks jsonb NOT NULL,
    metadata jsonb,
    status public.token_status_enum DEFAULT 'DRAFT'::public.token_status_enum NOT NULL,
    reviewers text[] DEFAULT '{}'::text[],
    approvals text[] DEFAULT '{}'::text[],
    contract_preview text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    total_supply text,
    config_mode public.token_config_mode_enum DEFAULT 'min'::public.token_config_mode_enum,
    address character varying(255),
    blockchain character varying(100),
    deployment_status character varying(50) DEFAULT 'pending'::character varying,
    deployment_timestamp timestamp without time zone,
    deployment_transaction character varying(255),
    deployment_error text,
    deployed_by uuid,
    deployment_environment character varying(50),
    description text,
    master_address text,
    master_version text,
    is_minimal_proxy boolean DEFAULT true,
    initialization_data jsonb,
    initial_owner text,
    product_id uuid,
    ratio numeric,
    parity numeric,
    product_type character varying(50),
    CONSTRAINT tokens_product_type_check CHECK (((product_type)::text = ANY (ARRAY[('asset_backed'::character varying)::text, ('bond'::character varying)::text, ('collectible'::character varying)::text, ('commodity'::character varying)::text, ('digital_tokenized_fund'::character varying)::text, ('energy'::character varying)::text, ('equity'::character varying)::text, ('fund'::character varying)::text, ('mmf'::character varying)::text, ('infrastructure'::character varying)::text, ('private_debt'::character varying)::text, ('private_equity'::character varying)::text, ('quant_strategy'::character varying)::text, ('real_estate'::character varying)::text, ('stablecoin'::character varying)::text, ('structured_product'::character varying)::text])))
);


--
-- Name: COLUMN tokens.config_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tokens.config_mode IS 'Indicates if token uses minimal or maximal configuration (values: min, max)';


--
-- Name: COLUMN tokens.deployment_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tokens.deployment_status IS 'Status of contract deployment and initialization. Values: pending, deployed, FAILED_INITIALIZATION, failed';


--
-- Name: COLUMN tokens.product_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tokens.product_id IS 'References either bond_products.id or fund_products.id depending on product_type';


--
-- Name: COLUMN tokens.product_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tokens.product_type IS 'Type of product: bond (bond_products), mmf (fund_products), or fund (fund_products)';


--
-- Name: climate_token_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.climate_token_summary AS
 SELECT t.id AS token_id,
    t.name,
    t.symbol,
    t.project_id,
    t.status,
    tcp.pool_id,
    ctp.name AS pool_name,
    t.total_supply,
    tcp.average_risk_score,
    tcp.discounted_value,
    tcp.discount_amount,
    tcp.average_discount_rate,
    ctp.risk_profile
   FROM ((public.tokens t
     JOIN public.token_climate_properties tcp ON ((t.id = tcp.token_id)))
     JOIN public.climate_tokenization_pools ctp ON ((tcp.pool_id = ctp.pool_id)));


--
-- Name: climate_user_data_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_user_data_cache (
    cache_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    source_id uuid,
    entity_id character varying(255) NOT NULL,
    data_type character varying(50) NOT NULL,
    processed_data jsonb NOT NULL,
    extracted_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone NOT NULL,
    data_quality_score numeric(3,2) DEFAULT 0.5,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT climate_user_data_cache_data_quality_score_check CHECK (((data_quality_score >= (0)::numeric) AND (data_quality_score <= 1.0))),
    CONSTRAINT climate_user_data_cache_data_type_check CHECK (((data_type)::text = ANY (ARRAY[('credit_score'::character varying)::text, ('financial_metrics'::character varying)::text, ('payment_history'::character varying)::text])))
);


--
-- Name: TABLE climate_user_data_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.climate_user_data_cache IS 'Processed and cached data extracted from user uploads';


--
-- Name: climate_user_data_sources; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.climate_user_data_sources (
    source_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid,
    project_id uuid,
    source_name character varying(255) NOT NULL,
    source_type character varying(50) NOT NULL,
    data_format character varying(20) NOT NULL,
    file_path text NOT NULL,
    file_size bigint NOT NULL,
    data_schema jsonb DEFAULT '{}'::jsonb,
    upload_date timestamp with time zone DEFAULT now(),
    last_processed timestamp with time zone,
    processing_status character varying(20) DEFAULT 'pending'::character varying,
    validation_errors jsonb DEFAULT '[]'::jsonb,
    refresh_frequency character varying(20) DEFAULT 'manual'::character varying,
    is_active boolean DEFAULT true,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT climate_user_data_sources_data_format_check CHECK (((data_format)::text = ANY (ARRAY[('csv'::character varying)::text, ('xlsx'::character varying)::text, ('json'::character varying)::text, ('xml'::character varying)::text, ('pdf'::character varying)::text]))),
    CONSTRAINT climate_user_data_sources_file_size_check CHECK ((file_size > 0)),
    CONSTRAINT climate_user_data_sources_processing_status_check CHECK (((processing_status)::text = ANY (ARRAY[('pending'::character varying)::text, ('processing'::character varying)::text, ('completed'::character varying)::text, ('error'::character varying)::text]))),
    CONSTRAINT climate_user_data_sources_refresh_frequency_check CHECK (((refresh_frequency)::text = ANY (ARRAY[('manual'::character varying)::text, ('daily'::character varying)::text, ('weekly'::character varying)::text, ('monthly'::character varying)::text]))),
    CONSTRAINT climate_user_data_sources_source_type_check CHECK (((source_type)::text = ANY (ARRAY[('credit_report'::character varying)::text, ('financial_statement'::character varying)::text, ('market_data'::character varying)::text, ('custom'::character varying)::text])))
);


--
-- Name: TABLE climate_user_data_sources; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.climate_user_data_sources IS 'User-uploaded data sources for enhanced risk assessment';


--
-- Name: collectibles_appraisals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_appraisals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    collectibles_product_id uuid NOT NULL,
    appraisal_date timestamp with time zone NOT NULL,
    appraiser_name character varying(255) NOT NULL,
    appraiser_credentials text,
    appraiser_firm character varying(255),
    appraisal_type character varying(50) NOT NULL,
    appraised_value numeric(20,2) NOT NULL,
    value_range_low numeric(20,2),
    value_range_high numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    appraisal_method character varying(100),
    condition_assessment text,
    condition_grade character varying(20),
    authenticity_verified boolean DEFAULT false,
    authenticity_method text,
    rarity_assessment text,
    market_demand_assessment text,
    comparable_sales jsonb,
    recent_auction_results jsonb,
    market_trends_analysis text,
    factors_affecting_value text,
    liquidity_assessment text,
    estimated_time_to_sell_days integer,
    insurance_recommended_value numeric(20,2),
    replacement_cost numeric(20,2),
    appraisal_report_url text,
    photo_documentation_urls text[],
    is_certified_appraisal boolean DEFAULT false,
    certification_body character varying(100),
    next_appraisal_recommended_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE collectibles_appraisals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.collectibles_appraisals IS 'Professional appraisal history for collectibles';


--
-- Name: collectibles_authentication_records; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_authentication_records (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    confidence_score numeric NOT NULL,
    certification_authority text,
    certification_date date,
    fraud_risk_score numeric NOT NULL,
    authentication_method text,
    certificate_number text,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_authentication_records_confidence_score_check CHECK (((confidence_score >= (0)::numeric) AND (confidence_score <= (100)::numeric))),
    CONSTRAINT collectibles_authentication_records_fraud_risk_score_check CHECK (((fraud_risk_score >= (0)::numeric) AND (fraud_risk_score <= (100)::numeric)))
);


--
-- Name: collectibles_condition_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_condition_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    collectibles_product_id uuid NOT NULL,
    report_date timestamp with time zone NOT NULL,
    inspector_name character varying(255) NOT NULL,
    inspector_credentials text,
    inspection_type character varying(50),
    overall_condition_grade character varying(20) NOT NULL,
    physical_condition_score integer,
    structural_integrity text,
    surface_condition text,
    color_condition text,
    mechanical_condition text,
    completeness_assessment text,
    damage_assessment text,
    previous_repairs text,
    restoration_history text,
    conservation_needs text,
    recommended_conservation_work text,
    conservation_cost_estimate numeric(20,2),
    storage_requirements text,
    environmental_requirements text,
    handling_instructions text,
    display_recommendations text,
    insurance_considerations text,
    impact_on_value text,
    comparison_to_previous_reports text,
    deterioration_rate character varying(20),
    photos_taken integer,
    photo_urls text[],
    uv_light_examination_results text,
    x_ray_examination_results text,
    infrared_examination_results text,
    scientific_analysis_results jsonb,
    condition_report_url text,
    is_suitable_for_sale boolean DEFAULT true,
    is_suitable_for_display boolean DEFAULT true,
    is_suitable_for_loan boolean DEFAULT true,
    next_inspection_recommended_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE collectibles_condition_reports; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.collectibles_condition_reports IS 'Detailed condition assessments';


--
-- Name: collectibles_insurance_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_insurance_policies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    policy_number text,
    provider text,
    annual_premium numeric NOT NULL,
    coverage_amount numeric NOT NULL,
    deductible numeric,
    policy_type text,
    start_date date,
    end_date date,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_insurance_policies_annual_premium_check CHECK ((annual_premium >= (0)::numeric)),
    CONSTRAINT collectibles_insurance_policies_coverage_amount_check CHECK ((coverage_amount >= (0)::numeric))
);


--
-- Name: collectibles_insurance_valuations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_insurance_valuations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    collectibles_product_id uuid NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    valuation_purpose character varying(50) NOT NULL,
    insurance_provider character varying(255),
    policy_number character varying(100),
    insured_value numeric(20,2) NOT NULL,
    replacement_value numeric(20,2) NOT NULL,
    agreed_value numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    valuation_basis character varying(50),
    annual_premium numeric(20,2),
    premium_rate numeric(5,4),
    deductible numeric(20,2),
    coverage_type character varying(50),
    coverage_territory character varying(100),
    storage_requirements text,
    security_requirements text,
    display_restrictions text,
    transit_coverage boolean DEFAULT false,
    exhibition_coverage boolean DEFAULT false,
    restoration_coverage boolean DEFAULT false,
    pair_and_set_clause text,
    inflation_guard_percentage numeric(5,2),
    appraisal_required_frequency character varying(20),
    last_appraisal_date timestamp with time zone,
    next_appraisal_due_date timestamp with time zone,
    claims_history jsonb,
    risk_mitigation_measures text,
    special_conditions text,
    policy_effective_date timestamp with time zone,
    policy_expiration_date timestamp with time zone,
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE collectibles_insurance_valuations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.collectibles_insurance_valuations IS 'Insurance-specific valuations';


--
-- Name: collectibles_market_comparables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_market_comparables (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    collectibles_product_id uuid NOT NULL,
    comparable_item_description text NOT NULL,
    artist_creator character varying(255),
    creation_date character varying(100),
    medium_type character varying(100),
    dimensions character varying(100),
    condition_grade character varying(20),
    sale_date timestamp with time zone NOT NULL,
    sale_price numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    sale_venue character varying(100),
    sale_type character varying(50),
    lot_number character varying(50),
    estimate_low numeric(20,2),
    estimate_high numeric(20,2),
    hammer_price numeric(20,2),
    buyers_premium_percentage numeric(5,2),
    total_price_with_premium numeric(20,2),
    number_of_bidders integer,
    provenance_quality character varying(20),
    exhibition_history_quality character varying(20),
    publication_history_quality character varying(20),
    authenticity_status character varying(20),
    rarity_compared character varying(50),
    condition_compared character varying(50),
    similarity_score integer,
    relevance_to_valuation character varying(20),
    adjustment_factors jsonb,
    adjusted_comparable_value numeric(20,2),
    data_source character varying(100),
    catalog_reference character varying(100),
    catalog_url text,
    image_url text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE collectibles_market_comparables; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.collectibles_market_comparables IS 'Comparable sales for valuation';


--
-- Name: collectibles_market_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_market_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    estimated_value numeric NOT NULL,
    trend numeric NOT NULL,
    liquidity numeric NOT NULL,
    volatility numeric NOT NULL,
    seasonality numeric NOT NULL,
    demand numeric NOT NULL,
    supply numeric NOT NULL,
    investment_grade numeric NOT NULL,
    last_updated timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_market_metrics_demand_check CHECK (((demand >= (0)::numeric) AND (demand <= (100)::numeric))),
    CONSTRAINT collectibles_market_metrics_estimated_value_check CHECK ((estimated_value >= (0)::numeric)),
    CONSTRAINT collectibles_market_metrics_investment_grade_check CHECK (((investment_grade >= (0)::numeric) AND (investment_grade <= (100)::numeric))),
    CONSTRAINT collectibles_market_metrics_liquidity_check CHECK (((liquidity >= (0)::numeric) AND (liquidity <= (100)::numeric))),
    CONSTRAINT collectibles_market_metrics_supply_check CHECK (((supply >= (0)::numeric) AND (supply <= (100)::numeric))),
    CONSTRAINT collectibles_market_metrics_volatility_check CHECK (((volatility >= (0)::numeric) AND (volatility <= (1)::numeric)))
);


--
-- Name: collectibles_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_id character varying(50),
    asset_type character varying(100),
    description text,
    acquisition_date timestamp with time zone,
    purchase_price numeric,
    current_value numeric,
    condition character varying(50),
    location text,
    owner text,
    insurance_details numeric,
    appraisal_date timestamp with time zone,
    sale_date timestamp with time zone,
    sale_price numeric,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: collectibles_provenance; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_provenance (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    collectibles_product_id uuid NOT NULL,
    sequence_number integer NOT NULL,
    ownership_period_start timestamp with time zone,
    ownership_period_end timestamp with time zone,
    owner_name character varying(255),
    owner_type character varying(50),
    acquisition_method character varying(100),
    acquisition_date timestamp with time zone,
    acquisition_price numeric(20,2),
    acquisition_currency character varying(3),
    acquisition_source character varying(255),
    sale_method character varying(100),
    sale_date timestamp with time zone,
    sale_price numeric(20,2),
    sale_currency character varying(3),
    buyer_name character varying(255),
    exhibition_history jsonb,
    publication_history jsonb,
    restoration_events jsonb,
    documentation_type character varying(50),
    documentation_url text,
    is_gap_in_provenance boolean DEFAULT false,
    gap_explanation text,
    authenticity_concerns text,
    legal_disputes text,
    export_import_documentation text,
    cultural_property_status character varying(50),
    verification_status character varying(20) DEFAULT 'verified'::character varying,
    verified_by character varying(255),
    verification_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE collectibles_provenance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.collectibles_provenance IS 'Ownership and authenticity history';


--
-- Name: collectibles_provenance_records; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_provenance_records (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    completeness_score numeric NOT NULL,
    documentation_quality numeric NOT NULL,
    ownership_history jsonb DEFAULT '[]'::jsonb,
    gaps text[],
    earliest_record_date date,
    verification_status text,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_provenance_records_completeness_score_check CHECK (((completeness_score >= (0)::numeric) AND (completeness_score <= (100)::numeric))),
    CONSTRAINT collectibles_provenance_records_documentation_quality_check CHECK (((documentation_quality >= (0)::numeric) AND (documentation_quality <= (100)::numeric)))
);


--
-- Name: collectibles_rarity_scores; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_rarity_scores (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    rarity_score numeric NOT NULL,
    production_quantity integer,
    surviving_quantity integer,
    grade_level text,
    unique_characteristics text[],
    comparable_count integer,
    scarcity_factor numeric,
    assessment_date date DEFAULT CURRENT_DATE NOT NULL,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_rarity_scores_rarity_score_check CHECK (((rarity_score >= (0)::numeric) AND (rarity_score <= (100)::numeric))),
    CONSTRAINT collectibles_rarity_scores_scarcity_factor_check CHECK (((scarcity_factor >= (0)::numeric) AND (scarcity_factor <= (1)::numeric)))
);


--
-- Name: collectibles_risk_assessments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_risk_assessments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    authenticity_risk numeric NOT NULL,
    damage_risk numeric NOT NULL,
    theft_risk numeric NOT NULL,
    storage_risk numeric NOT NULL,
    legal_risk numeric NOT NULL,
    market_risk numeric,
    liquidity_risk numeric,
    assessment_date date DEFAULT CURRENT_DATE NOT NULL,
    assessor text,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_risk_assessments_authenticity_risk_check CHECK (((authenticity_risk >= (0)::numeric) AND (authenticity_risk <= (100)::numeric))),
    CONSTRAINT collectibles_risk_assessments_damage_risk_check CHECK (((damage_risk >= (0)::numeric) AND (damage_risk <= (100)::numeric))),
    CONSTRAINT collectibles_risk_assessments_legal_risk_check CHECK (((legal_risk >= (0)::numeric) AND (legal_risk <= (100)::numeric))),
    CONSTRAINT collectibles_risk_assessments_storage_risk_check CHECK (((storage_risk >= (0)::numeric) AND (storage_risk <= (100)::numeric))),
    CONSTRAINT collectibles_risk_assessments_theft_risk_check CHECK (((theft_risk >= (0)::numeric) AND (theft_risk <= (100)::numeric)))
);


--
-- Name: collectibles_storage_facilities; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.collectibles_storage_facilities (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    facility_name text,
    location text,
    monthly_cost numeric NOT NULL,
    annual_cost numeric NOT NULL,
    storage_conditions text,
    security_level text,
    insurance_included boolean DEFAULT false,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT collectibles_storage_facilities_annual_cost_check CHECK ((annual_cost >= (0)::numeric)),
    CONSTRAINT collectibles_storage_facilities_monthly_cost_check CHECK ((monthly_cost >= (0)::numeric))
);


--
-- Name: commodities_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodities_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    commodity_id character varying(20),
    commodity_name text,
    commodity_type character varying(50),
    unit_of_measure character varying(50),
    contract_size numeric,
    grade_quality text,
    exchange character varying(50),
    delivery_months text[],
    liquidity_metric numeric,
    currency character varying(10),
    contract_issue_date timestamp with time zone,
    expiration_date timestamp with time zone,
    status character varying(50),
    roll_history jsonb,
    storage_delivery_costs numeric,
    production_inventory_levels jsonb,
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: commodity_collateral; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_collateral (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    position_id uuid NOT NULL,
    commodity_type text NOT NULL,
    token_address text NOT NULL,
    token_id text,
    amount numeric(20,6) NOT NULL,
    value_usd numeric(20,6) NOT NULL,
    haircut_bps integer NOT NULL,
    quality text,
    certificate_date timestamp with time zone,
    document_hash text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_collateral; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_collateral IS 'Tokenized commodity collateral details for each position';


--
-- Name: commodity_debt; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_debt (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    position_id uuid NOT NULL,
    asset_address text NOT NULL,
    amount numeric(20,6) NOT NULL,
    value_usd numeric(20,6) NOT NULL,
    interest_rate_bps integer NOT NULL,
    accrued_interest numeric(20,6) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    last_updated timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_debt; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_debt IS 'Debt obligations and accrued interest for each position';


--
-- Name: commodity_handling_costs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_handling_costs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type text NOT NULL,
    unit_of_measure text NOT NULL,
    cost_per_unit numeric NOT NULL,
    handling_type text,
    location text,
    currency text DEFAULT 'USD'::text NOT NULL,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    expiration_date date,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commodity_handling_costs_cost_per_unit_check CHECK ((cost_per_unit >= (0)::numeric))
);


--
-- Name: commodity_implied_volatility; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_implied_volatility (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    instrument_key text NOT NULL,
    volatility numeric NOT NULL,
    maturity_months integer,
    calculation_method text,
    confidence_interval numeric,
    calculation_date date DEFAULT CURRENT_DATE NOT NULL,
    data_source text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commodity_implied_volatility_volatility_check CHECK (((volatility >= (0)::numeric) AND (volatility <= (10)::numeric)))
);


--
-- Name: commodity_insurance_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_insurance_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type text NOT NULL,
    annual_rate numeric NOT NULL,
    coverage_type text,
    minimum_coverage numeric,
    maximum_coverage numeric,
    deductible_percentage numeric,
    geographic_scope text,
    risk_factors jsonb DEFAULT '{}'::jsonb,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    expiration_date date,
    provider text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commodity_insurance_rates_annual_rate_check CHECK ((annual_rate >= (0)::numeric))
);


--
-- Name: commodity_market_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_market_data (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    instrument_key text NOT NULL,
    open_interest integer DEFAULT 0 NOT NULL,
    volume integer DEFAULT 0 NOT NULL,
    vwap numeric,
    high numeric,
    low numeric,
    close numeric,
    settlement numeric,
    market_date date DEFAULT CURRENT_DATE NOT NULL,
    exchange text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: commodity_pool_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_pool_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    commodity_type text NOT NULL,
    base_haircut_bps integer DEFAULT 500 NOT NULL,
    ltv_bps integer DEFAULT 8000 NOT NULL,
    liquidation_threshold_bps integer DEFAULT 8500 NOT NULL,
    liquidation_bonus_bps integer DEFAULT 500 NOT NULL,
    supply_cap_usd numeric(20,6) DEFAULT 1000000 NOT NULL,
    borrow_cap_usd numeric(20,6) DEFAULT 800000 NOT NULL,
    is_isolated boolean DEFAULT false NOT NULL,
    debt_ceiling_usd numeric(20,6),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_pool_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_pool_config IS 'Risk parameters and configuration for each commodity type';


--
-- Name: commodity_positions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_positions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    wallet_address text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_positions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_positions IS 'Active lending positions with collateral and debt tracking';


--
-- Name: commodity_prices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_prices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    commodity_type text NOT NULL,
    price_usd numeric(20,6) NOT NULL,
    volume numeric(20,6),
    confidence_score integer DEFAULT 100 NOT NULL,
    oracle_source text NOT NULL,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_prices; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_prices IS 'Historical and real-time commodity prices from oracle feeds';


--
-- Name: commodity_quality_multipliers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_quality_multipliers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type text NOT NULL,
    grade text NOT NULL,
    multiplier numeric NOT NULL,
    grade_specification text,
    applicable_standards text[],
    typical_price_differential numeric,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    expiration_date date,
    certifying_body text,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commodity_quality_multipliers_multiplier_check CHECK ((multiplier > (0)::numeric))
);


--
-- Name: commodity_risk_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_risk_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    commodity_type text NOT NULL,
    volatility_bps integer NOT NULL,
    max_drawdown_bps integer NOT NULL,
    value_at_risk_95_bps integer NOT NULL,
    value_at_risk_99_bps integer NOT NULL,
    sharpe_ratio integer NOT NULL,
    liquidity_score integer NOT NULL,
    data_points integer NOT NULL,
    calculated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE commodity_risk_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commodity_risk_metrics IS 'Statistical risk analysis results for commodity haircut calculations';


--
-- Name: commodity_storage_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commodity_storage_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type text NOT NULL,
    storage_location text,
    annual_rate numeric NOT NULL,
    monthly_rate numeric,
    daily_rate numeric,
    unit_of_measure text,
    facility_type text,
    minimum_quantity numeric,
    currency text DEFAULT 'USD'::text NOT NULL,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    expiration_date date,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commodity_storage_rates_annual_rate_check CHECK ((annual_rate >= (0)::numeric))
);


--
-- Name: compliance_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_alerts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    type text NOT NULL,
    severity text NOT NULL,
    message text NOT NULL,
    details jsonb,
    "timestamp" timestamp with time zone NOT NULL,
    acknowledged boolean DEFAULT false,
    acknowledged_by uuid,
    acknowledged_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT compliance_alerts_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: TABLE compliance_alerts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.compliance_alerts IS 'Stores all compliance alerts generated by the system';


--
-- Name: compliance_audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_audit_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    operation_type text NOT NULL,
    operator text NOT NULL,
    compliance_status jsonb NOT NULL,
    violations jsonb[],
    audit_trail jsonb NOT NULL,
    regulatory_flags jsonb[],
    reporting_required boolean DEFAULT false,
    integrity_hash text NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: compliance_checks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_checks (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    investor_id uuid NOT NULL,
    project_id uuid NOT NULL,
    risk_level text NOT NULL,
    risk_reason text NOT NULL,
    status text NOT NULL,
    reviewed_by uuid,
    reviewed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT compliance_checks_risk_level_check CHECK ((risk_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text]))),
    CONSTRAINT compliance_checks_status_check CHECK ((status = ANY (ARRAY['pending_approval'::text, 'approved'::text, 'rejected'::text])))
);


--
-- Name: compliance_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    metric_date date NOT NULL,
    total_operations integer DEFAULT 0,
    compliant_operations integer DEFAULT 0,
    partial_compliance integer DEFAULT 0,
    non_compliant integer DEFAULT 0,
    violations_count integer DEFAULT 0,
    reports_generated integer DEFAULT 0,
    avg_compliance_score numeric,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: compliance_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    issuer_id uuid NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL,
    status public.compliance_status DEFAULT 'pending_review'::public.compliance_status NOT NULL,
    findings jsonb DEFAULT '[]'::jsonb NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid NOT NULL,
    updated_by uuid NOT NULL
);


--
-- Name: compliance_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_settings (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    organization_id text NOT NULL,
    kyc_status text DEFAULT 'not_started'::text NOT NULL,
    require_accreditation boolean DEFAULT false NOT NULL,
    minimum_investment integer DEFAULT 0 NOT NULL,
    jurisdictions text[] DEFAULT '{}'::text[],
    investor_count integer DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: compliance_violations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_violations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    violation_id text NOT NULL,
    operation_id uuid,
    type text NOT NULL,
    severity text NOT NULL,
    description text,
    remediation text,
    resolved boolean DEFAULT false,
    resolved_at timestamp with time zone,
    resolved_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT compliance_violations_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: consensus_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.consensus_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    consensus_type text NOT NULL,
    required_approvals integer NOT NULL,
    eligible_roles text[] NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: contract_master_versions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_master_versions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    contract_type text NOT NULL,
    version text NOT NULL,
    abi json NOT NULL,
    bytecode text NOT NULL,
    changes text,
    breaking_changes boolean DEFAULT false,
    migration_required boolean DEFAULT false,
    migration_guide text,
    deployed_at timestamp with time zone DEFAULT now(),
    deprecated_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: contract_masters; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_masters (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    network text NOT NULL,
    environment text NOT NULL,
    contract_type text NOT NULL,
    contract_address text NOT NULL,
    version text DEFAULT '1.0.0'::text NOT NULL,
    abi_version text DEFAULT '1.0.0'::text NOT NULL,
    abi json,
    abi_hash text,
    deployed_at timestamp with time zone DEFAULT now(),
    deployed_by uuid,
    deployment_tx_hash text,
    is_active boolean DEFAULT true,
    deprecated_at timestamp with time zone,
    deployment_data jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    contract_details jsonb,
    initial_owner text,
    is_template boolean DEFAULT false,
    verification_status text DEFAULT 'unverified'::text,
    verified_at timestamp with time zone,
    verification_url text,
    verification_error text,
    proxy_address text,
    implementation_address text,
    upgrade_history jsonb DEFAULT '[]'::jsonb,
    CONSTRAINT contract_masters_environment_check CHECK ((environment = ANY (ARRAY['mainnet'::text, 'testnet'::text, 'devnet'::text, 'local'::text])))
);


--
-- Name: TABLE contract_masters; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_masters IS 'Stores deployed contract information. For UUPS upgradeable contracts:
- contract_address = proxy address (main interface)
- deployment_data.proxy_address = same as contract_address
- deployment_data.implementation_address = implementation contract
- contract_details.upgrade_history = array of past upgrades
- deployment_data.initialization_params = initialize() parameters';


--
-- Name: COLUMN contract_masters.network; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters.network IS 'Blockchain network identifier - no enum constraint to allow new networks. Examples: ethereum, polygon, arbitrum, hoodi, base, optimism, avalanche, bsc, etc.';


--
-- Name: COLUMN contract_masters.contract_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters.contract_type IS 'Contract type identifier - no enum constraint to allow flexibility for new contract types. Examples: erc20_master, erc721_beacon, compliance_module, policy_engine, multi_sig_wallet, etc.';


--
-- Name: COLUMN contract_masters.abi_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters.abi_hash IS 'SHA-256 hash of ABI for verification and change detection';


--
-- Name: COLUMN contract_masters.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters.is_active IS 'Whether this is the currently active version (for upgrades)';


--
-- Name: COLUMN contract_masters.deployment_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters.deployment_data IS 'JSONB field for additional metadata: source_file, implementation_address, features, category, etherscan_link, etc.';


--
-- Name: contract_masters_backup; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_masters_backup (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    network text NOT NULL,
    environment text NOT NULL,
    contract_type text NOT NULL,
    contract_address text NOT NULL,
    version text DEFAULT '1.0.0'::text NOT NULL,
    abi_version text DEFAULT '1.0.0'::text NOT NULL,
    abi json,
    abi_hash text,
    deployed_at timestamp with time zone DEFAULT now(),
    deployed_by uuid,
    deployment_tx_hash text,
    is_active boolean DEFAULT true,
    deprecated_at timestamp with time zone,
    deployment_data jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    contract_details jsonb,
    initial_owner text,
    is_template boolean DEFAULT false,
    verification_status text DEFAULT 'unverified'::text,
    verified_at timestamp with time zone,
    verification_url text,
    verification_error text,
    CONSTRAINT contract_masters_environment_check CHECK ((environment = ANY (ARRAY['mainnet'::text, 'testnet'::text, 'devnet'::text, 'local'::text])))
);


--
-- Name: TABLE contract_masters_backup; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_masters_backup IS 'This is a backup of contract_masters';


--
-- Name: COLUMN contract_masters_backup.network; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters_backup.network IS 'Blockchain network identifier - no enum constraint to allow new networks. Examples: ethereum, polygon, arbitrum, hoodi, base, optimism, avalanche, bsc, etc.';


--
-- Name: COLUMN contract_masters_backup.contract_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters_backup.contract_type IS 'Contract type identifier - no enum constraint to allow flexibility for new contract types. Examples: erc20_master, erc721_beacon, compliance_module, policy_engine, multi_sig_wallet, etc.';


--
-- Name: COLUMN contract_masters_backup.abi_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters_backup.abi_hash IS 'SHA-256 hash of ABI for verification and change detection';


--
-- Name: COLUMN contract_masters_backup.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters_backup.is_active IS 'Whether this is the currently active version (for upgrades)';


--
-- Name: COLUMN contract_masters_backup.deployment_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_masters_backup.deployment_data IS 'JSONB field for additional metadata: source_file, implementation_address, features, category, etherscan_link, etc.';


--
-- Name: contract_role_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_role_assignments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    multi_sig_wallet_id uuid,
    multi_sig_wallet_address text NOT NULL,
    contract_address text NOT NULL,
    contract_type text NOT NULL,
    role_name text NOT NULL,
    role_bytes32 text NOT NULL,
    blockchain text NOT NULL,
    transaction_hash text NOT NULL,
    status text DEFAULT 'assigned'::text NOT NULL,
    revoked_tx_hash text,
    assigned_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT contract_role_assignments_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'assigned'::text, 'revoked'::text])))
);


--
-- Name: TABLE contract_role_assignments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_role_assignments IS 'Tracks role assignments to multi-sig wallets on smart contracts';


--
-- Name: COLUMN contract_role_assignments.contract_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_role_assignments.contract_type IS 'Type of contract (ERC20Master, TokenFactory, PolicyEngine, etc.)';


--
-- Name: COLUMN contract_role_assignments.role_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_role_assignments.role_name IS 'Human-readable role name (DEFAULT_ADMIN_ROLE, UPGRADER_ROLE, etc.)';


--
-- Name: COLUMN contract_role_assignments.role_bytes32; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_role_assignments.role_bytes32 IS 'keccak256 hash of role name for on-chain use';


--
-- Name: corporate_actions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.corporate_actions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    equity_product_id uuid NOT NULL,
    ticker_symbol character varying(20) NOT NULL,
    action_type character varying(50) NOT NULL,
    effective_date timestamp with time zone NOT NULL,
    announcement_date timestamp with time zone,
    ex_date timestamp with time zone,
    record_date timestamp with time zone,
    ratio_from integer,
    ratio_to integer,
    exchange_ratio numeric(20,6),
    acquiring_company character varying(255),
    target_company character varying(255),
    new_ticker_symbol character varying(20),
    cash_consideration numeric(20,2),
    stock_consideration numeric(20,6),
    description text,
    impact_on_holdings jsonb,
    status character varying(20) DEFAULT 'announced'::character varying,
    regulatory_approvals_required boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE corporate_actions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.corporate_actions IS 'Records corporate actions like splits, mergers, and spin-offs';


--
-- Name: credential_usage_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.credential_usage_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    credential_id uuid NOT NULL,
    action_type text NOT NULL,
    action_details jsonb,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now(),
    ip_address text,
    user_agent text
);


--
-- Name: critical_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.critical_alerts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    type text NOT NULL,
    severity text DEFAULT 'critical'::text,
    message text NOT NULL,
    details jsonb,
    "timestamp" timestamp with time zone NOT NULL,
    escalated boolean DEFAULT false,
    escalation_level integer DEFAULT 0,
    notification_channels text[],
    acknowledged boolean DEFAULT false,
    acknowledged_by uuid,
    acknowledged_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE critical_alerts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.critical_alerts IS 'Tracks critical alerts requiring escalation';


--
-- Name: crypto_etf_holdings_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.crypto_etf_holdings_summary AS
SELECT
    NULL::uuid AS fund_product_id,
    NULL::character varying(20) AS fund_ticker,
    NULL::text AS fund_name,
    NULL::character varying(50) AS blockchain,
    NULL::bigint AS num_holdings,
    NULL::numeric AS total_value,
    NULL::numeric AS percentage_of_aum,
    NULL::bigint AS num_staked_holdings,
    NULL::numeric AS total_staking_rewards,
    NULL::numeric AS avg_staking_apr,
    NULL::date AS as_of_date;


--
-- Name: VIEW crypto_etf_holdings_summary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.crypto_etf_holdings_summary IS 'Summary of crypto holdings by blockchain for crypto ETFs';


--
-- Name: crypto_symbol_mappings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.crypto_symbol_mappings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    symbol character varying(20) NOT NULL,
    coingecko_id character varying(50) NOT NULL,
    name character varying(100),
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE crypto_symbol_mappings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.crypto_symbol_mappings IS 'Crypto symbol to CoinGecko ID mappings (NO HARDCODED VALUES)';


--
-- Name: dashboard_updates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dashboard_updates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    compliance_status jsonb,
    violations integer,
    "timestamp" timestamp with time zone,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: data_source_mappings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.data_source_mappings (
    mapping_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    source_id uuid,
    source_field character varying(255) NOT NULL,
    target_field character varying(255) NOT NULL,
    data_transform text DEFAULT ''::text,
    validation_rules jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE data_source_mappings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.data_source_mappings IS 'Field mappings for standardizing user uploaded data';


--
-- Name: database_audit_coverage; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.database_audit_coverage AS
 WITH all_tables AS (
         SELECT tables.table_name
           FROM information_schema.tables
          WHERE (((tables.table_schema)::name = 'public'::name) AND ((tables.table_type)::text = 'BASE TABLE'::text))
        ), audited_tables AS (
         SELECT DISTINCT audit_logs.entity_type AS table_name
           FROM public.audit_logs
          WHERE ((audit_logs."timestamp" >= (now() - '7 days'::interval)) AND (audit_logs.entity_type IS NOT NULL))
        )
 SELECT at.table_name,
        CASE
            WHEN (aud.table_name IS NOT NULL) THEN true
            ELSE false
        END AS has_recent_audit,
    COALESCE(al.event_count, (0)::bigint) AS recent_event_count,
    COALESCE(al.last_event, NULL::timestamp with time zone) AS last_audit_event
   FROM ((all_tables at
     LEFT JOIN audited_tables aud ON (((at.table_name)::name = aud.table_name)))
     LEFT JOIN ( SELECT audit_logs.entity_type,
            count(*) AS event_count,
            max(audit_logs."timestamp") AS last_event
           FROM public.audit_logs
          WHERE (audit_logs."timestamp" >= (now() - '7 days'::interval))
          GROUP BY audit_logs.entity_type) al ON (((at.table_name)::name = al.entity_type)))
  ORDER BY COALESCE(al.event_count, (0)::bigint) DESC, at.table_name;


--
-- Name: VIEW database_audit_coverage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.database_audit_coverage IS 'Shows audit coverage across all database tables';


--
-- Name: deployment_audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.deployment_audit_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    network text NOT NULL,
    action text NOT NULL,
    command text NOT NULL,
    success boolean NOT NULL,
    exit_code integer NOT NULL,
    duration_ms integer NOT NULL,
    output text,
    error text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT deployment_audit_logs_action_check CHECK ((action = ANY (ARRAY['deployment'::text, 'verification'::text, 'command_execution'::text, 'deploy_and_verify'::text])))
);


--
-- Name: TABLE deployment_audit_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.deployment_audit_logs IS 'Audit log for all deployment and verification activities';


--
-- Name: COLUMN deployment_audit_logs.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.user_id IS 'User who initiated the deployment. NULL for system-initiated operations.';


--
-- Name: COLUMN deployment_audit_logs.network; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.network IS 'Network where deployment occurred (hoodi, sepolia, mainnet, etc.)';


--
-- Name: COLUMN deployment_audit_logs.action; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.action IS 'Type of action: deployment, verification, or command_execution';


--
-- Name: COLUMN deployment_audit_logs.command; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.command IS 'Sanitized command that was executed (private keys removed)';


--
-- Name: COLUMN deployment_audit_logs.success; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.success IS 'Whether the command succeeded';


--
-- Name: COLUMN deployment_audit_logs.exit_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.exit_code IS 'Exit code of the command (0 = success)';


--
-- Name: COLUMN deployment_audit_logs.duration_ms; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.duration_ms IS 'Duration of command execution in milliseconds';


--
-- Name: COLUMN deployment_audit_logs.output; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.output IS 'Command output (truncated to 10,000 characters)';


--
-- Name: COLUMN deployment_audit_logs.error; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.error IS 'Error message if command failed';


--
-- Name: COLUMN deployment_audit_logs.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.deployment_audit_logs.metadata IS 'Additional metadata (RPC URL, contract addresses, etc.)';


--
-- Name: deployment_rate_limits; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.deployment_rate_limits (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid NOT NULL,
    project_id uuid NOT NULL,
    token_id uuid NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL,
    completed_at timestamp with time zone,
    status text NOT NULL,
    network text,
    environment text,
    CONSTRAINT deployment_rate_limits_status_check CHECK ((status = ANY (ARRAY['started'::text, 'completed'::text, 'failed'::text])))
);


--
-- Name: dfns_activity_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_activity_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    activity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_type text NOT NULL,
    description text NOT NULL,
    user_id text,
    status text NOT NULL,
    metadata jsonb,
    ip_address inet,
    user_agent text,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_activity_logs_status_check CHECK ((status = ANY (ARRAY['success'::text, 'failed'::text, 'pending'::text])))
);


--
-- Name: dfns_api_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_api_requests (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    endpoint text NOT NULL,
    method text NOT NULL,
    request_id text,
    request_body jsonb,
    response_body jsonb,
    status_code integer NOT NULL,
    response_time_ms integer,
    error_message text,
    user_id text,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: dfns_applications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_applications (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    app_id text NOT NULL,
    name text NOT NULL,
    description text,
    kind text NOT NULL,
    origin text,
    relying_party text,
    status text DEFAULT 'Active'::text NOT NULL,
    external_id text,
    logo_url text,
    terms_of_service_url text,
    privacy_policy_url text,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_applications_kind_check CHECK ((kind = ANY (ARRAY['ClientSide'::text, 'ServerSide'::text]))),
    CONSTRAINT dfns_applications_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Archived'::text])))
);


--
-- Name: dfns_authentication_challenges; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_authentication_challenges (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    challenge_id text NOT NULL,
    user_id text NOT NULL,
    challenge_data jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    completed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_authentication_challenges_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'completed'::text, 'expired'::text, 'failed'::text])))
);


--
-- Name: TABLE dfns_authentication_challenges; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_authentication_challenges IS 'Stores authentication challenges for DFNS login flows';


--
-- Name: dfns_broadcast_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_broadcast_transactions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    broadcast_id text NOT NULL,
    wallet_id text,
    kind text NOT NULL,
    transaction text NOT NULL,
    external_id text,
    status text DEFAULT 'Pending'::text NOT NULL,
    tx_hash text,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    date_broadcast timestamp with time zone,
    date_confirmed timestamp with time zone,
    error_message text,
    dfns_broadcast_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_broadcast_transactions_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Broadcasted'::text, 'Confirmed'::text, 'Failed'::text, 'Cancelled'::text])))
);


--
-- Name: dfns_credential_challenges; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_credential_challenges (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    challenge_id text NOT NULL,
    user_id text NOT NULL,
    credential_type text NOT NULL,
    challenge_data jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    completed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_credential_challenges_credential_type_check CHECK ((credential_type = ANY (ARRAY['webauthn'::text, 'passkey'::text, 'private_key'::text]))),
    CONSTRAINT dfns_credential_challenges_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'completed'::text, 'expired'::text, 'failed'::text])))
);


--
-- Name: TABLE dfns_credential_challenges; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_credential_challenges IS 'Stores challenges for DFNS credential creation (WebAuthn/Passkeys)';


--
-- Name: dfns_credentials; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_credentials (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    credential_id text NOT NULL,
    user_id uuid,
    name text,
    kind text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    public_key text NOT NULL,
    algorithm text NOT NULL,
    attestation_type text,
    authenticator_info jsonb,
    enrolled_at timestamp with time zone DEFAULT now() NOT NULL,
    last_used_at timestamp with time zone,
    dfns_credential_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_credentials_kind_check CHECK ((kind = ANY (ARRAY['Fido2'::text, 'Key'::text, 'Password'::text, 'RecoveryKey'::text]))),
    CONSTRAINT dfns_credentials_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: dfns_exchange_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_exchange_accounts (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    account_id text NOT NULL,
    exchange_integration_id text,
    account_type text NOT NULL,
    trading_enabled boolean DEFAULT false,
    withdrawal_enabled boolean DEFAULT false,
    last_updated timestamp with time zone DEFAULT now(),
    dfns_account_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: dfns_exchange_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_exchange_balances (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    account_id text,
    asset text NOT NULL,
    total text DEFAULT '0'::text NOT NULL,
    available text DEFAULT '0'::text NOT NULL,
    locked text DEFAULT '0'::text NOT NULL,
    last_updated timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: dfns_exchange_integrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_exchange_integrations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    integration_id text NOT NULL,
    name text NOT NULL,
    exchange_kind text NOT NULL,
    credentials jsonb NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    config jsonb,
    last_sync_at timestamp with time zone,
    organization_id text,
    dfns_exchange_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_exchange_integrations_exchange_kind_check CHECK ((exchange_kind = ANY (ARRAY['Kraken'::text, 'Binance'::text, 'CoinbasePrime'::text]))),
    CONSTRAINT dfns_exchange_integrations_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Error'::text])))
);


--
-- Name: dfns_fee_sponsors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_fee_sponsors (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    sponsor_id text NOT NULL,
    name text NOT NULL,
    sponsor_address text NOT NULL,
    network text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    balance text DEFAULT '0'::text NOT NULL,
    spent_amount text DEFAULT '0'::text NOT NULL,
    transaction_count integer DEFAULT 0,
    external_id text,
    organization_id text,
    dfns_sponsor_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_fee_sponsors_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Depleted'::text])))
);


--
-- Name: dfns_fiat_activity_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_fiat_activity_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_id uuid NOT NULL,
    activity_type text NOT NULL,
    status text NOT NULL,
    description text,
    provider_data jsonb,
    error_details jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dfns_fiat_activity_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_fiat_activity_logs IS 'Activity logs for fiat transaction tracking';


--
-- Name: dfns_fiat_provider_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_fiat_provider_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider text NOT NULL,
    configuration jsonb NOT NULL,
    is_enabled boolean DEFAULT true,
    supported_currencies text[] DEFAULT '{}'::text[],
    supported_payment_methods text[] DEFAULT '{}'::text[],
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_fiat_provider_configs_provider_check CHECK ((provider = ANY (ARRAY['ramp_network'::text, 'mt_pelerin'::text])))
);


--
-- Name: TABLE dfns_fiat_provider_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_fiat_provider_configs IS 'Configuration for fiat service providers';


--
-- Name: dfns_fiat_quotes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_fiat_quotes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider text NOT NULL,
    type text NOT NULL,
    from_amount numeric(20,8) NOT NULL,
    from_currency text NOT NULL,
    to_amount numeric(20,8) NOT NULL,
    to_currency text NOT NULL,
    exchange_rate numeric(20,8) NOT NULL,
    fees jsonb NOT NULL,
    payment_method text NOT NULL,
    estimated_processing_time text,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_fiat_quotes_provider_check CHECK ((provider = ANY (ARRAY['ramp_network'::text, 'mt_pelerin'::text]))),
    CONSTRAINT dfns_fiat_quotes_type_check CHECK ((type = ANY (ARRAY['onramp'::text, 'offramp'::text])))
);


--
-- Name: TABLE dfns_fiat_quotes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_fiat_quotes IS 'Stores temporary fiat conversion quotes with expiration';


--
-- Name: dfns_fiat_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_fiat_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider text NOT NULL,
    provider_transaction_id text NOT NULL,
    type text NOT NULL,
    status text NOT NULL,
    amount numeric(20,8) NOT NULL,
    currency text NOT NULL,
    crypto_asset text NOT NULL,
    wallet_address text NOT NULL,
    wallet_id uuid,
    payment_method text,
    bank_account jsonb,
    payment_url text,
    withdrawal_address text,
    tx_hash text,
    exchange_rate jsonb,
    fees jsonb,
    estimated_completion_time text,
    expires_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    user_id uuid,
    project_id uuid,
    organization_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_fiat_transactions_amount_check CHECK ((amount > (0)::numeric)),
    CONSTRAINT dfns_fiat_transactions_provider_check CHECK ((provider = ANY (ARRAY['ramp_network'::text, 'mt_pelerin'::text]))),
    CONSTRAINT dfns_fiat_transactions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'processing'::text, 'waiting_for_payment'::text, 'payment_received'::text, 'completed'::text, 'failed'::text, 'cancelled'::text, 'expired'::text]))),
    CONSTRAINT dfns_fiat_transactions_type_check CHECK ((type = ANY (ARRAY['onramp'::text, 'offramp'::text])))
);


--
-- Name: TABLE dfns_fiat_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_fiat_transactions IS 'Stores fiat on/off-ramp transactions through DFNS providers';


--
-- Name: COLUMN dfns_fiat_transactions.provider; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.provider IS 'Fiat service provider (ramp_network, mt_pelerin)';


--
-- Name: COLUMN dfns_fiat_transactions.type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.type IS 'Transaction type (onramp = fiatcrypto, offramp = cryptofiat)';


--
-- Name: COLUMN dfns_fiat_transactions.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.status IS 'Current transaction status';


--
-- Name: COLUMN dfns_fiat_transactions.bank_account; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.bank_account IS 'Bank account information for off-ramp transactions';


--
-- Name: COLUMN dfns_fiat_transactions.payment_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.payment_url IS 'Provider payment URL for completing on-ramp transactions';


--
-- Name: COLUMN dfns_fiat_transactions.withdrawal_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.withdrawal_address IS 'Provider address for sending crypto in off-ramp transactions';


--
-- Name: COLUMN dfns_fiat_transactions.exchange_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.exchange_rate IS 'Exchange rate information including rate, timestamp, and provider';


--
-- Name: COLUMN dfns_fiat_transactions.fees; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.dfns_fiat_transactions.fees IS 'Fee breakdown including provider fees, network fees, and total';


--
-- Name: dfns_permission_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_permission_assignments (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    permission_id text,
    identity_id text NOT NULL,
    identity_kind text NOT NULL,
    assigned_by text NOT NULL,
    assigned_at timestamp with time zone DEFAULT now() NOT NULL,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_permission_assignments_identity_kind_check CHECK ((identity_kind = ANY (ARRAY['User'::text, 'ServiceAccount'::text, 'PersonalAccessToken'::text])))
);


--
-- Name: dfns_permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_permissions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    permission_id text NOT NULL,
    name text NOT NULL,
    resources text[] NOT NULL,
    operations text[] NOT NULL,
    effect text NOT NULL,
    condition jsonb,
    status text DEFAULT 'Active'::text NOT NULL,
    description text,
    category text,
    organization_id text,
    dfns_permission_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_permissions_effect_check CHECK ((effect = ANY (ARRAY['Allow'::text, 'Deny'::text]))),
    CONSTRAINT dfns_permissions_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: dfns_personal_access_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_personal_access_tokens (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    expires_at timestamp with time zone,
    last_used_at timestamp with time zone,
    permission_assignments jsonb,
    user_id uuid,
    dfns_token_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_personal_access_tokens_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Expired'::text])))
);


--
-- Name: dfns_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policies (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    policy_id text NOT NULL,
    name text NOT NULL,
    description text,
    rule_legacy jsonb NOT NULL,
    activity_kind text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    external_id text,
    organization_id text,
    dfns_policy_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    rule_kind text,
    rule_configuration jsonb,
    action_kind text,
    action_configuration jsonb,
    filters jsonb,
    metadata jsonb,
    CONSTRAINT dfns_policies_action_kind_check CHECK (((action_kind IS NULL) OR (action_kind = ANY (ARRAY['Block'::text, 'RequestApproval'::text, 'NoAction'::text])))),
    CONSTRAINT dfns_policies_activity_kind_check CHECK ((activity_kind = ANY (ARRAY['Wallets:Sign'::text, 'Wallets:IncomingTransaction'::text, 'Permissions:Assign'::text, 'Permissions:Modify'::text, 'Policies:Modify'::text]))),
    CONSTRAINT dfns_policies_rule_kind_check CHECK (((rule_kind IS NULL) OR (rule_kind = ANY (ARRAY['AlwaysTrigger'::text, 'TransactionAmountLimit'::text, 'TransactionAmountVelocity'::text, 'TransactionCountVelocity'::text, 'TransactionRecipientWhitelist'::text, 'ChainalysisTransactionPrescreening'::text, 'ChainalysisTransactionScreening'::text])))),
    CONSTRAINT dfns_policies_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Archived'::text])))
);


--
-- Name: TABLE dfns_policies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policies IS 'DFNS Policy Engine policies with rules, actions, and filters (enhanced from existing table)';


--
-- Name: dfns_policy_approval_decisions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policy_approval_decisions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    approval_id uuid,
    dfns_approval_id text NOT NULL,
    user_id text NOT NULL,
    decision_value text NOT NULL,
    reason text,
    date_actioned timestamp with time zone DEFAULT now(),
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_policy_approval_decisions_decision_value_check CHECK ((decision_value = ANY (ARRAY['Approved'::text, 'Denied'::text])))
);


--
-- Name: TABLE dfns_policy_approval_decisions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policy_approval_decisions IS 'Individual approval/denial decisions by users';


--
-- Name: dfns_policy_approval_groups; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policy_approval_groups (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    policy_id uuid,
    dfns_policy_id text NOT NULL,
    group_name text,
    quorum integer DEFAULT 1 NOT NULL,
    approvers jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dfns_policy_approval_groups; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policy_approval_groups IS 'Approval groups for RequestApproval policy actions';


--
-- Name: dfns_policy_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policy_approvals (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    approval_id text NOT NULL,
    activity_id text NOT NULL,
    policy_id text,
    status text DEFAULT 'Pending'::text NOT NULL,
    reason text,
    approved_by text,
    approved_at timestamp with time zone,
    rejected_by text,
    rejected_at timestamp with time zone,
    metadata jsonb,
    organization_id text,
    dfns_approval_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    dfns_policy_id text,
    initiator_id text,
    expiration_date timestamp with time zone,
    activity_details jsonb,
    evaluated_policies jsonb,
    CONSTRAINT dfns_policy_approvals_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Approved'::text, 'Denied'::text, 'AutoApproved'::text, 'Expired'::text])))
);


--
-- Name: TABLE dfns_policy_approvals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policy_approvals IS 'DFNS approval processes (enhanced from existing table)';


--
-- Name: dfns_policy_change_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policy_change_requests (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    dfns_change_request_id text NOT NULL,
    kind text DEFAULT 'Policy'::text NOT NULL,
    operation_kind text NOT NULL,
    status text DEFAULT 'Pending'::text NOT NULL,
    requester_user_id text NOT NULL,
    entity_id text NOT NULL,
    dfns_approval_id text,
    request_body jsonb NOT NULL,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_policy_change_requests_operation_kind_check CHECK ((operation_kind = ANY (ARRAY['Update'::text, 'Archive'::text]))),
    CONSTRAINT dfns_policy_change_requests_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Approved'::text, 'Denied'::text, 'Executed'::text])))
);


--
-- Name: TABLE dfns_policy_change_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policy_change_requests IS 'Policy modification requests requiring approval';


--
-- Name: dfns_policy_evaluations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_policy_evaluations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    dfns_policy_id text NOT NULL,
    activity_id text NOT NULL,
    trigger_status text NOT NULL,
    reason text,
    evaluation_timestamp timestamp with time zone DEFAULT now(),
    activity_kind text NOT NULL,
    activity_details jsonb,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_policy_evaluations_trigger_status_check CHECK ((trigger_status = ANY (ARRAY['Triggered'::text, 'Skipped'::text])))
);


--
-- Name: TABLE dfns_policy_evaluations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_policy_evaluations IS 'History of policy evaluations and triggers';


--
-- Name: dfns_service_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_service_accounts (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    external_id text,
    public_key text,
    permission_assignments jsonb,
    organization_id text,
    dfns_service_account_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_service_accounts_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: dfns_signatures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_signatures (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    signature_id text NOT NULL,
    key_id text,
    kind text NOT NULL,
    message text NOT NULL,
    external_id text,
    status text DEFAULT 'Pending'::text NOT NULL,
    signature text,
    public_key text NOT NULL,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    date_completed timestamp with time zone,
    error_message text,
    dfns_signature_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_signatures_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Signed'::text, 'Failed'::text, 'Cancelled'::text])))
);


--
-- Name: dfns_signing_keys; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_signing_keys (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    key_id text NOT NULL,
    public_key text NOT NULL,
    network text NOT NULL,
    curve text NOT NULL,
    scheme text NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    delegated boolean DEFAULT false,
    delegated_to text,
    external_id text,
    tags text[],
    imported boolean DEFAULT false,
    exported boolean DEFAULT false,
    date_exported timestamp with time zone,
    organization_id text,
    dfns_key_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_signing_keys_curve_check CHECK ((curve = ANY (ARRAY['ed25519'::text, 'secp256k1'::text, 'secp256r1'::text]))),
    CONSTRAINT dfns_signing_keys_scheme_check CHECK ((scheme = ANY (ARRAY['EdDSA'::text, 'ECDSA'::text]))),
    CONSTRAINT dfns_signing_keys_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: dfns_sponsored_fees; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_sponsored_fees (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    sponsored_fee_id text NOT NULL,
    fee_sponsor_id text,
    wallet_id text,
    tx_hash text NOT NULL,
    amount text NOT NULL,
    asset text NOT NULL,
    status text DEFAULT 'Pending'::text NOT NULL,
    sponsored_at timestamp with time zone DEFAULT now() NOT NULL,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_sponsored_fees_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Sponsored'::text, 'Failed'::text])))
);


--
-- Name: dfns_staking_integrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_staking_integrations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    staking_id text NOT NULL,
    wallet_id text,
    network text NOT NULL,
    validator_address text,
    delegation_amount text DEFAULT '0'::text NOT NULL,
    status text NOT NULL,
    total_rewards text DEFAULT '0'::text NOT NULL,
    pending_rewards text DEFAULT '0'::text NOT NULL,
    claimed_rewards text DEFAULT '0'::text NOT NULL,
    last_reward_at timestamp with time zone,
    last_claim_at timestamp with time zone,
    apr text,
    unstaking_period text,
    dfns_staking_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_staking_integrations_status_check CHECK ((status = ANY (ARRAY['Delegated'::text, 'Undelegating'::text, 'Undelegated'::text, 'Slashed'::text])))
);


--
-- Name: dfns_sync_status; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_sync_status (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    entity_type text NOT NULL,
    entity_id text,
    last_sync_at timestamp with time zone DEFAULT now() NOT NULL,
    sync_status text NOT NULL,
    error_message text,
    next_sync_at timestamp with time zone,
    organization_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_sync_status_sync_status_check CHECK ((sync_status = ANY (ARRAY['success'::text, 'failed'::text, 'in_progress'::text])))
);


--
-- Name: dfns_transaction_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_transaction_history (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id text,
    tx_hash text NOT NULL,
    direction text NOT NULL,
    status text NOT NULL,
    asset_symbol text NOT NULL,
    asset_name text,
    contract_address text,
    amount text NOT NULL,
    fee text,
    to_address text,
    from_address text,
    block_number bigint,
    block_hash text,
    "timestamp" timestamp with time zone NOT NULL,
    metadata jsonb,
    last_updated timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_transaction_history_direction_check CHECK ((direction = ANY (ARRAY['Incoming'::text, 'Outgoing'::text]))),
    CONSTRAINT dfns_transaction_history_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Confirmed'::text, 'Failed'::text, 'Cancelled'::text])))
);


--
-- Name: dfns_transfers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_transfers (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    transfer_id text NOT NULL,
    wallet_id text,
    to_address text NOT NULL,
    amount text NOT NULL,
    asset text,
    memo text,
    external_id text,
    nonce integer,
    gas_limit text,
    gas_price text,
    max_fee_per_gas text,
    max_priority_fee_per_gas text,
    status text DEFAULT 'Pending'::text NOT NULL,
    tx_hash text,
    fee text,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    date_broadcast timestamp with time zone,
    date_confirmed timestamp with time zone,
    estimated_confirmation_time text,
    error_message text,
    dfns_transfer_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_transfers_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Broadcasted'::text, 'Confirmed'::text, 'Failed'::text, 'Cancelled'::text])))
);


--
-- Name: dfns_user_action_challenges; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_user_action_challenges (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    challenge_id text NOT NULL,
    user_id text NOT NULL,
    action_type text NOT NULL,
    action_data jsonb NOT NULL,
    challenge text NOT NULL,
    signature text,
    signing_method text,
    credential_id text,
    status text DEFAULT 'pending'::text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    verified_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_user_action_challenges_action_type_check CHECK ((action_type = ANY (ARRAY['CreateWallet'::text, 'Transfer'::text, 'UpdatePolicy'::text, 'CreateCredential'::text]))),
    CONSTRAINT dfns_user_action_challenges_signing_method_check CHECK ((signing_method = ANY (ARRAY['private_key'::text, 'webauthn'::text, 'passkey'::text]))),
    CONSTRAINT dfns_user_action_challenges_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'verified'::text, 'failed'::text, 'expired'::text])))
);


--
-- Name: TABLE dfns_user_action_challenges; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_user_action_challenges IS 'Stores cryptographic challenges for DFNS user actions requiring signatures';


--
-- Name: dfns_user_sessions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_user_sessions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    session_id text NOT NULL,
    user_id text NOT NULL,
    access_token text NOT NULL,
    refresh_token text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    remember_me boolean DEFAULT false NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    logged_out_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_user_sessions_status_check CHECK ((status = ANY (ARRAY['active'::text, 'expired'::text, 'logged_out'::text, 'revoked'::text])))
);


--
-- Name: TABLE dfns_user_sessions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dfns_user_sessions IS 'Stores active DFNS user sessions with access/refresh tokens';


--
-- Name: dfns_users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_users (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    username text NOT NULL,
    email text,
    status text DEFAULT 'Active'::text NOT NULL,
    kind text NOT NULL,
    external_id text,
    public_key text,
    recovery_setup boolean DEFAULT false,
    mfa_enabled boolean DEFAULT false,
    last_login_at timestamp with time zone,
    registered_at timestamp with time zone DEFAULT now() NOT NULL,
    organization_id text,
    dfns_user_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_users_kind_check CHECK ((kind = ANY (ARRAY['EndUser'::text, 'Employee'::text, 'PatientUser'::text]))),
    CONSTRAINT dfns_users_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Pending'::text, 'Suspended'::text])))
);


--
-- Name: dfns_validators; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_validators (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    validator_address text NOT NULL,
    network text NOT NULL,
    name text,
    commission text DEFAULT '0'::text NOT NULL,
    delegated_amount text DEFAULT '0'::text NOT NULL,
    status text NOT NULL,
    apr text,
    uptime text,
    rank integer,
    last_updated timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_validators_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text, 'Jailed'::text])))
);


--
-- Name: dfns_wallet_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_wallet_balances (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id text,
    asset_symbol text NOT NULL,
    asset_name text,
    contract_address text,
    balance text DEFAULT '0'::text NOT NULL,
    value_in_usd text,
    decimals integer DEFAULT 18 NOT NULL,
    verified boolean DEFAULT false,
    native_asset boolean DEFAULT false,
    last_updated timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: dfns_wallet_nfts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_wallet_nfts (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id text,
    contract text NOT NULL,
    token_id text NOT NULL,
    collection text,
    name text,
    description text,
    image_url text,
    external_url text,
    attributes jsonb,
    last_updated timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: dfns_wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_wallets (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id text NOT NULL,
    network text NOT NULL,
    name text,
    address text NOT NULL,
    signing_key_id text,
    custodial boolean DEFAULT true,
    imported boolean DEFAULT false,
    exported boolean DEFAULT false,
    date_exported timestamp with time zone,
    external_id text,
    tags text[],
    status text DEFAULT 'Active'::text NOT NULL,
    delegated boolean DEFAULT false,
    delegated_to text,
    organization_id text,
    project_id uuid,
    investor_id uuid,
    dfns_wallet_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_wallets_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: dfns_webhook_deliveries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_webhook_deliveries (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    delivery_id text NOT NULL,
    webhook_id text,
    event text NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'Pending'::text NOT NULL,
    response_code integer,
    response_body text,
    attempts integer DEFAULT 0,
    next_retry_at timestamp with time zone,
    delivered_at timestamp with time zone,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_webhook_deliveries_status_check CHECK ((status = ANY (ARRAY['Pending'::text, 'Delivered'::text, 'Failed'::text, 'Retrying'::text])))
);


--
-- Name: dfns_webhooks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dfns_webhooks (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    webhook_id text NOT NULL,
    name text NOT NULL,
    url text NOT NULL,
    description text,
    events text[] NOT NULL,
    status text DEFAULT 'Active'::text NOT NULL,
    secret text,
    headers jsonb,
    external_id text,
    organization_id text,
    dfns_webhook_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT dfns_webhooks_status_check CHECK ((status = ANY (ARRAY['Active'::text, 'Inactive'::text])))
);


--
-- Name: digital_tokenised_funds; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.digital_tokenised_funds (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_name character varying(255),
    asset_symbol character varying(50),
    asset_type character varying(100),
    issuer character varying(255),
    blockchain_network character varying(100),
    smart_contract_address character varying(255),
    issuance_date timestamp with time zone,
    total_supply numeric(18,8),
    circulating_supply numeric(18,8),
    peg_value numeric(10,4),
    nav numeric(18,8),
    fractionalization_enabled boolean DEFAULT true,
    management_fee numeric(5,2),
    performance_fee numeric(5,2),
    redemption_terms text,
    compliance_rules text,
    permission_controls text,
    embedded_rights text,
    provenance_history_enabled boolean DEFAULT true,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: digital_tokenized_fund_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.digital_tokenized_fund_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_name character varying,
    asset_symbol character varying,
    asset_type character varying,
    issuer character varying,
    blockchain_network character varying,
    smart_contract_address character varying,
    issuance_date timestamp with time zone,
    total_supply numeric,
    circulating_supply numeric,
    nav numeric,
    fractionalization_enabled boolean,
    compliance_rules text,
    permission_controls text,
    embedded_rights text,
    provenance_history_enabled boolean,
    status character varying,
    target_raise numeric,
    token_economics character varying,
    custody_arrangements character varying,
    upgrade_governance character varying,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: distribution_redemptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.distribution_redemptions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    distribution_id uuid NOT NULL,
    redemption_request_id uuid NOT NULL,
    amount_redeemed numeric NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    organization_id uuid,
    project_id uuid,
    CONSTRAINT distribution_redemptions_amount_check CHECK ((amount_redeemed > (0)::numeric))
);


--
-- Name: TABLE distribution_redemptions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.distribution_redemptions IS 'Tracks which distributions have been included in redemption requests';


--
-- Name: document_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_approvals (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    document_id uuid,
    approver_id uuid,
    status text NOT NULL,
    comments text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT document_approvals_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text])))
);


--
-- Name: document_versions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_versions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    document_id uuid,
    version_number integer NOT NULL,
    file_path text,
    file_url text,
    uploaded_by uuid,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: document_workflows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_workflows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid NOT NULL,
    required_signers uuid[] NOT NULL,
    completed_signers uuid[] DEFAULT '{}'::uuid[] NOT NULL,
    status public.workflow_status DEFAULT 'pending'::public.workflow_status NOT NULL,
    deadline timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid NOT NULL,
    updated_by uuid NOT NULL,
    CONSTRAINT valid_deadline CHECK ((deadline > created_at)),
    CONSTRAINT valid_signers CHECK (((array_length(completed_signers, 1) <= array_length(required_signers, 1)) AND (completed_signers <@ required_signers)))
);


--
-- Name: documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.documents (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    type text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    file_path text,
    file_url text,
    entity_id uuid NOT NULL,
    entity_type text NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    category text,
    project_id uuid,
    uploaded_by uuid,
    expiry_date timestamp with time zone,
    workflow_stage_id text,
    version integer DEFAULT 1
);


--
-- Name: dtf_blockchain_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dtf_blockchain_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    digital_tokenized_fund_product_id uuid NOT NULL,
    dtf_token_metadata_id uuid NOT NULL,
    event_timestamp timestamp with time zone NOT NULL,
    transaction_hash character varying(255) NOT NULL,
    block_number integer NOT NULL,
    block_timestamp timestamp with time zone NOT NULL,
    event_type character varying(50) NOT NULL,
    event_name character varying(100),
    from_address character varying(255),
    to_address character varying(255),
    value numeric(30,8),
    token_id character varying(100),
    event_data jsonb,
    log_index integer,
    transaction_index integer,
    gas_used integer,
    gas_price_gwei numeric(10,2),
    gas_cost numeric(20,8),
    status character varying(20) DEFAULT 'confirmed'::character varying,
    is_internal_transaction boolean DEFAULT false,
    contract_method_called character varying(100),
    input_data text,
    error_message text,
    decoded_event_data jsonb,
    related_events jsonb,
    compliance_checked boolean DEFAULT false,
    compliance_status character varying(20),
    risk_score integer,
    aml_screening_result character varying(20),
    sanctioned_address boolean DEFAULT false,
    event_category character varying(50),
    is_suspicious boolean DEFAULT false,
    investigation_required boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dtf_blockchain_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dtf_blockchain_events IS 'All blockchain events related to tokens';


--
-- Name: dtf_minting_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dtf_minting_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    digital_tokenized_fund_product_id uuid NOT NULL,
    dtf_token_metadata_id uuid NOT NULL,
    mint_timestamp timestamp with time zone NOT NULL,
    transaction_hash character varying(255) NOT NULL,
    block_number integer NOT NULL,
    recipient_address character varying(255) NOT NULL,
    amount_minted numeric(30,8) NOT NULL,
    mint_price numeric(20,8),
    total_value numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    payment_method character varying(50),
    payment_currency character varying(10),
    payment_amount numeric(20,2),
    payment_tx_hash character varying(255),
    subscription_agreement_signed boolean DEFAULT true,
    kyc_aml_completed boolean DEFAULT true,
    accredited_investor_verified boolean DEFAULT true,
    minting_reason character varying(100),
    associated_assets jsonb,
    nav_at_mint numeric(20,8),
    gas_used integer,
    gas_price_gwei numeric(10,2),
    gas_cost numeric(20,8),
    issuer_address character varying(255),
    custody_arrangement text,
    lock_up_period_months integer,
    lock_up_end_date timestamp with time zone,
    vesting_schedule jsonb,
    regulatory_filing_reference character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dtf_minting_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dtf_minting_history IS 'Token minting/issuance events';


--
-- Name: dtf_nav_snapshots; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dtf_nav_snapshots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    digital_tokenized_fund_product_id uuid NOT NULL,
    dtf_token_metadata_id uuid NOT NULL,
    snapshot_timestamp timestamp with time zone NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    total_fund_nav numeric(20,2) NOT NULL,
    nav_per_token numeric(20,8) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    tokens_outstanding numeric(30,8) NOT NULL,
    total_assets numeric(20,2) NOT NULL,
    total_liabilities numeric(20,2) NOT NULL,
    net_assets numeric(20,2) NOT NULL,
    asset_breakdown jsonb,
    published_on_chain boolean DEFAULT false,
    oracle_transaction_hash character varying(255),
    oracle_block_number integer,
    oracle_gas_cost numeric(20,8),
    data_hash character varying(255),
    attestation_signature character varying(500),
    administrator_name character varying(255),
    auditor_verification boolean DEFAULT false,
    auditor_name character varying(255),
    price_change_from_previous numeric(5,2),
    daily_return numeric(5,4),
    inception_to_date_return numeric(5,2),
    benchmark_nav numeric(20,8),
    benchmark_index character varying(50),
    tracking_difference numeric(5,4),
    discount_premium_to_market numeric(5,2),
    trading_volume_24h numeric(20,2),
    number_of_transactions_24h integer,
    methodology_reference text,
    calculation_inputs jsonb,
    is_final boolean DEFAULT true,
    revision_number integer DEFAULT 1,
    previous_snapshot_id uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dtf_nav_snapshots; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dtf_nav_snapshots IS 'On-chain NAV publication history';


--
-- Name: dtf_redemption_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dtf_redemption_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    digital_tokenized_fund_product_id uuid NOT NULL,
    dtf_token_metadata_id uuid NOT NULL,
    request_id character varying(100) NOT NULL,
    request_timestamp timestamp with time zone NOT NULL,
    requester_address character varying(255) NOT NULL,
    amount_requested numeric(30,8) NOT NULL,
    redemption_nav numeric(20,8),
    redemption_value numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    redemption_fee numeric(20,2),
    fee_percentage numeric(5,2),
    net_redemption_value numeric(20,2),
    redemption_method character varying(50),
    settlement_currency character varying(10),
    settlement_address character varying(255),
    notice_period_days integer,
    earliest_settlement_date timestamp with time zone,
    actual_settlement_date timestamp with time zone,
    lock_up_check boolean,
    is_lock_up_compliant boolean DEFAULT true,
    minimum_redemption_check boolean,
    is_minimum_met boolean DEFAULT true,
    liquidity_gate_check boolean,
    is_within_gate_limits boolean DEFAULT true,
    pro_rata_redemption boolean DEFAULT false,
    processing_time_business_days integer,
    burn_transaction_hash character varying(255),
    burn_block_number integer,
    burn_timestamp timestamp with time zone,
    amount_burned numeric(30,8),
    assets_liquidated jsonb,
    liquidation_costs numeric(20,2),
    market_impact numeric(20,2),
    redemption_settlement_tx_hash character varying(255),
    status character varying(20) DEFAULT 'pending'::character varying,
    failure_reason text,
    gate_reason text,
    deferred_to_date timestamp with time zone,
    regulatory_reporting_required boolean DEFAULT true,
    tax_reporting_generated boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dtf_redemption_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dtf_redemption_requests IS 'Token redemption and burn requests';


--
-- Name: dtf_token_metadata; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dtf_token_metadata (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    digital_tokenized_fund_product_id uuid NOT NULL,
    token_name character varying(100) NOT NULL,
    token_symbol character varying(20) NOT NULL,
    token_standard character varying(20) NOT NULL,
    blockchain_network character varying(50) NOT NULL,
    chain_id integer,
    contract_address character varying(255) NOT NULL,
    contract_deployment_date timestamp with time zone NOT NULL,
    contract_deployment_tx_hash character varying(255),
    deployer_address character varying(255),
    total_supply numeric(30,8) NOT NULL,
    max_supply numeric(30,8),
    circulating_supply numeric(30,8),
    decimals integer DEFAULT 18,
    is_mintable boolean DEFAULT false,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    is_upgradeable boolean DEFAULT false,
    proxy_contract_address character varying(255),
    implementation_contract_address character varying(255),
    token_price numeric(20,8),
    token_nav numeric(20,8),
    currency character varying(3) DEFAULT 'USD'::character varying,
    price_premium_discount numeric(5,2),
    market_capitalization numeric(20,2),
    fully_diluted_valuation numeric(20,2),
    number_of_holders integer,
    unique_wallet_count integer,
    transfer_restrictions jsonb,
    compliance_modules jsonb,
    dividend_distribution_mechanism text,
    voting_rights boolean DEFAULT false,
    governance_token boolean DEFAULT false,
    utility_features text,
    redemption_mechanism text,
    oracle_price_feed character varying(255),
    audit_reports text[],
    verified_on_etherscan boolean DEFAULT false,
    etherscan_url text,
    metadata_uri text,
    whitepaper_url text,
    regulatory_framework text,
    securities_classification character varying(50),
    issuer_info jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE dtf_token_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dtf_token_metadata IS 'Blockchain token metadata and smart contract info';


--
-- Name: email_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_log (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    subject text NOT NULL,
    body text,
    priority text,
    sent_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: energy_assets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.energy_assets (
    asset_id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    type character varying(50) NOT NULL,
    location character varying(255) NOT NULL,
    capacity numeric(10,2) NOT NULL,
    owner_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    lcoe_calculated numeric(10,4),
    lcoe_industry_benchmark numeric(10,4),
    lcoe_competitiveness_ratio numeric(6,4),
    lcoe_last_calculated timestamp with time zone,
    capacity_factor_actual numeric(6,4),
    capacity_factor_theoretical numeric(6,4),
    capacity_factor_industry_avg numeric(6,4),
    capacity_factor_percentile integer,
    capacity_factor_last_calculated timestamp with time zone,
    project_id uuid,
    geolocation_details jsonb
);


--
-- Name: COLUMN energy_assets.lcoe_calculated; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_assets.lcoe_calculated IS 'Calculated Levelized Cost of Energy in $/MWh';


--
-- Name: COLUMN energy_assets.capacity_factor_actual; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_assets.capacity_factor_actual IS 'Actual capacity factor (0.20 = 20% efficiency)';


--
-- Name: energy_futures_contracts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.energy_futures_contracts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity text NOT NULL,
    contract_month integer NOT NULL,
    price numeric NOT NULL,
    contract_date date NOT NULL,
    exchange text,
    volume numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT energy_futures_contracts_commodity_check CHECK ((commodity = ANY (ARRAY['oil'::text, 'natural_gas'::text, 'electricity'::text, 'coal'::text, 'carbon'::text]))),
    CONSTRAINT energy_futures_contracts_contract_month_check CHECK (((contract_month >= 1) AND (contract_month <= 60))),
    CONSTRAINT energy_futures_contracts_price_check CHECK ((price > (0)::numeric))
);


--
-- Name: TABLE energy_futures_contracts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.energy_futures_contracts IS 'Stores futures contract prices for energy commodities used in NAV calculations';


--
-- Name: COLUMN energy_futures_contracts.commodity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_futures_contracts.commodity IS 'Type of energy commodity (oil, natural_gas, electricity, coal, carbon)';


--
-- Name: COLUMN energy_futures_contracts.contract_month; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_futures_contracts.contract_month IS 'Number of months ahead for this contract (1-60)';


--
-- Name: COLUMN energy_futures_contracts.price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_futures_contracts.price IS 'Price per unit in USD';


--
-- Name: COLUMN energy_futures_contracts.contract_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.energy_futures_contracts.contract_date IS 'Date when the contract pricing was recorded';


--
-- Name: energy_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.energy_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    project_identifier character varying(50),
    project_name text,
    project_type character varying(100),
    capacity numeric,
    project_status character varying(50),
    site_id character varying(50),
    site_location text,
    owner text,
    electricity_purchaser text,
    land_type character varying(100),
    expected_online_date timestamp with time zone,
    financial_data jsonb,
    regulatory_compliance text,
    timeline_data jsonb,
    field_service_logs text,
    performance_metrics jsonb,
    receivable_amount numeric,
    decommission_date timestamp with time zone,
    project_capacity_mw numeric,
    power_purchase_agreements text,
    regulatory_approvals text[],
    carbon_offset_potential numeric,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: environmental_certifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.environmental_certifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    real_estate_product_id uuid NOT NULL,
    certification_type character varying(50) NOT NULL,
    certification_level character varying(50),
    certification_number character varying(100),
    certifying_body character varying(255) NOT NULL,
    certified_date timestamp with time zone NOT NULL,
    expiration_date timestamp with time zone,
    recertification_date timestamp with time zone,
    score_or_rating character varying(50),
    energy_efficiency_rating character varying(10),
    water_efficiency_rating character varying(10),
    indoor_environmental_quality_rating character varying(10),
    materials_resources_rating character varying(10),
    certification_cost numeric(20,2),
    annual_savings_estimate numeric(20,2),
    carbon_footprint_reduction numeric(10,2),
    certification_criteria_met jsonb,
    audit_report_url text,
    verification_status character varying(20) DEFAULT 'verified'::character varying,
    market_value_premium numeric(5,2),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE environmental_certifications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.environmental_certifications IS 'Green building certifications (LEED, Energy Star, etc.)';


--
-- Name: equity_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.equity_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    ticker_symbol character varying(20),
    company_name text,
    exchange character varying(50),
    sector_industry character varying(100),
    market_capitalization numeric,
    authorized_shares integer,
    shares_outstanding numeric,
    dividend_yield numeric,
    earnings_per_share numeric,
    price_earnings_ratio numeric,
    currency character varying(10),
    ipo_date timestamp with time zone,
    delisting_date timestamp with time zone,
    status character varying(50),
    corporate_actions_history jsonb,
    dividend_payment_dates timestamp with time zone[],
    acquisition_disposal_date timestamp with time zone,
    voting_rights character varying(100),
    dividend_policy text,
    dilution_protection text[],
    exit_strategy character varying(100),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: escalation_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.escalation_notifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    process_id uuid NOT NULL,
    level integer NOT NULL,
    reason text,
    escalated_to uuid[],
    escalated_from uuid[],
    "timestamp" timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: escalation_schedule; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.escalation_schedule (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    process_id uuid NOT NULL,
    scheduled_at timestamp with time zone NOT NULL,
    status text DEFAULT 'scheduled'::text,
    executed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: etf_creation_redemption; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_creation_redemption (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    transaction_date date NOT NULL,
    transaction_type character varying(20) NOT NULL,
    ap_name character varying(255),
    ap_id character varying(100),
    creation_units integer NOT NULL,
    shares_per_unit integer,
    total_shares numeric(20,2) NOT NULL,
    nav_per_share numeric(20,6),
    transaction_value numeric(20,2),
    settlement_date date,
    settlement_method character varying(50),
    basket_composition jsonb,
    cash_component numeric(20,2),
    blockchain_transaction_hash character varying(255),
    custody_transfer_verified boolean DEFAULT false,
    impact_on_nav_bps numeric(10,2),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_creation_redemption; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_creation_redemption IS 'Authorized participant creation and redemption activity';


--
-- Name: etf_holdings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_holdings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    security_ticker character varying(20),
    security_name character varying(255) NOT NULL,
    security_type character varying(50) NOT NULL,
    isin character varying(12),
    cusip character varying(9),
    sedol character varying(7),
    figi character varying(12),
    blockchain character varying(50),
    contract_address character varying(255),
    token_standard character varying(50),
    coingecko_id character varying(100),
    coinmarketcap_id character varying(100),
    quantity numeric(30,10) NOT NULL,
    market_value numeric(20,2) NOT NULL,
    weight_percentage numeric(10,4) NOT NULL,
    price_per_unit numeric(30,10) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    fx_rate numeric(20,10),
    market_value_base_currency numeric(20,2),
    price_source character varying(100),
    price_timestamp timestamp with time zone,
    sector character varying(100),
    industry character varying(100),
    country character varying(100),
    asset_class character varying(50),
    market_cap_category character varying(50),
    custodian_name character varying(255),
    custody_address text,
    custody_verification_method character varying(50),
    last_custody_verification timestamp with time zone,
    is_staked boolean DEFAULT false,
    staking_provider character varying(255),
    staking_apr numeric(10,4),
    staking_rewards_accrued numeric(30,10),
    as_of_date date NOT NULL,
    acquisition_date date,
    status character varying(20) DEFAULT 'active'::character varying,
    accrued_income numeric(20,2),
    accrued_income_type character varying(50),
    cost_basis numeric(20,2),
    unrealized_gain_loss numeric(20,2),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_holdings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_holdings IS 'Individual securities held by ETFs, with comprehensive crypto support';


--
-- Name: COLUMN etf_holdings.blockchain; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_holdings.blockchain IS 'Blockchain network for crypto assets (bitcoin, ethereum, solana, etc.)';


--
-- Name: COLUMN etf_holdings.contract_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_holdings.contract_address IS 'Smart contract address for tokens (ERC-20, SPL, etc.)';


--
-- Name: COLUMN etf_holdings.quantity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_holdings.quantity IS 'Holding quantity with high precision for crypto (up to 10 decimals)';


--
-- Name: COLUMN etf_holdings.custody_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_holdings.custody_address IS 'Blockchain address where crypto assets are custodied';


--
-- Name: COLUMN etf_holdings.is_staked; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_holdings.is_staked IS 'Whether crypto holding is staked for yield (PoS chains)';


--
-- Name: etf_metadata; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_metadata (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    investment_objective text,
    strategy_description text,
    risk_profile text,
    sec_file_number character varying(50),
    prospectus_date date,
    fund_family character varying(255),
    fund_manager character varying(255),
    primary_exchange character varying(50),
    secondary_exchanges text[],
    options_available boolean DEFAULT false,
    short_sale_restrictions text,
    tax_treatment character varying(50),
    k1_issued boolean DEFAULT false,
    dividend_frequency character varying(50),
    capital_gains_frequency character varying(50),
    last_distribution_date date,
    next_distribution_date date,
    is_crypto_etf boolean DEFAULT false,
    supported_blockchains text[],
    custody_type character varying(50),
    staking_enabled boolean DEFAULT false,
    staking_yield_pct numeric(10,4),
    rebalancing_frequency character varying(50),
    screening_criteria jsonb,
    concentration_rules jsonb,
    primary_benchmark character varying(255),
    secondary_benchmark character varying(255),
    management_fee_pct numeric(10,4),
    administrative_fee_pct numeric(10,4),
    other_fees jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_metadata IS 'Extended ETF-specific metadata not in fund_products table';


--
-- Name: COLUMN etf_metadata.is_crypto_etf; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_metadata.is_crypto_etf IS 'True for ETFs holding cryptocurrency as primary assets';


--
-- Name: COLUMN etf_metadata.custody_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_metadata.custody_type IS 'How crypto assets are custodied (cold storage, institutional, etc.)';


--
-- Name: COLUMN etf_metadata.staking_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_metadata.staking_enabled IS 'Whether the ETF stakes proof-of-stake crypto holdings';


--
-- Name: etf_nav_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_nav_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    valuation_date date NOT NULL,
    nav_per_share numeric(20,6) NOT NULL,
    total_net_assets numeric(20,2) NOT NULL,
    shares_outstanding numeric(20,2) NOT NULL,
    opening_price numeric(20,6),
    closing_price numeric(20,6),
    high_price numeric(20,6),
    low_price numeric(20,6),
    market_price numeric(20,6),
    premium_discount_amount numeric(20,6),
    premium_discount_pct numeric(10,4),
    premium_discount_status character varying(20),
    volume bigint,
    trade_count integer,
    bid_price numeric(20,6),
    ask_price numeric(20,6),
    bid_ask_spread_bps numeric(10,2),
    daily_return_pct numeric(10,4),
    nav_return_pct numeric(10,4),
    price_return_pct numeric(10,4),
    benchmark_return_pct numeric(10,4),
    excess_return_pct numeric(10,4),
    tracking_difference_bps numeric(10,2),
    total_assets numeric(20,2) NOT NULL,
    total_liabilities numeric(20,2) NOT NULL,
    cash_position numeric(20,2),
    securities_value numeric(20,2),
    derivatives_value numeric(20,2),
    crypto_value numeric(20,2),
    accrued_income numeric(20,2),
    accrued_expenses numeric(20,2),
    staking_rewards_earned numeric(20,2),
    staking_yield_annualized numeric(10,4),
    on_chain_verification_hash character varying(255),
    dividend_per_share numeric(20,6),
    dividend_yield_pct numeric(10,4),
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    calculation_method character varying(50),
    data_quality character varying(20),
    data_sources jsonb,
    config_overrides_used jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_nav_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_nav_history IS 'Daily NAV and trading history for ETFs';


--
-- Name: COLUMN etf_nav_history.premium_discount_pct; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_nav_history.premium_discount_pct IS 'Percentage difference between market price and NAV';


--
-- Name: COLUMN etf_nav_history.tracking_difference_bps; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_nav_history.tracking_difference_bps IS 'Performance deviation from benchmark in basis points';


--
-- Name: COLUMN etf_nav_history.crypto_value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_nav_history.crypto_value IS 'Total market value of cryptocurrency holdings';


--
-- Name: COLUMN etf_nav_history.staking_rewards_earned; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_nav_history.staking_rewards_earned IS 'Staking income earned on the valuation date';


--
-- Name: COLUMN etf_nav_history.on_chain_verification_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_nav_history.on_chain_verification_hash IS 'Blockchain proof-of-reserves verification hash';


--
-- Name: fund_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.fund_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    fund_ticker character varying(20),
    fund_name text,
    fund_type character varying(50),
    net_asset_value numeric,
    assets_under_management numeric,
    expense_ratio numeric,
    benchmark_index text,
    holdings jsonb,
    distribution_frequency character varying(50),
    tracking_error numeric,
    currency character varying(10),
    inception_date timestamp with time zone,
    closure_liquidation_date timestamp with time zone,
    status character varying(50),
    creation_redemption_history jsonb,
    performance_history jsonb,
    flow_data jsonb,
    fund_vintage_year integer,
    investment_stage character varying(100),
    sector_focus text[],
    geographic_focus text[],
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    asset_allocation jsonb,
    concentration_limits jsonb,
    shares_outstanding numeric,
    initial_shares numeric,
    subscription_id_tracker jsonb,
    parent_fund_id uuid,
    share_class_name character varying(50),
    replication_method character varying(50),
    structure_type character varying(50),
    creation_unit_size integer,
    average_daily_volume bigint,
    bid_ask_spread_bps numeric(10,2),
    market_price numeric(20,6),
    premium_discount_pct numeric(10,4),
    isin character varying(12),
    sedol character varying(7),
    cusip character varying(9),
    exchange character varying(50),
    total_expense_ratio numeric(10,4),
    last_rebalance_date date,
    next_rebalance_date date,
    registration_status character varying(50),
    CONSTRAINT chk_fund_expense_ratio CHECK (((expense_ratio IS NULL) OR ((expense_ratio >= (0)::numeric) AND (expense_ratio <= 0.50)))),
    CONSTRAINT chk_fund_nav_positive CHECK (((net_asset_value IS NULL) OR (net_asset_value > (0)::numeric))),
    CONSTRAINT chk_fund_status_valid CHECK (((status)::text = ANY (ARRAY[('active'::character varying)::text, ('inactive'::character varying)::text, ('liquidated'::character varying)::text, ('suspended'::character varying)::text, ('Open'::character varying)::text]))),
    CONSTRAINT chk_share_class_has_parent CHECK ((((share_class_name IS NULL) AND (parent_fund_id IS NULL)) OR ((share_class_name IS NOT NULL) AND (parent_fund_id IS NOT NULL))))
);


--
-- Name: TABLE fund_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.fund_products IS 'Stores fund product details. Multiple funds can belong to one project (1:N relationship).';


--
-- Name: COLUMN fund_products.parent_fund_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.fund_products.parent_fund_id IS 'For ETF share classes, references the parent ETF. NULL for parent/standalone funds.';


--
-- Name: COLUMN fund_products.share_class_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.fund_products.share_class_name IS 'Share class identifier (e.g., "Class A", "Class I", "Institutional"). NULL for parent funds.';


--
-- Name: COLUMN fund_products.replication_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.fund_products.replication_method IS 'ETF replication: physical, synthetic, optimized, swap_based';


--
-- Name: COLUMN fund_products.registration_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.fund_products.registration_status IS 'ETF lifecycle: draft, pending_sec, active, suspended, liquidating';


--
-- Name: etf_premium_discount_latest; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.etf_premium_discount_latest AS
 SELECT fp.id AS fund_product_id,
    fp.fund_ticker,
    fp.fund_name,
    fp.fund_type,
    nav.valuation_date,
    nav.nav_per_share,
    nav.closing_price,
    nav.premium_discount_amount,
    nav.premium_discount_pct,
    nav.premium_discount_status,
    nav.bid_ask_spread_bps,
    nav.volume,
        CASE
            WHEN (nav.premium_discount_pct > 1.0) THEN 'significant_premium'::text
            WHEN (nav.premium_discount_pct > 0.25) THEN 'moderate_premium'::text
            WHEN (nav.premium_discount_pct < '-1.0'::numeric) THEN 'significant_discount'::text
            WHEN (nav.premium_discount_pct < '-0.25'::numeric) THEN 'moderate_discount'::text
            ELSE 'fair_value'::text
        END AS premium_discount_category
   FROM (public.fund_products fp
     JOIN LATERAL ( SELECT etf_nav_history.id,
            etf_nav_history.fund_product_id,
            etf_nav_history.valuation_date,
            etf_nav_history.nav_per_share,
            etf_nav_history.total_net_assets,
            etf_nav_history.shares_outstanding,
            etf_nav_history.opening_price,
            etf_nav_history.closing_price,
            etf_nav_history.high_price,
            etf_nav_history.low_price,
            etf_nav_history.market_price,
            etf_nav_history.premium_discount_amount,
            etf_nav_history.premium_discount_pct,
            etf_nav_history.premium_discount_status,
            etf_nav_history.volume,
            etf_nav_history.trade_count,
            etf_nav_history.bid_price,
            etf_nav_history.ask_price,
            etf_nav_history.bid_ask_spread_bps,
            etf_nav_history.daily_return_pct,
            etf_nav_history.nav_return_pct,
            etf_nav_history.price_return_pct,
            etf_nav_history.benchmark_return_pct,
            etf_nav_history.excess_return_pct,
            etf_nav_history.tracking_difference_bps,
            etf_nav_history.total_assets,
            etf_nav_history.total_liabilities,
            etf_nav_history.cash_position,
            etf_nav_history.securities_value,
            etf_nav_history.derivatives_value,
            etf_nav_history.crypto_value,
            etf_nav_history.accrued_income,
            etf_nav_history.accrued_expenses,
            etf_nav_history.staking_rewards_earned,
            etf_nav_history.staking_yield_annualized,
            etf_nav_history.on_chain_verification_hash,
            etf_nav_history.dividend_per_share,
            etf_nav_history.dividend_yield_pct,
            etf_nav_history.currency,
            etf_nav_history.calculation_method,
            etf_nav_history.data_quality,
            etf_nav_history.data_sources,
            etf_nav_history.config_overrides_used,
            etf_nav_history.created_at
           FROM public.etf_nav_history
          WHERE (etf_nav_history.fund_product_id = fp.id)
          ORDER BY etf_nav_history.valuation_date DESC
         LIMIT 1) nav ON (true))
  WHERE (((fp.fund_type)::text ~~ 'etf_%'::text) AND (nav.market_price IS NOT NULL));


--
-- Name: VIEW etf_premium_discount_latest; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.etf_premium_discount_latest IS 'Current premium/discount status for all ETFs';


--
-- Name: etf_products_with_latest_nav; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.etf_products_with_latest_nav AS
 SELECT fp.id,
    fp.project_id,
    fp.fund_ticker,
    fp.fund_name,
    fp.fund_type,
    fp.parent_fund_id,
    fp.share_class_name,
    fp.net_asset_value,
    fp.assets_under_management,
    fp.shares_outstanding,
    fp.expense_ratio,
    fp.total_expense_ratio,
    fp.benchmark_index,
    fp.tracking_error,
    fp.market_price,
    fp.premium_discount_pct,
    fp.currency,
    fp.inception_date,
    fp.status,
    fp.registration_status,
    fp.replication_method,
    fp.structure_type,
    fp.exchange,
    fp.isin,
    em.is_crypto_etf,
    em.supported_blockchains,
    em.staking_enabled,
    em.investment_objective,
    nav.valuation_date AS latest_nav_date,
    nav.nav_per_share AS latest_nav_per_share,
    nav.closing_price AS latest_closing_price,
    nav.premium_discount_pct AS latest_premium_discount,
    nav.daily_return_pct,
    nav.tracking_difference_bps,
    nav.staking_rewards_earned,
    parent.fund_ticker AS parent_ticker,
    parent.fund_name AS parent_name
   FROM (((public.fund_products fp
     LEFT JOIN public.etf_metadata em ON ((fp.id = em.fund_product_id)))
     LEFT JOIN LATERAL ( SELECT etf_nav_history.id,
            etf_nav_history.fund_product_id,
            etf_nav_history.valuation_date,
            etf_nav_history.nav_per_share,
            etf_nav_history.total_net_assets,
            etf_nav_history.shares_outstanding,
            etf_nav_history.opening_price,
            etf_nav_history.closing_price,
            etf_nav_history.high_price,
            etf_nav_history.low_price,
            etf_nav_history.market_price,
            etf_nav_history.premium_discount_amount,
            etf_nav_history.premium_discount_pct,
            etf_nav_history.premium_discount_status,
            etf_nav_history.volume,
            etf_nav_history.trade_count,
            etf_nav_history.bid_price,
            etf_nav_history.ask_price,
            etf_nav_history.bid_ask_spread_bps,
            etf_nav_history.daily_return_pct,
            etf_nav_history.nav_return_pct,
            etf_nav_history.price_return_pct,
            etf_nav_history.benchmark_return_pct,
            etf_nav_history.excess_return_pct,
            etf_nav_history.tracking_difference_bps,
            etf_nav_history.total_assets,
            etf_nav_history.total_liabilities,
            etf_nav_history.cash_position,
            etf_nav_history.securities_value,
            etf_nav_history.derivatives_value,
            etf_nav_history.crypto_value,
            etf_nav_history.accrued_income,
            etf_nav_history.accrued_expenses,
            etf_nav_history.staking_rewards_earned,
            etf_nav_history.staking_yield_annualized,
            etf_nav_history.on_chain_verification_hash,
            etf_nav_history.dividend_per_share,
            etf_nav_history.dividend_yield_pct,
            etf_nav_history.currency,
            etf_nav_history.calculation_method,
            etf_nav_history.data_quality,
            etf_nav_history.data_sources,
            etf_nav_history.config_overrides_used,
            etf_nav_history.created_at
           FROM public.etf_nav_history
          WHERE (etf_nav_history.fund_product_id = fp.id)
          ORDER BY etf_nav_history.valuation_date DESC
         LIMIT 1) nav ON (true))
     LEFT JOIN public.fund_products parent ON ((fp.parent_fund_id = parent.id)))
  WHERE ((fp.fund_type)::text ~~ 'etf_%'::text);


--
-- Name: VIEW etf_products_with_latest_nav; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.etf_products_with_latest_nav IS 'ETF products with most recent NAV and market data';


--
-- Name: etf_rebalancing_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_rebalancing_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    rebalance_date date NOT NULL,
    rebalance_type character varying(50),
    trigger_reason text,
    securities_added integer,
    securities_removed integer,
    securities_adjusted integer,
    turnover_percentage numeric(10,4),
    buy_value numeric(20,2),
    sell_value numeric(20,2),
    transaction_costs numeric(20,2),
    market_impact_bps numeric(10,2),
    tracking_error_before numeric(10,4),
    tracking_error_after numeric(10,4),
    changes_detail jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_rebalancing_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_rebalancing_history IS 'Historical record of ETF portfolio rebalancing events';


--
-- Name: etf_share_classes_comparison; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.etf_share_classes_comparison AS
 SELECT parent.id AS parent_fund_id,
    parent.fund_ticker AS parent_ticker,
    parent.fund_name AS parent_name,
    fp.id AS share_class_id,
    fp.share_class_name,
    fp.fund_ticker AS share_class_ticker,
    fp.expense_ratio,
    fp.total_expense_ratio,
    fp.net_asset_value,
    fp.shares_outstanding,
    fp.assets_under_management,
    nav.nav_per_share AS latest_nav,
    nav.valuation_date AS latest_nav_date,
    fp.inception_date,
    fp.status
   FROM ((public.fund_products parent
     JOIN public.fund_products fp ON ((parent.id = fp.parent_fund_id)))
     LEFT JOIN LATERAL ( SELECT etf_nav_history.nav_per_share,
            etf_nav_history.valuation_date
           FROM public.etf_nav_history
          WHERE (etf_nav_history.fund_product_id = fp.id)
          ORDER BY etf_nav_history.valuation_date DESC
         LIMIT 1) nav ON (true))
  WHERE (((parent.fund_type)::text ~~ 'etf_%'::text) AND (fp.share_class_name IS NOT NULL))
  ORDER BY parent.fund_ticker, fp.share_class_name;


--
-- Name: VIEW etf_share_classes_comparison; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.etf_share_classes_comparison IS 'Compare share classes of the same parent ETF';


--
-- Name: etf_token_links; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_token_links (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    token_id uuid NOT NULL,
    link_type character varying(50) DEFAULT 'primary'::character varying,
    is_active boolean DEFAULT true,
    supports_rebase boolean DEFAULT false,
    rebase_frequency character varying(20),
    last_rebase_date date,
    next_rebase_date date,
    rebase_threshold_pct numeric(10,4),
    oracle_address character varying(255),
    oracle_update_frequency character varying(20),
    last_oracle_update timestamp with time zone,
    maps_to_share_class character varying(50),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_token_links; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_token_links IS 'Links ETF products to their tokenized representations';


--
-- Name: COLUMN etf_token_links.supports_rebase; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_token_links.supports_rebase IS 'Whether token supply adjusts automatically with NAV changes';


--
-- Name: COLUMN etf_token_links.oracle_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.etf_token_links.oracle_address IS 'On-chain oracle providing NAV price feed';


--
-- Name: etf_tracking_error_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.etf_tracking_error_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    period_type character varying(20) NOT NULL,
    tracking_error numeric(10,4) NOT NULL,
    tracking_difference numeric(10,4) NOT NULL,
    etf_return numeric(10,4) NOT NULL,
    benchmark_return numeric(10,4) NOT NULL,
    excess_return numeric(10,4),
    correlation numeric(10,4),
    r_squared numeric(10,4),
    beta numeric(10,4),
    alpha numeric(10,4),
    information_ratio numeric(10,4),
    sharpe_ratio numeric(10,4),
    etf_volatility numeric(10,4),
    benchmark_volatility numeric(10,4),
    fee_drag_bps numeric(10,2),
    rebalancing_cost_bps numeric(10,2),
    cash_drag_bps numeric(10,2),
    sampling_error_bps numeric(10,2),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE etf_tracking_error_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.etf_tracking_error_history IS 'Performance tracking vs benchmark over various time periods';


--
-- Name: exchange_rate_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.exchange_rate_history (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_id uuid NOT NULL,
    currency text NOT NULL,
    rate numeric(20,8) NOT NULL,
    source jsonb NOT NULL,
    confidence numeric(5,2) DEFAULT 100.00,
    effective_from timestamp with time zone DEFAULT now() NOT NULL,
    effective_to timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT exchange_rate_history_currency_check CHECK ((currency = ANY (ARRAY['USDC'::text, 'USDT'::text])))
);


--
-- Name: TABLE exchange_rate_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.exchange_rate_history IS 'Historical exchange rates with source tracking';


--
-- Name: COLUMN exchange_rate_history.source; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.exchange_rate_history.source IS 'Source info: {type: oracle|manual|aggregated, provider, references, methodology}';


--
-- Name: COLUMN exchange_rate_history.confidence; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.exchange_rate_history.confidence IS 'Confidence score 0-100';


--
-- Name: external_api_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.external_api_cache (
    cache_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    cache_key character varying(255) NOT NULL,
    data jsonb NOT NULL,
    "timestamp" timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone NOT NULL,
    api_source character varying(100),
    request_count integer DEFAULT 1,
    last_accessed timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE external_api_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.external_api_cache IS 'Cache for external API calls used by PayerRiskAssessmentService';


--
-- Name: facet_registry; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.facet_registry (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    address text NOT NULL,
    version text NOT NULL,
    description text,
    function_selectors text[] DEFAULT '{}'::text[] NOT NULL,
    source_code_hash text NOT NULL,
    audit_report_url text,
    audit_status text DEFAULT 'pending'::text,
    is_active boolean DEFAULT false,
    deployed_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT facet_registry_audit_status_check CHECK ((audit_status = ANY (ARRAY['pending'::text, 'passed'::text, 'failed'::text])))
);


--
-- Name: faucet_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.faucet_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_address text NOT NULL,
    token_address text,
    amount text NOT NULL,
    network text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    transaction_hash text,
    user_id uuid,
    ip_address text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone,
    CONSTRAINT faucet_requests_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'COMPLETED'::text, 'FAILED'::text])))
);


--
-- Name: TABLE faucet_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.faucet_requests IS 'Requests for testnet tokens from the faucet';


--
-- Name: COLUMN faucet_requests.wallet_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.wallet_address IS 'Wallet address that requested tokens';


--
-- Name: COLUMN faucet_requests.token_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.token_address IS 'Address of the token requested (null for native tokens)';


--
-- Name: COLUMN faucet_requests.amount; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.amount IS 'Amount of tokens requested';


--
-- Name: COLUMN faucet_requests.network; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.network IS 'Network the tokens were requested on (e.g., sepolia, mumbai)';


--
-- Name: COLUMN faucet_requests.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.status IS 'Status of the request (PENDING, COMPLETED, FAILED)';


--
-- Name: COLUMN faucet_requests.transaction_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.transaction_hash IS 'Transaction hash for the token transfer';


--
-- Name: COLUMN faucet_requests.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.faucet_requests.user_id IS 'ID of the user who made the request';


--
-- Name: fiat_quotes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.fiat_quotes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider text NOT NULL,
    type text NOT NULL,
    from_amount numeric(20,8) NOT NULL,
    from_currency text NOT NULL,
    to_amount numeric(20,8) NOT NULL,
    to_currency text NOT NULL,
    exchange_rate numeric(20,8) NOT NULL,
    fees jsonb NOT NULL,
    payment_method text NOT NULL,
    estimated_processing_time text,
    expires_at timestamp with time zone NOT NULL,
    user_id uuid,
    session_id text,
    converted_to_transaction_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT fiat_quotes_provider_check CHECK ((provider = ANY (ARRAY['ramp_network'::text, 'mt_pelerin'::text]))),
    CONSTRAINT fiat_quotes_type_check CHECK ((type = ANY (ARRAY['onramp'::text, 'offramp'::text])))
);


--
-- Name: TABLE fiat_quotes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.fiat_quotes IS 'Stores fiat transaction quotes with expiration tracking';


--
-- Name: fiat_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.fiat_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider text NOT NULL,
    provider_transaction_id text NOT NULL,
    type text NOT NULL,
    status text NOT NULL,
    amount numeric(20,8) NOT NULL,
    currency text NOT NULL,
    crypto_asset text NOT NULL,
    wallet_address text NOT NULL,
    wallet_id uuid,
    payment_method text,
    bank_account jsonb,
    payment_url text,
    withdrawal_address text,
    tx_hash text,
    exchange_rate jsonb,
    fees jsonb,
    estimated_completion_time text,
    expires_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    user_id uuid,
    project_id uuid,
    organization_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT fiat_transactions_provider_check CHECK ((provider = ANY (ARRAY['ramp_network'::text, 'mt_pelerin'::text]))),
    CONSTRAINT fiat_transactions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'processing'::text, 'waiting_for_payment'::text, 'payment_received'::text, 'completed'::text, 'failed'::text, 'cancelled'::text, 'expired'::text]))),
    CONSTRAINT fiat_transactions_type_check CHECK ((type = ANY (ARRAY['onramp'::text, 'offramp'::text])))
);


--
-- Name: TABLE fiat_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.fiat_transactions IS 'Stores fiat on/off-ramp transactions from all providers including RAMP Network';


--
-- Name: fund_nav_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.fund_nav_data (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    fund_id uuid NOT NULL,
    date date NOT NULL,
    nav numeric(18,6) NOT NULL,
    total_assets numeric(78,18) NOT NULL,
    total_liabilities numeric(78,18) DEFAULT 0 NOT NULL,
    outstanding_shares numeric(78,18) NOT NULL,
    previous_nav numeric(18,6),
    change_amount numeric(18,6),
    change_percent numeric(8,4),
    source text DEFAULT 'manual'::text NOT NULL,
    validated boolean DEFAULT false,
    validated_by uuid,
    validated_at timestamp with time zone,
    notes text,
    calculation_method text,
    market_conditions text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    CONSTRAINT fund_nav_data_source_check CHECK ((source = ANY (ARRAY['manual'::text, 'oracle'::text, 'calculated'::text, 'administrator'::text]))),
    CONSTRAINT non_negative_liabilities CHECK ((total_liabilities >= (0)::numeric)),
    CONSTRAINT positive_assets CHECK ((total_assets > (0)::numeric)),
    CONSTRAINT positive_nav CHECK ((nav > (0)::numeric)),
    CONSTRAINT positive_shares CHECK ((outstanding_shares > (0)::numeric))
);


--
-- Name: TABLE fund_nav_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.fund_nav_data IS 'Historical Net Asset Value data for tokenized funds with validation workflow';


--
-- Name: futures_prices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.futures_prices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    instrument_key text NOT NULL,
    contract_month text NOT NULL,
    delivery_month text NOT NULL,
    price numeric NOT NULL,
    days_to_maturity integer NOT NULL,
    open_interest integer,
    volume integer,
    currency text DEFAULT 'USD'::text NOT NULL,
    exchange text,
    price_date date DEFAULT CURRENT_DATE NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT futures_prices_days_to_maturity_check CHECK ((days_to_maturity >= 0)),
    CONSTRAINT futures_prices_price_check CHECK ((price > (0)::numeric))
);


--
-- Name: geographic_jurisdictions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.geographic_jurisdictions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    country_code character(2) NOT NULL,
    country_code_3 character(3) NOT NULL,
    country_name text NOT NULL,
    region text NOT NULL,
    regulatory_regime text,
    sanctions_risk_level text DEFAULT 'low'::text,
    fatf_compliance_status text DEFAULT 'compliant'::text,
    tax_treaty_status text,
    kyc_requirements_level text DEFAULT 'standard'::text,
    aml_risk_rating text DEFAULT 'low'::text,
    is_ofac_sanctioned boolean DEFAULT false,
    is_eu_sanctioned boolean DEFAULT false,
    is_un_sanctioned boolean DEFAULT false,
    offshore_financial_center boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE geographic_jurisdictions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.geographic_jurisdictions IS 'Master reference table for countries and their regulatory/compliance characteristics';


--
-- Name: guardian_api_tests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.guardian_api_tests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    test_name character varying(100) NOT NULL,
    test_type character varying(50) NOT NULL,
    endpoint character varying(200) NOT NULL,
    http_method character varying(10) NOT NULL,
    request_payload jsonb,
    request_headers jsonb,
    response_status integer,
    response_payload jsonb,
    response_headers jsonb,
    guardian_wallet_id character varying(100),
    guardian_operation_id character varying(100),
    guardian_wallet_address character varying(100),
    execution_time_ms integer,
    success boolean DEFAULT false NOT NULL,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    created_by character varying(100),
    notes text,
    CONSTRAINT guardian_api_tests_test_type_check CHECK (((test_type)::text = ANY (ARRAY[('create_wallet'::character varying)::text, ('get_wallet'::character varying)::text, ('get_operation'::character varying)::text, ('list_wallets'::character varying)::text, ('list_operations'::character varying)::text, ('complete_flow'::character varying)::text])))
);


--
-- Name: TABLE guardian_api_tests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.guardian_api_tests IS 'Records of all Guardian API requests and responses for testing purposes';


--
-- Name: COLUMN guardian_api_tests.test_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_api_tests.test_type IS 'Type of test: create_wallet, get_wallet, get_operation, list_wallets, complete_flow';


--
-- Name: COLUMN guardian_api_tests.guardian_wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_api_tests.guardian_wallet_id IS 'The UUID we send to Guardian for wallet creation';


--
-- Name: COLUMN guardian_api_tests.guardian_operation_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_api_tests.guardian_operation_id IS 'Operation ID returned by Guardian for async operations';


--
-- Name: guardian_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.guardian_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id character varying(100) NOT NULL,
    operation_type character varying(50) NOT NULL,
    operation_status character varying(50),
    guardian_wallet_id character varying(100),
    related_test_id uuid,
    operation_result jsonb,
    operation_error jsonb,
    created_at timestamp with time zone DEFAULT now(),
    last_checked_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    check_count integer DEFAULT 0,
    notes text
);


--
-- Name: TABLE guardian_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.guardian_operations IS 'Tracks Guardian operations and their status changes over time';


--
-- Name: COLUMN guardian_operations.operation_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_operations.operation_id IS 'Guardian operation ID for tracking async operations';


--
-- Name: COLUMN guardian_operations.operation_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_operations.operation_type IS 'Type of operation being tracked';


--
-- Name: guardian_wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.guardian_wallets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    guardian_wallet_id character varying(100) NOT NULL,
    guardian_operation_id character varying(100),
    guardian_internal_id character varying(100),
    wallet_name character varying(200),
    wallet_status character varying(50),
    wallet_addresses jsonb,
    wallet_metadata jsonb,
    creation_request_id uuid,
    operation_check_request_id uuid,
    wallet_details_request_id uuid,
    requested_at timestamp with time zone DEFAULT now(),
    operation_completed_at timestamp with time zone,
    wallet_retrieved_at timestamp with time zone,
    test_notes text,
    created_by character varying(100),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE guardian_wallets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.guardian_wallets IS 'Tracks Guardian wallets through their lifecycle from creation to completion';


--
-- Name: COLUMN guardian_wallets.guardian_wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_wallets.guardian_wallet_id IS 'The UUID we sent to Guardian (our identifier)';


--
-- Name: COLUMN guardian_wallets.guardian_internal_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_wallets.guardian_internal_id IS 'Guardian internal wallet ID if different from our UUID';


--
-- Name: COLUMN guardian_wallets.wallet_addresses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.guardian_wallets.wallet_addresses IS 'JSON array of wallet addresses from Guardian';


--
-- Name: health_checks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.health_checks (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    service text NOT NULL,
    status text NOT NULL,
    response_time integer,
    details jsonb DEFAULT '{}'::jsonb,
    last_check timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT health_checks_status_check CHECK ((status = ANY (ARRAY['HEALTHY'::text, 'DEGRADED'::text, 'UNHEALTHY'::text])))
);


--
-- Name: individual_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.individual_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    entity_id uuid NOT NULL,
    entity_type text NOT NULL,
    document_type public.individual_document_type NOT NULL,
    document_name text NOT NULL,
    document_url text,
    document_hash text,
    file_size bigint,
    mime_type text,
    status text DEFAULT 'pending'::text,
    uploaded_by uuid,
    reviewed_by uuid,
    reviewed_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT individual_documents_entity_type_check CHECK ((entity_type = ANY (ARRAY['investor'::text, 'person'::text, 'user'::text]))),
    CONSTRAINT individual_documents_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text, 'expired'::text])))
);


--
-- Name: TABLE individual_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.individual_documents IS 'Individual KYC/AML and personal documents for investors and users';


--
-- Name: infra_capex_schedule; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_capex_schedule (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    capex_name character varying(255) NOT NULL,
    capex_category character varying(100) NOT NULL,
    description text,
    planned_start_date timestamp with time zone NOT NULL,
    planned_completion_date timestamp with time zone NOT NULL,
    actual_start_date timestamp with time zone,
    actual_completion_date timestamp with time zone,
    budgeted_amount numeric(20,2) NOT NULL,
    committed_amount numeric(20,2),
    spent_to_date numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    funding_source character varying(100),
    is_discretionary boolean DEFAULT true,
    is_regulatory_required boolean DEFAULT false,
    expected_benefit text,
    expected_roi numeric(5,2),
    payback_period_years numeric(5,2),
    impact_on_capacity numeric(10,2),
    impact_on_revenue numeric(20,2),
    impact_on_opex numeric(20,2),
    approval_status character varying(20) DEFAULT 'pending'::character varying,
    approval_date timestamp with time zone,
    contractor_name character varying(255),
    contract_reference character varying(100),
    milestone_schedule jsonb,
    risk_factors jsonb,
    status character varying(20) DEFAULT 'planned'::character varying,
    completion_percentage numeric(5,2),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_capex_schedule; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_capex_schedule IS 'Capital expenditure schedule and tracking';


--
-- Name: infra_concessions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_concessions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    concession_name character varying(255) NOT NULL,
    grantor character varying(255) NOT NULL,
    concessionaire character varying(255) NOT NULL,
    concession_type character varying(50),
    contract_reference character varying(100),
    signing_date timestamp with time zone NOT NULL,
    effective_date timestamp with time zone NOT NULL,
    expiration_date timestamp with time zone NOT NULL,
    concession_term_years integer NOT NULL,
    remaining_term_years integer,
    extension_options jsonb,
    handback_requirements text,
    performance_standards jsonb,
    revenue_rights jsonb,
    revenue_sharing_terms jsonb,
    tariff_setting_mechanism text,
    tariff_review_frequency character varying(20),
    minimum_service_requirements text,
    penalty_regime jsonb,
    termination_clauses jsonb,
    termination_compensation_formula text,
    refinancing_restrictions text,
    change_in_law_provisions text,
    force_majeure_provisions text,
    dispute_resolution_mechanism character varying(100),
    governing_law character varying(100),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_concessions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_concessions IS 'Concession agreement details for infrastructure';


--
-- Name: infra_operating_expenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_operating_expenses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    expense_date timestamp with time zone NOT NULL,
    expense_category character varying(100) NOT NULL,
    expense_subcategory character varying(100),
    description text,
    amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    is_fixed_cost boolean DEFAULT false,
    is_variable_cost boolean DEFAULT false,
    variable_cost_per_unit numeric(20,6),
    frequency character varying(20),
    escalation_rate numeric(5,4),
    vendor_name character varying(255),
    contract_reference character varying(100),
    budget_category character varying(100),
    budget_variance numeric(20,2),
    lifecycle_stage character varying(50),
    is_major_maintenance boolean DEFAULT false,
    maintenance_cycle_years integer,
    payment_status character varying(20) DEFAULT 'pending'::character varying,
    approval_status character varying(20) DEFAULT 'approved'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_operating_expenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_operating_expenses IS 'Operating expenses for infrastructure projects';


--
-- Name: infra_regulatory_filings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_regulatory_filings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    filing_type character varying(100) NOT NULL,
    regulatory_body character varying(255) NOT NULL,
    filing_date timestamp with time zone NOT NULL,
    due_date timestamp with time zone NOT NULL,
    filing_frequency character varying(20),
    next_filing_due timestamp with time zone,
    filing_reference character varying(100),
    description text,
    compliance_status character varying(20) DEFAULT 'pending'::character varying,
    submission_document_url text,
    approval_document_url text,
    approval_date timestamp with time zone,
    conditions_imposed jsonb,
    violations_cited jsonb,
    remediation_required boolean DEFAULT false,
    remediation_deadline timestamp with time zone,
    remediation_cost_estimate numeric(20,2),
    penalties_assessed numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    is_material_event boolean DEFAULT false,
    impact_on_operations text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_regulatory_filings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_regulatory_filings IS 'Regulatory compliance filings and status';


--
-- Name: infra_revenue_streams; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_revenue_streams (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    stream_name character varying(255) NOT NULL,
    stream_type character varying(50) NOT NULL,
    revenue_source character varying(100),
    contract_reference character varying(100),
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone,
    billing_frequency character varying(20),
    revenue_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    escalation_rate numeric(5,4),
    escalation_index character varying(50),
    volume_based boolean DEFAULT false,
    usage_units character varying(50),
    actual_usage numeric(20,2),
    tariff_per_unit numeric(20,6),
    minimum_revenue_guarantee numeric(20,2),
    maximum_revenue_cap numeric(20,2),
    revenue_sharing_percentage numeric(5,2),
    payment_terms character varying(100),
    credit_quality character varying(20),
    is_regulated boolean DEFAULT false,
    regulatory_review_frequency character varying(20),
    historical_growth_rate numeric(5,2),
    seasonality_factors jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_revenue_streams; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_revenue_streams IS 'Revenue streams for infrastructure projects';


--
-- Name: infra_usage_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infra_usage_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    infrastructure_product_id uuid NOT NULL,
    project_id uuid NOT NULL,
    metric_date timestamp with time zone NOT NULL,
    metric_type character varying(50) NOT NULL,
    metric_unit character varying(50) NOT NULL,
    actual_value numeric(20,2) NOT NULL,
    budgeted_value numeric(20,2),
    variance numeric(20,2),
    variance_percentage numeric(5,2),
    peak_value numeric(20,2),
    peak_time timestamp with time zone,
    off_peak_value numeric(20,2),
    capacity numeric(20,2),
    utilization_rate numeric(5,2),
    availability_rate numeric(5,2),
    downtime_hours numeric(10,2),
    planned_downtime_hours numeric(10,2),
    unplanned_downtime_hours numeric(10,2),
    downtime_reasons jsonb,
    weather_impact jsonb,
    seasonal_adjustment_factor numeric(5,4),
    growth_rate_mom numeric(5,2),
    growth_rate_yoy numeric(5,2),
    data_source character varying(100),
    data_quality_score integer,
    is_estimated boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE infra_usage_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.infra_usage_metrics IS 'Traffic, utilization, and performance metrics';


--
-- Name: infrastructure_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.infrastructure_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_id character varying(50),
    asset_type character varying(100),
    design_date timestamp with time zone,
    procurement_date timestamp with time zone,
    condition_score integer,
    age integer,
    maintenance_backlog integer,
    performance_metrics jsonb,
    mean_time_between_failure numeric,
    rehabilitation_date timestamp with time zone,
    replacement_date timestamp with time zone,
    cost_of_replacement numeric,
    inspection_date timestamp with time zone,
    safety_incidents integer,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: investor_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investor_approvals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    investor_id uuid NOT NULL,
    reviewer_id uuid,
    status text DEFAULT 'pending'::text NOT NULL,
    rejection_reason text,
    approval_date timestamp with time zone,
    submission_date timestamp with time zone DEFAULT now(),
    approval_type text NOT NULL,
    required_documents jsonb,
    review_notes text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: investor_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investor_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    investor_id uuid NOT NULL,
    document_type public.document_type NOT NULL,
    document_name text NOT NULL,
    file_url text NOT NULL,
    status public.document_status DEFAULT 'pending'::public.document_status NOT NULL,
    is_public boolean DEFAULT false NOT NULL,
    uploaded_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone,
    last_reviewed_at timestamp with time zone,
    reviewed_by uuid,
    version integer DEFAULT 1 NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid NOT NULL,
    updated_by uuid NOT NULL
);


--
-- Name: TABLE investor_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.investor_documents IS 'Documents uploaded by investors for KYC/compliance purposes';


--
-- Name: COLUMN investor_documents.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investor_documents.status IS 'Document review status: pending, approved, rejected, expired, active, pending_review';


--
-- Name: COLUMN investor_documents.is_public; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investor_documents.is_public IS 'Indicates whether the document is publicly visible or restricted';


--
-- Name: COLUMN investor_documents.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investor_documents.metadata IS 'Additional document metadata including file info and processing details';


--
-- Name: investor_group_members; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investor_group_members (
    group_id uuid NOT NULL,
    investor_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: investor_groups; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investor_groups (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    description text,
    member_count integer DEFAULT 0 NOT NULL,
    "group" text
);


--
-- Name: investor_groups_investors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investor_groups_investors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    group_id uuid NOT NULL,
    investor_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    organization_id uuid
);


--
-- Name: investors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.investors (
    investor_id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    email text NOT NULL,
    type text NOT NULL,
    wallet_address text,
    kyc_status public.kyc_status NOT NULL,
    "lastUpdated" text,
    verification_details jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    kyc_expiry_date timestamp with time zone,
    company text,
    notes text,
    investor_status text DEFAULT 'pending'::text,
    onboarding_completed boolean DEFAULT false,
    risk_assessment jsonb,
    profile_data jsonb,
    accreditation_status text DEFAULT 'not_started'::text,
    accreditation_expiry_date timestamp with time zone,
    accreditation_type text,
    tax_residency text,
    tax_id_number text,
    investment_preferences jsonb,
    last_compliance_check timestamp with time zone,
    compliance_checked_by uuid,
    compliance_checked_email text,
    compliance_checked_at timestamp with time zone,
    organization_id uuid,
    project_id uuid,
    user_id uuid,
    profile_type public.profile_type,
    profile_id uuid
);


--
-- Name: TABLE investors; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.investors IS 'Investor records with KYC status, expiry dates, and verification details. KYC status is an enum: approved, pending, failed, not_started, expired.';


--
-- Name: COLUMN investors.compliance_checked_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investors.compliance_checked_by IS 'UUID of the user who performed the compliance check';


--
-- Name: COLUMN investors.compliance_checked_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investors.compliance_checked_email IS 'Email of the user who performed the compliance check for audit trail';


--
-- Name: COLUMN investors.compliance_checked_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investors.compliance_checked_at IS 'Timestamp when the compliance check was confirmed';


--
-- Name: COLUMN investors.organization_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.investors.organization_id IS 'organization_id';


--
-- Name: invoice; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice (
    invoice_id integer NOT NULL,
    provider_id integer,
    patient_name character varying(255),
    patient_dob date,
    service_dates character varying(255),
    procedure_codes character varying(255),
    diagnosis_codes character varying(255),
    billed_amount numeric(10,2),
    adjustments numeric(10,2),
    net_amount_due numeric(10,2),
    payer_id integer,
    policy_number character varying(50),
    invoice_number character varying(50),
    invoice_date date,
    due_date date,
    factoring_discount_rate numeric(5,2),
    factoring_terms text,
    upload_timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    pool_id integer,
    CONSTRAINT invoice_net_amount_due_check CHECK ((net_amount_due >= (0)::numeric))
);


--
-- Name: invoice_aging_buckets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice_aging_buckets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    as_of_date timestamp with time zone NOT NULL,
    bucket_name character varying(50) NOT NULL,
    bucket_min_days integer NOT NULL,
    bucket_max_days integer,
    number_of_invoices integer NOT NULL,
    total_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    percentage_of_total numeric(5,2),
    reserve_percentage numeric(5,2),
    reserve_amount numeric(20,2),
    expected_collection_rate numeric(5,2),
    expected_collection_amount numeric(20,2),
    expected_loss_rate numeric(5,2),
    expected_loss_amount numeric(20,2),
    average_days_outstanding numeric(5,1),
    largest_invoice_amount numeric(20,2),
    concentration_risk character varying(20),
    historical_collection_rate jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE invoice_aging_buckets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.invoice_aging_buckets IS 'Aging analysis of receivables';


--
-- Name: invoice_collection_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice_collection_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    period_start_date timestamp with time zone NOT NULL,
    period_end_date timestamp with time zone NOT NULL,
    total_invoices_issued integer NOT NULL,
    total_invoices_amount numeric(20,2) NOT NULL,
    total_collected numeric(20,2) NOT NULL,
    collection_rate numeric(5,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    average_days_to_collect numeric(5,1),
    invoices_current integer,
    invoices_1_30_days integer,
    invoices_31_60_days integer,
    invoices_61_90_days integer,
    invoices_90_plus_days integer,
    invoices_written_off integer,
    amount_written_off numeric(20,2),
    write_off_rate numeric(5,2),
    disputed_invoices integer,
    disputed_amount numeric(20,2),
    resolved_disputes integer,
    resolved_dispute_amount numeric(20,2),
    collection_costs numeric(20,2),
    legal_costs numeric(20,2),
    net_collections numeric(20,2),
    dilution_amount numeric(20,2),
    dilution_rate numeric(5,2),
    concentration_by_debtor jsonb,
    concentration_by_industry jsonb,
    roll_rate_analysis jsonb,
    collection_effectiveness_index numeric(5,2),
    days_sales_outstanding numeric(5,1),
    best_possible_dso numeric(5,1),
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE invoice_collection_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.invoice_collection_history IS 'Collection effectiveness tracking';


--
-- Name: invoice_debtor_ratings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice_debtor_ratings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    debtor_name character varying(255) NOT NULL,
    debtor_id uuid,
    rating_date timestamp with time zone NOT NULL,
    internal_rating character varying(10) NOT NULL,
    external_rating character varying(10),
    rating_agency character varying(50),
    payment_behavior_score integer,
    days_beyond_terms_average numeric(5,1),
    payment_default_probability numeric(5,4),
    expected_recovery_rate numeric(5,2),
    credit_limit numeric(20,2),
    current_exposure numeric(20,2),
    concentration_percentage numeric(5,2),
    is_within_limit boolean DEFAULT true,
    financial_strength character varying(20),
    industry character varying(100),
    years_in_business integer,
    number_of_employees integer,
    annual_revenue numeric(20,2),
    profitability character varying(20),
    liquidity_ratio numeric(5,2),
    leverage_ratio numeric(5,2),
    payment_history_months integer,
    average_days_to_pay numeric(5,1),
    disputed_invoices_count integer,
    disputed_amount numeric(20,2),
    is_approved_debtor boolean DEFAULT true,
    approval_date timestamp with time zone,
    review_frequency character varying(20),
    next_review_date timestamp with time zone,
    watch_list_status boolean DEFAULT false,
    watch_list_reason text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE invoice_debtor_ratings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.invoice_debtor_ratings IS 'Credit ratings for invoice debtors';


--
-- Name: invoice_invoice_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.invoice ALTER COLUMN invoice_id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.invoice_invoice_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: invoice_payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice_payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_receivable_id uuid NOT NULL,
    payment_date timestamp with time zone NOT NULL,
    payment_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    payment_method character varying(50),
    transaction_reference character varying(100),
    days_late integer DEFAULT 0,
    late_fee_charged numeric(20,2),
    discount_taken numeric(20,2),
    payment_type character varying(50),
    is_early_payment boolean DEFAULT false,
    remaining_balance numeric(20,2),
    reconciliation_status character varying(20) DEFAULT 'matched'::character varying,
    applied_to_principal numeric(20,2),
    applied_to_fees numeric(20,2),
    applied_to_interest numeric(20,2),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE invoice_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.invoice_payments IS 'Payment tracking for invoices';


--
-- Name: invoice_receivables; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoice_receivables (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    invoice_number character varying(100) NOT NULL,
    debtor_name character varying(255) NOT NULL,
    debtor_id uuid,
    creditor_name character varying(255) NOT NULL,
    creditor_id uuid,
    invoice_date timestamp with time zone NOT NULL,
    due_date timestamp with time zone NOT NULL,
    invoice_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    advance_rate numeric(5,2),
    advance_amount numeric(20,2),
    discount_rate numeric(5,4),
    discount_amount numeric(20,2),
    fee_percentage numeric(5,2),
    fees_charged numeric(20,2),
    net_advance numeric(20,2),
    invoice_type character varying(50),
    invoice_category character varying(50),
    payment_terms character varying(50),
    is_recourse boolean DEFAULT true,
    dilution_risk numeric(5,2),
    credit_insurance_covered boolean DEFAULT false,
    insurance_policy_number character varying(100),
    insurance_coverage_amount numeric(20,2),
    goods_delivered boolean DEFAULT true,
    services_completed boolean DEFAULT true,
    dispute_risk character varying(20),
    concentration_risk character varying(20),
    debtor_relationship_years integer,
    payment_history_score integer,
    days_outstanding integer,
    aging_bucket character varying(20),
    status character varying(20) DEFAULT 'outstanding'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE invoice_receivables; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.invoice_receivables IS 'Invoice receivables for financing';


--
-- Name: invoices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    amount numeric,
    created_at timestamp with time zone DEFAULT now(),
    currency text,
    due_date date,
    invoice_number text,
    issued_date date,
    paid boolean DEFAULT false,
    subscription_id uuid
);


--
-- Name: issuer_access_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.issuer_access_roles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    issuer_id uuid NOT NULL,
    user_id uuid NOT NULL,
    role public.issuer_role NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid NOT NULL,
    updated_by uuid NOT NULL
);


--
-- Name: issuer_detail_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.issuer_detail_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    document_type text NOT NULL,
    document_url text NOT NULL,
    document_name text NOT NULL,
    uploaded_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    uploaded_by uuid,
    status text DEFAULT 'active'::text,
    metadata jsonb,
    is_public boolean DEFAULT false NOT NULL
);


--
-- Name: TABLE issuer_detail_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.issuer_detail_documents IS 'Documents related to issuer details for projects including legal and regulatory compliance';


--
-- Name: COLUMN issuer_detail_documents.document_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.issuer_detail_documents.document_type IS 'Type of issuer document (creditworthiness, term_sheet, legal_regulatory_compliance, etc.)';


--
-- Name: COLUMN issuer_detail_documents.is_public; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.issuer_detail_documents.is_public IS 'Controls whether the document is visible to investors in the investor portal';


--
-- Name: issuer_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.issuer_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    issuer_id uuid NOT NULL,
    document_type public.document_type NOT NULL,
    file_url text NOT NULL,
    status public.document_status DEFAULT 'pending'::public.document_status NOT NULL,
    uploaded_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone,
    last_reviewed_at timestamp with time zone,
    reviewed_by uuid,
    version integer DEFAULT 1 NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid NOT NULL,
    updated_by uuid NOT NULL,
    document_name text NOT NULL,
    is_public boolean DEFAULT false NOT NULL,
    CONSTRAINT valid_expiry_date CHECK ((expires_at > uploaded_at)),
    CONSTRAINT valid_review_date CHECK ((last_reviewed_at >= uploaded_at))
);


--
-- Name: COLUMN issuer_documents.document_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.issuer_documents.document_name IS 'Human-readable name for the document';


--
-- Name: COLUMN issuer_documents.is_public; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.issuer_documents.is_public IS 'Indicates whether the document is publicly visible or restricted';


--
-- Name: key_vault_keys; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.key_vault_keys (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    key_id text NOT NULL,
    encrypted_key text NOT NULL,
    key_type text DEFAULT 'private_key'::text NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_wallet_id uuid,
    wallet_id uuid,
    investor_id uuid,
    user_id uuid,
    CONSTRAINT chk_key_vault_owner_compatibility CHECK ((((user_id IS NOT NULL) AND (investor_id IS NULL) AND (wallet_id IS NULL) AND (project_wallet_id IS NULL)) OR ((investor_id IS NOT NULL) AND (user_id IS NULL) AND (project_wallet_id IS NULL)) OR ((wallet_id IS NOT NULL) AND (user_id IS NULL) AND (project_wallet_id IS NULL)) OR ((project_wallet_id IS NOT NULL) AND (user_id IS NULL) AND (investor_id IS NULL)) OR ((user_id IS NULL) AND (investor_id IS NULL) AND (wallet_id IS NULL) AND (project_wallet_id IS NULL))))
);


--
-- Name: TABLE key_vault_keys; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.key_vault_keys IS 'Secure key storage for KeyVault - not tied to projects, supports roles and future KMS integration';


--
-- Name: COLUMN key_vault_keys.project_wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.key_vault_keys.project_wallet_id IS 'Reference to project wallet (project_wallets table)';


--
-- Name: COLUMN key_vault_keys.wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.key_vault_keys.wallet_id IS 'Reference to investor wallet (wallets table)';


--
-- Name: COLUMN key_vault_keys.investor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.key_vault_keys.investor_id IS 'Reference to investor who owns this key (for investor wallets)';


--
-- Name: COLUMN key_vault_keys.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.key_vault_keys.user_id IS 'Reference to user who owns this key (for EOA user wallets)';


--
-- Name: kyc_screening_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.kyc_screening_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    investor_id uuid NOT NULL,
    previous_status text,
    new_status text,
    method text NOT NULL,
    notes text,
    performed_by text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: latest_nav_by_fund; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.latest_nav_by_fund AS
 SELECT DISTINCT ON (fund_nav_data.fund_id) fund_nav_data.fund_id,
    fund_nav_data.date,
    fund_nav_data.nav,
    fund_nav_data.change_amount,
    fund_nav_data.change_percent,
    fund_nav_data.source,
    fund_nav_data.validated,
    fund_nav_data.created_at
   FROM public.fund_nav_data
  ORDER BY fund_nav_data.fund_id, fund_nav_data.date DESC;


--
-- Name: lease_agreements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.lease_agreements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    real_estate_product_id uuid NOT NULL,
    tenant_name character varying(255) NOT NULL,
    tenant_type character varying(50),
    unit_number character varying(50),
    floor_number character varying(20),
    leased_square_feet numeric(10,2),
    lease_start_date timestamp with time zone NOT NULL,
    lease_end_date timestamp with time zone NOT NULL,
    lease_term_months integer,
    monthly_rent numeric(20,2) NOT NULL,
    annual_rent numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    rent_per_sqft numeric(10,2),
    security_deposit numeric(20,2),
    escalation_rate numeric(5,4),
    escalation_frequency character varying(20),
    rent_free_periods jsonb,
    tenant_improvements numeric(20,2),
    lease_type character varying(50),
    renewal_options jsonb,
    termination_clauses jsonb,
    rent_payment_schedule jsonb,
    late_payment_penalty numeric(20,2),
    tenant_credit_rating character varying(10),
    guarantor_info jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    is_anchor_tenant boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE lease_agreements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.lease_agreements IS 'Tenant lease agreements and rental income tracking';


--
-- Name: market_data_providers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.market_data_providers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    provider_name character varying(50) NOT NULL,
    base_url text NOT NULL,
    requires_api_key boolean DEFAULT false,
    rate_limit_per_minute integer,
    timeout_ms integer DEFAULT 15000,
    is_active boolean DEFAULT true,
    priority integer DEFAULT 100,
    use_edge_function boolean DEFAULT false,
    edge_function_name character varying(100),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE market_data_providers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.market_data_providers IS 'Market data provider configuration with edge function integration';


--
-- Name: market_data_snapshots; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.market_data_snapshots (
    snapshot_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    snapshot_date timestamp with time zone DEFAULT now(),
    treasury_rates jsonb,
    credit_spreads jsonb,
    energy_prices jsonb,
    policy_changes_count integer DEFAULT 0,
    api_call_count integer DEFAULT 0,
    cache_hit_rate numeric(5,4) DEFAULT 0,
    data_sources_used jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE market_data_snapshots; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.market_data_snapshots IS 'Historical market data snapshots for tracking and analysis';


--
-- Name: market_indices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.market_indices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    index_symbol character varying(20) NOT NULL,
    index_name character varying(255) NOT NULL,
    index_provider character varying(100),
    description text,
    asset_class character varying(50),
    geographic_focus character varying(50),
    sector_focus character varying(50),
    market_cap_segment character varying(50),
    methodology text,
    base_date timestamp with time zone,
    base_value numeric(20,4),
    currency character varying(3) NOT NULL,
    rebalancing_frequency character varying(50),
    constituent_count integer,
    constituents jsonb,
    calculation_method character varying(50),
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE market_indices; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.market_indices IS 'Market indices for beta calculations and benchmarking';


--
-- Name: market_rent_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.market_rent_data (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    property_type character varying(50) NOT NULL,
    property_subtype character varying(50),
    location character varying(255) NOT NULL,
    city character varying(100) NOT NULL,
    state_province character varying(100),
    country character varying(3) NOT NULL,
    postal_code character varying(20),
    market_rent_per_sqft numeric(10,2) NOT NULL,
    market_rent_per_unit numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    square_footage_range jsonb,
    building_class character varying(10),
    as_of_date timestamp with time zone NOT NULL,
    source character varying(255),
    vacancy_rate numeric(5,2),
    absorption_rate numeric(10,2),
    market_trends text,
    comparable_properties jsonb,
    data_quality_score integer,
    is_verified boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE market_rent_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.market_rent_data IS 'Market rental rate comparables for valuation';


--
-- Name: mfa_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mfa_policies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    required boolean NOT NULL,
    applies_to uuid[] NOT NULL,
    exceptions uuid[] NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: ml_baseline_statistics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ml_baseline_statistics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operator text NOT NULL,
    statistics jsonb NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE ml_baseline_statistics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ml_baseline_statistics IS 'Machine learning baseline statistics for anomaly detection';


--
-- Name: mmf_allocation_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_allocation_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    as_of_date timestamp with time zone NOT NULL,
    asset_class character varying NOT NULL,
    total_value numeric NOT NULL,
    percentage numeric NOT NULL,
    number_of_securities integer DEFAULT 0 NOT NULL,
    average_maturity_days integer,
    average_yield numeric,
    typical_range_min numeric,
    typical_range_max numeric,
    typical_range_average numeric,
    variance_from_typical numeric,
    is_within_typical_range boolean,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT mmf_allocation_history_average_maturity_days_check CHECK ((average_maturity_days >= 0)),
    CONSTRAINT mmf_allocation_history_number_of_securities_check CHECK ((number_of_securities >= 0)),
    CONSTRAINT mmf_allocation_history_percentage_check CHECK (((percentage >= (0)::numeric) AND (percentage <= (100)::numeric))),
    CONSTRAINT mmf_allocation_history_total_value_check CHECK ((total_value >= (0)::numeric))
);


--
-- Name: mmf_credit_ratings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_credit_ratings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    issuer_name character varying(255) NOT NULL,
    issuer_id character varying(100),
    rating_date timestamp with time zone NOT NULL,
    short_term_rating character varying(10) NOT NULL,
    long_term_rating character varying(10),
    rating_agency character varying(50) NOT NULL,
    rating_outlook character varying(20),
    previous_rating character varying(10),
    rating_action character varying(50),
    is_tier_1 boolean DEFAULT true,
    is_second_tier boolean DEFAULT false,
    is_eligible_mmf_holding boolean DEFAULT true,
    downgrade_watch boolean DEFAULT false,
    credit_watch_status character varying(50),
    probability_of_default numeric(5,4),
    rating_report_url text,
    internal_credit_assessment text,
    concentration_limits jsonb,
    current_exposure numeric(20,2),
    exposure_percentage numeric(5,2),
    is_within_concentration_limits boolean DEFAULT true,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE mmf_credit_ratings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.mmf_credit_ratings IS 'Credit quality monitoring for MMF issuers';


--
-- Name: mmf_fees_gates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_fees_gates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    effective_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone,
    fee_type character varying NOT NULL,
    fee_percentage numeric DEFAULT 0 NOT NULL,
    gate_status character varying,
    gate_duration_days integer,
    trigger_reason text NOT NULL,
    trigger_metrics jsonb,
    board_approval_date timestamp with time zone,
    board_approval_notes text,
    board_notification_sent boolean DEFAULT false,
    board_notification_date timestamp with time zone,
    net_redemptions_percentage numeric,
    weekly_liquidity_percentage numeric,
    daily_liquidity_percentage numeric,
    impact_on_shareholders text,
    regulatory_filing_reference character varying,
    status character varying DEFAULT 'active'::character varying,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    CONSTRAINT mmf_fees_gates_fee_percentage_check CHECK (((fee_percentage >= (0)::numeric) AND (fee_percentage <= (2)::numeric))),
    CONSTRAINT mmf_fees_gates_fee_type_check CHECK (((fee_type)::text = ANY (ARRAY[('none'::character varying)::text, ('mandatory'::character varying)::text, ('discretionary'::character varying)::text]))),
    CONSTRAINT mmf_fees_gates_gate_duration_days_check CHECK ((gate_duration_days >= 0)),
    CONSTRAINT mmf_fees_gates_gate_status_check CHECK (((gate_status)::text = ANY (ARRAY[('none'::character varying)::text, ('imposed'::character varying)::text, ('lifted'::character varying)::text]))),
    CONSTRAINT mmf_fees_gates_status_check CHECK (((status)::text = ANY (ARRAY[('active'::character varying)::text, ('lifted'::character varying)::text, ('expired'::character varying)::text])))
);


--
-- Name: mmf_holdings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_holdings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    holding_type character varying(50) NOT NULL,
    issuer_name character varying(255) NOT NULL,
    issuer_id character varying(100),
    security_description text NOT NULL,
    cusip character varying(9),
    isin character varying(12),
    par_value numeric(20,2) NOT NULL,
    purchase_price numeric(20,8),
    current_price numeric(20,8) NOT NULL,
    amortized_cost numeric(20,2) NOT NULL,
    market_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    quantity numeric(20,2),
    yield_to_maturity numeric(5,4),
    coupon_rate numeric(5,4),
    effective_maturity_date timestamp with time zone NOT NULL,
    final_maturity_date timestamp with time zone NOT NULL,
    weighted_average_maturity_days integer,
    weighted_average_life_days integer,
    days_to_maturity integer,
    credit_rating character varying(10) NOT NULL,
    rating_agency character varying(50),
    is_government_security boolean DEFAULT false,
    is_daily_liquid boolean DEFAULT false,
    is_weekly_liquid boolean DEFAULT false,
    liquidity_classification character varying(20),
    acquisition_date timestamp with time zone NOT NULL,
    settlement_date timestamp with time zone,
    accrued_interest numeric(20,6),
    amortization_adjustment numeric(20,6),
    shadow_nav_impact numeric(20,8),
    stress_test_value numeric(20,2),
    counterparty character varying(255),
    collateral_description text,
    is_affiliated_issuer boolean DEFAULT false,
    concentration_percentage numeric(5,2),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE mmf_holdings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.mmf_holdings IS 'Money market fund holdings and securities';


--
-- Name: subscriptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscriptions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    investor_id uuid NOT NULL,
    subscription_id text NOT NULL,
    fiat_amount numeric NOT NULL,
    currency text NOT NULL,
    confirmed boolean DEFAULT false NOT NULL,
    allocated boolean DEFAULT false NOT NULL,
    distributed boolean DEFAULT false NOT NULL,
    notes text,
    subscription_date timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    product_id uuid,
    nav_per_share numeric,
    shares_calculated numeric,
    transaction_type character varying(50) DEFAULT 'subscription'::character varying
);


--
-- Name: COLUMN subscriptions.product_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptions.product_id IS 'Links to fund_products (MMF or other fund types)';


--
-- Name: COLUMN subscriptions.nav_per_share; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptions.nav_per_share IS 'NAV per share at subscription/redemption time';


--
-- Name: COLUMN subscriptions.shares_calculated; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptions.shares_calculated IS 'MMF shares to issue (+) or redeem (-)';


--
-- Name: COLUMN subscriptions.transaction_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptions.transaction_type IS 'Type: subscription or redemption';


--
-- Name: mmf_investor_holdings_by_project; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.mmf_investor_holdings_by_project AS
 SELECT s.project_id,
    s.product_id AS fund_product_id,
    fp.fund_name,
    fp.fund_type,
    s.investor_id,
    i.name AS investor_name,
    COALESCE(sum(s.shares_calculated), (0)::numeric) AS total_shares,
    COALESCE(sum(s.fiat_amount), (0)::numeric) AS total_invested,
        CASE
            WHEN (COALESCE(sum(s.shares_calculated), (0)::numeric) > (0)::numeric) THEN (COALESCE(sum(s.fiat_amount), (0)::numeric) / COALESCE(sum(s.shares_calculated), (1)::numeric))
            ELSE (0)::numeric
        END AS average_nav,
    count(*) AS transaction_count,
    min(s.subscription_date) AS first_investment_date,
    max(s.subscription_date) AS last_transaction_date
   FROM ((public.subscriptions s
     JOIN public.investors i ON ((i.investor_id = s.investor_id)))
     JOIN public.fund_products fp ON ((fp.id = s.product_id)))
  WHERE ((s.product_id IS NOT NULL) AND (s.confirmed = true))
  GROUP BY s.project_id, s.product_id, fp.fund_name, fp.fund_type, s.investor_id, i.name;


--
-- Name: VIEW mmf_investor_holdings_by_project; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.mmf_investor_holdings_by_project IS 'Aggregated MMF holdings by investor and project';


--
-- Name: mmf_liquidity_buckets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_liquidity_buckets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    as_of_date timestamp with time zone NOT NULL,
    bucket_type character varying(50) NOT NULL,
    total_value numeric(20,2) NOT NULL,
    percentage_of_nav numeric(5,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    number_of_holdings integer,
    holdings_detail jsonb,
    regulatory_minimum numeric(5,2),
    is_compliant boolean DEFAULT true,
    cushion numeric(5,2),
    stress_scenario character varying(50),
    stressed_liquidity_percentage numeric(5,2),
    can_meet_redemptions boolean DEFAULT true,
    projected_redemption_rate numeric(5,2),
    liquidity_coverage_ratio numeric(5,2),
    time_to_liquidate_days integer,
    liquidation_cost_estimate numeric(20,2),
    contingency_liquidity_sources jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE mmf_liquidity_buckets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.mmf_liquidity_buckets IS 'Liquidity classification and stress testing';


--
-- Name: mmf_nav_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_nav_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    stable_nav numeric(20,8) DEFAULT 1.00,
    market_based_nav numeric(20,8) NOT NULL,
    deviation_from_stable numeric(10,8),
    deviation_bps integer,
    total_net_assets numeric(20,2) NOT NULL,
    shares_outstanding numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    daily_yield numeric(5,4),
    seven_day_yield numeric(5,4),
    thirty_day_yield numeric(5,4),
    effective_yield numeric(5,4),
    expense_ratio numeric(5,4),
    weighted_average_maturity_days integer NOT NULL,
    weighted_average_life_days integer NOT NULL,
    daily_liquid_assets_percentage numeric(5,2) NOT NULL,
    weekly_liquid_assets_percentage numeric(5,2) NOT NULL,
    is_wam_compliant boolean DEFAULT true,
    is_wal_compliant boolean DEFAULT true,
    is_liquidity_compliant boolean DEFAULT true,
    is_breaking_the_buck boolean DEFAULT false,
    stress_test_result character varying(20),
    gate_status character varying(20) DEFAULT 'open'::character varying,
    redemption_fee_imposed boolean DEFAULT false,
    total_subscriptions numeric(20,2),
    total_redemptions numeric(20,2),
    net_flows numeric(20,2),
    portfolio_manager_notes text,
    regulatory_filing_reference character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    config_overrides_used jsonb
);


--
-- Name: TABLE mmf_nav_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.mmf_nav_history IS 'Daily NAV tracking and compliance monitoring';


--
-- Name: mmf_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.mmf_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    fund_product_id uuid NOT NULL,
    transaction_date timestamp with time zone NOT NULL,
    settlement_date timestamp with time zone,
    transaction_type character varying(50) NOT NULL,
    holding_id uuid,
    security_description text,
    cusip character varying(9),
    quantity numeric(20,2),
    price numeric(20,8),
    gross_amount numeric(20,2) NOT NULL,
    net_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    accrued_interest numeric(20,6),
    fees numeric(20,2),
    realized_gain_loss numeric(20,2),
    yield numeric(5,4),
    counterparty character varying(255),
    broker_dealer character varying(255),
    trade_confirmation_number character varying(100),
    impact_on_wam integer,
    impact_on_wal integer,
    impact_on_liquidity jsonb,
    transaction_purpose text,
    is_stress_test_compliant boolean DEFAULT true,
    is_regulatory_compliant boolean DEFAULT true,
    compliance_notes text,
    status character varying(20) DEFAULT 'settled'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    investor_id uuid,
    subscription_id uuid
);


--
-- Name: TABLE mmf_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.mmf_transactions IS 'Daily transaction activity for money market funds';


--
-- Name: COLUMN mmf_transactions.investor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.mmf_transactions.investor_id IS 'Investor who made the subscription/redemption';


--
-- Name: COLUMN mmf_transactions.subscription_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.mmf_transactions.subscription_id IS 'Links to subscription record';


--
-- Name: monitoring_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.monitoring_metrics (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    service text NOT NULL,
    metric_name text NOT NULL,
    value numeric NOT NULL,
    unit text DEFAULT 'count'::text,
    tags jsonb DEFAULT '{}'::jsonb,
    recorded_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: moonpay_asset_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_asset_cache (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    contract_address text NOT NULL,
    token_id text NOT NULL,
    asset_data jsonb NOT NULL,
    cached_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone DEFAULT (now() + '24:00:00'::interval)
);


--
-- Name: moonpay_compliance_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_compliance_alerts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    alert_id text,
    alert_type text NOT NULL,
    severity text DEFAULT 'medium'::text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    customer_id text,
    transaction_id text,
    entity_type text,
    entity_id text,
    risk_score numeric,
    risk_level text,
    title text NOT NULL,
    description text NOT NULL,
    details jsonb DEFAULT '{}'::jsonb,
    screening_results jsonb DEFAULT '{}'::jsonb,
    recommended_actions text[],
    assigned_to text,
    reviewed_by text,
    resolved_by text,
    escalated_to text,
    resolution_notes text,
    auto_generated boolean DEFAULT false,
    source text DEFAULT 'moonpay_api'::text,
    external_reference text,
    related_alerts text[],
    metadata jsonb DEFAULT '{}'::jsonb,
    triggered_at timestamp with time zone DEFAULT now(),
    reviewed_at timestamp with time zone,
    resolved_at timestamp with time zone,
    escalated_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT chk_moonpay_compliance_alerts_resolved_logic CHECK ((((status = 'resolved'::text) AND (resolved_at IS NOT NULL) AND (resolved_by IS NOT NULL)) OR (status <> 'resolved'::text))),
    CONSTRAINT chk_moonpay_compliance_alerts_risk_score_range CHECK (((risk_score IS NULL) OR ((risk_score >= (0)::numeric) AND (risk_score <= (100)::numeric)))),
    CONSTRAINT moonpay_compliance_alerts_alert_type_check CHECK ((alert_type = ANY (ARRAY['aml_screening'::text, 'sanctions_check'::text, 'pep_screening'::text, 'transaction_monitoring'::text, 'kyc_verification'::text, 'suspicious_activity'::text, 'risk_threshold'::text, 'policy_violation'::text, 'document_verification'::text, 'identity_verification'::text, 'address_verification'::text]))),
    CONSTRAINT moonpay_compliance_alerts_entity_type_check CHECK ((entity_type = ANY (ARRAY['customer'::text, 'transaction'::text, 'policy'::text, 'system'::text]))),
    CONSTRAINT moonpay_compliance_alerts_risk_level_check CHECK ((risk_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'extreme'::text]))),
    CONSTRAINT moonpay_compliance_alerts_risk_score_check CHECK (((risk_score >= (0)::numeric) AND (risk_score <= (100)::numeric))),
    CONSTRAINT moonpay_compliance_alerts_severity_check CHECK ((severity = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'critical'::text]))),
    CONSTRAINT moonpay_compliance_alerts_status_check CHECK ((status = ANY (ARRAY['open'::text, 'in_review'::text, 'resolved'::text, 'dismissed'::text, 'escalated'::text])))
);


--
-- Name: TABLE moonpay_compliance_alerts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.moonpay_compliance_alerts IS 'Compliance monitoring alerts including AML screening, sanctions checking, and policy violations';


--
-- Name: COLUMN moonpay_compliance_alerts.screening_results; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_compliance_alerts.screening_results IS 'JSON results from AML/sanctions/PEP screening processes';


--
-- Name: COLUMN moonpay_compliance_alerts.recommended_actions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_compliance_alerts.recommended_actions IS 'Array of recommended actions to address the compliance alert';


--
-- Name: moonpay_customers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_customers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_customer_id text,
    moonpay_customer_id text,
    email text,
    first_name text,
    last_name text,
    date_of_birth date,
    address jsonb,
    kyc_level text DEFAULT 'none'::text,
    identity_verification_status text,
    verification_documents jsonb,
    transaction_limits jsonb,
    preferred_payment_methods text[],
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT moonpay_customers_identity_verification_status_check CHECK ((identity_verification_status = ANY (ARRAY['pending'::text, 'completed'::text, 'failed'::text]))),
    CONSTRAINT moonpay_customers_kyc_level_check CHECK ((kyc_level = ANY (ARRAY['none'::text, 'basic'::text, 'enhanced'::text, 'premium'::text])))
);


--
-- Name: moonpay_passes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_passes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_pass_id text,
    project_id text NOT NULL,
    contract_address text NOT NULL,
    token_id text NOT NULL,
    metadata_url text,
    name text NOT NULL,
    description text,
    image text,
    attributes jsonb,
    owner_address text,
    status text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT moonpay_passes_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'minted'::text, 'transferred'::text, 'burned'::text])))
);


--
-- Name: moonpay_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_policies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_policy_id text,
    name text NOT NULL,
    type text NOT NULL,
    rules jsonb NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT moonpay_policies_type_check CHECK ((type = ANY (ARRAY['kyc'::text, 'transaction'::text, 'compliance'::text, 'risk'::text])))
);


--
-- Name: moonpay_policy_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_policy_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    log_id text,
    policy_id text NOT NULL,
    policy_name text NOT NULL,
    policy_type text NOT NULL,
    action_type text NOT NULL,
    execution_status text DEFAULT 'success'::text NOT NULL,
    entity_type text,
    entity_id text,
    customer_id text,
    transaction_id text,
    rule_conditions jsonb DEFAULT '{}'::jsonb,
    rule_results jsonb DEFAULT '{}'::jsonb,
    violation_details jsonb DEFAULT '{}'::jsonb,
    before_state jsonb DEFAULT '{}'::jsonb,
    after_state jsonb DEFAULT '{}'::jsonb,
    triggered_by text,
    executed_by text,
    approved_by text,
    reason text,
    notes text,
    severity text DEFAULT 'info'::text,
    compliance_impact text,
    requires_action boolean DEFAULT false,
    action_taken text,
    follow_up_required boolean DEFAULT false,
    follow_up_date timestamp with time zone,
    retention_period_days integer DEFAULT 2555,
    auto_generated boolean DEFAULT false,
    source text DEFAULT 'moonpay_policy_engine'::text,
    correlation_id text,
    session_id text,
    ip_address inet,
    user_agent text,
    metadata jsonb DEFAULT '{}'::jsonb,
    executed_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT chk_moonpay_policy_logs_retention_period CHECK (((retention_period_days > 0) AND (retention_period_days <= 3650))),
    CONSTRAINT moonpay_policy_logs_action_type_check CHECK ((action_type = ANY (ARRAY['policy_created'::text, 'policy_updated'::text, 'policy_deleted'::text, 'policy_activated'::text, 'policy_deactivated'::text, 'rule_triggered'::text, 'rule_passed'::text, 'rule_failed'::text, 'violation_detected'::text, 'exception_granted'::text, 'review_initiated'::text, 'review_completed'::text, 'approval_required'::text, 'approval_granted'::text, 'approval_denied'::text]))),
    CONSTRAINT moonpay_policy_logs_compliance_impact_check CHECK ((compliance_impact = ANY (ARRAY['none'::text, 'low'::text, 'medium'::text, 'high'::text, 'critical'::text]))),
    CONSTRAINT moonpay_policy_logs_entity_type_check CHECK ((entity_type = ANY (ARRAY['customer'::text, 'transaction'::text, 'policy'::text, 'rule'::text, 'system'::text]))),
    CONSTRAINT moonpay_policy_logs_execution_status_check CHECK ((execution_status = ANY (ARRAY['success'::text, 'failure'::text, 'warning'::text, 'skipped'::text]))),
    CONSTRAINT moonpay_policy_logs_policy_type_check CHECK ((policy_type = ANY (ARRAY['kyc_policy'::text, 'transaction_limit'::text, 'risk_assessment'::text, 'compliance_rule'::text, 'aml_policy'::text, 'sanctions_policy'::text, 'geographic_restriction'::text, 'customer_verification'::text]))),
    CONSTRAINT moonpay_policy_logs_severity_check CHECK ((severity = ANY (ARRAY['info'::text, 'warning'::text, 'error'::text, 'critical'::text])))
);


--
-- Name: TABLE moonpay_policy_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.moonpay_policy_logs IS 'Audit trail of policy execution, violations, and compliance actions with retention management';


--
-- Name: COLUMN moonpay_policy_logs.retention_period_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_policy_logs.retention_period_days IS 'Number of days to retain this log entry for compliance purposes (default 7 years)';


--
-- Name: COLUMN moonpay_policy_logs.correlation_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_policy_logs.correlation_id IS 'Unique identifier to correlate related policy actions across multiple logs';


--
-- Name: moonpay_projects; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_projects (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_project_id text,
    name text NOT NULL,
    description text,
    contract_address text,
    network text NOT NULL,
    total_supply integer,
    max_supply integer,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: moonpay_swap_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_swap_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_transaction_id text,
    quote_id text NOT NULL,
    status text NOT NULL,
    base_currency text NOT NULL,
    quote_currency text NOT NULL,
    base_amount numeric NOT NULL,
    quote_amount numeric NOT NULL,
    from_address text NOT NULL,
    to_address text NOT NULL,
    tx_hash text,
    fees jsonb,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT moonpay_swap_transactions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'expired'::text])))
);


--
-- Name: moonpay_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    external_transaction_id text,
    type text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    crypto_currency text NOT NULL,
    fiat_currency text NOT NULL,
    crypto_amount numeric,
    fiat_amount numeric NOT NULL,
    wallet_address text,
    payment_method text,
    customer_id text,
    redirect_url text,
    widget_redirect_url text,
    fees jsonb,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT moonpay_transactions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'completed'::text, 'failed'::text, 'waitingPayment'::text, 'waitingAuthorization'::text]))),
    CONSTRAINT moonpay_transactions_type_check CHECK ((type = ANY (ARRAY['buy'::text, 'sell'::text])))
);


--
-- Name: TABLE moonpay_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.moonpay_transactions IS 'Stores Moonpay buy/sell transactions for fiat-to-crypto operations';


--
-- Name: moonpay_webhook_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_webhook_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    webhook_id text,
    url text NOT NULL,
    environment text DEFAULT 'sandbox'::text NOT NULL,
    events text[] DEFAULT '{}'::text[] NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    version text DEFAULT 'v1'::text,
    secret_key text,
    description text,
    retry_policy jsonb DEFAULT '{"timeout": 30000, "max_delay": 30000, "max_attempts": 3, "initial_delay": 1000, "backoff_strategy": "exponential"}'::jsonb,
    headers jsonb DEFAULT '{}'::jsonb,
    delivery_settings jsonb DEFAULT '{"enabled": true, "timeout": 30, "verify_ssl": true}'::jsonb,
    metadata jsonb DEFAULT '{}'::jsonb,
    last_delivery_attempt timestamp with time zone,
    last_successful_delivery timestamp with time zone,
    last_failure_reason text,
    delivery_attempts_count integer DEFAULT 0,
    successful_deliveries_count integer DEFAULT 0,
    failed_deliveries_count integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_by text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT chk_moonpay_webhook_config_events_not_empty CHECK ((array_length(events, 1) > 0)),
    CONSTRAINT chk_moonpay_webhook_config_url_format CHECK ((url ~* '^https?://'::text)),
    CONSTRAINT moonpay_webhook_config_environment_check CHECK ((environment = ANY (ARRAY['sandbox'::text, 'production'::text]))),
    CONSTRAINT moonpay_webhook_config_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text, 'suspended'::text, 'failed'::text])))
);


--
-- Name: TABLE moonpay_webhook_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.moonpay_webhook_config IS 'Configuration and management of MoonPay webhooks including delivery settings, retry policies, and monitoring';


--
-- Name: COLUMN moonpay_webhook_config.retry_policy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_webhook_config.retry_policy IS 'JSON configuration for webhook delivery retry logic including backoff strategy and limits';


--
-- Name: COLUMN moonpay_webhook_config.delivery_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.moonpay_webhook_config.delivery_settings IS 'JSON configuration for webhook delivery including SSL verification and timeout settings';


--
-- Name: moonpay_webhook_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.moonpay_webhook_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    event_type text NOT NULL,
    event_data jsonb NOT NULL,
    signature text NOT NULL,
    processed boolean DEFAULT false,
    processing_attempts integer DEFAULT 0,
    last_processing_error text,
    received_at timestamp with time zone DEFAULT now(),
    processed_at timestamp with time zone
);


--
-- Name: multi_sig_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_audit_log (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid,
    proposal_id uuid,
    action text NOT NULL,
    actor uuid,
    actor_address text,
    details jsonb DEFAULT '{}'::jsonb,
    ip_address inet,
    user_agent text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT multi_sig_audit_log_action_check CHECK ((action = ANY (ARRAY['create_proposal'::text, 'sign'::text, 'reject'::text, 'execute'::text, 'expire'::text, 'cancel'::text])))
);


--
-- Name: multi_sig_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_configurations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid,
    min_confirmation_time integer DEFAULT 0,
    max_daily_limit numeric,
    max_transaction_limit numeric,
    require_all_signatures boolean DEFAULT false,
    auto_execute boolean DEFAULT true,
    notification_webhook text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: multi_sig_on_chain_confirmations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_on_chain_confirmations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    on_chain_transaction_id uuid,
    signer_address text NOT NULL,
    confirmation_tx_hash text NOT NULL,
    confirmed_at_timestamp bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    project_id uuid
);


--
-- Name: TABLE multi_sig_on_chain_confirmations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.multi_sig_on_chain_confirmations IS 'Tracks individual confirmations for on-chain multi-sig transactions';


--
-- Name: multi_sig_on_chain_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_on_chain_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid,
    on_chain_tx_id integer NOT NULL,
    to_address text NOT NULL,
    value text DEFAULT '0'::text NOT NULL,
    data text,
    executed boolean DEFAULT false,
    num_confirmations integer DEFAULT 0,
    created_at_timestamp bigint NOT NULL,
    expires_at_timestamp bigint,
    submission_tx_hash text NOT NULL,
    execution_tx_hash text,
    submitted_by text NOT NULL,
    executed_by text,
    created_at timestamp with time zone DEFAULT now(),
    executed_at timestamp with time zone,
    project_id uuid
);


--
-- Name: TABLE multi_sig_on_chain_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.multi_sig_on_chain_transactions IS 'LAYER 3 (BLOCKCHAIN STATE): Mirror of smart contract storage, populated by event listeners.
Represents the immutable on-chain state of multi-sig transactions.';


--
-- Name: multi_sig_proposals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_proposals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid,
    transaction_hash text NOT NULL,
    raw_transaction jsonb NOT NULL,
    chain_type text NOT NULL,
    status text DEFAULT 'pending'::text,
    signatures_collected integer DEFAULT 0,
    signatures_required integer NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    executed_at timestamp with time zone,
    execution_hash text,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    on_chain_tx_id integer,
    on_chain_tx_hash text,
    submitted_on_chain boolean DEFAULT false,
    project_id uuid,
    submitted_by text,
    title text,
    description text,
    to_address text,
    value text,
    token_address text,
    data text,
    blockchain text,
    CONSTRAINT multi_sig_proposals_signatures_required_check CHECK ((signatures_required > 0)),
    CONSTRAINT multi_sig_proposals_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'signed'::text, 'executed'::text, 'expired'::text, 'rejected'::text])))
);


--
-- Name: TABLE multi_sig_proposals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.multi_sig_proposals IS 'Single table for multi-sig proposals combining UI fields (title, description) with technical blockchain fields. Eliminates duplication with deleted transaction_proposals table.';


--
-- Name: COLUMN multi_sig_proposals.submitted_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_proposals.submitted_by IS 'Ethereum address that submitted the proposal to the blockchain';


--
-- Name: multi_sig_wallet_owners; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_wallet_owners (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    role_id uuid NOT NULL,
    added_at timestamp with time zone DEFAULT now() NOT NULL,
    added_by uuid,
    user_id uuid,
    user_address_id uuid
);


--
-- Name: TABLE multi_sig_wallet_owners; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.multi_sig_wallet_owners IS 'Junction table for multi-sig wallet owners. Replaces the old denormalized owners array column. Each row represents one owner/role assignment for a wallet.';


--
-- Name: COLUMN multi_sig_wallet_owners.role_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallet_owners.role_id IS 'The role through which the user was granted ownership. Links to roles table. Used for tracking and permissions.';


--
-- Name: COLUMN multi_sig_wallet_owners.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallet_owners.user_id IS 'The specific user who is an owner of this multi-sig wallet. Links to auth.users. A user can only be an owner once per wallet.';


--
-- Name: COLUMN multi_sig_wallet_owners.user_address_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallet_owners.user_address_id IS 'FK to user_addresses - specifies which Ethereum address is the owner in the contract';


--
-- Name: multi_sig_wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multi_sig_wallets (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    blockchain text NOT NULL,
    address text NOT NULL,
    threshold integer NOT NULL,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    status text DEFAULT 'active'::text,
    blocked_at timestamp with time zone,
    block_reason text,
    project_id uuid,
    investor_id uuid,
    contract_type text DEFAULT 'custom'::text,
    deployment_tx text,
    factory_address text,
    ownership_type text DEFAULT 'address_based'::text,
    migrated_to_roles boolean DEFAULT false,
    migration_date timestamp with time zone,
    funded_by_wallet_id uuid,
    abi jsonb,
    CONSTRAINT multi_sig_wallets_contract_type_check CHECK ((contract_type = ANY (ARRAY['custom'::text, 'gnosis_safe'::text]))),
    CONSTRAINT multi_sig_wallets_ownership_type_check CHECK ((ownership_type = ANY (ARRAY['address_based'::text, 'role_based'::text]))),
    CONSTRAINT multi_sig_wallets_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'active'::text, 'blocked'::text])))
);


--
-- Name: COLUMN multi_sig_wallets.blockchain; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallets.blockchain IS 'Network name from chainIds.ts (e.g., ethereum, hoodi, holesky, sepolia, polygon, arbitrumOne). No constraint to allow new networks to be added via chainIds.ts without migrations.';


--
-- Name: COLUMN multi_sig_wallets.ownership_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallets.ownership_type IS 'Whether wallet uses address_based (legacy) or role_based ownership';


--
-- Name: COLUMN multi_sig_wallets.funded_by_wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallets.funded_by_wallet_id IS 'Project wallet that funded the multi-sig wallet deployment';


--
-- Name: COLUMN multi_sig_wallets.abi; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multi_sig_wallets.abi IS 'Smart contract ABI for multi-sig wallet interaction';


--
-- Name: role_addresses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.role_addresses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    role_id uuid NOT NULL,
    blockchain text NOT NULL,
    address text NOT NULL,
    signing_method text DEFAULT 'private_key'::text NOT NULL,
    encrypted_private_key text,
    key_vault_reference text,
    derivation_path text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid,
    contract_roles jsonb DEFAULT '[]'::jsonb,
    CONSTRAINT role_addresses_signing_method_check CHECK ((signing_method = ANY (ARRAY['private_key'::text, 'hardware_wallet'::text, 'mpc'::text])))
);


--
-- Name: TABLE role_addresses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.role_addresses IS 'Stores blockchain addresses for roles, supporting multi-chain deployments';


--
-- Name: COLUMN role_addresses.signing_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.role_addresses.signing_method IS 'Method used for signing: private_key (software), hardware_wallet, or mpc';


--
-- Name: COLUMN role_addresses.contract_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.role_addresses.contract_roles IS 'Array of contract role names this address can use. Empty array means address inherits all roles from role_contracts table.';


--
-- Name: multi_sig_wallet_roles; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.multi_sig_wallet_roles AS
 SELECT msw.id AS wallet_id,
    msw.name AS wallet_name,
    msw.address AS wallet_address,
    msw.blockchain,
    msw.threshold,
    msw.ownership_type,
    r.id AS role_id,
    r.name AS role_name,
    r.description AS role_description,
    r.priority AS role_priority,
    ra.address AS role_address,
    ra.signing_method,
    mwo.added_at,
    mwo.added_by
   FROM (((public.multi_sig_wallets msw
     JOIN public.multi_sig_wallet_owners mwo ON ((mwo.wallet_id = msw.id)))
     JOIN public.roles r ON ((r.id = mwo.role_id)))
     LEFT JOIN public.role_addresses ra ON (((ra.role_id = r.id) AND (ra.blockchain = msw.blockchain))))
  WHERE (msw.ownership_type = 'role_based'::text)
  ORDER BY msw.name, r.priority DESC;


--
-- Name: VIEW multi_sig_wallet_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.multi_sig_wallet_roles IS 'Complete view of multi-sig wallets with their role-based owners and addresses';


--
-- Name: nav_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_approvals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    run_id uuid NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    requested_by uuid NOT NULL,
    validated_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    comments text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT nav_approvals_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'validated'::text, 'approved'::text, 'rejected'::text, 'published'::text])))
);


--
-- Name: TABLE nav_approvals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_approvals IS 'Manages approval workflow for NAV calculations with state transitions and audit trail';


--
-- Name: nav_asset_type_adjustments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_asset_type_adjustments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    mark_to_market_multiplier numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_asset_type_adjustments_mark_to_market_multiplier_check CHECK ((mark_to_market_multiplier >= (0)::numeric))
);


--
-- Name: TABLE nav_asset_type_adjustments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_asset_type_adjustments IS 'Mark-to-market adjustments by asset type for asset-backed securities';


--
-- Name: COLUMN nav_asset_type_adjustments.mark_to_market_multiplier; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_asset_type_adjustments.mark_to_market_multiplier IS 'Multiplier for mark-to-market valuation (typically 0.8-1.0)';


--
-- Name: nav_calculation_default_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_calculation_default_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    etf_type character varying(50) NOT NULL,
    config jsonb NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE nav_calculation_default_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_calculation_default_configs IS 'Default NAV calculation configs by ETF type';


--
-- Name: nav_calculation_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_calculation_history (
    id bigint NOT NULL,
    run_id text NOT NULL,
    asset_id text NOT NULL,
    product_type text NOT NULL,
    calculation_step text NOT NULL,
    step_order integer NOT NULL,
    input_data jsonb NOT NULL,
    output_data jsonb NOT NULL,
    processing_time_ms integer NOT NULL,
    data_sources jsonb,
    validation_results jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: nav_calculation_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.nav_calculation_history_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: nav_calculation_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.nav_calculation_history_id_seq OWNED BY public.nav_calculation_history.id;


--
-- Name: nav_calculation_runs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_calculation_runs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid NOT NULL,
    product_type text NOT NULL,
    project_id uuid,
    valuation_date date NOT NULL,
    started_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    status text DEFAULT 'queued'::text NOT NULL,
    inputs_json jsonb,
    result_nav_value numeric(18,6),
    nav_per_share numeric(18,6),
    fx_rate_used numeric(18,6),
    pricing_sources jsonb,
    error_message text,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT nav_calculation_runs_status_check CHECK ((status = ANY (ARRAY['queued'::text, 'running'::text, 'failed'::text, 'completed'::text])))
);


--
-- Name: TABLE nav_calculation_runs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_calculation_runs IS 'Tracks NAV calculation processes including inputs, outputs, and execution status for all asset types';


--
-- Name: nav_calculator_parameters; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_calculator_parameters (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    calculator_type text NOT NULL,
    parameter_key text NOT NULL,
    parameter_value text NOT NULL,
    asset_subtype text,
    description text,
    unit text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE nav_calculator_parameters; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_calculator_parameters IS 'Calculator-specific configuration parameters for NAV calculations. Separate from general platform settings.';


--
-- Name: COLUMN nav_calculator_parameters.calculator_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_calculator_parameters.calculator_type IS 'Type of calculator: energy, equity, receivables, commodities, etc.';


--
-- Name: COLUMN nav_calculator_parameters.parameter_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_calculator_parameters.parameter_key IS 'Key for the parameter without subtype prefix';


--
-- Name: COLUMN nav_calculator_parameters.asset_subtype; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_calculator_parameters.asset_subtype IS 'Subtype within calculator (solar, wind, oil, etc.) - NULL for general parameters';


--
-- Name: nav_credit_quality_multipliers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_credit_quality_multipliers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_quality text NOT NULL,
    multiplier numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_credit_quality_multipliers_multiplier_check CHECK ((multiplier > (0)::numeric))
);


--
-- Name: TABLE nav_credit_quality_multipliers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_credit_quality_multipliers IS 'Credit quality multipliers for adjusting delinquency rates';


--
-- Name: COLUMN nav_credit_quality_multipliers.multiplier; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_credit_quality_multipliers.multiplier IS 'Multiplier to apply based on credit quality (e.g., 0.8 for high quality, 1.2 for low)';


--
-- Name: nav_credit_spreads; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_credit_spreads (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_rating text NOT NULL,
    asset_class text NOT NULL,
    spread_bps numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_credit_spreads_spread_bps_check CHECK ((spread_bps >= (0)::numeric))
);


--
-- Name: TABLE nav_credit_spreads; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_credit_spreads IS 'Credit spreads by rating and asset class';


--
-- Name: COLUMN nav_credit_spreads.spread_bps; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_credit_spreads.spread_bps IS 'Credit spread in basis points over risk-free rate';


--
-- Name: nav_validation_results; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_validation_results (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    run_id uuid NOT NULL,
    rule_code text NOT NULL,
    severity text NOT NULL,
    passed boolean NOT NULL,
    details_json jsonb,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT nav_validation_results_severity_check CHECK ((severity = ANY (ARRAY['info'::text, 'warn'::text, 'error'::text])))
);


--
-- Name: TABLE nav_validation_results; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_validation_results IS 'Stores validation rule results for NAV calculations including pass/fail status and details';


--
-- Name: nav_data_with_status; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.nav_data_with_status AS
 SELECT nav.id,
    nav.asset_id,
    nav.project_id,
    nav.date,
    nav.nav,
    nav.total_assets,
    nav.asset_name,
    nav.total_liabilities,
    nav.outstanding_shares,
    nav.previous_nav,
    nav.change_amount,
    nav.change_percent,
    nav.source,
    nav.validated,
    nav.validated_by,
    nav.validated_at,
    nav.notes,
    nav.calculation_method,
    nav.market_conditions,
    nav.created_at,
    nav.updated_at,
    nav.created_by,
    nav.calculated_nav,
    runs.id AS run_id,
    runs.status AS run_status,
    runs.started_at AS run_started_at,
    runs.completed_at AS run_completed_at,
    runs.product_type,
    approvals.status AS approval_status,
    approvals.approved_by,
    approvals.approved_at,
    approvals.comments AS approval_comments,
        CASE
            WHEN (validation_summary.total_validations = 0) THEN 'no_validations'::text
            WHEN (validation_summary.failed_validations = 0) THEN 'all_passed'::text
            WHEN (validation_summary.error_validations > 0) THEN 'errors_present'::text
            ELSE 'warnings_present'::text
        END AS validation_status,
    validation_summary.total_validations,
    validation_summary.failed_validations,
    validation_summary.error_validations
   FROM (((public.asset_nav_data nav
     LEFT JOIN public.nav_calculation_runs runs ON (((runs.asset_id = nav.asset_id) AND (runs.valuation_date = nav.date))))
     LEFT JOIN public.nav_approvals approvals ON ((approvals.run_id = runs.id)))
     LEFT JOIN ( SELECT nav_validation_results.run_id,
            count(*) AS total_validations,
            count(*) FILTER (WHERE (NOT nav_validation_results.passed)) AS failed_validations,
            count(*) FILTER (WHERE ((NOT nav_validation_results.passed) AND (nav_validation_results.severity = 'error'::text))) AS error_validations
           FROM public.nav_validation_results
          GROUP BY nav_validation_results.run_id) validation_summary ON ((validation_summary.run_id = runs.id)));


--
-- Name: VIEW nav_data_with_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.nav_data_with_status IS 'Comprehensive view of NAV data including calculation run status, validation results, and approval workflow status';


--
-- Name: nav_default_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_default_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    credit_rating text NOT NULL,
    monthly_rate numeric NOT NULL,
    annual_rate numeric,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_default_rates_annual_rate_check CHECK (((annual_rate >= (0)::numeric) AND (annual_rate <= (1)::numeric))),
    CONSTRAINT nav_default_rates_monthly_rate_check CHECK (((monthly_rate >= (0)::numeric) AND (monthly_rate <= (1)::numeric)))
);


--
-- Name: TABLE nav_default_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_default_rates IS 'Default rates by asset type and credit rating';


--
-- Name: COLUMN nav_default_rates.monthly_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_default_rates.monthly_rate IS 'Monthly default rate as decimal';


--
-- Name: nav_delinquency_adjustments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_delinquency_adjustments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    days_past_due integer NOT NULL,
    adjustment_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_delinquency_adjustments_adjustment_rate_check CHECK (((adjustment_rate >= (0)::numeric) AND (adjustment_rate <= (1)::numeric))),
    CONSTRAINT nav_delinquency_adjustments_days_past_due_check CHECK ((days_past_due >= 0))
);


--
-- Name: TABLE nav_delinquency_adjustments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_delinquency_adjustments IS 'Adjustment rates based on delinquency status (days past due)';


--
-- Name: COLUMN nav_delinquency_adjustments.adjustment_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_delinquency_adjustments.adjustment_rate IS 'Adjustment factor to apply to value (0=full writedown, 1=no adjustment)';


--
-- Name: nav_economic_capital; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_economic_capital (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_rating text NOT NULL,
    capital_rate numeric NOT NULL,
    confidence_level numeric DEFAULT 0.999 NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_economic_capital_capital_rate_check CHECK (((capital_rate >= (0)::numeric) AND (capital_rate <= (1)::numeric))),
    CONSTRAINT nav_economic_capital_confidence_level_check CHECK (((confidence_level > (0)::numeric) AND (confidence_level < (1)::numeric)))
);


--
-- Name: TABLE nav_economic_capital; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_economic_capital IS 'Economic capital requirements by credit rating';


--
-- Name: COLUMN nav_economic_capital.capital_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_economic_capital.capital_rate IS 'Required capital as % of exposure';


--
-- Name: nav_fx_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_fx_rates (
    base_ccy text NOT NULL,
    quote_ccy text NOT NULL,
    rate numeric(18,8) NOT NULL,
    as_of timestamp with time zone NOT NULL,
    source text DEFAULT 'chainlink'::text NOT NULL
);


--
-- Name: TABLE nav_fx_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_fx_rates IS 'Stores foreign exchange rates for multi-currency NAV calculations with historical data';


--
-- Name: nav_fx_rates_latest; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.nav_fx_rates_latest AS
 SELECT DISTINCT ON (nav_fx_rates.base_ccy, nav_fx_rates.quote_ccy) nav_fx_rates.base_ccy,
    nav_fx_rates.quote_ccy,
    nav_fx_rates.rate,
    nav_fx_rates.as_of,
    nav_fx_rates.source
   FROM public.nav_fx_rates
  ORDER BY nav_fx_rates.base_ccy, nav_fx_rates.quote_ccy, nav_fx_rates.as_of DESC;


--
-- Name: nav_liquidity_discounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_liquidity_discounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_rating text NOT NULL,
    asset_class text NOT NULL,
    discount_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_liquidity_discounts_discount_rate_check CHECK (((discount_rate >= (0)::numeric) AND (discount_rate <= (1)::numeric)))
);


--
-- Name: TABLE nav_liquidity_discounts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_liquidity_discounts IS 'Liquidity discounts by credit rating and asset class';


--
-- Name: COLUMN nav_liquidity_discounts.discount_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_liquidity_discounts.discount_rate IS 'Liquidity discount rate as decimal (e.g., 0.05 = 5% discount)';


--
-- Name: nav_loss_given_default; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_loss_given_default (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    lgd_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_loss_given_default_lgd_rate_check CHECK (((lgd_rate >= (0)::numeric) AND (lgd_rate <= (1)::numeric)))
);


--
-- Name: TABLE nav_loss_given_default; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_loss_given_default IS 'Loss given default rates by asset type';


--
-- Name: COLUMN nav_loss_given_default.lgd_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_loss_given_default.lgd_rate IS 'Loss given default as decimal (1 - recovery rate)';


--
-- Name: nav_oracle_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_oracle_configs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    fund_id uuid NOT NULL,
    name text NOT NULL,
    oracle_type text NOT NULL,
    endpoint_url text,
    api_key_encrypted text,
    response_path text,
    update_frequency integer DEFAULT 3600,
    last_update timestamp with time zone,
    min_nav numeric(18,6),
    max_nav numeric(18,6),
    max_change_percent numeric(8,4) DEFAULT 10.0,
    active boolean DEFAULT true,
    success_rate numeric(5,2) DEFAULT 0.0,
    last_error text,
    consecutive_failures integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    CONSTRAINT nav_oracle_configs_oracle_type_check CHECK ((oracle_type = ANY (ARRAY['chainlink'::text, 'api3'::text, 'custom_api'::text, 'manual'::text]))),
    CONSTRAINT positive_frequency CHECK ((update_frequency > 0)),
    CONSTRAINT valid_change_limit CHECK ((max_change_percent > (0)::numeric)),
    CONSTRAINT valid_success_rate CHECK (((success_rate >= (0)::numeric) AND (success_rate <= (100)::numeric)))
);


--
-- Name: TABLE nav_oracle_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_oracle_configs IS 'Oracle configurations for automated NAV data feeds';


--
-- Name: nav_prepayment_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_prepayment_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    monthly_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_prepayment_rates_monthly_rate_check CHECK (((monthly_rate >= (0)::numeric) AND (monthly_rate <= (1)::numeric)))
);


--
-- Name: TABLE nav_prepayment_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_prepayment_rates IS 'Monthly prepayment rates by asset type';


--
-- Name: COLUMN nav_prepayment_rates.monthly_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_prepayment_rates.monthly_rate IS 'Monthly prepayment rate as decimal (e.g., 0.01 = 1% per month)';


--
-- Name: nav_price_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_price_cache (
    instrument_key text NOT NULL,
    price numeric(18,6) NOT NULL,
    currency text DEFAULT 'USD'::text NOT NULL,
    as_of timestamp with time zone NOT NULL,
    source text NOT NULL
);


--
-- Name: TABLE nav_price_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_price_cache IS 'Caches market prices for instruments to optimize NAV calculation performance';


--
-- Name: nav_probability_of_default; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_probability_of_default (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_rating text NOT NULL,
    annual_pd numeric NOT NULL,
    time_horizon_years integer DEFAULT 1 NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_probability_of_default_annual_pd_check CHECK (((annual_pd >= (0)::numeric) AND (annual_pd <= (1)::numeric))),
    CONSTRAINT nav_probability_of_default_time_horizon_years_check CHECK ((time_horizon_years > 0))
);


--
-- Name: TABLE nav_probability_of_default; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_probability_of_default IS 'Probability of default by credit rating';


--
-- Name: COLUMN nav_probability_of_default.annual_pd; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_probability_of_default.annual_pd IS 'Annual probability of default as decimal';


--
-- Name: nav_recovery_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_recovery_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_type text NOT NULL,
    recovery_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_recovery_rates_recovery_rate_check CHECK (((recovery_rate >= (0)::numeric) AND (recovery_rate <= (1)::numeric)))
);


--
-- Name: TABLE nav_recovery_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_recovery_rates IS 'Recovery rates by asset type for defaulted assets';


--
-- Name: COLUMN nav_recovery_rates.recovery_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_recovery_rates.recovery_rate IS 'Expected recovery rate as decimal (e.g., 0.40 = 40% recovery)';


--
-- Name: nav_redemptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_redemptions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid NOT NULL,
    product_type text NOT NULL,
    as_of_date date NOT NULL,
    shares_redeemed numeric(78,18) DEFAULT 0 NOT NULL,
    value_redeemed numeric(78,18) DEFAULT 0 NOT NULL,
    redemption_rate numeric(18,6) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE nav_redemptions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_redemptions IS 'Tracks daily redemption rates and activity for assets and products';


--
-- Name: nav_unexpected_loss; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.nav_unexpected_loss (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    credit_rating text NOT NULL,
    ul_rate numeric NOT NULL,
    description text,
    as_of_date timestamp with time zone DEFAULT now() NOT NULL,
    source text DEFAULT 'manual'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT nav_unexpected_loss_ul_rate_check CHECK ((ul_rate >= (0)::numeric))
);


--
-- Name: TABLE nav_unexpected_loss; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.nav_unexpected_loss IS 'Unexpected loss rates by credit rating for risk capital calculations';


--
-- Name: COLUMN nav_unexpected_loss.ul_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.nav_unexpected_loss.ul_rate IS 'Unexpected loss as decimal';


--
-- Name: notification_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    project_id uuid,
    event_types text[],
    notification_channels text[],
    email_recipients text[],
    email_template text DEFAULT 'default'::text,
    advance_notice_days integer[] DEFAULT '{1,7,30}'::integer[],
    disabled boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE notification_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_settings IS 'Stores user preferences for product lifecycle event notifications';


--
-- Name: COLUMN notification_settings.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.user_id IS 'User who owns these notification preferences';


--
-- Name: COLUMN notification_settings.project_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.project_id IS 'Optional project ID for project-specific settings, NULL for global settings';


--
-- Name: COLUMN notification_settings.event_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.event_types IS 'Array of event types to be notified about, empty array means all types';


--
-- Name: COLUMN notification_settings.notification_channels; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.notification_channels IS 'Channels to use for notifications (email, in_app, calendar)';


--
-- Name: COLUMN notification_settings.email_recipients; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.email_recipients IS 'Additional email recipients beyond the user';


--
-- Name: COLUMN notification_settings.email_template; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.email_template IS 'Preferred email template style';


--
-- Name: COLUMN notification_settings.advance_notice_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.advance_notice_days IS 'Days before events to send notifications';


--
-- Name: COLUMN notification_settings.disabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_settings.disabled IS 'Whether notifications are disabled for this user/project';


--
-- Name: notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notifications (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id text NOT NULL,
    type text NOT NULL,
    title text NOT NULL,
    description text NOT NULL,
    date timestamp with time zone DEFAULT now() NOT NULL,
    read boolean DEFAULT false NOT NULL,
    action_required boolean DEFAULT false NOT NULL,
    action_url text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: onboarding_restrictions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.onboarding_restrictions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    type text NOT NULL,
    value text NOT NULL,
    reason text NOT NULL,
    active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    created_by text NOT NULL,
    CONSTRAINT onboarding_restrictions_type_check CHECK ((type = ANY (ARRAY['COUNTRY'::text, 'INVESTOR_TYPE'::text])))
);


--
-- Name: onchain_claims; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.onchain_claims (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    identity_id uuid,
    issuer_id uuid,
    topic integer NOT NULL,
    data text,
    signature text NOT NULL,
    valid_from timestamp with time zone,
    valid_to timestamp with time zone,
    verification_timestamp timestamp with time zone DEFAULT now() NOT NULL,
    status text NOT NULL,
    CONSTRAINT onchain_claims_status_check CHECK ((status = ANY (ARRAY['VALID'::text, 'INVALID'::text, 'EXPIRED'::text, 'REVOKED'::text])))
);


--
-- Name: onchain_identities; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.onchain_identities (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid,
    identity_address text NOT NULL,
    blockchain text NOT NULL,
    network text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    is_active boolean DEFAULT true NOT NULL
);


--
-- Name: onchain_issuers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.onchain_issuers (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    issuer_address text NOT NULL,
    issuer_name text NOT NULL,
    blockchain text NOT NULL,
    network text NOT NULL,
    trusted_for_claims integer[] DEFAULT '{}'::integer[] NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    is_active boolean DEFAULT true NOT NULL
);


--
-- Name: onchain_verification_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.onchain_verification_history (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    identity_id uuid,
    verification_type text NOT NULL,
    required_claims integer[] DEFAULT '{}'::integer[] NOT NULL,
    result boolean NOT NULL,
    reason text,
    verification_timestamp timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: operation_metadata; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.operation_metadata (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    gas_estimate jsonb,
    simulation_result jsonb,
    execution_context jsonb,
    performance_metrics jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE operation_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.operation_metadata IS 'Operation metadata for enhanced tracking';


--
-- Name: operation_validations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.operation_validations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    policy_id uuid,
    rule_evaluations jsonb,
    validation_status text NOT NULL,
    rejection_reasons text[],
    validated_by uuid,
    validated_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT operation_validations_validation_status_check CHECK ((validation_status = ANY (ARRAY['approved'::text, 'rejected'::text, 'pending'::text])))
);


--
-- Name: operator_status; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.operator_status (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operator text NOT NULL,
    status text,
    blocked_reason text,
    blocked_at timestamp with time zone,
    blocked_until timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT operator_status_status_check CHECK ((status = ANY (ARRAY['active'::text, 'blocked'::text, 'restricted'::text, 'under-review'::text])))
);


--
-- Name: TABLE operator_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.operator_status IS 'Tracks operator status including blocks and restrictions';


--
-- Name: organization_details; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.organization_details (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    registration_number text,
    jurisdiction text,
    address jsonb,
    contact jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: organizations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.organizations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    legal_name text,
    registration_number text,
    registration_date timestamp with time zone,
    tax_id text,
    jurisdiction text,
    business_type text,
    status text DEFAULT 'pending'::text,
    contact_email text,
    contact_phone text,
    website text,
    address jsonb,
    legal_representatives jsonb,
    compliance_status text DEFAULT 'pending_review'::text,
    onboarding_completed boolean DEFAULT false,
    updated_at timestamp with time zone DEFAULT now(),
    entity_structure text,
    issuer_type text,
    governance_model text,
    CONSTRAINT chk_entity_structure CHECK (((entity_structure IS NULL) OR (entity_structure = ANY (ARRAY['single_entity'::text, 'holding_company'::text, 'subsidiary'::text, 'spv'::text, 'joint_venture'::text])))),
    CONSTRAINT chk_governance_model CHECK (((governance_model IS NULL) OR (governance_model = ANY (ARRAY['board'::text, 'manager_managed'::text, 'member_managed'::text, 'trustee'::text])))),
    CONSTRAINT chk_issuer_type CHECK (((issuer_type IS NULL) OR (issuer_type = ANY (ARRAY['corporate'::text, 'government'::text, 'fund'::text, 'spv'::text, 'reit'::text]))))
);


--
-- Name: COLUMN organizations.entity_structure; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizations.entity_structure IS 'Legal entity structure type (single_entity, holding_company, subsidiary, spv, joint_venture)';


--
-- Name: COLUMN organizations.issuer_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizations.issuer_type IS 'Type of issuer (corporate, government, fund, spv, reit)';


--
-- Name: COLUMN organizations.governance_model; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizations.governance_model IS 'Governance model (board, manager_managed, member_managed, trustee)';


--
-- Name: payer; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payer (
    payer_id integer NOT NULL,
    name character varying(255)
);


--
-- Name: payer_payer_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.payer ALTER COLUMN payer_id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.payer_payer_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: paymaster_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.paymaster_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_operation_id uuid NOT NULL,
    paymaster_address text NOT NULL,
    paymaster_data text NOT NULL,
    verification_gas_limit bigint NOT NULL,
    post_op_gas_limit bigint NOT NULL,
    gas_sponsored bigint NOT NULL,
    sponsor_address text,
    policy_applied jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE paymaster_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.paymaster_operations IS 'Tracks paymaster sponsorship for user operations';


--
-- Name: COLUMN paymaster_operations.policy_applied; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.paymaster_operations.policy_applied IS 'JSONB storing the sponsorship policy that was applied';


--
-- Name: paymaster_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.paymaster_policies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    policy_name text NOT NULL,
    paymaster_address text NOT NULL,
    chain_id integer NOT NULL,
    policy_type text NOT NULL,
    policy_config jsonb DEFAULT '{}'::jsonb NOT NULL,
    is_active boolean DEFAULT true,
    daily_limit bigint,
    monthly_limit bigint,
    whitelisted_addresses jsonb DEFAULT '[]'::jsonb,
    blacklisted_addresses jsonb DEFAULT '[]'::jsonb,
    allowed_functions jsonb DEFAULT '[]'::jsonb,
    time_restrictions jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT paymaster_policies_policy_type_check CHECK ((policy_type = ANY (ARRAY['whitelist'::text, 'rate_limit'::text, 'spending_limit'::text, 'token_based'::text, 'time_based'::text])))
);


--
-- Name: TABLE paymaster_policies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.paymaster_policies IS 'Advanced paymaster policy configurations for sponsored transactions';


--
-- Name: pd_collateral; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_collateral (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    collateral_type character varying(50) NOT NULL,
    collateral_description text NOT NULL,
    collateral_location character varying(255),
    original_value numeric(20,2) NOT NULL,
    current_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    valuation_method character varying(50),
    loan_to_value_ratio numeric(5,2),
    advance_rate numeric(5,2),
    lien_position character varying(20),
    perfection_status character varying(50),
    ucc_filing_number character varying(100),
    insurance_coverage numeric(20,2),
    insurance_provider character varying(255),
    last_inspection_date timestamp with time zone,
    inspection_report_url text,
    depreciation_rate numeric(5,2),
    liquidation_timeframe_days integer,
    estimated_recovery_value numeric(20,2),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_collateral; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_collateral IS 'Collateral securing private debt loans';


--
-- Name: pd_covenants; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_covenants (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    covenant_type character varying(50) NOT NULL,
    covenant_category character varying(50),
    covenant_description text NOT NULL,
    measurement_frequency character varying(20),
    test_date timestamp with time zone NOT NULL,
    next_test_date timestamp with time zone,
    threshold_value numeric(20,6),
    actual_value numeric(20,6),
    threshold_operator character varying(10),
    is_compliant boolean NOT NULL,
    breach_severity character varying(20),
    grace_period_days integer,
    waiver_obtained boolean DEFAULT false,
    waiver_expiration_date timestamp with time zone,
    cure_actions jsonb,
    cure_deadline timestamp with time zone,
    consequences_of_breach text,
    notification_required boolean DEFAULT true,
    notification_sent boolean DEFAULT false,
    historical_compliance jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_covenants; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_covenants IS 'Loan covenant tracking and compliance';


--
-- Name: pd_credit_ratings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_credit_ratings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    borrower_id uuid,
    rating_agency character varying(50) NOT NULL,
    rating_type character varying(50),
    rating character varying(10) NOT NULL,
    rating_outlook character varying(20),
    rating_date timestamp with time zone NOT NULL,
    previous_rating character varying(10),
    rating_action character varying(50),
    rating_methodology text,
    key_rating_factors jsonb,
    probability_of_default numeric(5,4),
    recovery_rate_estimate numeric(5,2),
    is_investment_grade boolean,
    rating_report_url text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_credit_ratings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_credit_ratings IS 'Credit ratings for private debt borrowers';


--
-- Name: pd_default_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_default_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    event_type character varying(50) NOT NULL,
    event_date timestamp with time zone NOT NULL,
    detection_date timestamp with time zone NOT NULL,
    notification_date timestamp with time zone,
    days_past_due integer,
    amount_in_default numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    default_description text NOT NULL,
    covenant_breached_id uuid,
    severity character varying(20) NOT NULL,
    is_event_of_default boolean DEFAULT false,
    cure_period_days integer,
    cure_deadline timestamp with time zone,
    is_cured boolean DEFAULT false,
    cure_date timestamp with time zone,
    cure_actions_taken jsonb,
    lender_actions jsonb,
    forbearance_agreement jsonb,
    restructuring_terms jsonb,
    loss_mitigation_strategy text,
    expected_loss numeric(20,2),
    recovery_actions jsonb,
    recovery_amount numeric(20,2),
    write_off_amount numeric(20,2),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_default_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_default_events IS 'Default and delinquency events for private debt';


--
-- Name: pd_loan_schedules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_loan_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    payment_number integer NOT NULL,
    payment_date timestamp with time zone NOT NULL,
    principal_amount numeric(20,2) NOT NULL,
    interest_amount numeric(20,2) NOT NULL,
    total_payment numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    beginning_balance numeric(20,2) NOT NULL,
    ending_balance numeric(20,2) NOT NULL,
    payment_type character varying(50) DEFAULT 'regular'::character varying,
    interest_rate numeric(5,4) NOT NULL,
    days_in_period integer,
    accrual_basis character varying(20),
    fees numeric(20,2) DEFAULT 0,
    is_estimated boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_loan_schedules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_loan_schedules IS 'Payment schedules for private debt loans';


--
-- Name: pd_payment_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pd_payment_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_debt_product_id uuid NOT NULL,
    loan_id uuid NOT NULL,
    scheduled_payment_id uuid,
    payment_date timestamp with time zone NOT NULL,
    due_date timestamp with time zone NOT NULL,
    principal_paid numeric(20,2) NOT NULL,
    interest_paid numeric(20,2) NOT NULL,
    fees_paid numeric(20,2) DEFAULT 0,
    penalties_paid numeric(20,2) DEFAULT 0,
    total_paid numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    payment_method character varying(50),
    transaction_reference character varying(100),
    days_late integer DEFAULT 0,
    is_partial_payment boolean DEFAULT false,
    is_prepayment boolean DEFAULT false,
    prepayment_penalty numeric(20,2),
    remaining_balance numeric(20,2),
    status character varying(20) DEFAULT 'received'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pd_payment_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pd_payment_history IS 'Actual payment history for private debt';


--
-- Name: pe_capital_calls; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pe_capital_calls (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_equity_product_id uuid NOT NULL,
    fund_id uuid NOT NULL,
    call_number integer NOT NULL,
    call_date timestamp with time zone NOT NULL,
    due_date timestamp with time zone NOT NULL,
    call_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    purpose text,
    target_investments jsonb,
    call_percentage numeric(5,2),
    cumulative_called_percentage numeric(5,2),
    notice_period_days integer,
    payment_instructions text,
    investor_allocations jsonb,
    defaulted_investors jsonb,
    total_received numeric(20,2),
    total_outstanding numeric(20,2),
    status character varying(20) DEFAULT 'issued'::character varying,
    is_emergency_call boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pe_capital_calls; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pe_capital_calls IS 'Capital calls to fund investors in private equity funds';


--
-- Name: pe_distributions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pe_distributions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_equity_product_id uuid NOT NULL,
    fund_id uuid NOT NULL,
    distribution_number integer NOT NULL,
    distribution_date timestamp with time zone NOT NULL,
    payment_date timestamp with time zone NOT NULL,
    distribution_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    distribution_type character varying(50) NOT NULL,
    source_investment character varying(255),
    source_event character varying(100),
    investor_allocations jsonb,
    tax_treatment jsonb,
    withholding_taxes jsonb,
    net_distribution numeric(20,2),
    payment_method character varying(50),
    currency_hedging jsonb,
    status character varying(20) DEFAULT 'declared'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pe_distributions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pe_distributions IS 'Distributions to investors from private equity funds';


--
-- Name: pe_performance_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pe_performance_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_equity_product_id uuid NOT NULL,
    fund_id uuid NOT NULL,
    as_of_date timestamp with time zone NOT NULL,
    calculation_date timestamp with time zone DEFAULT now() NOT NULL,
    total_committed_capital numeric(20,2) NOT NULL,
    total_called_capital numeric(20,2) NOT NULL,
    total_distributed numeric(20,2) NOT NULL,
    residual_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    irr numeric(5,2),
    moic numeric(5,2),
    tvpi numeric(5,2),
    dpi numeric(5,2),
    rvpi numeric(5,2),
    pme numeric(5,2),
    pme_benchmark character varying(50),
    since_inception_irr numeric(5,2),
    vintage_year integer,
    fund_age_years numeric(5,2),
    quartile_ranking integer,
    peer_comparison jsonb,
    j_curve_position character varying(50),
    realized_investments integer,
    unrealized_investments integer,
    written_off_investments integer,
    total_fees_paid numeric(20,2),
    carried_interest_accrued numeric(20,2),
    calculation_methodology text,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pe_performance_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pe_performance_metrics IS 'Fund-level performance metrics (IRR, MOIC, DPI, etc.)';


--
-- Name: pe_portfolio_companies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pe_portfolio_companies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    private_equity_product_id uuid NOT NULL,
    fund_id uuid NOT NULL,
    company_name character varying(255) NOT NULL,
    company_registration_number character varying(100),
    jurisdiction character varying(100),
    industry_sector character varying(100),
    initial_investment_date timestamp with time zone NOT NULL,
    initial_cost_basis numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    ownership_percentage numeric(5,2),
    shares_owned numeric(20,2),
    total_shares_outstanding numeric(20,2),
    security_type character varying(50),
    board_seats integer,
    investment_thesis text,
    exit_strategy character varying(100),
    target_hold_period_years integer,
    target_return_multiple numeric(5,2),
    current_valuation numeric(20,2),
    unrealized_gain_loss numeric(20,2),
    total_capital_invested numeric(20,2),
    additional_investments jsonb,
    partial_exits jsonb,
    management_team jsonb,
    key_metrics jsonb,
    investment_stage character varying(50),
    status character varying(20) DEFAULT 'active'::character varying,
    exit_date timestamp with time zone,
    exit_proceeds numeric(20,2),
    realized_gain_loss numeric(20,2),
    moic numeric(5,2),
    irr numeric(5,2),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pe_portfolio_companies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pe_portfolio_companies IS 'Portfolio company holdings in private equity funds';


--
-- Name: pe_valuations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pe_valuations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    entity_id uuid NOT NULL,
    entity_type character varying(50) NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    valuation_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    valuation_method character varying(50) NOT NULL,
    valuation_firm character varying(255),
    valuer_name character varying(255),
    ebitda numeric(20,2),
    revenue numeric(20,2),
    valuation_multiple numeric(10,2),
    multiple_type character varying(50),
    discount_rate numeric(5,4),
    terminal_growth_rate numeric(5,4),
    comparable_companies jsonb,
    precedent_transactions jsonb,
    adjustments jsonb,
    fair_value_estimate numeric(20,2),
    fair_value_range jsonb,
    confidence_level character varying(20),
    valuation_report_url text,
    audit_status character varying(20) DEFAULT 'pending'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE pe_valuations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.pe_valuations IS 'Valuations of private equity funds and portfolio companies';


--
-- Name: permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.permissions (
    name text NOT NULL,
    description text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: policy_operation_mappings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_operation_mappings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    policy_id uuid,
    operation_type text NOT NULL,
    chain_id text,
    token_standard text,
    conditions jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT policy_operation_mappings_operation_type_check CHECK ((operation_type = ANY (ARRAY['mint'::text, 'burn'::text, 'transfer'::text, 'lock'::text, 'unlock'::text, 'block'::text, 'unblock'::text])))
);


--
-- Name: policy_rule_approvers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_rule_approvers (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    policy_rule_id uuid NOT NULL,
    user_id uuid NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'pending'::text,
    comment text,
    "timestamp" timestamp with time zone
);


--
-- Name: policy_rule_approvers_backup; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_rule_approvers_backup (
    policy_rule_id uuid,
    user_id uuid,
    created_at timestamp with time zone,
    created_by uuid,
    status text,
    comment text,
    "timestamp" timestamp with time zone
);


--
-- Name: policy_template_approvers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_template_approvers (
    template_id uuid NOT NULL,
    user_id uuid NOT NULL,
    created_by uuid,
    status text DEFAULT 'pending'::text,
    "timestamp" timestamp with time zone DEFAULT now()
);


--
-- Name: policy_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_templates (
    template_id uuid DEFAULT gen_random_uuid() NOT NULL,
    template_name text NOT NULL,
    description text,
    template_data jsonb NOT NULL,
    created_by text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    template_type text GENERATED ALWAYS AS (
CASE
    WHEN ((template_data ->> 'type'::text) IS NOT NULL) THEN (template_data ->> 'type'::text)
    ELSE 'general'::text
END) STORED,
    status text DEFAULT 'active'::text NOT NULL
);


--
-- Name: TABLE policy_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.policy_templates IS 'Stores reusable policy templates';


--
-- Name: COLUMN policy_templates.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.policy_templates.status IS 'Status of the template (active, inactive)';


--
-- Name: policy_violations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.policy_violations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    policy_id uuid,
    violation_type text NOT NULL,
    severity text NOT NULL,
    description text,
    resolved boolean DEFAULT false,
    resolved_by uuid,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT policy_violations_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: pool; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pool (
    pool_id integer NOT NULL,
    pool_name character varying(255),
    pool_type public.pool_type_enum,
    creation_timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: pool_pool_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.pool ALTER COLUMN pool_id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.pool_pool_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: private_debt_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.private_debt_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    deal_id character varying(50),
    opportunity_source character varying(100),
    industry_sector character varying(100),
    company_name text,
    deal_size numeric,
    screening_status character varying(50),
    due_diligence_status character varying(50),
    financial_metrics jsonb,
    risk_profile character varying(100),
    valuation_amount numeric,
    deal_structure_details text,
    transaction_status character varying(50),
    execution_date timestamp with time zone,
    portfolio_performance_metrics jsonb,
    compliance_status character varying(50),
    monitoring_frequency integer,
    advisory_service_type character varying(100),
    exit_strategy_status character varying(50),
    outcome text,
    debtor_credit_quality character varying(100),
    collection_period_days integer,
    recovery_rate_percentage numeric,
    diversification_metrics jsonb,
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: private_equity_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.private_equity_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    fund_id character varying(50),
    fund_name text,
    fund_type character varying(50),
    fund_size numeric,
    formation_date timestamp with time zone,
    commitment_period integer,
    capital_commitment numeric,
    capital_call numeric,
    invested_capital numeric,
    management_fee numeric,
    carried_interest numeric,
    hurdle_rate numeric,
    internal_rate_of_return numeric,
    net_asset_value numeric,
    distributed_to_paid_in numeric,
    residual_value_to_paid_in numeric,
    investment_date timestamp with time zone,
    exit_date timestamp with time zone,
    exit_mechanism character varying(100),
    portfolio_company_id character varying(50),
    stage_of_development character varying(100),
    financing_round character varying(50),
    investment_amount numeric,
    valuation_pre_money numeric,
    valuation_post_money numeric,
    ownership_percentage numeric,
    investor_type character varying(100),
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    fund_vintage_year character varying,
    investment_stage character varying,
    sector_focus character varying,
    geographic_focus character varying
);


--
-- Name: token_deployments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_deployments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    network text NOT NULL,
    contract_address text NOT NULL,
    transaction_hash text NOT NULL,
    deployed_at timestamp with time zone DEFAULT now(),
    deployed_by text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    deployment_data jsonb,
    deployment_strategy text,
    factory_address text,
    master_address text,
    gas_used bigint,
    gas_price text,
    details jsonb NOT NULL,
    initial_owner text,
    source_verified boolean DEFAULT false,
    source_verification_status text DEFAULT 'not_verified'::text,
    source_verification_guid text,
    source_verification_attempts integer DEFAULT 0,
    last_source_verification_attempt timestamp with time zone,
    block_explorer_url text
);


--
-- Name: TABLE token_deployments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_deployments IS 'Bridge table linking token configurations to deployed contracts. Tracks deployment status and initialization state.';


--
-- Name: COLUMN token_deployments.source_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.source_verified IS 'Whether source code is verified on block explorer';


--
-- Name: COLUMN token_deployments.source_verification_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.source_verification_status IS 'Status: not_verified, pending, verified, failed, already_verified';


--
-- Name: COLUMN token_deployments.source_verification_guid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.source_verification_guid IS 'GUID from block explorer for tracking verification';


--
-- Name: COLUMN token_deployments.source_verification_attempts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.source_verification_attempts IS 'Number of verification attempts';


--
-- Name: COLUMN token_deployments.last_source_verification_attempt; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.last_source_verification_attempt IS 'Timestamp of last verification attempt';


--
-- Name: COLUMN token_deployments.block_explorer_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_deployments.block_explorer_url IS 'URL to verified contract on block explorer';


--
-- Name: problematic_token_deployments; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.problematic_token_deployments AS
 SELECT t.id,
    t.name,
    t.symbol,
    t.address AS contract_address,
    t.blockchain,
    t.deployment_status,
    t.deployment_error,
    td.status AS deployment_table_status,
    (td.deployment_data ->> 'initialization_error'::text) AS initialization_error,
        CASE
            WHEN ((t.deployment_status)::text = 'FAILED_INITIALIZATION'::text) THEN 'Needs initialize() call'::text
            WHEN (td.status = 'FAILED_INITIALIZATION'::text) THEN 'Needs initialize() call'::text
            ELSE 'Unknown issue'::text
        END AS recommended_action
   FROM (public.tokens t
     LEFT JOIN public.token_deployments td ON ((td.token_id = t.id)))
  WHERE (((t.deployment_status)::text = ANY (ARRAY[('FAILED_INITIALIZATION'::character varying)::text, ('failed'::character varying)::text])) OR (td.status = 'FAILED_INITIALIZATION'::text));


--
-- Name: product_lifecycle_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.product_lifecycle_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    product_id uuid NOT NULL,
    product_type character varying(100),
    event_type character varying(100),
    event_date timestamp with time zone,
    quantity numeric(18,8),
    transaction_hash character varying(255),
    actor character varying(255),
    details text,
    status character varying(50),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE product_lifecycle_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.product_lifecycle_events IS 'Tracks lifecycle events for all product types';


--
-- Name: COLUMN product_lifecycle_events.event_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product_lifecycle_events.event_type IS 'Type of event (e.g., issuance, maturity, redemption, call, rebase)';


--
-- Name: COLUMN product_lifecycle_events.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product_lifecycle_events.status IS 'Status of the event (e.g., Pending, Success, Failed)';


--
-- Name: production_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.production_data (
    production_id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid,
    production_date date NOT NULL,
    output_mwh numeric(10,2) NOT NULL,
    weather_condition_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT production_data_output_mwh_check CHECK ((output_mwh >= (0)::numeric))
);


--
-- Name: profiles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.profiles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    profile_type public.profile_type,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE profiles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.profiles IS 'User profiles linking auth.users to public.users with profile types';


--
-- Name: COLUMN profiles.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.profiles.id IS 'References auth.users.id (Supabase auth user)';


--
-- Name: COLUMN profiles.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.profiles.user_id IS 'References public.users.id (application user)';


--
-- Name: COLUMN profiles.profile_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.profiles.profile_type IS 'User role type in the system';


--
-- Name: project_organization_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.project_organization_assignments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    relationship_type text NOT NULL,
    notes text,
    is_active boolean DEFAULT true,
    assigned_by uuid,
    assigned_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT project_organization_assignments_relationship_type_check CHECK ((relationship_type = ANY (ARRAY['issuer'::text, 'investor'::text, 'service_provider'::text, 'regulator'::text])))
);


--
-- Name: TABLE project_organization_assignments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.project_organization_assignments IS 'Stores many-to-many relationships between projects and organizations with typed relationship roles';


--
-- Name: COLUMN project_organization_assignments.relationship_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_organization_assignments.relationship_type IS 'Type of relationship: issuer, investor, service_provider, or regulator';


--
-- Name: COLUMN project_organization_assignments.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_organization_assignments.notes IS 'Optional notes about the relationship';


--
-- Name: COLUMN project_organization_assignments.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_organization_assignments.is_active IS 'Whether this assignment is currently active';


--
-- Name: COLUMN project_organization_assignments.assigned_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_organization_assignments.assigned_by IS 'User who created this assignment';


--
-- Name: projects; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.projects (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    project_type text,
    organization_id uuid,
    is_primary boolean DEFAULT false NOT NULL,
    investment_status character varying(50) DEFAULT 'Open'::character varying NOT NULL,
    status character varying(50) DEFAULT 'active'::character varying,
    target_raise numeric,
    subscription_start_date date,
    subscription_end_date date,
    transaction_start_date date,
    maturity_date date,
    total_notional numeric,
    company_valuation numeric,
    minimum_investment numeric,
    estimated_yield_percentage numeric,
    token_symbol text,
    legal_entity text,
    jurisdiction text,
    tax_id text,
    duration text,
    currency text DEFAULT 'USD'::text,
    regulatory_exemptions jsonb[],
    authorized_shares bigint,
    CONSTRAINT projects_investment_status_check CHECK (((investment_status)::text = ANY (ARRAY[('Open'::character varying)::text, ('Closed'::character varying)::text]))),
    CONSTRAINT projects_project_type_check CHECK ((project_type = ANY (ARRAY['structured_products'::text, 'equity'::text, 'commodities'::text, 'funds_etfs_etps'::text, 'bonds'::text, 'quantitative_investment_strategies'::text, 'private_equity'::text, 'private_debt'::text, 'real_estate'::text, 'energy'::text, 'infrastructure'::text, 'collectibles'::text, 'receivables'::text, 'solar_wind_climate'::text, 'digital_tokenised_fund'::text, 'fiat_backed_stablecoin'::text, 'crypto_backed_stablecoin'::text, 'commodity_backed_stablecoin'::text, 'algorithmic_stablecoin'::text, 'rebasing_stablecoin'::text]))),
    CONSTRAINT projects_status_check CHECK (((status)::text = ANY (ARRAY[('active'::character varying)::text, ('inactive'::character varying)::text, ('completed'::character varying)::text, ('draft'::character varying)::text])))
);


--
-- Name: COLUMN projects.project_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.project_type IS 'Project type supporting Traditional Assets (structured_products, equity, commodities, funds_etfs_etps, bonds, quantitative_investment_strategies), Alternative Assets (private_equity, private_debt, real_estate, energy, infrastructure, collectibles, receivables, solar_wind_climate), and Digital Assets (digital_tokenised_fund, fiat_backed_stablecoin, crypto_backed_stablecoin, commodity_backed_stablecoin, algorithmic_stablecoin, rebasing_stablecoin)';


--
-- Name: COLUMN projects.is_primary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.is_primary IS 'Indicates if this is the primary project for the organization (only one per org)';


--
-- Name: COLUMN projects.investment_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.investment_status IS 'Investment availability status: Open (accepting investments) or Closed (not accepting)';


--
-- Name: COLUMN projects.subscription_start_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.subscription_start_date IS 'Date when investors can start subscribing';


--
-- Name: COLUMN projects.subscription_end_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.subscription_end_date IS 'Date when the subscription period closes';


--
-- Name: COLUMN projects.transaction_start_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.transaction_start_date IS 'Date when the investment period begins';


--
-- Name: COLUMN projects.maturity_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.maturity_date IS 'Date when the investment reaches maturity';


--
-- Name: COLUMN projects.total_notional; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.total_notional IS 'Total notional amount of the project';


--
-- Name: COLUMN projects.company_valuation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.company_valuation IS 'Valuation of the company';


--
-- Name: COLUMN projects.minimum_investment; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.minimum_investment IS 'Minimum investment amount';


--
-- Name: COLUMN projects.estimated_yield_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.estimated_yield_percentage IS 'Estimated yield percentage';


--
-- Name: COLUMN projects.token_symbol; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.token_symbol IS 'Symbol for the token (if applicable)';


--
-- Name: COLUMN projects.legal_entity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.legal_entity IS 'Legal entity name';


--
-- Name: COLUMN projects.jurisdiction; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.jurisdiction IS 'Legal jurisdiction';


--
-- Name: COLUMN projects.tax_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.tax_id IS 'Tax identification number';


--
-- Name: COLUMN projects.duration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.duration IS 'Project duration (e.g., "12_months")';


--
-- Name: COLUMN projects.currency; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.currency IS 'Currency for all financial values';


--
-- Name: COLUMN projects.authorized_shares; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.projects.authorized_shares IS 'Total number of authorized shares for equity-based projects';


--
-- Name: project_type_stats; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.project_type_stats AS
 WITH project_stats AS (
         SELECT p.project_type,
                CASE
                    WHEN (p.project_type = ANY (ARRAY['structured_product'::text, 'equity'::text, 'bond'::text, 'fund'::text, 'etf'::text, 'etp'::text, 'commodities'::text, 'quantitative_investment_strategies'::text])) THEN 'Traditional Assets'::text
                    WHEN (p.project_type = ANY (ARRAY['private_equity'::text, 'private_debt'::text, 'real_estate'::text, 'energy'::text, 'solar'::text, 'wind'::text, 'infrastructure'::text, 'collectibles'::text, 'receivables'::text])) THEN 'Alternative Assets'::text
                    WHEN (p.project_type = ANY (ARRAY['digital_tokenised_fund'::text, 'fiat_backed_stablecoin'::text, 'crypto_backed_stablecoin'::text, 'commodity_backed_stablecoin'::text, 'algorithmic_stablecoin'::text, 'rebasing_stablecoin'::text, 'stablecoin'::text])) THEN 'Digital Assets'::text
                    ELSE 'Other'::text
                END AS category,
            p.status,
            p.target_raise
           FROM public.projects p
          WHERE (p.project_type IS NOT NULL)
        )
 SELECT project_stats.category,
    project_stats.project_type,
    count(*) AS project_count,
    count(*) FILTER (WHERE ((project_stats.status)::text = 'active'::text)) AS active_count,
    avg(project_stats.target_raise) AS avg_target_raise,
    sum(project_stats.target_raise) AS total_target_raise
   FROM project_stats
  GROUP BY project_stats.category, project_stats.project_type
  ORDER BY project_stats.category, (count(*)) DESC;


--
-- Name: project_wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.project_wallets (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    project_id uuid NOT NULL,
    wallet_address text NOT NULL,
    public_key text NOT NULL,
    private_key text,
    mnemonic text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    chain_id text,
    private_key_vault_id uuid,
    mnemonic_vault_id uuid,
    project_wallet_name text,
    non_evm_network text,
    bitcoin_network_type text,
    wallet_type text,
    evm_address text,
    evm_chain_id text
);


--
-- Name: COLUMN project_wallets.chain_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.chain_id IS 'Numeric chain ID for EVM chains (e.g., 1 for Ethereum, 137 for Polygon). NULL for non-EVM chains.';


--
-- Name: COLUMN project_wallets.private_key_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.private_key_vault_id IS 'Foreign key to key_vault_keys.id for the private key record (key_type = project_private_key)';


--
-- Name: COLUMN project_wallets.mnemonic_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.mnemonic_vault_id IS 'Foreign key to key_vault_keys.id for the mnemonic record (key_type = project_mnemonic)';


--
-- Name: COLUMN project_wallets.non_evm_network; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.non_evm_network IS 'Network identifier for non-EVM chains (e.g., solana, near, injective, bitcoin)';


--
-- Name: COLUMN project_wallets.bitcoin_network_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.bitcoin_network_type IS 'Bitcoin network type: mainnet, testnet, regtest';


--
-- Name: COLUMN project_wallets.wallet_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.wallet_type IS 'Role/purpose of the wallet (e.g., admin, minter, burner, blocker, deployer, operator, treasury, compliance)';


--
-- Name: COLUMN project_wallets.evm_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.evm_address IS 'EVM address (0x...) corresponding to Injective bech32 address (inj1...)';


--
-- Name: COLUMN project_wallets.evm_chain_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.project_wallets.evm_chain_id IS 'EVM chain ID for networks with EVM compatibility (e.g., Injective EVM: 1776 mainnet, 1439 testnet)';


--
-- Name: property_expenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.property_expenses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    real_estate_product_id uuid NOT NULL,
    expense_date timestamp with time zone NOT NULL,
    expense_type character varying(50) NOT NULL,
    expense_category character varying(100) NOT NULL,
    description text,
    amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    frequency character varying(20),
    is_recurring boolean DEFAULT false,
    vendor_name character varying(255),
    invoice_number character varying(100),
    payment_date timestamp with time zone,
    payment_status character varying(20) DEFAULT 'pending'::character varying,
    allocation_method character varying(50),
    allocated_to_units jsonb,
    is_capital_expenditure boolean DEFAULT false,
    amortization_period_months integer,
    budget_category character varying(100),
    budget_variance numeric(20,2),
    approval_status character varying(20) DEFAULT 'approved'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE property_expenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.property_expenses IS 'Property operating and capital expenses';


--
-- Name: property_insurance; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.property_insurance (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    real_estate_product_id uuid NOT NULL,
    property_type character varying(50) NOT NULL,
    insurance_type character varying(50) NOT NULL,
    policy_number character varying(100) NOT NULL,
    insurance_provider character varying(255) NOT NULL,
    coverage_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    premium_amount numeric(20,2) NOT NULL,
    premium_frequency character varying(20) NOT NULL,
    deductible numeric(20,2),
    policy_start_date timestamp with time zone NOT NULL,
    policy_end_date timestamp with time zone NOT NULL,
    effective_date timestamp with time zone NOT NULL,
    covered_perils jsonb,
    exclusions jsonb,
    additional_insureds jsonb,
    loss_payee character varying(255),
    claims_history jsonb,
    risk_assessment jsonb,
    inspection_date timestamp with time zone,
    inspection_report_url text,
    renewal_options jsonb,
    cancellation_terms text,
    status character varying(20) DEFAULT 'active'::character varying,
    is_adequate_coverage boolean DEFAULT true,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE property_insurance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.property_insurance IS 'Property insurance policies and coverage';


--
-- Name: property_tax_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.property_tax_rates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    jurisdiction character varying(255) NOT NULL,
    city character varying(100),
    state_province character varying(100) NOT NULL,
    country character varying(3) NOT NULL,
    property_type character varying(50) NOT NULL,
    tax_rate numeric(5,4) NOT NULL,
    assessment_ratio numeric(5,4),
    effective_date timestamp with time zone NOT NULL,
    expiration_date timestamp with time zone,
    tax_year integer NOT NULL,
    millage_rate numeric(10,4),
    exemptions jsonb,
    special_assessments jsonb,
    calculation_method text,
    payment_schedule character varying(50),
    due_dates jsonb,
    late_payment_penalty numeric(5,2),
    source character varying(255),
    is_current boolean DEFAULT true,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE property_tax_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.property_tax_rates IS 'Property tax rates by jurisdiction';


--
-- Name: property_valuations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.property_valuations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    real_estate_product_id uuid NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    valuation_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    valuation_method character varying(50) NOT NULL,
    appraiser_name character varying(255),
    appraiser_license character varying(100),
    appraiser_firm character varying(255),
    cap_rate numeric(5,4),
    discount_rate numeric(5,4),
    noi numeric(20,2),
    gross_rental_income numeric(20,2),
    operating_expenses numeric(20,2),
    comparable_sales jsonb,
    adjustments_made jsonb,
    market_conditions text,
    highest_best_use text,
    valuation_report_url text,
    confidence_level character varying(20),
    purpose character varying(100),
    is_certified boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE property_valuations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.property_valuations IS 'Property appraisal and valuation history';


--
-- Name: proposal_signatures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.proposal_signatures (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    proposal_id uuid,
    signer_address text NOT NULL,
    signature text NOT NULL,
    signature_type text NOT NULL,
    signed_at timestamp with time zone DEFAULT now(),
    is_valid boolean DEFAULT true,
    validation_error text,
    on_chain_confirmation_tx text,
    confirmed_on_chain boolean DEFAULT false,
    CONSTRAINT proposal_signatures_signature_type_check CHECK ((signature_type = ANY (ARRAY['ecdsa'::text, 'schnorr'::text, 'eddsa'::text, 'other'::text])))
);


--
-- Name: TABLE proposal_signatures; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.proposal_signatures IS 'Layer 1 (UI) - Tracks user signatures on transaction proposals. References transaction_proposals for user-friendly tracking.';


--
-- Name: provider; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.provider (
    provider_id integer NOT NULL,
    name character varying(255),
    address character varying(255)
);


--
-- Name: provider_provider_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.provider ALTER COLUMN provider_id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.provider_provider_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: proxy_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.proxy_approvals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    original_approver_id uuid NOT NULL,
    proxy_approver_id uuid NOT NULL,
    delegation_id uuid NOT NULL,
    "timestamp" timestamp with time zone DEFAULT now(),
    reason text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: psp_api_keys; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_api_keys (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    key_description text NOT NULL,
    key_hash text NOT NULL,
    warp_api_key_vault_id uuid,
    environment text NOT NULL,
    ip_whitelist text[],
    status text DEFAULT 'active'::text NOT NULL,
    last_used_at timestamp with time zone,
    usage_count integer DEFAULT 0,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone,
    CONSTRAINT psp_api_keys_environment_check CHECK ((environment = ANY (ARRAY['sandbox'::text, 'production'::text]))),
    CONSTRAINT psp_api_keys_status_check CHECK ((status = ANY (ARRAY['active'::text, 'suspended'::text, 'revoked'::text])))
);


--
-- Name: TABLE psp_api_keys; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_api_keys IS 'API keys for customer access with encrypted Warp credentials';


--
-- Name: COLUMN psp_api_keys.warp_api_key_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.psp_api_keys.warp_api_key_vault_id IS 'Reference to encrypted Warp API key in key_vault_keys table';


--
-- Name: psp_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_balances (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    virtual_account_id uuid,
    asset_type text NOT NULL,
    asset_symbol text NOT NULL,
    network text,
    available_balance numeric(30,18) DEFAULT 0,
    locked_balance numeric(30,18) DEFAULT 0,
    pending_balance numeric(30,18) DEFAULT 0,
    total_balance numeric(30,18) DEFAULT 0,
    warp_wallet_id text,
    wallet_address text,
    last_synced_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_balances_asset_type_check CHECK ((asset_type = ANY (ARRAY['fiat'::text, 'crypto'::text])))
);


--
-- Name: TABLE psp_balances; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_balances IS 'Multi-asset balance tracking for fiat and crypto';


--
-- Name: psp_external_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_external_accounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_account_id text,
    account_type text NOT NULL,
    currency_type text NOT NULL,
    routing_number_vault_id uuid,
    account_number_vault_id uuid,
    account_number_last4 text,
    account_holder_name text,
    bank_name text,
    account_classification text,
    transfer_method text,
    network text,
    wallet_address text,
    description text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_external_accounts_account_classification_check CHECK ((account_classification = ANY (ARRAY['checking'::text, 'savings'::text]))),
    CONSTRAINT psp_external_accounts_account_type_check CHECK ((account_type = ANY (ARRAY['ach'::text, 'wire'::text, 'crypto'::text, 'plaid'::text]))),
    CONSTRAINT psp_external_accounts_currency_type_check CHECK ((currency_type = ANY (ARRAY['fiat'::text, 'crypto'::text]))),
    CONSTRAINT psp_external_accounts_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text, 'suspended'::text]))),
    CONSTRAINT psp_external_accounts_transfer_method_check CHECK ((transfer_method = ANY (ARRAY['ach'::text, 'wire'::text])))
);


--
-- Name: TABLE psp_external_accounts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_external_accounts IS 'External bank and crypto accounts for receiving payments';


--
-- Name: psp_fiat_crypto_spreads; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_fiat_crypto_spreads (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    crypto_asset text NOT NULL,
    network text,
    tier_name text NOT NULL,
    tier_min numeric(30,2) NOT NULL,
    tier_max numeric(30,2),
    buy_spread_bps integer DEFAULT 0 NOT NULL,
    sell_spread_bps integer DEFAULT 0 NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    updated_by uuid
);


--
-- Name: TABLE psp_fiat_crypto_spreads; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_fiat_crypto_spreads IS 'Fiat-to-crypto trading spreads configuration by transaction size and asset';


--
-- Name: COLUMN psp_fiat_crypto_spreads.tier_min; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.psp_fiat_crypto_spreads.tier_min IS 'Minimum transaction amount for this tier (inclusive)';


--
-- Name: COLUMN psp_fiat_crypto_spreads.tier_max; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.psp_fiat_crypto_spreads.tier_max IS 'Maximum transaction amount for this tier (exclusive), NULL for highest tier';


--
-- Name: COLUMN psp_fiat_crypto_spreads.buy_spread_bps; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.psp_fiat_crypto_spreads.buy_spread_bps IS 'Spread in basis points when buying crypto (100 bps = 1%)';


--
-- Name: COLUMN psp_fiat_crypto_spreads.sell_spread_bps; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.psp_fiat_crypto_spreads.sell_spread_bps IS 'Spread in basis points when selling crypto (100 bps = 1%)';


--
-- Name: psp_identity_cases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_identity_cases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_case_id text,
    case_type text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    business_data jsonb,
    persons_data jsonb,
    verification_results jsonb,
    next_steps text[],
    missing_fields text[],
    rejection_reasons text[],
    submitted_at timestamp with time zone,
    approved_at timestamp with time zone,
    rejected_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_identity_cases_case_type_check CHECK ((case_type = ANY (ARRAY['individual'::text, 'business'::text]))),
    CONSTRAINT psp_identity_cases_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'in_review'::text, 'approved'::text, 'rejected'::text, 'review_required'::text])))
);


--
-- Name: TABLE psp_identity_cases; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_identity_cases IS 'KYB/KYC identity verification cases';


--
-- Name: psp_payment_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_payment_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    automation_enabled boolean DEFAULT false,
    withdrawal_frequency text DEFAULT 'on_demand'::text,
    onramp_enabled boolean DEFAULT false,
    onramp_target_asset text,
    onramp_target_network text,
    onramp_target_wallet_id uuid,
    offramp_enabled boolean DEFAULT false,
    offramp_target_currency text DEFAULT 'USD'::text,
    offramp_target_account_id uuid,
    default_fiat_rail text DEFAULT 'ach'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_payment_settings_default_fiat_rail_check CHECK ((default_fiat_rail = ANY (ARRAY['ach'::text, 'wire'::text, 'rtp'::text, 'fednow'::text]))),
    CONSTRAINT psp_payment_settings_withdrawal_frequency_check CHECK ((withdrawal_frequency = ANY (ARRAY['continuous'::text, 'on_demand'::text, 'daily'::text, 'weekly'::text])))
);


--
-- Name: TABLE psp_payment_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_payment_settings IS 'Payment automation and configuration settings per project';


--
-- Name: psp_payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_payment_id text,
    payment_type text NOT NULL,
    direction text NOT NULL,
    source_type text,
    source_id uuid,
    destination_type text,
    destination_id uuid,
    amount numeric(30,18) NOT NULL,
    currency text NOT NULL,
    network text,
    asset_symbol text,
    payment_rail text,
    status text DEFAULT 'pending'::text NOT NULL,
    error_code text,
    error_message text,
    memo text,
    idempotency_key text,
    metadata jsonb,
    initiated_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    failed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_payments_destination_type_check CHECK ((destination_type = ANY (ARRAY['wallet'::text, 'virtual_account'::text, 'external_account'::text]))),
    CONSTRAINT psp_payments_direction_check CHECK ((direction = ANY (ARRAY['inbound'::text, 'outbound'::text]))),
    CONSTRAINT psp_payments_payment_rail_check CHECK ((payment_rail = ANY (ARRAY['ach'::text, 'wire'::text, 'rtp'::text, 'fednow'::text, 'push_to_card'::text, 'crypto'::text]))),
    CONSTRAINT psp_payments_payment_type_check CHECK ((payment_type = ANY (ARRAY['fiat_payment'::text, 'crypto_payment'::text, 'trade'::text, 'fiat_withdrawal'::text, 'fiat_deposit'::text, 'crypto_withdrawal'::text]))),
    CONSTRAINT psp_payments_source_type_check CHECK ((source_type = ANY (ARRAY['wallet'::text, 'virtual_account'::text, 'external_account'::text]))),
    CONSTRAINT psp_payments_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'cancelled'::text])))
);


--
-- Name: TABLE psp_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_payments IS 'Payment transactions across all rails (fiat and crypto)';


--
-- Name: psp_trades; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_trades (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_trade_id text,
    virtual_account_id uuid,
    source_symbol text NOT NULL,
    source_network text,
    source_amount numeric(30,18) NOT NULL,
    destination_symbol text NOT NULL,
    destination_network text,
    destination_amount numeric(30,18),
    exchange_rate numeric(30,18),
    fee_amount numeric(30,18),
    fee_currency text,
    status text DEFAULT 'pending'::text NOT NULL,
    error_message text,
    executed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_trades_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'executing'::text, 'completed'::text, 'failed'::text, 'cancelled'::text])))
);


--
-- Name: TABLE psp_trades; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_trades IS 'Currency trading transactions (crypto to fiat, fiat to crypto)';


--
-- Name: psp_virtual_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_virtual_accounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_virtual_account_id text,
    identity_case_id uuid,
    account_name text NOT NULL,
    account_type text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    balances jsonb,
    deposit_instructions jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_virtual_accounts_account_type_check CHECK ((account_type = ANY (ARRAY['individual'::text, 'business'::text]))),
    CONSTRAINT psp_virtual_accounts_status_check CHECK ((status = ANY (ARRAY['active'::text, 'suspended'::text, 'closed'::text])))
);


--
-- Name: TABLE psp_virtual_accounts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_virtual_accounts IS 'Multi-currency virtual accounts for managing balances';


--
-- Name: psp_webhook_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_webhook_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    webhook_id uuid,
    project_id uuid NOT NULL,
    event_id text NOT NULL,
    event_name text NOT NULL,
    resource_urls text[] NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    delivery_attempts integer DEFAULT 0,
    delivered_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_webhook_events_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'delivered'::text, 'failed'::text])))
);


--
-- Name: TABLE psp_webhook_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_webhook_events IS 'Webhook events received from Warp/Beam API';


--
-- Name: psp_webhooks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.psp_webhooks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    warp_webhook_id text,
    callback_url text NOT NULL,
    auth_username text NOT NULL,
    auth_password_vault_id uuid,
    status text DEFAULT 'active'::text NOT NULL,
    retry_count integer DEFAULT 0,
    last_success_at timestamp with time zone,
    last_failure_at timestamp with time zone,
    failure_reason text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT psp_webhooks_status_check CHECK ((status = ANY (ARRAY['active'::text, 'suspended'::text, 'failed'::text])))
);


--
-- Name: TABLE psp_webhooks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.psp_webhooks IS 'Webhook registrations with Warp/Beam API';


--
-- Name: quant_backtests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quant_backtests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quantitative_investment_strategies_product_id uuid NOT NULL,
    backtest_name character varying(255) NOT NULL,
    backtest_date timestamp with time zone NOT NULL,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone NOT NULL,
    strategy_version character varying(50),
    universe_definition text,
    initial_capital numeric(20,2) NOT NULL,
    final_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    total_return numeric(5,2),
    annualized_return numeric(5,2),
    annualized_volatility numeric(5,2),
    sharpe_ratio numeric(5,2),
    sortino_ratio numeric(5,2),
    max_drawdown numeric(5,2),
    max_drawdown_duration_days integer,
    calmar_ratio numeric(5,2),
    win_rate numeric(5,2),
    profit_factor numeric(5,2),
    number_of_trades integer,
    average_trade_return numeric(5,2),
    average_win numeric(5,2),
    average_loss numeric(5,2),
    largest_win numeric(5,2),
    largest_loss numeric(5,2),
    turnover_rate numeric(5,2),
    transaction_costs numeric(20,2),
    slippage_costs numeric(20,2),
    benchmark_return numeric(5,2),
    benchmark_index character varying(50),
    excess_return numeric(5,2),
    alpha numeric(5,2),
    beta numeric(5,4),
    tracking_error numeric(5,2),
    information_ratio numeric(5,2),
    factor_loadings jsonb,
    monthly_returns jsonb,
    daily_returns jsonb,
    equity_curve jsonb,
    drawdown_curve jsonb,
    out_of_sample_performance jsonb,
    stress_test_results jsonb,
    robustness_checks jsonb,
    data_quality_issues text,
    assumptions text,
    limitations text,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE quant_backtests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.quant_backtests IS 'Historical backtest results and performance';


--
-- Name: quant_factors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quant_factors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quantitative_investment_strategies_product_id uuid NOT NULL,
    factor_name character varying(100) NOT NULL,
    factor_category character varying(50),
    factor_definition text NOT NULL,
    calculation_methodology text NOT NULL,
    data_frequency character varying(20),
    rebalancing_frequency character varying(20),
    target_exposure numeric(5,2),
    current_exposure numeric(5,2),
    exposure_range jsonb,
    historical_return numeric(5,2),
    historical_volatility numeric(5,2),
    sharpe_ratio numeric(5,2),
    information_ratio numeric(5,2),
    turnover_rate numeric(5,2),
    transaction_costs_bps integer,
    capacity_estimate numeric(20,2),
    correlation_to_other_factors jsonb,
    factor_timing_rules text,
    risk_controls jsonb,
    academic_references text,
    is_active boolean DEFAULT true,
    inception_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE quant_factors; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.quant_factors IS 'Quantitative factor definitions and exposures';


--
-- Name: quant_performance_attribution; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quant_performance_attribution (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quantitative_investment_strategies_product_id uuid NOT NULL,
    period_start_date timestamp with time zone NOT NULL,
    period_end_date timestamp with time zone NOT NULL,
    total_return numeric(5,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    factor_returns jsonb NOT NULL,
    alpha numeric(5,2),
    beta_adjusted_return numeric(5,2),
    benchmark_return numeric(5,2),
    excess_return numeric(5,2),
    transaction_costs numeric(5,2),
    management_fees numeric(5,2),
    net_return numeric(5,2),
    value_factor_return numeric(5,2),
    momentum_factor_return numeric(5,2),
    quality_factor_return numeric(5,2),
    size_factor_return numeric(5,2),
    volatility_factor_return numeric(5,2),
    carry_factor_return numeric(5,2),
    other_factor_returns jsonb,
    sector_attribution jsonb,
    geographic_attribution jsonb,
    security_selection_effect numeric(5,2),
    allocation_effect numeric(5,2),
    interaction_effect numeric(5,2),
    timing_effect numeric(5,2),
    top_contributors jsonb,
    top_detractors jsonb,
    turnover numeric(5,2),
    gross_leverage numeric(5,2),
    net_leverage numeric(5,2),
    var_95 numeric(5,2),
    expected_shortfall numeric(5,2),
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE quant_performance_attribution; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.quant_performance_attribution IS 'Performance attribution to factors';


--
-- Name: quant_risk_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quant_risk_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quantitative_investment_strategies_product_id uuid NOT NULL,
    calculation_date timestamp with time zone NOT NULL,
    portfolio_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    gross_leverage numeric(5,2),
    net_leverage numeric(5,2),
    long_exposure numeric(5,2),
    short_exposure numeric(5,2),
    net_exposure numeric(5,2),
    var_95_1day numeric(20,2),
    var_99_1day numeric(20,2),
    expected_shortfall_95 numeric(20,2),
    volatility_20day numeric(5,2),
    volatility_60day numeric(5,2),
    beta_to_market numeric(5,4),
    correlation_to_market numeric(5,4),
    tracking_error numeric(5,2),
    max_drawdown_current numeric(5,2),
    days_in_drawdown integer,
    concentration_risk jsonb,
    factor_exposures jsonb,
    sector_exposures jsonb,
    geographic_exposures jsonb,
    currency_exposures jsonb,
    liquidity_score integer,
    estimated_liquidation_time_days integer,
    stress_test_scenarios jsonb,
    position_limits_breached jsonb,
    risk_budget_utilization jsonb,
    correlation_breakdown boolean DEFAULT false,
    regime_detection character varying(50),
    tail_risk_indicators jsonb,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE quant_risk_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.quant_risk_metrics IS 'Daily risk monitoring and metrics';


--
-- Name: quant_signals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quant_signals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quantitative_investment_strategies_product_id uuid NOT NULL,
    signal_timestamp timestamp with time zone NOT NULL,
    signal_type character varying(50) NOT NULL,
    asset_class character varying(50),
    security_ticker character varying(50),
    security_name character varying(255),
    signal_strength numeric(5,2),
    confidence_level numeric(5,2),
    recommended_action character varying(50),
    recommended_position_size numeric(20,2),
    recommended_weight numeric(5,2),
    current_position_size numeric(20,2),
    current_weight numeric(5,2),
    target_price numeric(20,8),
    stop_loss_price numeric(20,8),
    take_profit_price numeric(20,8),
    time_horizon character varying(20),
    factor_contribution jsonb,
    model_inputs jsonb,
    model_outputs jsonb,
    risk_metrics jsonb,
    execution_priority character varying(20),
    execution_deadline timestamp with time zone,
    was_executed boolean DEFAULT false,
    execution_timestamp timestamp with time zone,
    execution_price numeric(20,8),
    execution_size numeric(20,2),
    slippage numeric(20,8),
    signal_performance numeric(5,2),
    signal_status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE quant_signals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.quant_signals IS 'Trading signals and recommendations';


--
-- Name: quantitative_investment_strategies_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quantitative_investment_strategies_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    strategy_id character varying,
    strategy_name character varying,
    strategy_type character varying,
    parameters jsonb,
    underlying_assets text[],
    risk_metrics numeric,
    benchmark character varying,
    data_sources text[],
    machine_learning_flags boolean,
    currency character varying,
    inception_date timestamp with time zone,
    termination_date timestamp with time zone,
    status character varying,
    backtest_history jsonb,
    adjustment_history jsonb,
    performance_attribution jsonb,
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: quantitative_strategies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.quantitative_strategies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    strategy_id character varying(50),
    strategy_name text,
    strategy_type character varying(100),
    parameters jsonb,
    underlying_assets text[],
    risk_metrics jsonb,
    benchmark text,
    data_sources text[],
    machine_learning_flags boolean,
    currency character varying(10),
    inception_date timestamp with time zone,
    termination_date timestamp with time zone,
    status character varying(50),
    backtest_history jsonb,
    adjustment_history jsonb,
    performance_attribution jsonb,
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: ramp_network_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ramp_network_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid,
    api_key_encrypted text NOT NULL,
    host_app_name text NOT NULL,
    host_logo_url text NOT NULL,
    enabled_flows text[] DEFAULT ARRAY['ONRAMP'::text, 'OFFRAMP'::text] NOT NULL,
    environment text DEFAULT 'production'::text NOT NULL,
    webhook_secret_encrypted text,
    configuration jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ramp_network_config_environment_check CHECK ((environment = ANY (ARRAY['staging'::text, 'production'::text])))
);


--
-- Name: TABLE ramp_network_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ramp_network_config IS 'RAMP Network API configuration per organization';


--
-- Name: ramp_supported_assets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ramp_supported_assets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    symbol text NOT NULL,
    name text NOT NULL,
    chain text NOT NULL,
    type text NOT NULL,
    address text,
    logo_url text,
    enabled boolean DEFAULT true NOT NULL,
    hidden boolean DEFAULT false NOT NULL,
    decimals integer NOT NULL,
    price_data jsonb,
    currency_code text DEFAULT 'USD'::text NOT NULL,
    min_purchase_amount numeric(20,8),
    max_purchase_amount numeric(20,8),
    min_purchase_crypto_amount text,
    network_fee numeric(20,8),
    flow_type text NOT NULL,
    last_updated timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ramp_supported_assets_flow_type_check CHECK ((flow_type = ANY (ARRAY['onramp'::text, 'offramp'::text, 'both'::text])))
);


--
-- Name: TABLE ramp_supported_assets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ramp_supported_assets IS 'Cache of RAMP Network supported assets with pricing and limits';


--
-- Name: ramp_transaction_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ramp_transaction_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_id uuid NOT NULL,
    event_type text NOT NULL,
    event_data jsonb NOT NULL,
    ramp_event_id text,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    session_id text,
    user_agent text,
    ip_address inet
);


--
-- Name: TABLE ramp_transaction_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ramp_transaction_events IS 'Detailed event tracking for RAMP Network transactions';


--
-- Name: ramp_webhook_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ramp_webhook_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    event_id text NOT NULL,
    event_type text NOT NULL,
    flow_type text NOT NULL,
    payload jsonb NOT NULL,
    processing_status text DEFAULT 'pending'::text NOT NULL,
    error_message text,
    processed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ramp_webhook_events_flow_type_check CHECK ((flow_type = ANY (ARRAY['onramp'::text, 'offramp'::text]))),
    CONSTRAINT ramp_webhook_events_processing_status_check CHECK ((processing_status = ANY (ARRAY['pending'::text, 'processed'::text, 'failed'::text])))
);


--
-- Name: TABLE ramp_webhook_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ramp_webhook_events IS 'Stores RAMP Network webhook events for audit and processing tracking';


--
-- Name: real_estate_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.real_estate_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    property_id character varying(50),
    property_name text,
    property_address text,
    property_type character varying(100),
    acquisition_date timestamp with time zone,
    building text,
    unit text,
    area_type character varying(50),
    units numeric,
    lease_number character varying(50),
    tenant text,
    lease_begin_date timestamp with time zone,
    lease_end_date timestamp with time zone,
    lease_manager text,
    lease_classification character varying(50),
    borrowing_rate numeric,
    asset_number character varying(50),
    gross_amount numeric,
    taxable_amount numeric,
    billing_frequency character varying(50),
    starting_date timestamp with time zone,
    ending_date timestamp with time zone,
    status character varying(50),
    disposition_date timestamp with time zone,
    geographic_location text,
    development_stage character varying(100),
    environmental_certs text[],
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: rec_price_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.rec_price_cache (
    cache_id uuid DEFAULT gen_random_uuid() NOT NULL,
    date date NOT NULL,
    price numeric NOT NULL,
    market_type character varying(50) NOT NULL,
    region character varying(50) NOT NULL,
    source character varying(100) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: recent_address_selections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.recent_address_selections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    project_id uuid,
    address text NOT NULL,
    selected_at timestamp with time zone DEFAULT now() NOT NULL,
    context text DEFAULT 'transfer_tab'::text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT recent_address_selections_address_check CHECK ((address ~* '^0x[a-fA-F0-9]{40}$'::text))
);


--
-- Name: TABLE recent_address_selections; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.recent_address_selections IS 'Tracks addresses selected by users in transfer UI for showing recent addresses';


--
-- Name: redemption_analytics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_analytics (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_window_id uuid NOT NULL,
    total_eligible_tokens numeric(78,18) DEFAULT 0,
    total_requested_tokens numeric(78,18) DEFAULT 0,
    total_approved_tokens numeric(78,18) DEFAULT 0,
    total_processed_tokens numeric(78,18) DEFAULT 0,
    eligible_investors integer DEFAULT 0,
    participating_investors integer DEFAULT 0,
    average_request_size numeric(78,18) DEFAULT 0,
    median_request_size numeric(78,18) DEFAULT 0,
    average_processing_time interval,
    pro_rata_factor_applied numeric(5,4) DEFAULT 1.0000,
    total_fees_collected numeric(78,18) DEFAULT 0,
    calculated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE redemption_analytics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_analytics IS 'Real-time analytics and metrics for redemption window performance tracking';


--
-- Name: redemption_approvers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_approvers (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_id uuid NOT NULL,
    name text NOT NULL,
    role text NOT NULL,
    avatar_url text,
    approved boolean DEFAULT false NOT NULL,
    approved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    approver_id text NOT NULL,
    status text DEFAULT 'pending'::text,
    comments text,
    decision_date timestamp with time zone,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT redemption_approvers_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text, 'delegated'::text])))
);


--
-- Name: TABLE redemption_approvers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_approvers IS 'Comprehensive approval tracking for redemption requests with multi-signature workflow support';


--
-- Name: COLUMN redemption_approvers.approver_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_approvers.approver_id IS 'ID of the user who needs to approve this request';


--
-- Name: COLUMN redemption_approvers.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_approvers.status IS 'Current approval status: pending, approved, rejected, delegated';


--
-- Name: COLUMN redemption_approvers.comments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_approvers.comments IS 'Optional comments from the approver';


--
-- Name: COLUMN redemption_approvers.decision_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_approvers.decision_date IS 'When the approval decision was made';


--
-- Name: COLUMN redemption_approvers.updated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_approvers.updated_at IS 'Last update timestamp, automatically maintained';


--
-- Name: redemption_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_notifications (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_window_id uuid NOT NULL,
    user_id uuid NOT NULL,
    notification_type text NOT NULL,
    title text NOT NULL,
    message text NOT NULL,
    is_read boolean DEFAULT false,
    sent_at timestamp with time zone DEFAULT now(),
    read_at timestamp with time zone,
    CONSTRAINT chk_notifications_type CHECK ((notification_type = ANY (ARRAY['window_opening'::text, 'window_closing'::text, 'request_approved'::text, 'request_rejected'::text, 'processing_complete'::text, 'settlement_ready'::text])))
);


--
-- Name: TABLE redemption_notifications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_notifications IS 'User notifications related to redemption windows and request status changes';


--
-- Name: redemption_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_requests (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_amount numeric NOT NULL,
    token_type text NOT NULL,
    redemption_type text NOT NULL,
    status text NOT NULL,
    source_wallet_address text NOT NULL,
    destination_wallet_address text NOT NULL,
    conversion_rate numeric NOT NULL,
    investor_name text,
    investor_id text,
    required_approvals integer DEFAULT 1 NOT NULL,
    is_bulk_redemption boolean DEFAULT false,
    investor_count integer DEFAULT 1,
    rejection_reason text,
    rejected_by text,
    rejection_timestamp timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    project_id uuid,
    organization_id uuid,
    eligibility_check_id uuid,
    window_id uuid,
    distribution_ids uuid[] DEFAULT '{}'::uuid[],
    validation_results jsonb DEFAULT '{}'::jsonb,
    business_rules_version text DEFAULT '1.0'::text,
    token_symbol text,
    distribution_id uuid,
    distribution_date timestamp with time zone,
    distribution_tx_hash text,
    usdc_amount numeric,
    redemption_window_id uuid,
    requested_by uuid,
    approved_by uuid,
    processed_by uuid,
    priority_level integer DEFAULT 1,
    estimated_processing_time interval,
    actual_processing_time interval,
    compliance_status text DEFAULT 'pending'::text,
    redemption_fee numeric(78,18) DEFAULT 0,
    net_redemption_amount numeric(78,18),
    pro_rata_adjustment numeric(78,18) DEFAULT 0,
    auto_execute_transfer boolean DEFAULT true,
    execution_mode public.execution_mode DEFAULT 'automatic'::public.execution_mode,
    transfer_execution_triggered_at timestamp with time zone,
    transfer_execution_triggered_by uuid,
    transfer_execution_method text,
    CONSTRAINT chk_redemption_requests_compliance_status CHECK ((compliance_status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text, 'requires_review'::text]))),
    CONSTRAINT chk_redemption_requests_priority_level CHECK (((priority_level >= 1) AND (priority_level <= 5))),
    CONSTRAINT redemption_requests_transfer_execution_method_check CHECK ((transfer_execution_method = ANY (ARRAY['auto'::text, 'manual'::text, 'batch'::text])))
);


--
-- Name: COLUMN redemption_requests.auto_execute_transfer; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_requests.auto_execute_transfer IS 'When true, transfer executes automatically after approval';


--
-- Name: COLUMN redemption_requests.execution_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_requests.execution_mode IS 'Controls how transfer execution is triggered: automatic, manual, or batched';


--
-- Name: COLUMN redemption_requests.transfer_execution_triggered_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_requests.transfer_execution_triggered_at IS 'Timestamp when transfer execution was triggered';


--
-- Name: COLUMN redemption_requests.transfer_execution_triggered_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_requests.transfer_execution_triggered_by IS 'User who triggered the transfer execution';


--
-- Name: COLUMN redemption_requests.transfer_execution_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_requests.transfer_execution_method IS 'Method used to trigger: auto, manual, or batch';


--
-- Name: stablecoin_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stablecoin_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    asset_name character varying(255),
    asset_symbol character varying(50),
    asset_type character varying(100),
    issuer character varying(255),
    blockchain_network character varying(100),
    smart_contract_address character varying(255),
    issuance_date timestamp with time zone,
    total_supply numeric(18,8),
    circulating_supply numeric(18,8),
    peg_value numeric(10,4),
    fractionalization_enabled boolean DEFAULT true,
    compliance_rules text,
    collateral_type character varying(50),
    collateral_ratio numeric(5,2),
    overcollateralization_threshold numeric(5,2),
    liquidation_terms text,
    stability_mechanism text,
    rebase_frequency character varying(50),
    algorithm_description text,
    provenance_history_enabled boolean DEFAULT true,
    collateral_type_enum character varying(50),
    reserve_management_policy text,
    audit_frequency character varying(50),
    redemption_mechanism text,
    depeg_risk_mitigation text[],
    status character varying(50),
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    embedded_rights text,
    reserve_assets text[],
    reserve_audit_frequency character varying,
    reserve_custodian character varying,
    reserve_insurance boolean,
    collateral_assets text[],
    minimum_collateralization_ratio numeric,
    liquidation_penalty numeric,
    oracle_provider character varying,
    interest_rate numeric,
    commodity_type character varying,
    storage_provider character varying,
    physical_redemption boolean,
    redemption_fee numeric,
    audit_provider character varying,
    algorithm_type character varying,
    secondary_token_symbol character varying,
    expansion_mechanism character varying,
    contraction_mechanism character varying,
    governance_token character varying,
    rebase_oracle character varying,
    positive_rebase_limit numeric,
    negative_rebase_limit numeric,
    rebase_governance character varying
);


--
-- Name: structured_products; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.structured_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    product_id text,
    product_name text,
    issuer text,
    underlying_assets text[],
    payoff_structure character varying(100),
    barrier_level numeric,
    coupon_rate numeric,
    strike_price numeric,
    protection_level numeric,
    currency character varying(10),
    nominal_amount numeric,
    risk_indicators numeric,
    issue_date timestamp with time zone,
    maturity_date timestamp with time zone,
    status character varying(50),
    event_history jsonb,
    redemption_date timestamp with time zone,
    valuation_history jsonb,
    monitoring_triggers jsonb,
    target_raise numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    target_audience character varying,
    distribution_strategy character varying,
    risk_rating integer,
    complex_features jsonb
);


--
-- Name: redemption_rules_with_product_details; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.redemption_rules_with_product_details AS
 WITH product_details AS (
         SELECT rr_1.id AS redemption_rule_id,
            'asset_backed_products'::text AS product_table,
            to_jsonb(abp.*) AS product_details,
            abp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.asset_backed_products abp ON ((rr_1.product_id = abp.id)))
          WHERE (rr_1.product_type = 'receivables'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'bond_products'::text AS product_table,
            to_jsonb(bp.*) AS product_details,
            bp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.bond_products bp ON ((rr_1.product_id = bp.id)))
          WHERE (rr_1.product_type = 'bonds'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'collectibles_products'::text AS product_table,
            to_jsonb(cp.*) AS product_details,
            cp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.collectibles_products cp ON ((rr_1.product_id = cp.id)))
          WHERE (rr_1.product_type = 'collectibles'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'commodities_products'::text AS product_table,
            to_jsonb(cop.*) AS product_details,
            cop.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.commodities_products cop ON ((rr_1.product_id = cop.id)))
          WHERE (rr_1.product_type = 'commodities'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'digital_tokenized_fund_products'::text AS product_table,
            to_jsonb(dtfp.*) AS product_details,
            dtfp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.digital_tokenized_fund_products dtfp ON ((rr_1.product_id = dtfp.id)))
          WHERE (rr_1.product_type = 'digital_tokenised_fund'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'energy_products'::text AS product_table,
            to_jsonb(ep.*) AS product_details,
            ep.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.energy_products ep ON ((rr_1.product_id = ep.id)))
          WHERE (rr_1.product_type = ANY (ARRAY['energy'::text, 'solar_wind_climate'::text]))
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'equity_products'::text AS product_table,
            to_jsonb(eqp.*) AS product_details,
            eqp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.equity_products eqp ON ((rr_1.product_id = eqp.id)))
          WHERE (rr_1.product_type = 'equity'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'fund_products'::text AS product_table,
            to_jsonb(fp.*) AS product_details,
            fp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.fund_products fp ON ((rr_1.product_id = fp.id)))
          WHERE (rr_1.product_type = 'funds_etfs_etps'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'infrastructure_products'::text AS product_table,
            to_jsonb(ip.*) AS product_details,
            ip.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.infrastructure_products ip ON ((rr_1.product_id = ip.id)))
          WHERE (rr_1.product_type = 'infrastructure'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'private_debt_products'::text AS product_table,
            to_jsonb(pdp.*) AS product_details,
            pdp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.private_debt_products pdp ON ((rr_1.product_id = pdp.id)))
          WHERE (rr_1.product_type = 'private_debt'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'private_equity_products'::text AS product_table,
            to_jsonb(pep.*) AS product_details,
            pep.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.private_equity_products pep ON ((rr_1.product_id = pep.id)))
          WHERE (rr_1.product_type = 'private_equity'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'quantitative_investment_strategies_products'::text AS product_table,
            to_jsonb(qisp.*) AS product_details,
            qisp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.quantitative_investment_strategies_products qisp ON ((rr_1.product_id = qisp.id)))
          WHERE (rr_1.product_type = 'quantitative_investment_strategies'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'real_estate_products'::text AS product_table,
            to_jsonb(rep.*) AS product_details,
            rep.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.real_estate_products rep ON ((rr_1.product_id = rep.id)))
          WHERE (rr_1.product_type = 'real_estate'::text)
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'stablecoin_products'::text AS product_table,
            to_jsonb(sp.*) AS product_details,
            sp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.stablecoin_products sp ON ((rr_1.product_id = sp.id)))
          WHERE (rr_1.product_type = ANY (ARRAY['fiat_backed_stablecoin'::text, 'crypto_backed_stablecoin'::text, 'commodity_backed_stablecoin'::text, 'algorithmic_stablecoin'::text, 'rebasing_stablecoin'::text]))
        UNION ALL
         SELECT rr_1.id AS redemption_rule_id,
            'structured_products'::text AS product_table,
            to_jsonb(stp.*) AS product_details,
            stp.target_raise AS product_target_raise
           FROM (public.redemption_rules rr_1
             JOIN public.structured_products stp ON ((rr_1.product_id = stp.id)))
          WHERE (rr_1.product_type = 'structured_products'::text)
        ), capacity_info AS (
         SELECT rr_1.id AS redemption_rule_id,
            rc.target_raise_amount,
            rc.total_redeemed_amount,
            rc.available_capacity,
            rc.capacity_percentage
           FROM (public.redemption_rules rr_1
             CROSS JOIN LATERAL public.get_redemption_capacity(rr_1.id) rc(target_raise_amount, total_redeemed_amount, available_capacity, capacity_percentage))
        )
 SELECT rr.id,
    rr.rule_id,
    rr.redemption_type,
    rr.require_multi_sig_approval,
    rr.required_approvers,
    rr.total_approvers,
    rr.notify_investors,
    rr.settlement_method,
    rr.immediate_execution,
    rr.use_latest_nav,
    rr.allow_any_time_redemption,
    rr.repurchase_frequency,
    rr.lock_up_period,
    rr.submission_window_days,
    rr.lock_tokens_on_request,
    rr.use_window_nav,
    rr.enable_pro_rata_distribution,
    rr.queue_unprocessed_requests,
    rr.enable_admin_override,
    rr.created_at,
    rr.updated_at,
    rr.project_id,
    rr.organization_id,
    rr.product_type,
    rr.product_id,
    rr.is_redemption_open,
    rr.open_after_date,
    rr.allow_continuous_redemption,
    rr.max_redemption_percentage,
    rr.redemption_eligibility_rules,
    rr.target_raise_amount,
    p.name AS project_name,
    p.project_type,
    pd.product_table,
    pd.product_details,
        CASE
            WHEN (pd.product_table = 'bond_products'::text) THEN (pd.product_details ->> 'issuer_name'::text)
            WHEN (pd.product_table = 'equity_products'::text) THEN (pd.product_details ->> 'company_name'::text)
            WHEN (pd.product_table = 'fund_products'::text) THEN (pd.product_details ->> 'fund_name'::text)
            WHEN (pd.product_table = 'stablecoin_products'::text) THEN (pd.product_details ->> 'asset_name'::text)
            WHEN (pd.product_table = 'real_estate_products'::text) THEN (pd.product_details ->> 'property_name'::text)
            WHEN (pd.product_table = 'energy_products'::text) THEN (pd.product_details ->> 'project_name'::text)
            WHEN (pd.product_table = 'commodities_products'::text) THEN (pd.product_details ->> 'commodity_name'::text)
            WHEN (pd.product_table = 'private_equity_products'::text) THEN (pd.product_details ->> 'fund_name'::text)
            ELSE (pd.product_details ->> 'name'::text)
        END AS product_name,
    COALESCE((pd.product_details ->> 'status'::text), (pd.product_details ->> 'product_status'::text)) AS product_status,
    COALESCE((pd.product_details ->> 'currency'::text), (pd.product_details ->> 'base_currency'::text)) AS product_currency,
    COALESCE(pd.product_target_raise, rr.target_raise_amount) AS effective_target_raise,
    ci.total_redeemed_amount,
    ci.available_capacity,
    ci.capacity_percentage,
        CASE
            WHEN (rr.target_raise_amount IS NULL) THEN 'NO_LIMIT'::text
            WHEN (ci.capacity_percentage >= (100)::numeric) THEN 'FULLY_REDEEMED'::text
            WHEN (ci.capacity_percentage >= (90)::numeric) THEN 'NEAR_CAPACITY'::text
            WHEN (ci.capacity_percentage >= (50)::numeric) THEN 'MODERATE_USAGE'::text
            ELSE 'LOW_USAGE'::text
        END AS capacity_status
   FROM (((public.redemption_rules rr
     JOIN public.projects p ON ((rr.project_id = p.id)))
     LEFT JOIN product_details pd ON ((rr.id = pd.redemption_rule_id)))
     LEFT JOIN capacity_info ci ON ((rr.id = ci.redemption_rule_id)))
  ORDER BY rr.created_at DESC;


--
-- Name: redemption_settlements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_settlements (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_request_id uuid NOT NULL,
    settlement_type text NOT NULL,
    status text DEFAULT 'initiated'::text NOT NULL,
    token_contract_address text NOT NULL,
    token_amount numeric(78,18) NOT NULL,
    burn_transaction_hash text,
    burn_gas_used bigint,
    burn_gas_price numeric(78,18),
    burn_status text DEFAULT 'pending'::text,
    burn_confirmed_at timestamp with time zone,
    transfer_amount numeric(78,18) NOT NULL,
    transfer_currency text DEFAULT 'USDC'::text NOT NULL,
    transfer_to_address text NOT NULL,
    transfer_transaction_hash text,
    transfer_gas_used bigint,
    transfer_gas_price numeric(78,18),
    transfer_status text DEFAULT 'pending'::text,
    transfer_confirmed_at timestamp with time zone,
    nav_used numeric(18,6),
    exchange_rate numeric(18,6),
    settlement_fee numeric(78,18) DEFAULT 0,
    gas_estimate numeric(78,18),
    estimated_completion timestamp with time zone,
    actual_completion timestamp with time zone,
    error_message text,
    retry_count integer DEFAULT 0,
    last_retry_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    project_id uuid,
    organization_id uuid,
    CONSTRAINT positive_token_amount CHECK ((token_amount > (0)::numeric)),
    CONSTRAINT positive_transfer_amount CHECK ((transfer_amount > (0)::numeric)),
    CONSTRAINT redemption_settlements_burn_status_check CHECK ((burn_status = ANY (ARRAY['pending'::text, 'confirmed'::text, 'failed'::text]))),
    CONSTRAINT redemption_settlements_settlement_type_check CHECK ((settlement_type = ANY (ARRAY['standard'::text, 'interval_fund'::text, 'emergency'::text]))),
    CONSTRAINT redemption_settlements_status_check CHECK ((status = ANY (ARRAY['initiated'::text, 'burning_tokens'::text, 'transferring_funds'::text, 'confirming'::text, 'completed'::text, 'failed'::text, 'cancelled'::text]))),
    CONSTRAINT redemption_settlements_transfer_status_check CHECK ((transfer_status = ANY (ARRAY['pending'::text, 'confirmed'::text, 'failed'::text]))),
    CONSTRAINT valid_retry_count CHECK ((retry_count >= 0))
);


--
-- Name: TABLE redemption_settlements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_settlements IS 'Tracks settlement processing for redemption requests including token burning and fund transfers';


--
-- Name: redemption_system_health; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.redemption_system_health AS
 SELECT count(DISTINCT rr.project_id) AS projects_with_rules,
    count(*) AS total_rules,
    count(*) FILTER (WHERE (rr.is_redemption_open = true)) AS open_redemption_projects,
    count(*) FILTER (WHERE (rr.allow_continuous_redemption = true)) AS continuous_redemption_projects,
    0 AS active_windows,
    COALESCE(count(DISTINCT re.investor_id), (0)::bigint) AS eligible_investors,
    COALESCE(sum(re.total_max_redeemable), (0)::numeric) AS total_redeemable_amount
   FROM (public.redemption_rules rr
     LEFT JOIN public.active_redemption_opportunities re ON ((re.project_id = rr.project_id)));


--
-- Name: redemption_window_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_window_templates (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    name text NOT NULL,
    description text,
    submission_date_mode text DEFAULT 'fixed'::text NOT NULL,
    processing_date_mode text DEFAULT 'fixed'::text NOT NULL,
    lockup_days integer DEFAULT 0,
    processing_offset_days integer DEFAULT 1 NOT NULL,
    default_nav_source text DEFAULT 'manual'::text,
    default_enable_pro_rata_distribution boolean DEFAULT true,
    default_auto_process boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_by uuid,
    project_id uuid,
    organization_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT chk_templates_lockup_days_non_negative CHECK ((lockup_days >= 0)),
    CONSTRAINT chk_templates_processing_offset_non_negative CHECK ((processing_offset_days >= 0))
);


--
-- Name: TABLE redemption_window_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_window_templates IS 'Templates for creating standardized redemption windows with predefined configurations';


--
-- Name: redemption_windows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.redemption_windows (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone NOT NULL,
    submission_start_date timestamp with time zone NOT NULL,
    submission_end_date timestamp with time zone NOT NULL,
    nav numeric(18,6),
    nav_date date,
    nav_source text,
    status text DEFAULT 'upcoming'::text NOT NULL,
    max_redemption_amount numeric(78,18),
    current_requests integer DEFAULT 0,
    total_request_value numeric(78,18) DEFAULT 0,
    approved_requests integer DEFAULT 0,
    approved_value numeric(78,18) DEFAULT 0,
    rejected_requests integer DEFAULT 0,
    rejected_value numeric(78,18) DEFAULT 0,
    queued_requests integer DEFAULT 0,
    queued_value numeric(78,18) DEFAULT 0,
    processed_by uuid,
    processed_at timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    project_id uuid,
    organization_id uuid,
    submission_date_mode public.submission_date_mode_enum DEFAULT 'fixed'::public.submission_date_mode_enum NOT NULL,
    processing_date_mode public.processing_date_mode_enum DEFAULT 'fixed'::public.processing_date_mode_enum NOT NULL,
    lockup_days integer,
    processing_offset_days integer DEFAULT 1 NOT NULL,
    name text,
    enable_pro_rata_distribution boolean DEFAULT true,
    auto_process boolean DEFAULT false,
    is_active boolean DEFAULT true,
    is_template boolean DEFAULT false,
    min_redemption_amount numeric(78,18) DEFAULT 0,
    pro_rata_factor numeric(5,4) DEFAULT 1.0000,
    processing_fee_percentage numeric(5,4) DEFAULT 0.0000,
    early_redemption_penalty numeric(5,4) DEFAULT 0.0000,
    submission_status text DEFAULT 'not_started'::text,
    processing_status text DEFAULT 'pending'::text,
    last_modified_by uuid,
    last_status_change_at timestamp with time zone DEFAULT now(),
    approved_by uuid,
    approved_at timestamp with time zone,
    CONSTRAINT chk_lockup_days_non_negative CHECK ((lockup_days >= 0)),
    CONSTRAINT chk_processing_offset_days_non_negative CHECK ((processing_offset_days >= 0)),
    CONSTRAINT chk_redemption_windows_processing_status CHECK ((processing_status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'completed'::text, 'failed'::text, 'cancelled'::text]))),
    CONSTRAINT chk_redemption_windows_submission_status CHECK ((submission_status = ANY (ARRAY['not_started'::text, 'open'::text, 'closed'::text, 'extended'::text, 'cancelled'::text]))),
    CONSTRAINT positive_nav CHECK (((nav IS NULL) OR (nav > (0)::numeric))),
    CONSTRAINT redemption_windows_nav_source_check CHECK ((nav_source = ANY (ARRAY['manual'::text, 'oracle'::text, 'calculated'::text]))),
    CONSTRAINT redemption_windows_status_check CHECK ((status = ANY (ARRAY['upcoming'::text, 'submission_open'::text, 'submission_closed'::text, 'processing'::text, 'completed'::text, 'cancelled'::text]))),
    CONSTRAINT valid_submission_dates CHECK ((submission_end_date > submission_start_date)),
    CONSTRAINT valid_window_dates CHECK ((end_date > start_date))
);


--
-- Name: TABLE redemption_windows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.redemption_windows IS 'Specific instances of redemption windows for interval funds';


--
-- Name: COLUMN redemption_windows.project_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.project_id IS 'project_id';


--
-- Name: COLUMN redemption_windows.submission_date_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.submission_date_mode IS 'Mode for submission dates: "fixed" (use specific dates) or "relative" (days after issuance)';


--
-- Name: COLUMN redemption_windows.processing_date_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.processing_date_mode IS 'Mode for processing dates: "fixed" (use specific dates), "same_day" (same as submission), or "offset" (submission + offset days)';


--
-- Name: COLUMN redemption_windows.lockup_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.lockup_days IS 'Number of days after issuance when redemption submissions can begin (0 = same day)';


--
-- Name: COLUMN redemption_windows.processing_offset_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.processing_offset_days IS 'Number of days after submission period for processing (default 1 = next day)';


--
-- Name: COLUMN redemption_windows.enable_pro_rata_distribution; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.enable_pro_rata_distribution IS 'Enable proportional distribution when redemption demand exceeds capacity';


--
-- Name: COLUMN redemption_windows.auto_process; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.auto_process IS 'Automatically process approved redemption requests without manual intervention';


--
-- Name: COLUMN redemption_windows.submission_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.submission_status IS 'Current status of the submission period (not_started, open, closed, extended, cancelled)';


--
-- Name: COLUMN redemption_windows.processing_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.redemption_windows.processing_status IS 'Current status of the processing phase (pending, in_progress, completed, failed, cancelled)';


--
-- Name: regulatory_equivalence_mapping; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.regulatory_equivalence_mapping (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    home_jurisdiction character(2) NOT NULL,
    equivalent_jurisdiction character(2) NOT NULL,
    equivalence_type text NOT NULL,
    regulatory_framework text NOT NULL,
    recognition_date date NOT NULL,
    expiry_date date,
    mutual_recognition boolean DEFAULT false,
    passport_rights boolean DEFAULT false,
    simplified_procedures boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: regulatory_exemptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.regulatory_exemptions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    region text NOT NULL,
    country text NOT NULL,
    exemption_type text NOT NULL,
    explanation text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT regulatory_exemptions_region_check CHECK ((region = ANY (ARRAY['Americas'::text, 'Europe'::text, 'Asia-Pacific'::text])))
);


--
-- Name: regulatory_registrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.regulatory_registrations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    type text NOT NULL,
    registration_number text,
    issued_by text,
    issued_at timestamp with time zone,
    expires_at timestamp with time zone,
    status text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: regulatory_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.regulatory_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    type text NOT NULL,
    jurisdiction text NOT NULL,
    reporting_period_start timestamp with time zone NOT NULL,
    reporting_period_end timestamp with time zone NOT NULL,
    compliance_status jsonb,
    violations jsonb[],
    remediation_actions jsonb[],
    attestation jsonb,
    submission_details jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE regulatory_reports; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.regulatory_reports IS 'Regulatory compliance reports for various jurisdictions';


--
-- Name: remediation_actions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.remediation_actions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    violation_id text NOT NULL,
    action_description text NOT NULL,
    status text,
    completion_date timestamp with time zone,
    responsible_party text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT remediation_actions_status_check CHECK ((status = ANY (ARRAY['planned'::text, 'in-progress'::text, 'completed'::text])))
);


--
-- Name: renewable_energy_credits; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.renewable_energy_credits (
    rec_id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_id uuid,
    quantity integer NOT NULL,
    vintage_year integer NOT NULL,
    market_type character varying(50) NOT NULL,
    price_per_rec numeric(10,2) NOT NULL,
    total_value numeric(15,2) NOT NULL,
    certification character varying(100),
    status character varying(50) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    receivable_id uuid,
    incentive_id uuid,
    project_id uuid
);


--
-- Name: TABLE renewable_energy_credits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.renewable_energy_credits IS 'Renewable Energy Credits with optional link to climate_incentives';


--
-- Name: COLUMN renewable_energy_credits.receivable_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.renewable_energy_credits.receivable_id IS 'Optional link to climate receivable - allows RECs to be associated with specific receivables';


--
-- Name: COLUMN renewable_energy_credits.incentive_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.renewable_energy_credits.incentive_id IS 'Links to climate_incentives.incentive_id for synchronized records';


--
-- Name: COLUMN renewable_energy_credits.project_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.renewable_energy_credits.project_id IS 'Links to projects.id for project-based filtering';


--
-- Name: restriction_statistics; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.restriction_statistics AS
 SELECT count(*) AS total_rules,
    count(*) FILTER (WHERE (onboarding_restrictions.active = true)) AS active_rules,
    count(*) FILTER (WHERE ((onboarding_restrictions.type = 'COUNTRY'::text) AND (onboarding_restrictions.active = true))) AS blocked_countries,
    count(*) FILTER (WHERE ((onboarding_restrictions.type = 'INVESTOR_TYPE'::text) AND (onboarding_restrictions.active = true))) AS blocked_investor_types
   FROM public.onboarding_restrictions;


--
-- Name: restriction_validation_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.restriction_validation_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    transaction_hash text,
    validation_result boolean NOT NULL,
    failed_rules jsonb DEFAULT '[]'::jsonb,
    warnings jsonb DEFAULT '[]'::jsonb,
    validated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE restriction_validation_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.restriction_validation_logs IS 'Logs all restriction validation attempts for compliance and auditing';


--
-- Name: ripple_dex_orders; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_dex_orders (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    account character varying(50) NOT NULL,
    sequence integer NOT NULL,
    taker_pays jsonb NOT NULL,
    taker_gets jsonb NOT NULL,
    quality numeric(30,15),
    expiration integer,
    book_node character varying(64),
    owner_node character varying(64),
    previous_txn_id character varying(64),
    previous_txn_lgr integer,
    status character varying(20) DEFAULT 'open'::character varying,
    filled_amount numeric(30,15) DEFAULT 0,
    network_type character varying(20) NOT NULL,
    owner_id uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_dex_orders_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_dex_orders_status_check CHECK (((status)::text = ANY (ARRAY[('open'::character varying)::text, ('filled'::character varying)::text, ('partially_filled'::character varying)::text, ('cancelled'::character varying)::text, ('expired'::character varying)::text])))
);


--
-- Name: TABLE ripple_dex_orders; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_dex_orders IS 'DEX order book entries';


--
-- Name: ripple_escrows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_escrows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    account character varying(50) NOT NULL,
    destination character varying(50) NOT NULL,
    amount numeric(30,15) NOT NULL,
    condition character varying(255),
    cancel_after integer,
    finish_after integer,
    destination_tag integer,
    source_tag integer,
    owner character varying(50) NOT NULL,
    escrow_id character varying(64),
    prev_txn_id character varying(64),
    status character varying(20) DEFAULT 'created'::character varying,
    network_type character varying(20) NOT NULL,
    owner_id uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_escrows_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_escrows_status_check CHECK (((status)::text = ANY (ARRAY[('created'::character varying)::text, ('held'::character varying)::text, ('finished'::character varying)::text, ('cancelled'::character varying)::text])))
);


--
-- Name: TABLE ripple_escrows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_escrows IS 'Time-locked and conditional escrow transactions';


--
-- Name: ripple_issuers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_issuers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    address character varying(50) NOT NULL,
    name character varying(100),
    domain character varying(255),
    email_hash character varying(64),
    verified boolean DEFAULT false,
    trust_level integer DEFAULT 0,
    network_type character varying(20) NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_issuers_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_issuers_trust_level_check CHECK (((trust_level >= 0) AND (trust_level <= 10)))
);


--
-- Name: TABLE ripple_issuers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_issuers IS 'Known and verified token issuers on XRP Ledger';


--
-- Name: ripple_multisig_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_multisig_accounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    address character varying(50) NOT NULL,
    signer_list jsonb NOT NULL,
    quorum integer NOT NULL,
    signers text[] NOT NULL,
    regular_key character varying(50),
    master_key_disabled boolean DEFAULT false,
    sequence integer DEFAULT 0,
    network_type character varying(20) NOT NULL,
    owner_id uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_multisig_accounts_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_multisig_accounts_quorum_check CHECK ((quorum > 0))
);


--
-- Name: TABLE ripple_multisig_accounts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_multisig_accounts IS 'Multi-signature account configurations';


--
-- Name: ripple_multisig_proposals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_multisig_proposals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    account character varying(50) NOT NULL,
    transaction jsonb NOT NULL,
    signatures jsonb DEFAULT '[]'::jsonb,
    status character varying(20) DEFAULT 'pending'::character varying,
    expires_at timestamp with time zone NOT NULL,
    execution_hash character varying(64),
    execution_ledger integer,
    cancellation_reason text,
    network_type character varying(20) NOT NULL,
    created_by uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    executed_at timestamp with time zone,
    cancelled_at timestamp with time zone,
    CONSTRAINT ripple_multisig_proposals_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_multisig_proposals_status_check CHECK (((status)::text = ANY (ARRAY[('pending'::character varying)::text, ('ready'::character varying)::text, ('executed'::character varying)::text, ('cancelled'::character varying)::text, ('expired'::character varying)::text])))
);


--
-- Name: TABLE ripple_multisig_proposals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_multisig_proposals IS 'Pending multi-sig transaction proposals';


--
-- Name: ripple_payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    hash text NOT NULL,
    from_account text NOT NULL,
    to_account text NOT NULL,
    amount numeric NOT NULL,
    currency text DEFAULT 'XRP'::text NOT NULL,
    fee numeric DEFAULT 0.000012,
    status text DEFAULT 'pending'::text NOT NULL,
    ledger_index integer,
    sequence_number integer,
    destination_tag integer,
    source_tag integer,
    memo text,
    payment_type text DEFAULT 'standard'::text,
    from_country text,
    to_country text,
    exchange_rate numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    issuer character varying(50),
    result_code character varying(50),
    invoice_id character varying(64),
    paths jsonb,
    network_type character varying(20) DEFAULT 'mainnet'::character varying NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    validated_at timestamp with time zone,
    CONSTRAINT ripple_payments_network_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text]))),
    CONSTRAINT ripple_payments_payment_type_check CHECK ((payment_type = ANY (ARRAY['standard'::text, 'cross_border'::text, 'domestic'::text]))),
    CONSTRAINT ripple_payments_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'validated'::text, 'failed'::text])))
);


--
-- Name: TABLE ripple_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_payments IS 'Ripple payment transaction history with enhanced multi-sig support';


--
-- Name: ripple_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_tokens (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    currency character varying(40) NOT NULL,
    issuer character varying(50) NOT NULL,
    name character varying(100),
    symbol character varying(20),
    decimals integer DEFAULT 15,
    logo_url text,
    verified boolean DEFAULT false,
    network_type character varying(20) NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_tokens_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text])))
);


--
-- Name: TABLE ripple_tokens; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_tokens IS 'Metadata for Ripple issued currencies (IOUs)';


--
-- Name: ripple_trust_lines; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ripple_trust_lines (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    account character varying(50) NOT NULL,
    currency character varying(40) NOT NULL,
    issuer character varying(50) NOT NULL,
    trust_limit numeric(30,15) NOT NULL,
    balance numeric(30,15) DEFAULT 0,
    quality_in integer,
    quality_out integer,
    no_ripple boolean DEFAULT false,
    "freeze" boolean DEFAULT false,
    authorized boolean DEFAULT false,
    network_type character varying(20) NOT NULL,
    owner_id uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT ripple_trust_lines_network_type_check CHECK (((network_type)::text = ANY (ARRAY[('mainnet'::character varying)::text, ('testnet'::character varying)::text, ('devnet'::character varying)::text])))
);


--
-- Name: TABLE ripple_trust_lines; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.ripple_trust_lines IS 'Account trust lines for issued currencies';


--
-- Name: risk_assessments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.risk_assessments (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id text,
    wallet_address text,
    assessment_type text NOT NULL,
    risk_level text NOT NULL,
    risk_score numeric,
    factors jsonb DEFAULT '{}'::jsonb,
    recommendations jsonb DEFAULT '{}'::jsonb,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT risk_assessments_risk_level_check CHECK ((risk_level = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text])))
);


--
-- Name: risk_thresholds; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.risk_thresholds (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    amount_high numeric,
    amount_critical numeric,
    frequency_high integer,
    frequency_critical integer,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: role_contracts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.role_contracts (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    role_id uuid NOT NULL,
    contract_roles jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: role_addresses_with_resolved_roles; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.role_addresses_with_resolved_roles AS
 SELECT ra.id AS address_id,
    ra.role_id,
    r.name AS role_name,
    ra.blockchain,
    ra.address,
    ra.signing_method,
    ra.contract_roles AS explicit_roles,
        CASE
            WHEN (jsonb_array_length(ra.contract_roles) > 0) THEN ra.contract_roles
            ELSE COALESCE(rc.contract_roles, '[]'::jsonb)
        END AS effective_roles,
        CASE
            WHEN (jsonb_array_length(ra.contract_roles) > 0) THEN 'explicit'::text
            ELSE 'inherited'::text
        END AS role_assignment_type,
    ra.created_at,
    ra.updated_at
   FROM ((public.role_addresses ra
     JOIN public.roles r ON ((r.id = ra.role_id)))
     LEFT JOIN public.role_contracts rc ON ((rc.role_id = ra.role_id)));


--
-- Name: role_permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.role_permissions (
    role_id uuid NOT NULL,
    permission_name text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: rule_conflicts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.rule_conflicts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    rule1_id uuid,
    rule2_id uuid,
    conflict_type text,
    resolution jsonb,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: rule_evaluations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.rule_evaluations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    rule_id uuid,
    passed boolean NOT NULL,
    score numeric,
    conditions jsonb,
    evaluation_time_ms integer,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.rules (
    rule_id uuid DEFAULT gen_random_uuid() NOT NULL,
    rule_name text NOT NULL,
    rule_type text NOT NULL,
    rule_details jsonb,
    created_by uuid NOT NULL,
    status text DEFAULT 'active'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    is_template boolean DEFAULT false,
    CONSTRAINT rules_created_by_uuid_check CHECK (((created_by)::text ~ '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'::text))
);


--
-- Name: sc_algorithm_parameters; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sc_algorithm_parameters (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_product_id uuid NOT NULL,
    effective_timestamp timestamp with time zone NOT NULL,
    expiration_timestamp timestamp with time zone,
    parameter_set_name character varying(100),
    algorithm_version character varying(20),
    target_peg numeric(20,8) NOT NULL,
    rebase_frequency character varying(20),
    rebase_lag integer,
    rebase_threshold_bps integer,
    max_rebase_percentage numeric(5,2),
    expansion_coefficient numeric(5,4),
    contraction_coefficient numeric(5,4),
    smoothing_factor numeric(5,4),
    oracle_source character varying(100),
    oracle_update_frequency_seconds integer,
    oracle_deviation_threshold_bps integer,
    stability_fee_rate numeric(5,4),
    liquidation_ratio numeric(5,2),
    liquidation_penalty numeric(5,2),
    minimum_collateral_ratio numeric(5,2),
    debt_ceiling numeric(20,2),
    governance_parameters jsonb,
    circuit_breaker_rules jsonb,
    coupon_issuance_rules jsonb,
    bonding_curve_parameters jsonb,
    is_active boolean DEFAULT true,
    change_reason text,
    proposed_by character varying(255),
    approval_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sc_algorithm_parameters; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sc_algorithm_parameters IS 'Algorithmic stablecoin parameters and rebase rules';


--
-- Name: sc_minting_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sc_minting_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_product_id uuid NOT NULL,
    mint_id character varying(100) NOT NULL,
    minter_address character varying(255) NOT NULL,
    mint_timestamp timestamp with time zone NOT NULL,
    minted_amount numeric(30,8) NOT NULL,
    collateral_deposited jsonb NOT NULL,
    collateral_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    minting_fee numeric(20,8),
    fee_percentage numeric(5,4),
    exchange_rate numeric(20,8),
    source_address character varying(255),
    destination_address character varying(255),
    transaction_hash character varying(255) NOT NULL,
    block_number integer,
    gas_used integer,
    gas_price_gwei numeric(10,2),
    total_gas_cost numeric(20,8),
    status character varying(20) DEFAULT 'confirmed'::character varying,
    failure_reason text,
    kyc_aml_status character varying(20),
    risk_score integer,
    is_large_mint boolean DEFAULT false,
    collateralization_ratio_after numeric(5,2),
    triggered_rebalancing boolean DEFAULT false,
    related_redemption_id character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sc_minting_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sc_minting_events IS 'New stablecoin minting events and collateral deposits';


--
-- Name: sc_peg_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sc_peg_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_product_id uuid NOT NULL,
    "timestamp" timestamp with time zone NOT NULL,
    target_peg numeric(20,8) NOT NULL,
    actual_price numeric(20,8) NOT NULL,
    deviation numeric(10,6),
    deviation_percentage numeric(5,4),
    deviation_bps integer,
    exchange character varying(50),
    trading_volume_24h numeric(20,2),
    market_cap numeric(20,2),
    currency character varying(3) DEFAULT 'USD'::character varying,
    price_source character varying(100),
    data_provider character varying(100),
    bid_price numeric(20,8),
    ask_price numeric(20,8),
    spread_bps integer,
    liquidity_depth numeric(20,2),
    is_within_acceptable_range boolean,
    acceptable_range_bps integer DEFAULT 100,
    depeg_severity character varying(20),
    market_conditions text,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sc_peg_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sc_peg_history IS 'Historical price peg tracking for stablecoins';


--
-- Name: sc_redemptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sc_redemptions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_product_id uuid NOT NULL,
    redemption_id character varying(100) NOT NULL,
    requester_address character varying(255) NOT NULL,
    request_timestamp timestamp with time zone NOT NULL,
    requested_amount numeric(30,8) NOT NULL,
    redemption_currency character varying(3) DEFAULT 'USD'::character varying,
    redemption_method character varying(50),
    processing_time_hours integer,
    completion_timestamp timestamp with time zone,
    redeemed_amount numeric(30,8),
    redemption_fee numeric(20,8),
    fee_percentage numeric(5,4),
    exchange_rate numeric(20,8),
    destination_address character varying(255),
    transaction_hash character varying(255),
    status character varying(20) DEFAULT 'pending'::character varying,
    failure_reason text,
    kyc_aml_status character varying(20),
    risk_score integer,
    is_large_redemption boolean DEFAULT false,
    triggered_reserve_action boolean DEFAULT false,
    collateral_released jsonb,
    market_impact_estimate numeric(5,4),
    related_mint_id character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sc_redemptions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sc_redemptions IS 'Stablecoin redemption transactions and requests';


--
-- Name: sc_reserve_audits; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sc_reserve_audits (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_product_id uuid NOT NULL,
    audit_date timestamp with time zone NOT NULL,
    audit_period_start timestamp with time zone NOT NULL,
    audit_period_end timestamp with time zone NOT NULL,
    auditor_name character varying(255) NOT NULL,
    auditor_type character varying(50),
    audit_type character varying(50) NOT NULL,
    total_tokens_outstanding numeric(30,8) NOT NULL,
    total_reserve_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    collateralization_ratio numeric(5,2) NOT NULL,
    reserve_breakdown jsonb NOT NULL,
    cash_and_equivalents numeric(20,2),
    short_term_deposits numeric(20,2),
    treasury_securities numeric(20,2),
    commercial_paper numeric(20,2),
    corporate_bonds numeric(20,2),
    crypto_assets numeric(20,2),
    other_assets numeric(20,2),
    custodian_breakdown jsonb,
    geographic_breakdown jsonb,
    credit_quality_breakdown jsonb,
    maturity_breakdown jsonb,
    liquidity_analysis jsonb,
    discrepancies jsonb,
    opinion character varying(50),
    key_findings text,
    audit_report_url text,
    is_publicly_disclosed boolean DEFAULT true,
    disclosure_date timestamp with time zone,
    regulatory_filing_reference character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sc_reserve_audits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sc_reserve_audits IS 'Reserve attestation and audit reports';


--
-- Name: security_audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.security_audit_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    event_type text NOT NULL,
    severity text NOT NULL,
    user_id text,
    wallet_address text,
    details jsonb DEFAULT '{}'::jsonb,
    metadata jsonb DEFAULT '{}'::jsonb,
    ip_address text,
    user_agent text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT security_audit_logs_severity_check CHECK ((severity = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text])))
);


--
-- Name: security_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.security_events (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    event_type text NOT NULL,
    severity text NOT NULL,
    user_id uuid,
    wallet_id uuid,
    wallet_address text,
    ip_address text,
    device_info text,
    transaction_hash text,
    contract_address text,
    details text,
    metadata jsonb,
    status text,
    related_events text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone
);


--
-- Name: TABLE security_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.security_events IS 'Stores security-related events and incidents across the platform';


--
-- Name: session_key_usage; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.session_key_usage (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    session_key_id uuid NOT NULL,
    user_operation_id uuid NOT NULL,
    amount_spent bigint DEFAULT 0 NOT NULL,
    target_address text NOT NULL,
    function_signature text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE session_key_usage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.session_key_usage IS 'Tracks individual session key transaction usage and spending';


--
-- Name: session_keys; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.session_keys (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    session_key_address text NOT NULL,
    public_key text NOT NULL,
    permissions jsonb DEFAULT '{}'::jsonb NOT NULL,
    validity_start timestamp with time zone NOT NULL,
    validity_end timestamp with time zone NOT NULL,
    status text DEFAULT 'active'::text,
    created_by_user_id uuid NOT NULL,
    spending_limit bigint,
    daily_limit bigint,
    allowed_targets jsonb DEFAULT '[]'::jsonb,
    allowed_functions jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    last_used_at timestamp with time zone,
    revoked_at timestamp with time zone,
    usage_count integer DEFAULT 0,
    CONSTRAINT session_keys_status_check CHECK ((status = ANY (ARRAY['active'::text, 'revoked'::text, 'expired'::text])))
);


--
-- Name: TABLE session_keys; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.session_keys IS 'Session key management for improved account abstraction UX';


--
-- Name: settlement_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.settlement_metrics (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    date date NOT NULL,
    total_settlements integer DEFAULT 0,
    successful_settlements integer DEFAULT 0,
    failed_settlements integer DEFAULT 0,
    average_processing_time interval,
    total_tokens_burned numeric(78,18) DEFAULT 0,
    total_funds_transferred numeric(78,18) DEFAULT 0,
    total_gas_used numeric(78,18) DEFAULT 0,
    total_fees_collected numeric(78,18) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE settlement_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.settlement_metrics IS 'Daily aggregated metrics for settlement processing performance';


--
-- Name: settlement_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.settlement_operations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_id uuid NOT NULL,
    token_transfer_id uuid NOT NULL,
    type text DEFAULT 'stablecoin_settlement'::text NOT NULL,
    currency text NOT NULL,
    amount text NOT NULL,
    from_wallet text NOT NULL,
    to_wallet text NOT NULL,
    status text NOT NULL,
    transaction_hash text,
    confirmations integer DEFAULT 0,
    block_number bigint,
    chain_id integer NOT NULL,
    error jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    settled_at timestamp with time zone,
    CONSTRAINT settlement_operations_currency_check CHECK ((currency = ANY (ARRAY['USDC'::text, 'USDT'::text]))),
    CONSTRAINT settlement_operations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'simulating'::text, 'approved'::text, 'broadcasting'::text, 'confirming'::text, 'confirmed'::text, 'failed'::text, 'reversed'::text])))
);


--
-- Name: TABLE settlement_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.settlement_operations IS 'Stage 11: Settlement operations (USDC/USDT payments)';


--
-- Name: settlement_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.settlement_summary AS
 SELECT rs.id,
    rs.redemption_request_id,
    rs.settlement_type,
    rs.status,
    rs.token_amount,
    rs.transfer_amount,
    rs.nav_used,
    rs.created_at,
    rs.actual_completion,
    COALESCE(rs.actual_completion, rs.estimated_completion) AS completion_time,
        CASE
            WHEN (rs.actual_completion IS NOT NULL) THEN EXTRACT(epoch FROM (rs.actual_completion - rs.created_at))
            ELSE NULL::numeric
        END AS processing_time_seconds
   FROM public.redemption_settlements rs;


--
-- Name: sidebar_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sidebar_configurations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    min_role_priority integer,
    organization_id uuid,
    configuration_data jsonb NOT NULL,
    is_active boolean DEFAULT true,
    is_default boolean DEFAULT false,
    created_by uuid,
    updated_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    target_role_ids uuid[],
    target_profile_type_enums public.profile_type[]
);


--
-- Name: TABLE sidebar_configurations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sidebar_configurations IS 'Dynamic sidebar configurations using role IDs and profile type enums (updated 2025-08-28)';


--
-- Name: COLUMN sidebar_configurations.target_role_ids; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sidebar_configurations.target_role_ids IS 'Proper UUID references to roles table (preferred)';


--
-- Name: COLUMN sidebar_configurations.target_profile_type_enums; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sidebar_configurations.target_profile_type_enums IS 'Proper enum references to profile_type (preferred)';


--
-- Name: sidebar_configurations_with_names; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.sidebar_configurations_with_names AS
 SELECT sc.id,
    sc.name,
    sc.description,
    sc.target_role_ids,
    sc.target_profile_type_enums,
    ARRAY( SELECT r.name
           FROM public.roles r
          WHERE (r.id = ANY (sc.target_role_ids))
          ORDER BY r.priority DESC) AS computed_role_names,
    sc.target_profile_type_enums AS computed_profile_types,
    sc.min_role_priority,
    sc.organization_id,
    sc.configuration_data,
    sc.is_active,
    sc.is_default,
    sc.created_by,
    sc.updated_by,
    sc.created_at,
    sc.updated_at
   FROM public.sidebar_configurations sc;


--
-- Name: VIEW sidebar_configurations_with_names; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.sidebar_configurations_with_names IS 'Sidebar configurations with computed role names and profile types (updated to use new fields 2025-08-28)';


--
-- Name: sidebar_items; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sidebar_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    item_id character varying(100) NOT NULL,
    section_id uuid,
    label character varying(255) NOT NULL,
    href character varying(500) NOT NULL,
    icon character varying(100),
    description text,
    display_order integer DEFAULT 0,
    required_permissions text[],
    required_roles text[],
    min_role_priority integer,
    profile_types text[],
    requires_project boolean DEFAULT false,
    is_visible boolean DEFAULT true,
    is_active boolean DEFAULT true,
    organization_id uuid,
    created_by uuid,
    updated_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: sidebar_sections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sidebar_sections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    section_id character varying(100) NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    display_order integer DEFAULT 0,
    required_permissions text[],
    required_roles text[],
    min_role_priority integer,
    profile_types text[],
    is_active boolean DEFAULT true,
    organization_id uuid,
    created_by uuid,
    updated_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: signature_migration_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.signature_migration_approvals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    migration_id uuid NOT NULL,
    approver_address text NOT NULL,
    signature text NOT NULL,
    approved_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE signature_migration_approvals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.signature_migration_approvals IS 'Records guardian and owner approvals for signature migrations';


--
-- Name: signature_migrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.signature_migrations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    from_scheme text NOT NULL,
    to_scheme text NOT NULL,
    new_public_key text NOT NULL,
    new_credential_id text,
    status text DEFAULT 'pending'::text NOT NULL,
    migration_hash text NOT NULL,
    required_approvals integer DEFAULT 1 NOT NULL,
    current_approvals integer DEFAULT 0 NOT NULL,
    finalize_after timestamp with time zone,
    transaction_hash text,
    migration_data jsonb DEFAULT '{}'::jsonb,
    finalized_at timestamp with time zone,
    cancelled_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT signature_migrations_from_scheme_check CHECK ((from_scheme = ANY (ARRAY['secp256k1'::text, 'secp256r1'::text]))),
    CONSTRAINT signature_migrations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'finalized'::text, 'cancelled'::text]))),
    CONSTRAINT signature_migrations_to_scheme_check CHECK ((to_scheme = ANY (ARRAY['secp256k1'::text, 'secp256r1'::text])))
);


--
-- Name: TABLE signature_migrations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.signature_migrations IS 'Tracks signature scheme migrations between secp256k1 (ECDSA) and secp256r1 (WebAuthn) with guardian approval workflow';


--
-- Name: COLUMN signature_migrations.migration_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.signature_migrations.migration_hash IS 'Cryptographic hash for signature verification and replay protection';


--
-- Name: COLUMN signature_migrations.finalize_after; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.signature_migrations.finalize_after IS 'Timestamp after which migration can be finalized (security delay)';


--
-- Name: signatures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.signatures (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    proposal_id uuid,
    signer text NOT NULL,
    signature text NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: signer_keys; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.signer_keys (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    address text NOT NULL,
    chain_type text NOT NULL,
    key_id text NOT NULL,
    is_hardware_wallet boolean DEFAULT false,
    device_type text,
    derivation_path text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT signer_keys_device_type_check CHECK ((device_type = ANY (ARRAY['ledger'::text, 'trezor'::text, 'metamask'::text, 'walletconnect'::text, 'dfns'::text, 'guardian'::text, 'internal'::text, NULL::text])))
);


--
-- Name: smart_contract_wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.smart_contract_wallets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    diamond_proxy_address text NOT NULL,
    implementation_version text NOT NULL,
    facet_registry_address text NOT NULL,
    is_deployed boolean DEFAULT false,
    deployment_tx_hash text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: sp_barrier_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_barrier_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    event_timestamp timestamp with time zone NOT NULL,
    barrier_type character varying(50) NOT NULL,
    barrier_level numeric(20,8) NOT NULL,
    observed_level numeric(20,8) NOT NULL,
    underlying_asset character varying(100),
    breach_detected boolean NOT NULL,
    breach_magnitude numeric(20,8),
    observation_method character varying(50),
    event_consequences text,
    triggered_autocall boolean DEFAULT false,
    triggered_coupon_cancellation boolean DEFAULT false,
    triggered_capital_loss boolean DEFAULT false,
    payoff_impact numeric(20,8),
    notification_required boolean DEFAULT true,
    notification_sent boolean DEFAULT false,
    investor_communication_sent boolean DEFAULT false,
    regulatory_reporting_required boolean DEFAULT false,
    is_verified boolean DEFAULT false,
    verification_source character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_barrier_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_barrier_events IS 'Barrier breach events and monitoring';


--
-- Name: sp_components; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_components (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    component_name character varying(255) NOT NULL,
    component_type character varying(50) NOT NULL,
    underlying_ticker character varying(50),
    underlying_isin character varying(50),
    underlying_cusip character varying(50),
    position_type character varying(20) NOT NULL,
    notional_amount numeric(20,2) NOT NULL,
    quantity numeric(20,6),
    currency character varying(3) DEFAULT 'USD'::character varying,
    initial_price numeric(20,8),
    current_price numeric(20,8),
    weight_percentage numeric(5,2),
    strike_price numeric(20,8),
    option_expiry timestamp with time zone,
    option_style character varying(20),
    delta numeric(5,4),
    gamma numeric(5,4),
    vega numeric(5,4),
    theta numeric(10,6),
    implied_volatility numeric(5,2),
    correlation_to_other_components jsonb,
    performance_contribution numeric(20,8),
    last_rebalance_date timestamp with time zone,
    next_rebalance_date timestamp with time zone,
    is_path_dependent boolean DEFAULT false,
    path_dependency_type character varying(50),
    status character varying(20) DEFAULT 'active'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_components; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_components IS 'Component assets within structured products';


--
-- Name: sp_coupon_schedules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_coupon_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    coupon_number integer NOT NULL,
    observation_date timestamp with time zone NOT NULL,
    payment_date timestamp with time zone NOT NULL,
    coupon_rate numeric(5,4) NOT NULL,
    notional_amount numeric(20,2) NOT NULL,
    coupon_amount numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    barrier_level numeric(5,2),
    barrier_met boolean,
    barrier_observation_value numeric(20,8),
    is_conditional boolean DEFAULT false,
    condition_description text,
    memory_coupon boolean DEFAULT false,
    accumulated_unpaid_coupons numeric(20,2),
    payment_status character varying(20) DEFAULT 'scheduled'::character varying,
    actual_payment_date timestamp with time zone,
    actual_payment_amount numeric(20,2),
    withholding_tax numeric(20,2),
    net_payment numeric(20,2),
    payment_reference character varying(100),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_coupon_schedules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_coupon_schedules IS 'Coupon payment schedules and history';


--
-- Name: sp_payoff_structures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_payoff_structures (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    structure_name character varying(255) NOT NULL,
    structure_type character varying(50) NOT NULL,
    payoff_formula text NOT NULL,
    participation_rate numeric(5,2),
    cap_rate numeric(5,2),
    floor_rate numeric(5,2),
    coupon_rate numeric(5,2),
    coupon_frequency character varying(20),
    coupon_barrier_level numeric(5,2),
    downside_protection_level numeric(5,2),
    knock_in_barrier numeric(5,2),
    knock_out_barrier numeric(5,2),
    observation_dates timestamp with time zone[],
    observation_frequency character varying(20),
    memory_feature boolean DEFAULT false,
    autocall_levels jsonb,
    worst_of_basket jsonb,
    averaging_method character varying(50),
    settlement_method character varying(20),
    payoff_scenarios jsonb,
    is_principal_protected boolean DEFAULT false,
    protection_percentage numeric(5,2),
    issuer_credit_spread numeric(5,2),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_payoff_structures; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_payoff_structures IS 'Payoff calculation rules and terms';


--
-- Name: sp_performance_tracking; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_performance_tracking (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    valuation_date timestamp with time zone NOT NULL,
    market_value numeric(20,2) NOT NULL,
    par_value numeric(20,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying,
    percentage_of_par numeric(5,2),
    accrued_coupon numeric(20,2),
    clean_price numeric(20,8),
    dirty_price numeric(20,8),
    yield_to_maturity numeric(5,4),
    duration numeric(10,4),
    convexity numeric(10,4),
    delta numeric(5,4),
    gamma numeric(5,4),
    vega numeric(5,4),
    theta numeric(10,6),
    component_performance jsonb,
    barrier_proximity jsonb,
    autocall_probability numeric(5,2),
    expected_payoff numeric(20,2),
    value_at_risk numeric(20,2),
    credit_valuation_adjustment numeric(20,2),
    funding_valuation_adjustment numeric(20,2),
    days_to_maturity integer,
    pricing_model character varying(50),
    model_assumptions jsonb,
    data_source character varying(100),
    is_estimated boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_performance_tracking; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_performance_tracking IS 'Historical performance and mark-to-market valuation';


--
-- Name: sp_redemption_features; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sp_redemption_features (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    structured_product_id uuid NOT NULL,
    feature_type character varying(50) NOT NULL,
    effective_date timestamp with time zone NOT NULL,
    expiration_date timestamp with time zone,
    call_notice_days integer,
    redemption_price numeric(20,8) NOT NULL,
    redemption_price_type character varying(50),
    trigger_condition text,
    trigger_level numeric(5,2),
    is_callable boolean DEFAULT false,
    is_puttable boolean DEFAULT false,
    call_schedule jsonb,
    call_protection_end_date timestamp with time zone,
    make_whole_provision boolean DEFAULT false,
    make_whole_formula text,
    redemption_fee numeric(5,2),
    partial_redemption_allowed boolean DEFAULT false,
    minimum_redemption_amount numeric(20,2),
    redemption_settlement_days integer,
    was_triggered boolean DEFAULT false,
    trigger_date timestamp with time zone,
    redemption_status character varying(20) DEFAULT 'inactive'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE sp_redemption_features; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sp_redemption_features IS 'Early redemption and call features';


--
-- Name: stablecoin_collateral; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stablecoin_collateral (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stablecoin_id uuid NOT NULL,
    collateral_asset character varying(255),
    backing_amount numeric(18,8),
    custodian character varying(255),
    auditor character varying(255),
    last_audit_date timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    collateral_address text,
    collateral_symbol text,
    collateral_amount numeric,
    collateral_value_usd numeric,
    liquidation_ratio numeric,
    stability_fee numeric,
    debt_ceiling numeric,
    risk_parameters jsonb,
    oracle_price numeric,
    last_oracle_update timestamp with time zone,
    total_reserves numeric,
    backing_ratio numeric
);


--
-- Name: stage_requirements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stage_requirements (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    stage_id text NOT NULL,
    name text NOT NULL,
    description text,
    status text DEFAULT 'pending'::text NOT NULL,
    completed_at timestamp with time zone,
    failure_reason text,
    "order" integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: staking_apr_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.staking_apr_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    blockchain character varying(50) NOT NULL,
    current_apr numeric(10,4) NOT NULL,
    min_apr numeric(10,4) DEFAULT 0,
    max_apr numeric(10,4) DEFAULT 100,
    commission numeric(10,4) DEFAULT 0,
    source character varying(100),
    last_updated timestamp with time zone DEFAULT now(),
    is_validated boolean DEFAULT false,
    validator_address text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE staking_apr_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.staking_apr_config IS 'Staking APR configuration by blockchain (MUST BE UPDATED FROM REAL DATA)';


--
-- Name: stock_dividends; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stock_dividends (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    equity_product_id uuid NOT NULL,
    ticker_symbol character varying(20) NOT NULL,
    ex_dividend_date timestamp with time zone NOT NULL,
    payment_date timestamp with time zone,
    record_date timestamp with time zone,
    declaration_date timestamp with time zone,
    dividend_amount numeric(20,6) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    dividend_type character varying(50),
    frequency character varying(20),
    status character varying(20) DEFAULT 'declared'::character varying,
    tax_implications jsonb,
    reinvestment_option boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE stock_dividends; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.stock_dividends IS 'Tracks dividend declarations and payments for equity products';


--
-- Name: stock_exchanges; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stock_exchanges (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    exchange_code character varying(10) NOT NULL,
    exchange_name character varying(255) NOT NULL,
    country character varying(3) NOT NULL,
    region character varying(50),
    timezone character varying(50) NOT NULL,
    trading_hours jsonb,
    currency character varying(3) NOT NULL,
    market_identifier_code character varying(4),
    website_url text,
    regulatory_body character varying(255),
    trading_calendar jsonb,
    circuit_breaker_rules jsonb,
    tick_size_rules jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE stock_exchanges; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.stock_exchanges IS 'Reference data for stock exchanges worldwide';


--
-- Name: stripe_conversion_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stripe_conversion_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    stripe_payment_intent_id character varying(255),
    stripe_session_id character varying(255),
    conversion_type character varying(20) NOT NULL,
    source_currency character varying(10) NOT NULL,
    source_amount numeric(20,8) NOT NULL,
    source_network character varying(50),
    destination_currency character varying(10) NOT NULL,
    destination_amount numeric(20,8),
    destination_network character varying(50),
    destination_wallet character varying(255),
    exchange_rate numeric(20,8),
    fees numeric(20,8),
    stripe_fee numeric(20,8),
    network_fee numeric(20,8),
    status character varying(50) DEFAULT 'pending'::character varying,
    stripe_status character varying(50),
    transaction_hash character varying(255),
    block_number bigint,
    confirmations integer DEFAULT 0,
    metadata jsonb,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT stripe_conversion_transactions_conversion_type_check CHECK (((conversion_type)::text = ANY (ARRAY[('fiat_to_crypto'::character varying)::text, ('crypto_to_fiat'::character varying)::text])))
);


--
-- Name: TABLE stripe_conversion_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.stripe_conversion_transactions IS 'Tracks FIAT to stablecoin conversion transactions and vice versa';


--
-- Name: COLUMN stripe_conversion_transactions.conversion_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.stripe_conversion_transactions.conversion_type IS 'Type of conversion: fiat_to_crypto or crypto_to_fiat';


--
-- Name: COLUMN stripe_conversion_transactions.source_currency; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.stripe_conversion_transactions.source_currency IS 'Source currency code (e.g., USD, EUR for fiat, USDC, USDB for crypto)';


--
-- Name: COLUMN stripe_conversion_transactions.destination_currency; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.stripe_conversion_transactions.destination_currency IS 'Destination currency code';


--
-- Name: COLUMN stripe_conversion_transactions.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.stripe_conversion_transactions.status IS 'Transaction status: pending, processing, completed, failed, cancelled';


--
-- Name: COLUMN stripe_conversion_transactions.stripe_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.stripe_conversion_transactions.stripe_status IS 'Stripe-specific status from payment intent or session';


--
-- Name: stripe_stablecoin_accounts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stripe_stablecoin_accounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    account_id character varying(255) NOT NULL,
    balance_usdc numeric(20,8) DEFAULT 0,
    balance_usdb numeric(20,8) DEFAULT 0,
    account_status character varying(50) DEFAULT 'active'::character varying,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE stripe_stablecoin_accounts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.stripe_stablecoin_accounts IS 'Stores Stripe stablecoin account information for users';


--
-- Name: stripe_webhook_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.stripe_webhook_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stripe_event_id character varying(255) NOT NULL,
    event_type character varying(100) NOT NULL,
    processed boolean DEFAULT false,
    data jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE stripe_webhook_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.stripe_webhook_events IS 'Stores Stripe webhook events for processing and audit trail';


--
-- Name: suspicious_activity_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.suspicious_activity_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    filing_date timestamp with time zone NOT NULL,
    suspicious_activity jsonb NOT NULL,
    involved_parties jsonb[],
    transaction_details jsonb[],
    narrative text,
    recommendations text[],
    status text,
    filed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT suspicious_activity_reports_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'filed'::text, 'acknowledged'::text])))
);


--
-- Name: TABLE suspicious_activity_reports; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.suspicious_activity_reports IS 'Suspicious Activity Reports (SARs) for regulatory filing';


--
-- Name: wallet_access_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_access_logs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id uuid,
    accessed_by uuid,
    action text NOT NULL,
    success boolean DEFAULT true NOT NULL,
    error_message text,
    ip_address text,
    user_agent text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE wallet_access_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallet_access_logs IS 'Audit log for all wallet access operations';


--
-- Name: suspicious_wallet_activity; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.suspicious_wallet_activity AS
 SELECT wal.wallet_id,
    pw.wallet_address,
    wal.accessed_by,
    u.email AS user_email,
    count(*) AS failed_attempts,
    min(wal.created_at) AS first_failure,
    max(wal.created_at) AS last_failure,
    array_agg(DISTINCT wal.ip_address) AS ip_addresses
   FROM ((public.wallet_access_logs wal
     JOIN public.project_wallets pw ON ((wal.wallet_id = pw.id)))
     LEFT JOIN public.users u ON ((wal.accessed_by = u.id)))
  WHERE ((wal.success = false) AND (wal.created_at >= (now() - '01:00:00'::interval)))
  GROUP BY wal.wallet_id, pw.wallet_address, wal.accessed_by, u.email
 HAVING (count(*) >= 3);


--
-- Name: VIEW suspicious_wallet_activity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.suspicious_wallet_activity IS 'Detects potential security threats based on failed access attempts';


--
-- Name: system_processes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_processes (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    process_name text NOT NULL,
    start_time timestamp with time zone DEFAULT now(),
    end_time timestamp with time zone,
    status text DEFAULT 'running'::text,
    error_details jsonb,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    progress double precision DEFAULT 0,
    priority character varying(10) DEFAULT 'normal'::character varying,
    notification_sent boolean DEFAULT false,
    cancellable boolean DEFAULT false
);


--
-- Name: TABLE system_processes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.system_processes IS 'Tracks system processes and their execution status';


--
-- Name: system_process_activities; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.system_process_activities AS
 SELECT sp.id AS process_id,
    sp.process_name,
    sp.start_time,
    sp.end_time,
    sp.status,
    sp.progress,
    sp.priority,
    al.id AS activity_id,
    al.action,
    al.entity_type,
    al.entity_id,
    al.status AS activity_status,
    al."timestamp" AS activity_time,
    al.metadata AS activity_metadata
   FROM (public.system_processes sp
     LEFT JOIN public.audit_logs al ON ((sp.id = al.system_process_id)))
  ORDER BY sp.start_time DESC, al."timestamp";


--
-- Name: system_process_activity; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.system_process_activity AS
 SELECT sp.id AS process_id,
    sp.process_name,
    sp.status AS process_status,
    sp.start_time,
    sp.end_time,
    EXTRACT(epoch FROM (sp.end_time - sp.start_time)) AS duration_seconds,
    count(al.id) AS activity_count,
    count(
        CASE
            WHEN ((al.status = 'failure'::text) OR (al.status = 'failed'::text)) THEN 1
            ELSE NULL::integer
        END) AS failed_activities
   FROM (public.system_processes sp
     LEFT JOIN public.audit_logs al ON ((sp.id = al.system_process_id)))
  GROUP BY sp.id, sp.process_name, sp.status, sp.start_time, sp.end_time;


--
-- Name: system_process_performance; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.system_process_performance AS
 SELECT sp.process_name,
    count(*) AS total_executions,
    avg(EXTRACT(epoch FROM (sp.end_time - sp.start_time))) AS avg_duration_seconds,
    min(EXTRACT(epoch FROM (sp.end_time - sp.start_time))) AS min_duration_seconds,
    max(EXTRACT(epoch FROM (sp.end_time - sp.start_time))) AS max_duration_seconds,
    count(
        CASE
            WHEN (sp.status = 'completed'::text) THEN 1
            ELSE NULL::integer
        END) AS successful_executions,
    count(
        CASE
            WHEN (sp.status = 'failed'::text) THEN 1
            ELSE NULL::integer
        END) AS failed_executions,
    round((((count(
        CASE
            WHEN (sp.status = 'completed'::text) THEN 1
            ELSE NULL::integer
        END))::numeric / (count(*))::numeric) * (100)::numeric), 2) AS success_rate
   FROM public.system_processes sp
  WHERE (sp.end_time IS NOT NULL)
  GROUP BY sp.process_name
  ORDER BY (count(*)) DESC;


--
-- Name: VIEW system_process_performance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.system_process_performance IS 'Performance metrics for system processes';


--
-- Name: system_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    key text NOT NULL,
    value text NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: threshold_breaches; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.threshold_breaches (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operation_id uuid,
    breach_type text NOT NULL,
    threshold_value numeric,
    actual_value numeric,
    severity text NOT NULL,
    operator text,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT threshold_breaches_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: token_allocations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_allocations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    investor_id uuid NOT NULL,
    subscription_id uuid NOT NULL,
    project_id uuid,
    token_type text NOT NULL,
    token_amount numeric NOT NULL,
    distributed boolean DEFAULT false NOT NULL,
    distribution_date timestamp with time zone,
    distribution_tx_hash text,
    notes text,
    allocation_date timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    minted boolean DEFAULT false NOT NULL,
    minting_date timestamp with time zone,
    minting_tx_hash text,
    standard public.token_standard_enum,
    symbol text,
    token_id uuid,
    CONSTRAINT token_allocations_token_amount_check CHECK ((token_amount > (0)::numeric))
);


--
-- Name: token_deployment_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_deployment_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    project_id uuid NOT NULL,
    status text NOT NULL,
    transaction_hash text,
    block_number integer,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    error text,
    blockchain text NOT NULL,
    environment text NOT NULL,
    initial_owner text
);


--
-- Name: TABLE token_deployment_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_deployment_history IS 'Records the history of token deployment attempts and their status';


--
-- Name: token_deployment_verifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_deployment_verifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    implementation_verified boolean DEFAULT false,
    initialization_verified boolean DEFAULT false,
    functionality_verified boolean DEFAULT false,
    bytecode_verified boolean DEFAULT false,
    verification_checks jsonb DEFAULT '{}'::jsonb NOT NULL,
    expected_master_address text,
    actual_implementation_address text,
    verified_at timestamp with time zone DEFAULT now(),
    verified_by uuid,
    verification_status text DEFAULT 'pending'::text,
    errors jsonb DEFAULT '[]'::jsonb,
    warnings jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    initial_owner text,
    CONSTRAINT token_deployment_verifications_verification_status_check CHECK ((verification_status = ANY (ARRAY['pending'::text, 'passed'::text, 'failed'::text, 'partial'::text])))
);


--
-- Name: token_designs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_designs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    name text NOT NULL,
    type text NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    total_supply numeric NOT NULL,
    contract_address text,
    deployment_date timestamp with time zone,
    CONSTRAINT token_designs_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'under review'::text, 'approved'::text, 'rejected'::text, 'ready to mint'::text, 'minted'::text, 'paused'::text, 'distributed'::text]))),
    CONSTRAINT token_designs_type_check CHECK ((type = ANY (ARRAY['ERC-20'::text, 'ERC-721'::text, 'ERC-1155'::text, 'ERC-1400'::text, 'ERC-3525'::text])))
);


--
-- Name: token_erc1155_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_balances (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    token_type_id text NOT NULL,
    address text NOT NULL,
    amount text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1155_crafting_recipes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_crafting_recipes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    recipe_name text NOT NULL,
    input_tokens jsonb NOT NULL,
    output_token_type_id text NOT NULL,
    output_quantity integer DEFAULT 1,
    success_rate integer DEFAULT 100,
    cooldown_period integer DEFAULT 0,
    required_level integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1155_discount_tiers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_discount_tiers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    min_quantity integer NOT NULL,
    max_quantity integer,
    discount_percentage text NOT NULL,
    tier_name text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1155_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    base_uri text,
    metadata_storage text DEFAULT 'ipfs'::text,
    has_royalty boolean DEFAULT false,
    royalty_percentage text,
    royalty_receiver text,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    updatable_uris boolean DEFAULT false,
    supply_tracking boolean DEFAULT true,
    whitelist_config jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    dynamic_uris boolean,
    batch_minting_enabled boolean DEFAULT false,
    container_enabled boolean DEFAULT false,
    compliance_module_address text,
    policy_engine_address text,
    vesting_module_address text,
    document_module_address text,
    royalty_module_address text,
    supply_cap_module_address text,
    uri_management_module_address text,
    initial_owner text,
    royalty_config jsonb,
    supply_cap_config jsonb,
    uri_management_config jsonb,
    document_config jsonb,
    vesting_config jsonb,
    compliance_config jsonb,
    policy_engine_config jsonb,
    granular_approval_config jsonb,
    CONSTRAINT check_whitelist_config_valid CHECK (public.validate_whitelist_config_permissive(whitelist_config)),
    CONSTRAINT token_erc1155_properties_compliance_module_address_check CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_document_module_address_check CHECK (((document_module_address IS NULL) OR (document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_policy_engine_address_check CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_royalty_module_address_check CHECK (((royalty_module_address IS NULL) OR (royalty_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_supply_cap_module_address_check CHECK (((supply_cap_module_address IS NULL) OR (supply_cap_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_uri_management_module_address_check CHECK (((uri_management_module_address IS NULL) OR (uri_management_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1155_properties_vesting_module_address_check CHECK (((vesting_module_address IS NULL) OR (vesting_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_document_config_erc1155 CHECK (((document_config IS NULL) OR public.validate_document_config(document_config))),
    CONSTRAINT valid_vesting_config_erc1155 CHECK (((vesting_config IS NULL) OR public.validate_vesting_config(vesting_config))),
    CONSTRAINT whitelist_config_structure_check CHECK (((whitelist_config IS NULL) OR ((jsonb_typeof(whitelist_config) = 'object'::text) AND (whitelist_config ? 'enabled'::text) AND (((whitelist_config -> 'enabled'::text))::text = ANY (ARRAY['true'::text, 'false'::text])))))
);


--
-- Name: COLUMN token_erc1155_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.compliance_module_address IS 'Address of ERC20ComplianceModule for KYC/AML compliance';


--
-- Name: COLUMN token_erc1155_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.policy_engine_address IS 'Address of PolicyEngine for pre-transaction validation';


--
-- Name: COLUMN token_erc1155_properties.vesting_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.vesting_module_address IS 'Address of ERC20VestingModule for token lock schedules';


--
-- Name: COLUMN token_erc1155_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.document_module_address IS 'Address of UniversalDocumentModule for document management';


--
-- Name: COLUMN token_erc1155_properties.royalty_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.royalty_module_address IS 'Address of ERC1155RoyaltyModule for creator royalties';


--
-- Name: COLUMN token_erc1155_properties.supply_cap_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.supply_cap_module_address IS 'Address of ERC1155SupplyCapModule for per-token-id supply caps';


--
-- Name: COLUMN token_erc1155_properties.uri_management_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.uri_management_module_address IS 'Address of ERC1155URIModule for dynamic URI management';


--
-- Name: COLUMN token_erc1155_properties.royalty_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.royalty_config IS 'Royalty configuration: {percentage: number, recipient: address}';


--
-- Name: COLUMN token_erc1155_properties.supply_cap_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.supply_cap_config IS 'Supply cap configuration: {defaultCap: number}';


--
-- Name: COLUMN token_erc1155_properties.uri_management_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.uri_management_config IS 'URI management configuration: {baseURI: string}';


--
-- Name: COLUMN token_erc1155_properties.document_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.document_config IS 'Collection documents: {documents: [{name, uri, hash, documentType}]}';


--
-- Name: COLUMN token_erc1155_properties.granular_approval_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_properties.granular_approval_config IS 'ERC-5216 granular approval settings';


--
-- Name: token_erc1155_type_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_type_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    token_type_id text NOT NULL,
    supply_cap text,
    mint_price text,
    is_tradeable boolean DEFAULT true,
    is_transferable boolean DEFAULT true,
    utility_type text,
    rarity_tier text,
    experience_value integer DEFAULT 0,
    crafting_materials jsonb,
    burn_rewards jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1155_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_types (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    token_type_id text NOT NULL,
    name text,
    description text,
    max_supply text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    fungibility_type text DEFAULT 'non-fungible'::text,
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT token_erc1155_types_fungibility_type_check CHECK ((fungibility_type = ANY (ARRAY['fungible'::text, 'non-fungible'::text, 'semi-fungible'::text])))
);


--
-- Name: COLUMN token_erc1155_types.fungibility_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1155_types.fungibility_type IS 'Type of fungibility: fungible, non-fungible, or semi-fungible';


--
-- Name: token_erc1155_uri_mappings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1155_uri_mappings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    token_type_id text NOT NULL,
    uri text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1155_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_erc1155_view AS
 SELECT t.id AS token_id,
    t.name,
    t.symbol,
    t.decimals,
    t.standard,
    t.total_supply,
    t.metadata,
    t.status,
    t.description,
    t.created_at AS token_created_at,
    t.updated_at AS token_updated_at,
    p.id AS erc1155_property_id,
    p.base_uri,
    p.metadata_storage,
    p.has_royalty,
    p.royalty_percentage,
    p.royalty_receiver,
    p.is_burnable,
    p.is_pausable,
    p.updatable_uris,
    p.supply_tracking,
    p.created_at AS property_created_at,
    p.updated_at AS property_updated_at
   FROM (public.tokens t
     LEFT JOIN public.token_erc1155_properties p ON ((t.id = p.token_id)))
  WHERE (t.standard = 'ERC-1155'::public.token_standard_enum);


--
-- Name: VIEW token_erc1155_view; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.token_erc1155_view IS 'ERC-1155 token view - Cleaned up 2025-12-30: Removed 70 non-standard fields. Kept only ERC-1155 core and documented extensions (ERC-2981, ERC-4906, ERC-5615, ERC1155Burnable, ERC1155Pausable).';


--
-- Name: token_erc1400_controllers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_controllers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    address text NOT NULL,
    permissions text[],
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1400_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid,
    name text NOT NULL,
    document_uri text NOT NULL,
    document_type text,
    document_hash text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc1400_partition_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_partition_balances (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    partition_id uuid NOT NULL,
    holder_address text NOT NULL,
    balance text DEFAULT '0'::text NOT NULL,
    last_updated timestamp with time zone DEFAULT now(),
    metadata jsonb DEFAULT '{}'::jsonb,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE token_erc1400_partition_balances; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_erc1400_partition_balances IS 'Tracks token balances per partition for each holder';


--
-- Name: token_erc1400_partition_operators; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_partition_operators (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    partition_id uuid NOT NULL,
    holder_address text NOT NULL,
    operator_address text NOT NULL,
    authorized boolean DEFAULT true,
    last_updated timestamp with time zone DEFAULT now(),
    metadata jsonb DEFAULT '{}'::jsonb,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE token_erc1400_partition_operators; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_erc1400_partition_operators IS 'Tracks authorized operators for each partition';


--
-- Name: token_erc1400_partition_transfers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_partition_transfers (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    partition_id uuid NOT NULL,
    from_address text NOT NULL,
    to_address text NOT NULL,
    amount text NOT NULL,
    operator_address text,
    "timestamp" timestamp with time zone DEFAULT now(),
    transaction_hash text,
    metadata jsonb DEFAULT '{}'::jsonb,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE token_erc1400_partition_transfers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_erc1400_partition_transfers IS 'Records all token transfers within partitions';


--
-- Name: token_erc1400_partitions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_partitions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    name text NOT NULL,
    partition_id text NOT NULL,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    total_supply text DEFAULT '0'::text,
    partition_type text,
    amount text,
    updated_at timestamp with time zone DEFAULT now(),
    corporate_actions boolean DEFAULT false,
    custom_features jsonb,
    transferable boolean DEFAULT true
);


--
-- Name: COLUMN token_erc1400_partitions.total_supply; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_partitions.total_supply IS 'Total token supply in this partition';


--
-- Name: token_erc1400_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc1400_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    initial_supply text,
    cap text,
    is_mintable boolean DEFAULT false,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    document_uri text,
    document_hash text,
    controller_address text,
    require_kyc boolean DEFAULT true,
    security_type text DEFAULT 'equity'::text,
    issuing_jurisdiction text,
    issuing_entity_name text,
    issuing_entity_lei text,
    kyc_settings jsonb,
    compliance_settings jsonb,
    forced_transfers boolean DEFAULT false,
    issuance_modules boolean DEFAULT false,
    document_management boolean DEFAULT false,
    recovery_mechanism boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    regulation_type text,
    is_multi_class boolean DEFAULT false,
    tranche_transferability boolean DEFAULT false,
    decimals integer DEFAULT 18,
    token_details text,
    legal_terms text,
    prospectus text,
    enforce_kyc boolean DEFAULT false,
    forced_redemption_enabled boolean DEFAULT false,
    whitelist_enabled boolean DEFAULT false,
    holding_period integer,
    max_investor_count integer,
    investor_accreditation boolean DEFAULT false,
    auto_compliance boolean DEFAULT false,
    manual_approvals boolean DEFAULT false,
    compliance_module text,
    is_issuable boolean DEFAULT false,
    granular_control boolean DEFAULT false,
    dividend_distribution boolean DEFAULT false,
    corporate_actions boolean DEFAULT false,
    custom_features jsonb,
    compliance_automation_level text DEFAULT 'manual'::text,
    whitelist_config jsonb,
    investor_whitelist_enabled boolean DEFAULT false,
    accredited_investor_only boolean DEFAULT false,
    jurisdiction_restrictions jsonb DEFAULT '[]'::jsonb,
    investor_limits jsonb DEFAULT '{}'::jsonb,
    compliance_module_address text,
    policy_engine_address text,
    vesting_module_address text,
    document_module_address text,
    controller_module_address text,
    erc1400_document_module_address text,
    transfer_restrictions_module_address text,
    initial_owner text,
    controller_config jsonb,
    default_partitions jsonb DEFAULT '["DEFAULT"]'::jsonb,
    enhanced_transfer_restrictions_config jsonb,
    enhanced_document_config jsonb,
    partition_config jsonb,
    granularity bigint DEFAULT 1,
    CONSTRAINT check_whitelist_config_valid CHECK (public.validate_whitelist_config_permissive(whitelist_config)),
    CONSTRAINT granularity_positive CHECK ((granularity > 0)),
    CONSTRAINT token_erc1400_properties_compliance_module_address_check CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_controller_module_address_check CHECK (((controller_module_address IS NULL) OR (controller_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_document_module_address_check CHECK (((document_module_address IS NULL) OR (document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_erc1400_document_module_address_check CHECK (((erc1400_document_module_address IS NULL) OR (erc1400_document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_policy_engine_address_check CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_transfer_restrictions_module_add_check CHECK (((transfer_restrictions_module_address IS NULL) OR (transfer_restrictions_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc1400_properties_vesting_module_address_check CHECK (((vesting_module_address IS NULL) OR (vesting_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_enhanced_document_config CHECK (((enhanced_document_config IS NULL) OR public.validate_document_config(enhanced_document_config)))
);


--
-- Name: COLUMN token_erc1400_properties.whitelist_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.whitelist_config IS 'JSON configuration for security token whitelist including investor verification, compliance requirements, and transfer restrictions';


--
-- Name: COLUMN token_erc1400_properties.investor_whitelist_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.investor_whitelist_enabled IS 'Enable whitelist enforcement for all investor interactions';


--
-- Name: COLUMN token_erc1400_properties.accredited_investor_only; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.accredited_investor_only IS 'Restrict token access to accredited investors only';


--
-- Name: COLUMN token_erc1400_properties.jurisdiction_restrictions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.jurisdiction_restrictions IS 'Array of blocked/allowed jurisdictions for investor eligibility';


--
-- Name: COLUMN token_erc1400_properties.investor_limits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.investor_limits IS 'JSON object defining maximum investors, holding periods, and investment limits';


--
-- Name: COLUMN token_erc1400_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.compliance_module_address IS 'Address of ERC20ComplianceModule for KYC/AML compliance';


--
-- Name: COLUMN token_erc1400_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.policy_engine_address IS 'Address of PolicyEngine for pre-transaction validation';


--
-- Name: COLUMN token_erc1400_properties.vesting_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.vesting_module_address IS 'Address of ERC20VestingModule for token lock schedules';


--
-- Name: COLUMN token_erc1400_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.document_module_address IS 'Address of UniversalDocumentModule for document management';


--
-- Name: COLUMN token_erc1400_properties.controller_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.controller_module_address IS 'Address of ERC1400ControllerModule for operator control functions';


--
-- Name: COLUMN token_erc1400_properties.erc1400_document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.erc1400_document_module_address IS 'Address of ERC1400DocumentModule for security document management';


--
-- Name: COLUMN token_erc1400_properties.transfer_restrictions_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.transfer_restrictions_module_address IS 'Address of ERC1400TransferRestrictionsModule for partition transfer rules';


--
-- Name: COLUMN token_erc1400_properties.controller_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.controller_config IS 'Controller configuration: {controllers: address[]}';


--
-- Name: COLUMN token_erc1400_properties.default_partitions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.default_partitions IS 'Array of partition identifiers to create on deployment (e.g., ["CLASS_A", "CLASS_B", "PREFERRED"])';


--
-- Name: COLUMN token_erc1400_properties.enhanced_transfer_restrictions_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.enhanced_transfer_restrictions_config IS 'Detailed transfer restrictions: {restrictions: [{restrictionType, value, enabled}], defaultPolicy}';


--
-- Name: COLUMN token_erc1400_properties.enhanced_document_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.enhanced_document_config IS 'Partition-specific documents: {documents: [{partition, name, uri, hash}]}';


--
-- Name: COLUMN token_erc1400_properties.partition_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.partition_config IS 'Partition definitions with metadata and rules';


--
-- Name: COLUMN token_erc1400_properties.granularity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc1400_properties.granularity IS 'ERC-1400 mandatory: Minimum transferable unit. 1 = fully divisible, 100 = cents, 10000 = basis points';


--
-- Name: token_erc20_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc20_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    initial_supply text,
    cap text,
    is_mintable boolean DEFAULT false,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    compliance_module_address text,
    vesting_module_address text,
    fees_module_address text,
    policy_engine_address text,
    flash_mint_module_address text,
    permit_module_address text,
    snapshot_module_address text,
    timelock_module_address text,
    votes_module_address text,
    payable_token_module_address text,
    temporary_approval_module_address text,
    initial_owner text,
    timelock_config jsonb,
    temporary_approval_config jsonb,
    vesting_config jsonb,
    document_config jsonb,
    policy_engine_config jsonb,
    fees_config jsonb,
    flash_mint_config jsonb,
    permit_config jsonb,
    snapshot_config jsonb,
    votes_config jsonb,
    payable_token_config jsonb,
    document_module_address text,
    compliance_config jsonb,
    CONSTRAINT compliance_module_address_format CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~ '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT fees_module_address_format CHECK (((fees_module_address IS NULL) OR (fees_module_address ~ '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT policy_engine_address_format CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~ '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_flash_mint_module_address_check CHECK (((flash_mint_module_address IS NULL) OR (flash_mint_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_payable_token_module_address_check CHECK (((payable_token_module_address IS NULL) OR (payable_token_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_permit_module_address_check CHECK (((permit_module_address IS NULL) OR (permit_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_snapshot_module_address_check CHECK (((snapshot_module_address IS NULL) OR (snapshot_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_temporary_approval_module_address_check CHECK (((temporary_approval_module_address IS NULL) OR (temporary_approval_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_timelock_module_address_check CHECK (((timelock_module_address IS NULL) OR (timelock_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc20_properties_votes_module_address_check CHECK (((votes_module_address IS NULL) OR (votes_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_document_config_erc20 CHECK (((document_config IS NULL) OR public.validate_document_config(document_config))),
    CONSTRAINT valid_vesting_config_erc20 CHECK (((vesting_config IS NULL) OR public.validate_vesting_config(vesting_config))),
    CONSTRAINT vesting_module_address_format CHECK (((vesting_module_address IS NULL) OR (vesting_module_address ~ '^0x[a-fA-F0-9]{40}$'::text)))
);


--
-- Name: TABLE token_erc20_properties; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_erc20_properties IS 'ERC20 token properties - Streamlined to essential fields only. 
Module-specific configurations (governance, vesting, fees, compliance) 
should be stored in token_modules and module_configurations tables.
Cleaned: 2025-05-15 - Removed 53 unused/deprecated fields.';


--
-- Name: COLUMN token_erc20_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.compliance_module_address IS 'Address of deployed ERC20ComplianceModule contract';


--
-- Name: COLUMN token_erc20_properties.vesting_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.vesting_module_address IS 'Address of deployed ERC20VestingModule contract';


--
-- Name: COLUMN token_erc20_properties.fees_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.fees_module_address IS 'Address of deployed ERC20FeesModule contract';


--
-- Name: COLUMN token_erc20_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.policy_engine_address IS 'Address of deployed PolicyEngine contract';


--
-- Name: COLUMN token_erc20_properties.flash_mint_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.flash_mint_module_address IS 'Address of ERC20FlashMintModule for flash loan functionality (EIP-3156)';


--
-- Name: COLUMN token_erc20_properties.permit_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.permit_module_address IS 'Address of ERC20PermitModule for gasless approvals (EIP-2612)';


--
-- Name: COLUMN token_erc20_properties.snapshot_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.snapshot_module_address IS 'Address of ERC20SnapshotModule for balance snapshots at specific points in time';


--
-- Name: COLUMN token_erc20_properties.timelock_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.timelock_module_address IS 'Address of ERC20TimelockModule for time-locked transfers';


--
-- Name: COLUMN token_erc20_properties.votes_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.votes_module_address IS 'Address of ERC20VotesModule for governance voting power tracking';


--
-- Name: COLUMN token_erc20_properties.payable_token_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.payable_token_module_address IS 'Address of ERC1363PayableToken for receiver callback functionality';


--
-- Name: COLUMN token_erc20_properties.temporary_approval_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.temporary_approval_module_address IS 'Address of ERC20TemporaryApprovalModule for time-limited approvals';


--
-- Name: COLUMN token_erc20_properties.timelock_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.timelock_config IS 'Timelock module configuration: { minDelay: number (seconds) }';


--
-- Name: COLUMN token_erc20_properties.temporary_approval_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.temporary_approval_config IS 'Temporary Approval module configuration: { defaultDuration: number (seconds) }';


--
-- Name: COLUMN token_erc20_properties.vesting_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.vesting_config IS 'Vesting schedules: {schedules: [{beneficiary, amount, startTime, cliffDuration, vestingDuration, revocable, category}]}';


--
-- Name: COLUMN token_erc20_properties.document_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.document_config IS 'Initial documents: {documents: [{name, uri, hash, documentType}]}';


--
-- Name: COLUMN token_erc20_properties.policy_engine_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.policy_engine_config IS 'Policy rules: {rules: [{ruleId, conditions, actions}], validators: [...]}';


--
-- Name: COLUMN token_erc20_properties.fees_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.fees_config IS 'Fee configuration: {transferFeeBps, feeRecipient, exemptAddresses}';


--
-- Name: COLUMN token_erc20_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.document_module_address IS 'Deployed address of the Document Management extension module';


--
-- Name: COLUMN token_erc20_properties.compliance_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc20_properties.compliance_config IS 'JSONB configuration for KYC/AML compliance settings';


--
-- Name: token_erc20_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_erc20_view AS
 SELECT t.id AS token_id,
    t.name,
    t.symbol,
    t.decimals,
    t.standard,
    t.total_supply,
    t.metadata,
    t.status,
    t.description,
    t.created_at AS token_created_at,
    t.updated_at AS token_updated_at,
    p.id AS erc20_property_id,
    p.cap,
    p.initial_supply,
    p.is_mintable,
    p.is_burnable,
    p.is_pausable,
    p.initial_owner,
    p.created_at AS property_created_at,
    p.updated_at AS property_updated_at
   FROM (public.tokens t
     LEFT JOIN public.token_erc20_properties p ON ((t.id = p.token_id)))
  WHERE (t.standard = 'ERC-20'::public.token_standard_enum);


--
-- Name: VIEW token_erc20_view; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.token_erc20_view IS 'ERC-20 token view - Updated 2025-12-30: Removed token_type, access_control, default_restriction_policy fields. Data archived in legacy_properties JSONB column.';


--
-- Name: token_erc3525_allocations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_allocations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    slot_id text NOT NULL,
    token_id_within_slot text NOT NULL,
    value text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    recipient text,
    linked_token_id uuid,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: COLUMN token_erc3525_allocations.linked_token_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_allocations.linked_token_id IS 'Foreign key reference to another token that this allocation is linked to';


--
-- Name: token_erc3525_payment_schedules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_payment_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    slot_id text NOT NULL,
    payment_date timestamp with time zone NOT NULL,
    payment_amount text NOT NULL,
    payment_type text NOT NULL,
    currency text DEFAULT 'USD'::text,
    is_completed boolean DEFAULT false,
    transaction_hash text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc3525_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    value_decimals integer DEFAULT 0,
    base_uri text,
    metadata_storage text DEFAULT 'ipfs'::text,
    slot_type text DEFAULT 'generic'::text,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    has_royalty boolean DEFAULT false,
    royalty_percentage text,
    royalty_receiver text,
    slot_approvals boolean DEFAULT true,
    value_approvals boolean DEFAULT true,
    updatable_uris boolean DEFAULT false,
    updatable_slots boolean DEFAULT false,
    value_transfers_enabled boolean DEFAULT true,
    sales_config jsonb,
    mergable boolean DEFAULT false,
    splittable boolean DEFAULT false,
    slot_transfer_validation jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    dynamic_metadata boolean DEFAULT false,
    allows_slot_enumeration boolean DEFAULT true,
    value_aggregation boolean DEFAULT false,
    permissioning_enabled boolean DEFAULT false,
    supply_tracking boolean DEFAULT false,
    updatable_values boolean DEFAULT false,
    custom_extensions text,
    fractionalizable boolean DEFAULT false,
    metadata jsonb,
    fractional_ownership_enabled boolean DEFAULT false,
    auto_unit_calculation boolean DEFAULT false,
    custom_slot_properties jsonb,
    slot_enumeration_enabled boolean DEFAULT true,
    value_aggregation_enabled boolean DEFAULT false,
    permissioning_advanced boolean DEFAULT false,
    slot_transfer_restrictions jsonb,
    value_transfer_restrictions jsonb,
    financial_instrument_type text,
    principal_amount text,
    interest_rate text,
    maturity_date timestamp with time zone,
    coupon_frequency text,
    payment_schedule jsonb,
    early_redemption_enabled boolean DEFAULT false,
    redemption_penalty_rate text,
    derivative_type text,
    underlying_asset text,
    underlying_asset_address text,
    strike_price text,
    expiration_date timestamp with time zone,
    settlement_type text,
    margin_requirements jsonb,
    leverage_ratio text,
    whitelist_config jsonb,
    compliance_module_address text,
    policy_engine_address text,
    vesting_module_address text,
    document_module_address text,
    slot_approvable_module_address text,
    slot_manager_module_address text,
    value_exchange_module_address text,
    initial_owner text,
    value_exchange_config jsonb,
    slot_manager_config jsonb,
    slot_approvable_config jsonb,
    document_config jsonb,
    compliance_config jsonb,
    policy_engine_config jsonb,
    legacy_properties jsonb DEFAULT '{}'::jsonb,
    CONSTRAINT check_whitelist_config_valid CHECK (public.validate_whitelist_config_permissive(whitelist_config)),
    CONSTRAINT sales_config_erc3525_check CHECK (((sales_config IS NULL) OR ((jsonb_typeof(sales_config) = 'object'::text) AND (sales_config ? 'enabled'::text) AND (((sales_config -> 'enabled'::text))::text = ANY (ARRAY['true'::text, 'false'::text]))))),
    CONSTRAINT slot_transfer_validation_enhanced_check CHECK (((slot_transfer_validation IS NULL) OR ((jsonb_typeof(slot_transfer_validation) = 'object'::text) AND (slot_transfer_validation ? 'rules'::text)))),
    CONSTRAINT token_erc3525_properties_compliance_module_address_check CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_document_module_address_check CHECK (((document_module_address IS NULL) OR (document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_policy_engine_address_check CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_slot_approvable_module_address_check CHECK (((slot_approvable_module_address IS NULL) OR (slot_approvable_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_slot_manager_module_address_check CHECK (((slot_manager_module_address IS NULL) OR (slot_manager_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_value_exchange_module_address_check CHECK (((value_exchange_module_address IS NULL) OR (value_exchange_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc3525_properties_vesting_module_address_check CHECK (((vesting_module_address IS NULL) OR (vesting_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_document_config_erc3525 CHECK (((document_config IS NULL) OR public.validate_document_config(document_config)))
);


--
-- Name: COLUMN token_erc3525_properties.mergable; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.mergable IS 'Whether tokens can be merged';


--
-- Name: COLUMN token_erc3525_properties.splittable; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.splittable IS 'Whether tokens can be split';


--
-- Name: COLUMN token_erc3525_properties.slot_transfer_validation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.slot_transfer_validation IS 'JSON configuration for slot transfer validation rules';


--
-- Name: COLUMN token_erc3525_properties.dynamic_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.dynamic_metadata IS 'Whether the token supports dynamic metadata updates';


--
-- Name: COLUMN token_erc3525_properties.allows_slot_enumeration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.allows_slot_enumeration IS 'Whether slots can be enumerated';


--
-- Name: COLUMN token_erc3525_properties.value_aggregation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.value_aggregation IS 'Whether token values can be aggregated';


--
-- Name: COLUMN token_erc3525_properties.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.metadata IS 'JSON metadata for token properties';


--
-- Name: COLUMN token_erc3525_properties.auto_unit_calculation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.auto_unit_calculation IS 'Whether token values are automatically calculated';


--
-- Name: COLUMN token_erc3525_properties.value_aggregation_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.value_aggregation_enabled IS 'Whether token values can be aggregated across slots';


--
-- Name: COLUMN token_erc3525_properties.financial_instrument_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.financial_instrument_type IS 'Type of financial instrument: bond, loan, equity, derivative';


--
-- Name: COLUMN token_erc3525_properties.whitelist_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.whitelist_config IS 'JSON configuration for semi-fungible token whitelist controls including slot-specific access, transfer restrictions, and compliance settings';


--
-- Name: COLUMN token_erc3525_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.compliance_module_address IS 'Address of ERC20ComplianceModule for KYC/AML compliance';


--
-- Name: COLUMN token_erc3525_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.policy_engine_address IS 'Address of PolicyEngine for pre-transaction validation';


--
-- Name: COLUMN token_erc3525_properties.vesting_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.vesting_module_address IS 'Address of ERC20VestingModule for token lock schedules';


--
-- Name: COLUMN token_erc3525_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.document_module_address IS 'Address of UniversalDocumentModule for document management';


--
-- Name: COLUMN token_erc3525_properties.slot_approvable_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.slot_approvable_module_address IS 'Address of ERC3525SlotApprovableModule for slot-level approvals';


--
-- Name: COLUMN token_erc3525_properties.slot_manager_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.slot_manager_module_address IS 'Address of ERC3525SlotManagerModule for slot enumeration and management';


--
-- Name: COLUMN token_erc3525_properties.value_exchange_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.value_exchange_module_address IS 'Address of ERC3525ValueExchangeModule for value transfers between tokens';


--
-- Name: COLUMN token_erc3525_properties.value_exchange_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.value_exchange_config IS 'Value exchange configuration: {exchangeFeeBps: number}';


--
-- Name: COLUMN token_erc3525_properties.slot_manager_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.slot_manager_config IS 'Slot definitions: {slots: [{slotId, name, transferable, mergeable, splittable, maxSupply}]}';


--
-- Name: COLUMN token_erc3525_properties.slot_approvable_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.slot_approvable_config IS 'Slot approval settings: {approvalMode}';


--
-- Name: COLUMN token_erc3525_properties.document_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc3525_properties.document_config IS 'Semi-fungible token documents';


--
-- Name: token_erc3525_slot_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_slot_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    slot_id text NOT NULL,
    slot_name text,
    slot_description text,
    value_units text,
    slot_type text,
    transferable boolean DEFAULT true,
    tradeable boolean DEFAULT true,
    divisible boolean DEFAULT true,
    min_value text,
    max_value text,
    value_precision integer DEFAULT 18,
    slot_properties jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc3525_slots; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_slots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    slot_id text NOT NULL,
    name text,
    description text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    value_units text,
    updated_at timestamp with time zone DEFAULT now(),
    slot_transferable boolean DEFAULT true
);


--
-- Name: token_erc3525_value_adjustments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc3525_value_adjustments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    slot_id text NOT NULL,
    adjustment_date timestamp with time zone DEFAULT now(),
    adjustment_type text NOT NULL,
    adjustment_amount text NOT NULL,
    adjustment_reason text,
    oracle_price text,
    oracle_source text,
    approved_by text,
    transaction_hash text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc3525_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_erc3525_view AS
 SELECT t.id AS token_id,
    t.name,
    t.symbol,
    t.decimals,
    t.standard,
    t.total_supply,
    t.metadata,
    t.status,
    t.description,
    t.created_at AS token_created_at,
    t.updated_at AS token_updated_at,
    p.id AS erc3525_property_id,
    p.value_decimals,
    p.base_uri,
    p.metadata_storage,
    p.slot_type,
    p.is_burnable,
    p.is_pausable,
    p.has_royalty,
    p.royalty_percentage,
    p.royalty_receiver,
    p.slot_approvals,
    p.value_approvals,
    p.updatable_uris,
    p.updatable_slots,
    p.value_transfers_enabled,
    p.sales_config,
    p.mergable,
    p.splittable,
    p.slot_transfer_validation,
    p.dynamic_metadata,
    p.allows_slot_enumeration,
    p.value_aggregation,
    p.permissioning_enabled,
    p.supply_tracking,
    p.updatable_values,
    p.custom_extensions,
    p.fractionalizable,
    p.fractional_ownership_enabled,
    p.auto_unit_calculation,
    p.custom_slot_properties,
    p.slot_enumeration_enabled,
    p.value_aggregation_enabled,
    p.permissioning_advanced,
    p.slot_transfer_restrictions,
    p.value_transfer_restrictions,
    p.financial_instrument_type,
    p.principal_amount,
    p.interest_rate,
    p.maturity_date,
    p.coupon_frequency,
    p.payment_schedule,
    p.early_redemption_enabled,
    p.redemption_penalty_rate,
    p.derivative_type,
    p.underlying_asset,
    p.underlying_asset_address,
    p.strike_price,
    p.expiration_date,
    p.settlement_type,
    p.margin_requirements,
    p.leverage_ratio,
    p.compliance_module_address,
    p.policy_engine_address,
    p.vesting_module_address,
    p.document_module_address,
    p.slot_approvable_module_address,
    p.slot_manager_module_address,
    p.value_exchange_module_address,
    p.initial_owner,
    p.value_exchange_config,
    p.slot_manager_config,
    p.slot_approvable_config,
    p.document_config,
    p.compliance_config,
    p.policy_engine_config,
    p.whitelist_config,
    p.metadata AS property_metadata,
    p.created_at AS property_created_at,
    p.updated_at AS property_updated_at
   FROM (public.tokens t
     LEFT JOIN public.token_erc3525_properties p ON ((t.id = p.token_id)))
  WHERE (t.standard = 'ERC-3525'::public.token_standard_enum);


--
-- Name: VIEW token_erc3525_view; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.token_erc3525_view IS 'ERC-3525 view - Cleaned 2025-12-31: Removed 10 operational/enterprise fields. Kept whitelist_config, ERC-3525 standard fields, and financial instrument parameters.';


--
-- Name: token_erc4626_asset_allocations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_asset_allocations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    asset text NOT NULL,
    percentage text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    description text,
    protocol text,
    expected_apy text,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc4626_fee_tiers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_fee_tiers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    tier_name text NOT NULL,
    min_balance text NOT NULL,
    max_balance text,
    management_fee_rate text NOT NULL,
    performance_fee_rate text NOT NULL,
    deposit_fee_rate text DEFAULT '0'::text,
    withdrawal_fee_rate text DEFAULT '0'::text,
    tier_benefits jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc4626_performance_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_performance_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    metric_date date NOT NULL,
    total_assets text NOT NULL,
    share_price text NOT NULL,
    apy text,
    daily_yield text,
    benchmark_performance text,
    total_fees_collected text,
    new_deposits text,
    withdrawals text,
    net_flow text,
    sharpe_ratio text,
    volatility text,
    max_drawdown text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc4626_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    asset_address text,
    asset_name text,
    asset_symbol text,
    asset_decimals integer DEFAULT 18,
    vault_type text DEFAULT 'yield'::text,
    is_mintable boolean DEFAULT false,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    vault_strategy text DEFAULT 'simple'::text,
    custom_strategy boolean DEFAULT false,
    strategy_controller text,
    permit boolean DEFAULT false,
    flash_loans boolean DEFAULT false,
    emergency_shutdown boolean DEFAULT false,
    fee_structure jsonb,
    rebalancing_rules jsonb,
    performance_metrics boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    yield_source text DEFAULT 'external'::text,
    strategy_documentation text,
    rebalance_threshold text,
    liquidity_reserve text DEFAULT '10'::text,
    max_slippage text,
    deposit_limit text,
    withdrawal_limit text,
    min_deposit text,
    max_deposit text,
    min_withdrawal text,
    max_withdrawal text,
    performance_tracking boolean DEFAULT false,
    deposit_fee text,
    withdrawal_fee text,
    management_fee text,
    performance_fee text,
    fee_recipient text,
    withdrawal_rules jsonb,
    automated_rebalancing boolean DEFAULT false,
    whitelist_config jsonb,
    strategy_complexity text DEFAULT 'simple'::text,
    multi_asset_enabled boolean DEFAULT false,
    rebalancing_enabled boolean DEFAULT false,
    auto_compounding_enabled boolean DEFAULT false,
    yield_optimization_strategy text,
    risk_management_enabled boolean DEFAULT false,
    risk_tolerance text,
    apy_tracking_enabled boolean DEFAULT false,
    yield_sources jsonb,
    yield_distribution_schedule text,
    compound_frequency text DEFAULT 'continuous'::text,
    insurance_enabled boolean DEFAULT false,
    insurance_provider text,
    insurance_coverage_amount text,
    emergency_exit_enabled boolean DEFAULT false,
    circuit_breaker_enabled boolean DEFAULT false,
    max_drawdown_threshold text,
    stop_loss_enabled boolean DEFAULT false,
    stop_loss_threshold text,
    dynamic_fees_enabled boolean DEFAULT false,
    performance_fee_high_water_mark boolean DEFAULT false,
    fee_tier_system_enabled boolean DEFAULT false,
    compliance_module_address text,
    policy_engine_address text,
    document_module_address text,
    fee_strategy_module_address text,
    withdrawal_queue_module_address text,
    yield_strategy_module_address text,
    multi_asset_vault_module_address text,
    async_vault_module_address text,
    native_vault_module_address text,
    router_module_address text,
    initial_owner text,
    fee_strategy_config jsonb,
    withdrawal_queue_config jsonb,
    yield_strategy_config jsonb,
    async_vault_config jsonb,
    multi_asset_vault_config jsonb,
    document_config jsonb,
    compliance_config jsonb,
    policy_engine_config jsonb,
    native_vault_config jsonb,
    router_config jsonb,
    CONSTRAINT check_whitelist_config_valid CHECK (public.validate_whitelist_config_permissive(whitelist_config)),
    CONSTRAINT rebalancing_rules_validation_check CHECK (((rebalancing_rules IS NULL) OR ((jsonb_typeof(rebalancing_rules) = 'object'::text) AND (rebalancing_rules ? 'frequency'::text)))),
    CONSTRAINT token_erc4626_properties_async_vault_module_address_check CHECK (((async_vault_module_address IS NULL) OR (async_vault_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_compliance_module_address_check CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_document_module_address_check CHECK (((document_module_address IS NULL) OR (document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_fee_strategy_module_address_check CHECK (((fee_strategy_module_address IS NULL) OR (fee_strategy_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_multi_asset_vault_module_address_check CHECK (((multi_asset_vault_module_address IS NULL) OR (multi_asset_vault_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_native_vault_module_address_check CHECK (((native_vault_module_address IS NULL) OR (native_vault_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_policy_engine_address_check CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_router_module_address_check CHECK (((router_module_address IS NULL) OR (router_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_withdrawal_queue_module_address_check CHECK (((withdrawal_queue_module_address IS NULL) OR (withdrawal_queue_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc4626_properties_yield_strategy_module_address_check CHECK (((yield_strategy_module_address IS NULL) OR (yield_strategy_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_document_config_erc4626 CHECK (((document_config IS NULL) OR public.validate_document_config(document_config)))
);


--
-- Name: COLUMN token_erc4626_properties.whitelist_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.whitelist_config IS 'JSON configuration for vault token whitelist controls including depositor restrictions, withdrawal limits, and investor eligibility';


--
-- Name: COLUMN token_erc4626_properties.strategy_complexity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.strategy_complexity IS 'Complexity level of the vault strategy: simple, moderate, advanced';


--
-- Name: COLUMN token_erc4626_properties.multi_asset_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.multi_asset_enabled IS 'Whether the vault manages multiple underlying assets';


--
-- Name: COLUMN token_erc4626_properties.auto_compounding_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.auto_compounding_enabled IS 'Whether yields are automatically reinvested';


--
-- Name: COLUMN token_erc4626_properties.yield_optimization_strategy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.yield_optimization_strategy IS 'Strategy used to optimize yield generation';


--
-- Name: COLUMN token_erc4626_properties.risk_management_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.risk_management_enabled IS 'Whether risk management features are active';


--
-- Name: COLUMN token_erc4626_properties.insurance_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.insurance_enabled IS 'Whether vault deposits are insured';


--
-- Name: COLUMN token_erc4626_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.compliance_module_address IS 'Address of ERC20ComplianceModule for KYC/AML compliance';


--
-- Name: COLUMN token_erc4626_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.policy_engine_address IS 'Address of PolicyEngine for pre-transaction validation';


--
-- Name: COLUMN token_erc4626_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.document_module_address IS 'Address of UniversalDocumentModule for document management';


--
-- Name: COLUMN token_erc4626_properties.fee_strategy_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.fee_strategy_module_address IS 'Address of ERC4626FeeStrategyModule for vault fee management';


--
-- Name: COLUMN token_erc4626_properties.withdrawal_queue_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.withdrawal_queue_module_address IS 'Address of ERC4626WithdrawalQueueModule for delayed withdrawals';


--
-- Name: COLUMN token_erc4626_properties.yield_strategy_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.yield_strategy_module_address IS 'Address of ERC4626YieldStrategyModule for yield generation strategies';


--
-- Name: COLUMN token_erc4626_properties.multi_asset_vault_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.multi_asset_vault_module_address IS 'Address of ERC7575MultiAssetVaultModule for multi-asset support';


--
-- Name: COLUMN token_erc4626_properties.async_vault_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.async_vault_module_address IS 'Address of ERC7540AsyncVaultModule for delayed deposit/redeem (RWA, liquid staking)';


--
-- Name: COLUMN token_erc4626_properties.native_vault_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.native_vault_module_address IS 'Address of ERC7535NativeVaultModule for native token (ETH) vaults';


--
-- Name: COLUMN token_erc4626_properties.router_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.router_module_address IS 'Address of ERC4626Router for multi-vault routing and aggregation';


--
-- Name: COLUMN token_erc4626_properties.fee_strategy_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.fee_strategy_config IS 'Fee strategy configuration: {managementFeeBps: number, performanceFeeBps: number}';


--
-- Name: COLUMN token_erc4626_properties.withdrawal_queue_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.withdrawal_queue_config IS 'Withdrawal queue configuration: {maxQueueSize: number}';


--
-- Name: COLUMN token_erc4626_properties.yield_strategy_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.yield_strategy_config IS 'Yield strategy configuration: {targetYieldBps: number}';


--
-- Name: COLUMN token_erc4626_properties.async_vault_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.async_vault_config IS 'Async vault configuration: {settlementDelay: number}';


--
-- Name: COLUMN token_erc4626_properties.multi_asset_vault_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.multi_asset_vault_config IS 'Multi-asset vault configuration: {maxAssets: number}';


--
-- Name: COLUMN token_erc4626_properties.native_vault_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.native_vault_config IS 'Native token (ETH) vault settings: {wrapNative, wrappedTokenAddress}';


--
-- Name: COLUMN token_erc4626_properties.router_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc4626_properties.router_config IS 'Vault router settings: {allowedVaults, slippageTolerance}';


--
-- Name: token_erc4626_strategy_params; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_strategy_params (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    name text NOT NULL,
    value text NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT now(),
    param_type text DEFAULT 'string'::text,
    is_required boolean DEFAULT false,
    default_value text,
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc4626_vault_strategies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc4626_vault_strategies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    strategy_name text NOT NULL,
    strategy_type text NOT NULL,
    protocol_address text,
    protocol_name text,
    allocation_percentage text NOT NULL,
    min_allocation_percentage text,
    max_allocation_percentage text,
    risk_score integer,
    expected_apy text,
    actual_apy text,
    is_active boolean DEFAULT true,
    last_rebalance timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc721_attributes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc721_attributes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    trait_type text NOT NULL,
    "values" text[] NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc721_mint_phases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc721_mint_phases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    phase_name text NOT NULL,
    phase_order integer NOT NULL,
    start_time timestamp with time zone,
    end_time timestamp with time zone,
    max_supply integer,
    price text,
    max_per_wallet integer,
    whitelist_required boolean DEFAULT false,
    merkle_root text,
    is_active boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc721_properties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc721_properties (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    base_uri text,
    max_supply text,
    has_royalty boolean DEFAULT false,
    royalty_percentage text,
    royalty_receiver text,
    is_burnable boolean DEFAULT false,
    is_pausable boolean DEFAULT false,
    asset_type text DEFAULT 'unique_asset'::text,
    minting_method text DEFAULT 'open'::text,
    auto_increment_ids boolean DEFAULT true,
    enumerable boolean DEFAULT true,
    updatable_uris boolean DEFAULT false,
    sales_config jsonb,
    whitelist_config jsonb,
    permission_config jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    is_mintable boolean,
    soulbound boolean DEFAULT false,
    supply_cap_enabled boolean DEFAULT false,
    total_supply_cap text,
    compliance_module_address text,
    policy_engine_address text,
    vesting_module_address text,
    document_module_address text,
    consecutive_module_address text,
    fractionalization_module_address text,
    rental_module_address text,
    royalty_module_address text,
    soulbound_module_address text,
    metadata_events_module_address text,
    initial_owner text,
    rental_enabled boolean DEFAULT false,
    rental_config jsonb,
    fractionalization_config jsonb,
    compliance_enabled boolean DEFAULT false,
    compliance_config jsonb,
    vesting_enabled boolean DEFAULT false,
    vesting_config jsonb,
    document_enabled boolean DEFAULT false,
    consecutive boolean DEFAULT false,
    metadata_events boolean DEFAULT false,
    policy_engine_enabled boolean DEFAULT false,
    policy_rules_enabled text,
    policy_validators_enabled text,
    document_config jsonb,
    consecutive_config jsonb,
    metadata_events_config jsonb,
    soulbound_config jsonb,
    legacy_properties jsonb DEFAULT '{}'::jsonb,
    CONSTRAINT check_whitelist_config_valid CHECK (public.validate_whitelist_config_permissive(whitelist_config)),
    CONSTRAINT sales_config_structure_check CHECK (((sales_config IS NULL) OR ((jsonb_typeof(sales_config) = 'object'::text) AND (sales_config ? 'enabled'::text) AND (((sales_config -> 'enabled'::text))::text = ANY (ARRAY['true'::text, 'false'::text]))))),
    CONSTRAINT token_erc721_properties_compliance_module_address_check CHECK (((compliance_module_address IS NULL) OR (compliance_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_consecutive_module_address_check CHECK (((consecutive_module_address IS NULL) OR (consecutive_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_document_module_address_check CHECK (((document_module_address IS NULL) OR (document_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_fractionalization_module_address_check CHECK (((fractionalization_module_address IS NULL) OR (fractionalization_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_initial_owner_format CHECK (((initial_owner IS NULL) OR (initial_owner ~* '^0x[a-f0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_metadata_events_module_address_check CHECK (((metadata_events_module_address IS NULL) OR (metadata_events_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_policy_engine_address_check CHECK (((policy_engine_address IS NULL) OR (policy_engine_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_rental_module_address_check CHECK (((rental_module_address IS NULL) OR (rental_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_royalty_module_address_check CHECK (((royalty_module_address IS NULL) OR (royalty_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_soulbound_module_address_check CHECK (((soulbound_module_address IS NULL) OR (soulbound_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_erc721_properties_vesting_module_address_check CHECK (((vesting_module_address IS NULL) OR (vesting_module_address ~* '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT valid_document_config_erc721 CHECK (((document_config IS NULL) OR public.validate_document_config(document_config))),
    CONSTRAINT whitelist_config_structure_check CHECK (((whitelist_config IS NULL) OR ((jsonb_typeof(whitelist_config) = 'object'::text) AND (whitelist_config ? 'enabled'::text) AND (((whitelist_config -> 'enabled'::text))::text = ANY (ARRAY['true'::text, 'false'::text])))))
);


--
-- Name: TABLE token_erc721_properties; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_erc721_properties IS 'ERC-721 properties - Phase 2 cleanup complete (2025-12-30): Removed 17 sales/minting fields';


--
-- Name: COLUMN token_erc721_properties.soulbound; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.soulbound IS 'Whether tokens are non-transferable after mint';


--
-- Name: COLUMN token_erc721_properties.compliance_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.compliance_module_address IS 'Address of ERC20ComplianceModule for KYC/AML compliance';


--
-- Name: COLUMN token_erc721_properties.policy_engine_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.policy_engine_address IS 'Address of PolicyEngine for pre-transaction validation';


--
-- Name: COLUMN token_erc721_properties.vesting_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.vesting_module_address IS 'Address of ERC20VestingModule for token lock schedules';


--
-- Name: COLUMN token_erc721_properties.document_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.document_module_address IS 'Address of UniversalDocumentModule for document management';


--
-- Name: COLUMN token_erc721_properties.consecutive_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.consecutive_module_address IS 'Address of deployed consecutive minting module instance';


--
-- Name: COLUMN token_erc721_properties.fractionalization_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.fractionalization_module_address IS 'Address of ERC721FractionModule for NFT fractionalization';


--
-- Name: COLUMN token_erc721_properties.rental_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.rental_module_address IS 'Address of ERC721RentalModule for NFT rental/leasing';


--
-- Name: COLUMN token_erc721_properties.royalty_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.royalty_module_address IS 'Address of ERC721RoyaltyModule for creator royalties';


--
-- Name: COLUMN token_erc721_properties.soulbound_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.soulbound_module_address IS 'Address of ERC721SoulboundModule for non-transferable tokens';


--
-- Name: COLUMN token_erc721_properties.metadata_events_module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.metadata_events_module_address IS 'Address of deployed metadata events module instance';


--
-- Name: COLUMN token_erc721_properties.consecutive; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.consecutive IS 'Enable batch minting with sequential IDs (ERC721C) for gas efficiency';


--
-- Name: COLUMN token_erc721_properties.metadata_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.metadata_events IS 'Emit events when metadata changes (essential for dynamic/evolving NFTs)';


--
-- Name: COLUMN token_erc721_properties.policy_engine_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.policy_engine_enabled IS 'Enable policy engine for transaction validation against configurable rules';


--
-- Name: COLUMN token_erc721_properties.policy_rules_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.policy_rules_enabled IS 'Comma-separated list of enabled policy rule IDs (e.g., "transfer_limit,holder_limit,time_lock")';


--
-- Name: COLUMN token_erc721_properties.policy_validators_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.policy_validators_enabled IS 'Comma-separated list of enabled validator IDs (e.g., "kyc_validator,accreditation_validator")';


--
-- Name: COLUMN token_erc721_properties.document_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.document_config IS 'NFT legal documents: {documents: [{name, uri, hash, documentType}]}';


--
-- Name: COLUMN token_erc721_properties.consecutive_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.consecutive_config IS 'Consecutive minting: {batchSize, startTokenId}';


--
-- Name: COLUMN token_erc721_properties.soulbound_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_erc721_properties.soulbound_config IS 'Soulbound settings: {transferable, burnableByOwner}';


--
-- Name: token_erc721_trait_definitions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_erc721_trait_definitions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    trait_name text NOT NULL,
    trait_type text NOT NULL,
    possible_values jsonb,
    rarity_weights jsonb,
    is_required boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: token_erc721_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_erc721_view AS
 SELECT t.id AS token_id,
    t.name,
    t.symbol,
    t.decimals,
    t.standard,
    t.total_supply,
    t.metadata,
    t.status,
    t.description,
    t.created_at AS token_created_at,
    t.updated_at AS token_updated_at,
    p.id AS erc721_property_id,
    p.base_uri,
    p.max_supply,
    p.has_royalty,
    p.royalty_percentage,
    p.royalty_receiver,
    p.is_burnable,
    p.is_pausable,
    p.asset_type,
    p.minting_method,
    p.auto_increment_ids,
    p.enumerable,
    p.updatable_uris,
    p.sales_config,
    p.permission_config,
    p.soulbound,
    p.created_at AS property_created_at,
    p.updated_at AS property_updated_at
   FROM (public.tokens t
     LEFT JOIN public.token_erc721_properties p ON ((t.id = p.token_id)))
  WHERE (t.standard = 'ERC-721'::public.token_standard_enum);


--
-- Name: token_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_events (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_id uuid NOT NULL,
    event_type text NOT NULL,
    severity text NOT NULL,
    message text NOT NULL,
    data jsonb,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    is_read boolean DEFAULT false NOT NULL,
    CONSTRAINT token_events_severity_check CHECK ((severity = ANY (ARRAY['info'::text, 'low'::text, 'medium'::text, 'high'::text, 'critical'::text])))
);


--
-- Name: token_exchange_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_exchange_configs (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_id uuid NOT NULL,
    currency text NOT NULL,
    base_currency text NOT NULL,
    update_frequency integer DEFAULT 300 NOT NULL,
    sources jsonb DEFAULT '[]'::jsonb NOT NULL,
    fallback_rate numeric(20,8),
    max_deviation numeric(5,2) DEFAULT 5.00,
    require_multi_source boolean DEFAULT false,
    active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    CONSTRAINT token_exchange_configs_base_currency_check CHECK ((base_currency = ANY (ARRAY['USDC'::text, 'USDT'::text]))),
    CONSTRAINT token_exchange_configs_currency_check CHECK ((currency = ANY (ARRAY['USDC'::text, 'USDT'::text])))
);


--
-- Name: TABLE token_exchange_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_exchange_configs IS 'Configuration for token exchange rates (USDC/USDT)';


--
-- Name: COLUMN token_exchange_configs.sources; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_exchange_configs.sources IS 'Array of price oracle sources: [{type, provider, endpoint}]';


--
-- Name: COLUMN token_exchange_configs.max_deviation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_exchange_configs.max_deviation IS 'Maximum allowed deviation percentage from previous rate';


--
-- Name: token_extensions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_extensions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    extension_type text NOT NULL,
    extension_address text NOT NULL,
    configuration jsonb DEFAULT '{}'::jsonb NOT NULL,
    is_active boolean DEFAULT true,
    attached_at timestamp with time zone DEFAULT now(),
    attached_by uuid,
    attached_tx_hash text,
    detached_at timestamp with time zone,
    detached_by uuid,
    detached_tx_hash text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT token_extensions_extension_type_check CHECK ((extension_type = ANY (ARRAY['compliance'::text, 'vesting'::text, 'royalty'::text, 'fee'::text])))
);


--
-- Name: token_geographic_restrictions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_geographic_restrictions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    restriction_type text NOT NULL,
    country_code character(2) NOT NULL,
    max_ownership_percentage numeric(5,2),
    min_investment_amount text,
    max_investment_amount text,
    requires_local_custodian boolean DEFAULT false,
    requires_tax_clearance boolean DEFAULT false,
    requires_regulatory_approval boolean DEFAULT false,
    holding_period_restriction integer,
    transfer_restrictions jsonb,
    reporting_requirements jsonb,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    expiry_date date,
    notes text,
    created_by text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT valid_ownership_percentage CHECK (((max_ownership_percentage >= (0)::numeric) AND (max_ownership_percentage <= (100)::numeric))),
    CONSTRAINT valid_restriction_type CHECK ((restriction_type = ANY (ARRAY['blocked'::text, 'allowed'::text, 'limited'::text, 'enhanced_dd'::text, 'conditional'::text])))
);


--
-- Name: TABLE token_geographic_restrictions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_geographic_restrictions IS 'Token-specific geographic restrictions and compliance rules';


--
-- Name: token_geographic_restrictions_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_geographic_restrictions_view AS
 SELECT tgr.token_id,
    t.name AS token_name,
    t.symbol AS token_symbol,
    t.standard,
    tgr.restriction_type,
    gj.country_code,
    gj.country_name,
    gj.region,
    gj.regulatory_regime,
    tgr.max_ownership_percentage,
    tgr.requires_local_custodian,
    tgr.requires_regulatory_approval,
    gj.sanctions_risk_level,
    gj.is_ofac_sanctioned,
    gj.is_eu_sanctioned,
    gj.is_un_sanctioned,
    tgr.effective_date,
    tgr.expiry_date,
    tgr.notes
   FROM ((public.token_geographic_restrictions tgr
     JOIN public.tokens t ON ((tgr.token_id = t.id)))
     JOIN public.geographic_jurisdictions gj ON ((tgr.country_code = gj.country_code)))
  WHERE (((tgr.effective_date IS NULL) OR (tgr.effective_date <= CURRENT_DATE)) AND ((tgr.expiry_date IS NULL) OR (tgr.expiry_date > CURRENT_DATE)));


--
-- Name: token_modules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_modules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    module_type text NOT NULL,
    module_address text NOT NULL,
    master_address text,
    deployment_tx_hash text,
    configuration jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    attached_at timestamp with time zone DEFAULT now(),
    deployed_at timestamp with time zone,
    detached_at timestamp with time zone,
    deployed_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    source_verified boolean DEFAULT false,
    source_verification_status text DEFAULT 'not_verified'::text,
    source_verification_guid text,
    source_verification_attempts integer DEFAULT 0,
    last_source_verification_attempt timestamp with time zone,
    block_explorer_url text,
    CONSTRAINT token_modules_master_address_check CHECK (((master_address IS NULL) OR (master_address ~ '^0x[a-fA-F0-9]{40}$'::text))),
    CONSTRAINT token_modules_module_address_check CHECK ((module_address ~ '^0x[a-fA-F0-9]{40}$'::text)),
    CONSTRAINT token_modules_module_type_check CHECK ((module_type = ANY (ARRAY['compliance'::text, 'vesting'::text, 'fees'::text, 'policy_engine'::text])))
);


--
-- Name: TABLE token_modules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_modules IS 'Tracks extension module deployments and attachments to tokens';


--
-- Name: COLUMN token_modules.module_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.module_type IS 'Type of module: compliance, vesting, fees, or policy_engine';


--
-- Name: COLUMN token_modules.module_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.module_address IS 'On-chain address of the deployed module';


--
-- Name: COLUMN token_modules.master_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.master_address IS 'Address of the master contract this module was cloned from';


--
-- Name: COLUMN token_modules.configuration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.configuration IS 'Module-specific configuration parameters';


--
-- Name: COLUMN token_modules.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.is_active IS 'Whether this module is currently active/attached';


--
-- Name: COLUMN token_modules.attached_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.attached_at IS 'When the module was attached to the token';


--
-- Name: COLUMN token_modules.detached_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.detached_at IS 'When the module was detached (if applicable)';


--
-- Name: COLUMN token_modules.source_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.source_verified IS 'Whether source code is verified on block explorer';


--
-- Name: COLUMN token_modules.source_verification_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.source_verification_status IS 'Status: not_verified, pending, verified, failed, already_verified';


--
-- Name: COLUMN token_modules.source_verification_guid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.source_verification_guid IS 'GUID from block explorer for tracking verification';


--
-- Name: COLUMN token_modules.source_verification_attempts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.source_verification_attempts IS 'Number of verification attempts';


--
-- Name: COLUMN token_modules.last_source_verification_attempt; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.last_source_verification_attempt IS 'Timestamp of last verification attempt';


--
-- Name: COLUMN token_modules.block_explorer_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_modules.block_explorer_url IS 'URL to verified contract on block explorer';


--
-- Name: token_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    operation_type text NOT NULL,
    operator text NOT NULL,
    amount numeric,
    recipient text,
    sender text,
    target_address text,
    nft_token_id text,
    token_type_id text,
    slot_id text,
    value numeric,
    partition text,
    asset_token_address text,
    lock_duration integer,
    lock_reason text,
    unlock_time timestamp with time zone,
    lock_id text,
    transaction_hash text,
    "timestamp" timestamp with time zone DEFAULT now(),
    status text DEFAULT 'SUCCESSFUL'::text,
    error_message text,
    blocks jsonb
);


--
-- Name: token_sanctions_rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_sanctions_rules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    sanctions_regime text NOT NULL,
    screening_enabled boolean DEFAULT true,
    auto_block_sanctioned_entities boolean DEFAULT true,
    enhanced_due_diligence_required boolean DEFAULT false,
    manual_review_threshold text,
    screening_frequency text DEFAULT 'real_time'::text,
    whitelist_override_allowed boolean DEFAULT false,
    last_screening_update timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE token_sanctions_rules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.token_sanctions_rules IS 'Sanctions screening configuration per token';


--
-- Name: token_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_templates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    project_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    standard text NOT NULL,
    blocks jsonb NOT NULL,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT token_templates_standard_check CHECK ((standard = ANY (ARRAY['ERC-20'::text, 'ERC-721'::text, 'ERC-1155'::text, 'ERC-1400'::text, 'ERC-3525'::text, 'ERC-4626'::text])))
);


--
-- Name: token_versions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_versions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    version integer NOT NULL,
    data jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    created_by text,
    blocks jsonb,
    decimals integer,
    metadata jsonb,
    name text,
    standard text,
    symbol text,
    notes text
);


--
-- Name: token_whitelists; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.token_whitelists (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_id uuid NOT NULL,
    wallet_address text NOT NULL,
    blockchain text NOT NULL,
    approved_by uuid,
    approval_date timestamp with time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    updated_by uuid,
    approval_reason text,
    removal_date timestamp with time zone,
    removal_reason text,
    removal_by uuid
);


--
-- Name: COLUMN token_whitelists.created_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.created_by IS 'User ID who added the address to whitelist';


--
-- Name: COLUMN token_whitelists.updated_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.updated_by IS 'User ID who last modified the whitelist entry';


--
-- Name: COLUMN token_whitelists.approval_reason; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.approval_reason IS 'Reason for approving the address';


--
-- Name: COLUMN token_whitelists.removal_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.removal_date IS 'Date when address was removed from whitelist';


--
-- Name: COLUMN token_whitelists.removal_reason; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.removal_reason IS 'Reason for removing the address';


--
-- Name: COLUMN token_whitelists.removal_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.token_whitelists.removal_by IS 'User ID who removed the address';


--
-- Name: token_whitelist_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.token_whitelist_summary AS
 SELECT t.id AS token_id,
    t.name AS token_name,
    t.symbol AS token_symbol,
    t.standard AS token_standard,
        CASE
            WHEN (t.standard = 'ERC-20'::public.token_standard_enum) THEN COALESCE((tw.address_count > 0), false)
            WHEN (t.standard = 'ERC-721'::public.token_standard_enum) THEN COALESCE(((erc721.whitelist_config ->> 'enabled'::text))::boolean, false)
            WHEN (t.standard = 'ERC-1155'::public.token_standard_enum) THEN COALESCE(((erc1155.whitelist_config ->> 'enabled'::text))::boolean, false)
            WHEN (t.standard = 'ERC-1400'::public.token_standard_enum) THEN COALESCE(erc1400.investor_whitelist_enabled, false)
            WHEN (t.standard = 'ERC-3525'::public.token_standard_enum) THEN COALESCE(((erc3525.whitelist_config ->> 'enabled'::text))::boolean, false)
            WHEN (t.standard = 'ERC-4626'::public.token_standard_enum) THEN COALESCE(((erc4626.whitelist_config ->> 'enabled'::text))::boolean, false)
            ELSE NULL::boolean
        END AS whitelist_enabled,
    COALESCE(tw.address_count, (0)::bigint) AS whitelisted_address_count,
    t.created_at,
    t.updated_at
   FROM ((((((public.tokens t
     LEFT JOIN public.token_erc721_properties erc721 ON ((t.id = erc721.token_id)))
     LEFT JOIN public.token_erc1155_properties erc1155 ON ((t.id = erc1155.token_id)))
     LEFT JOIN public.token_erc1400_properties erc1400 ON ((t.id = erc1400.token_id)))
     LEFT JOIN public.token_erc3525_properties erc3525 ON ((t.id = erc3525.token_id)))
     LEFT JOIN public.token_erc4626_properties erc4626 ON ((t.id = erc4626.token_id)))
     LEFT JOIN ( SELECT token_whitelists.token_id,
            count(*) AS address_count
           FROM public.token_whitelists
          WHERE (token_whitelists.is_active = true)
          GROUP BY token_whitelists.token_id) tw ON ((t.id = tw.token_id)));


--
-- Name: trade_finance_auction_executions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_auction_executions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    auction_id bigint NOT NULL,
    liquidator_address character varying(42) NOT NULL,
    collateral_received numeric(78,0) NOT NULL,
    debt_paid numeric(78,0) NOT NULL,
    final_price numeric(78,0) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    executed_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_authorized_claimers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_authorized_claimers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    claimer_address character varying(42) NOT NULL,
    chain_id integer DEFAULT 1 NOT NULL,
    is_active boolean DEFAULT true,
    authorized_at timestamp with time zone DEFAULT now(),
    revoked_at timestamp with time zone,
    expires_at timestamp with time zone
);


--
-- Name: TABLE trade_finance_authorized_claimers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_authorized_claimers IS 'Delegated claiming permissions for institutional accounts';


--
-- Name: COLUMN trade_finance_authorized_claimers.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.trade_finance_authorized_claimers.expires_at IS 'Optional expiration date for the claimer authorization';


--
-- Name: trade_finance_commodity_emission_configs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_commodity_emission_configs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type character varying(50) NOT NULL,
    commodity_type_hash character varying(66),
    seasonal_multiplier numeric(38,18) DEFAULT 1.0,
    volatility_adjustment numeric(38,18) DEFAULT 0,
    min_emission numeric(78,0) DEFAULT 0,
    max_emission numeric(78,0),
    is_active boolean DEFAULT true,
    effective_from timestamp with time zone DEFAULT now(),
    effective_until timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_commodity_emission_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_commodity_emission_configs IS 'Commodity-specific emission adjustments';


--
-- Name: trade_finance_dutch_auctions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_dutch_auctions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    auction_id bigint NOT NULL,
    user_address character varying(42) NOT NULL,
    collateral_asset character varying(42) NOT NULL,
    debt_asset character varying(42) NOT NULL,
    collateral_amount numeric(78,0) NOT NULL,
    debt_amount numeric(78,0) NOT NULL,
    start_time timestamp without time zone NOT NULL,
    duration integer NOT NULL,
    start_price numeric(78,0) NOT NULL,
    start_discount_bps integer NOT NULL,
    end_discount_bps integer NOT NULL,
    use_exponential_decay boolean DEFAULT false,
    active boolean DEFAULT true,
    physical_delivery_requested boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_emission_admins; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_emission_admins (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    reward_token_address character varying(42) NOT NULL,
    admin_address character varying(42) NOT NULL,
    chain_id integer DEFAULT 1 NOT NULL,
    is_active boolean DEFAULT true,
    granted_at timestamp with time zone DEFAULT now(),
    revoked_at timestamp with time zone
);


--
-- Name: TABLE trade_finance_emission_admins; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_emission_admins IS 'Admin permissions per reward token';


--
-- Name: trade_finance_fee_accumulations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_fee_accumulations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    current_amount numeric(78,0) DEFAULT 0,
    total_collected numeric(78,0) DEFAULT 0,
    last_collected timestamp without time zone,
    last_distributed timestamp without time zone,
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_fee_collections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_fee_collections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    amount numeric(78,0) NOT NULL,
    fee_source character varying(50) NOT NULL,
    collector_address character varying(42),
    transaction_hash character varying(66),
    block_number bigint,
    collected_at timestamp without time zone DEFAULT now(),
    CONSTRAINT trade_finance_fee_collections_fee_source_check CHECK (((fee_source)::text = ANY (ARRAY[('INTEREST_SPREAD'::character varying)::text, ('FLASH_LOAN'::character varying)::text, ('LIQUIDATION_BONUS'::character varying)::text, ('ORACLE_SUBSCRIPTION'::character varying)::text, ('POSITION_MANAGEMENT'::character varying)::text, ('OTHER'::character varying)::text])))
);


--
-- Name: trade_finance_fee_distributions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_fee_distributions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    recipient_id character varying(50) NOT NULL,
    recipient_address character varying(42) NOT NULL,
    amount numeric(78,0) NOT NULL,
    share_bps integer NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    distributed_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_flash_liquidations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_flash_liquidations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    liquidation_id bigint NOT NULL,
    initiator_address character varying(42) NOT NULL,
    user_address character varying(42) NOT NULL,
    collateral_asset character varying(42) NOT NULL,
    debt_asset character varying(42) NOT NULL,
    flash_loan_amount numeric(78,0) NOT NULL,
    collateral_received numeric(78,0) NOT NULL,
    debt_covered numeric(78,0) NOT NULL,
    flash_loan_fee numeric(78,0) NOT NULL,
    profit numeric(78,0) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    executed_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_health_warnings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_health_warnings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    health_factor numeric(78,18) NOT NULL,
    warning_type character varying(20) NOT NULL,
    issued_at timestamp without time zone DEFAULT now(),
    acknowledged boolean DEFAULT false,
    CONSTRAINT trade_finance_health_warnings_warning_type_check CHECK (((warning_type)::text = ANY (ARRAY[('LOW'::character varying)::text, ('CRITICAL'::character varying)::text, ('MARGIN_CALL'::character varying)::text])))
);


--
-- Name: trade_finance_insurance_claims; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_insurance_claims (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    commodity_type character varying(50) NOT NULL,
    claim_amount numeric(78,0) NOT NULL,
    claim_reason text,
    status character varying(20) DEFAULT 'PENDING'::character varying,
    initiated_at timestamp without time zone DEFAULT now(),
    resolved_at timestamp without time zone,
    payout_amount numeric(78,0),
    CONSTRAINT trade_finance_insurance_claims_status_check CHECK (((status)::text = ANY (ARRAY[('PENDING'::character varying)::text, ('APPROVED'::character varying)::text, ('REJECTED'::character varying)::text, ('PAID'::character varying)::text])))
);


--
-- Name: trade_finance_interest_rate_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_interest_rate_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    reserve_address character varying(42) NOT NULL,
    chain_id integer DEFAULT 1 NOT NULL,
    optimal_usage_ratio integer DEFAULT 8000 NOT NULL,
    base_variable_borrow_rate integer DEFAULT 100 NOT NULL,
    variable_rate_slope1 integer DEFAULT 400 NOT NULL,
    variable_rate_slope2 integer DEFAULT 6000 NOT NULL,
    commodity_type integer DEFAULT 0 NOT NULL,
    seasonal_enabled boolean DEFAULT false,
    storage_adjustment_bps integer DEFAULT 0,
    quality_decay_rate_bps integer DEFAULT 0,
    contango_adjustment_bps integer DEFAULT 0,
    asset_symbol character varying(20),
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: trade_finance_margin_calls; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_margin_calls (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    commodity_type character varying(50) NOT NULL,
    start_time timestamp without time zone NOT NULL,
    end_time timestamp without time zone NOT NULL,
    initial_health_factor numeric(78,18) NOT NULL,
    required_collateral numeric(78,0) NOT NULL,
    resolved boolean DEFAULT false,
    liquidated boolean DEFAULT false,
    resolution_time timestamp without time zone,
    collateral_added numeric(78,0),
    new_health_factor numeric(78,18),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_partial_liquidations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_partial_liquidations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    liquidator_address character varying(42) NOT NULL,
    collateral_asset character varying(42) NOT NULL,
    debt_asset character varying(42) NOT NULL,
    collateral_liquidated numeric(78,0) NOT NULL,
    debt_covered numeric(78,0) NOT NULL,
    new_health_factor numeric(78,18) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    executed_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_payment_streams; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_payment_streams (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stream_id bigint NOT NULL,
    sender_address character varying(42) NOT NULL,
    recipient_address character varying(42) NOT NULL,
    token_address character varying(42) NOT NULL,
    deposit_amount numeric(78,0) NOT NULL,
    start_time timestamp without time zone NOT NULL,
    stop_time timestamp without time zone NOT NULL,
    remaining_balance numeric(78,0) NOT NULL,
    rate_per_second numeric(78,0) NOT NULL,
    withdrawn_amount numeric(78,0) DEFAULT 0,
    canceled boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_protocol_reserve; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_protocol_reserve (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    total_balance numeric(78,0) DEFAULT 0,
    allocated_amount numeric(78,0) DEFAULT 0,
    available_amount numeric(78,0) DEFAULT 0,
    last_deposit timestamp without time zone,
    last_withdrawal timestamp without time zone,
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_rate_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_rate_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    reserve_address character varying(42) NOT NULL,
    chain_id integer DEFAULT 1 NOT NULL,
    liquidity_rate_ray character varying(78) NOT NULL,
    variable_borrow_rate_ray character varying(78) NOT NULL,
    utilization_ratio_ray character varying(78) NOT NULL,
    liquidity_rate_percent numeric(10,4),
    variable_borrow_rate_percent numeric(10,4),
    utilization_percent numeric(10,4),
    total_supply character varying(78),
    total_borrows character varying(78),
    available_liquidity character varying(78),
    seasonal_multiplier_bps integer,
    commodity_adjustment_bps integer,
    snapshot_timestamp timestamp with time zone DEFAULT now()
);


--
-- Name: trade_finance_rate_simulations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_rate_simulations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    reserve_address character varying(42) NOT NULL,
    chain_id integer DEFAULT 1 NOT NULL,
    simulated_utilization numeric(10,4) NOT NULL,
    simulated_liquidity_rate numeric(10,4) NOT NULL,
    simulated_borrow_rate numeric(10,4) NOT NULL,
    with_seasonal_adjustment boolean DEFAULT false,
    seasonal_month integer,
    simulation_timestamp timestamp with time zone DEFAULT now()
);


--
-- Name: trade_finance_reserve_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_reserve_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    transaction_type character varying(20) NOT NULL,
    amount numeric(78,0) NOT NULL,
    purpose text,
    authorized_by character varying(42) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    executed_at timestamp without time zone DEFAULT now(),
    CONSTRAINT trade_finance_reserve_transactions_transaction_type_check CHECK (((transaction_type)::text = ANY (ARRAY[('DEPOSIT'::character varying)::text, ('WITHDRAWAL'::character varying)::text, ('ALLOCATION'::character varying)::text, ('DEALLOCATION'::character varying)::text])))
);


--
-- Name: trade_finance_revenue_recipients; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_revenue_recipients (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    recipient_id character varying(50) NOT NULL,
    recipient_address character varying(42) NOT NULL,
    recipient_name character varying(100),
    recipient_type character varying(30),
    fee_share_bps integer NOT NULL,
    active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT trade_finance_revenue_recipients_fee_share_bps_check CHECK (((fee_share_bps >= 0) AND (fee_share_bps <= 10000))),
    CONSTRAINT trade_finance_revenue_recipients_recipient_type_check CHECK (((recipient_type)::text = ANY (ARRAY[('TREASURY'::character varying)::text, ('TEAM'::character varying)::text, ('INSURANCE_FUND'::character varying)::text, ('DEVELOPMENT_FUND'::character varying)::text, ('COMMUNITY'::character varying)::text, ('OPERATIONS'::character varying)::text])))
);


--
-- Name: trade_finance_rewards_claims; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_rewards_claims (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    reward_token_address character varying(42) NOT NULL,
    reward_token_symbol character varying(50),
    amount numeric(78,0) NOT NULL,
    amount_formatted numeric(38,18),
    to_address character varying(42) NOT NULL,
    claimer_address character varying(42),
    transaction_hash character varying(66),
    block_number bigint,
    chain_id integer DEFAULT 1 NOT NULL,
    claimed_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_rewards_claims; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_rewards_claims IS 'History of reward claims for audit and analytics';


--
-- Name: trade_finance_rewards_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_rewards_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_address character varying(42) NOT NULL,
    asset_symbol character varying(50),
    reward_token_address character varying(42) NOT NULL,
    reward_token_symbol character varying(50),
    emission_per_second numeric(78,0) DEFAULT 0 NOT NULL,
    distribution_end timestamp with time zone NOT NULL,
    distribution_start timestamp with time zone DEFAULT now(),
    transfer_strategy_address character varying(42),
    transfer_strategy_type character varying(50) DEFAULT 'pull'::character varying,
    reward_oracle_address character varying(42),
    reward_decimals smallint DEFAULT 18,
    asset_decimals smallint DEFAULT 18,
    current_index numeric(78,0) DEFAULT 0,
    last_update_timestamp timestamp with time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    chain_id integer DEFAULT 1 NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_rewards_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_rewards_config IS 'Configuration for reward distributions per asset-reward pair';


--
-- Name: trade_finance_rewards_snapshots; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_rewards_snapshots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    asset_address character varying(42) NOT NULL,
    reward_token_address character varying(42) NOT NULL,
    snapshot_timestamp timestamp with time zone NOT NULL,
    total_distributed numeric(78,0) DEFAULT 0,
    total_claimed numeric(78,0) DEFAULT 0,
    total_unclaimed numeric(78,0) DEFAULT 0,
    unique_claimers integer DEFAULT 0,
    current_emission_rate numeric(78,0),
    current_index numeric(78,0),
    chain_id integer DEFAULT 1 NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_rewards_snapshots; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_rewards_snapshots IS 'Periodic snapshots for analytics and reporting';


--
-- Name: trade_finance_seasonal_multipliers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_seasonal_multipliers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    commodity_type integer NOT NULL,
    month integer NOT NULL,
    multiplier_bps integer DEFAULT 10000 NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT trade_finance_seasonal_multipliers_month_check CHECK (((month >= 0) AND (month <= 11))),
    CONSTRAINT trade_finance_seasonal_multipliers_multiplier_bps_check CHECK (((multiplier_bps >= 7000) AND (multiplier_bps <= 15000)))
);


--
-- Name: trade_finance_stata_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_stata_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stata_token_address character varying(42) NOT NULL,
    user_address character varying(42) NOT NULL,
    operation_type character varying(20) NOT NULL,
    assets_amount numeric(78,0) NOT NULL,
    shares_amount numeric(78,0) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    "timestamp" timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_stata_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_stata_tokens (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stata_token_address character varying(42) NOT NULL,
    ctoken_address character varying(42) NOT NULL,
    underlying_address character varying(42) NOT NULL,
    commodity_type character varying(50) NOT NULL,
    name character varying(100) NOT NULL,
    symbol character varying(20) NOT NULL,
    total_assets numeric(78,0) DEFAULT 0,
    total_shares numeric(78,0) DEFAULT 0,
    deployed_at timestamp without time zone DEFAULT now(),
    deployer_address character varying(42),
    chain_id integer DEFAULT 1,
    is_paused boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_stream_withdrawals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_stream_withdrawals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    stream_id bigint NOT NULL,
    recipient_address character varying(42) NOT NULL,
    amount numeric(78,0) NOT NULL,
    transaction_hash character varying(66),
    block_number bigint,
    withdrawn_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_transfer_strategies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_transfer_strategies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    strategy_address character varying(42) NOT NULL,
    strategy_type character varying(50) NOT NULL,
    rewards_vault_address character varying(42),
    staked_token_address character varying(42),
    underlying_token_address character varying(42),
    chain_id integer DEFAULT 1 NOT NULL,
    is_active boolean DEFAULT true,
    deployed_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_transfer_strategies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_transfer_strategies IS 'Registry of transfer strategy contracts';


--
-- Name: trade_finance_treasury_snapshots; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_treasury_snapshots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    token_address character varying(42) NOT NULL,
    balance numeric(78,0) NOT NULL,
    accumulated_fees numeric(78,0) NOT NULL,
    distributed_amount numeric(78,0) NOT NULL,
    reserve_balance numeric(78,0) NOT NULL,
    snapshot_date date NOT NULL,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: trade_finance_user_rewards; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trade_finance_user_rewards (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_address character varying(42) NOT NULL,
    asset_address character varying(42) NOT NULL,
    reward_token_address character varying(42) NOT NULL,
    user_index numeric(78,0) DEFAULT 0,
    accrued_amount numeric(78,0) DEFAULT 0,
    claimed_amount numeric(78,0) DEFAULT 0,
    last_update_timestamp timestamp with time zone DEFAULT now(),
    chain_id integer DEFAULT 1 NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE trade_finance_user_rewards; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.trade_finance_user_rewards IS 'User-level reward tracking with index and accrued amounts';


--
-- Name: transaction_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction_events (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    request_id text NOT NULL,
    event_type text NOT NULL,
    "timestamp" timestamp with time zone DEFAULT now() NOT NULL,
    data jsonb NOT NULL,
    actor text,
    actor_role text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: transaction_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction_notifications (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    transaction_id text,
    wallet_address text NOT NULL,
    type text NOT NULL,
    message text NOT NULL,
    read boolean DEFAULT false,
    action_url text,
    data jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: transaction_signatures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction_signatures (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    proposal_id uuid NOT NULL,
    transaction_hash text,
    signer uuid NOT NULL,
    signature text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    signer_address text,
    signer_name text
);


--
-- Name: TABLE transaction_signatures; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.transaction_signatures IS 'Signatures for multi-signature transactions';


--
-- Name: COLUMN transaction_signatures.signer_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.transaction_signatures.signer_address IS 'Ethereum address used for signing - must match multi-sig contract owner';


--
-- Name: COLUMN transaction_signatures.signer_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.transaction_signatures.signer_name IS 'Cached user name for display purposes';


--
-- Name: transaction_validations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction_validations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_hash text,
    from_address text NOT NULL,
    to_address text NOT NULL,
    value text,
    data text,
    validation_result jsonb NOT NULL,
    policies_checked uuid[],
    rules_checked uuid[],
    valid boolean NOT NULL,
    proceeded boolean,
    override_used boolean DEFAULT false,
    override_by uuid,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_hash text NOT NULL,
    from_address text NOT NULL,
    to_address text NOT NULL,
    value numeric DEFAULT 0 NOT NULL,
    token_symbol text,
    token_address text,
    blockchain text DEFAULT 'ethereum'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    type text DEFAULT 'transfer'::text NOT NULL,
    gas_used numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    gas_limit numeric,
    gas_price numeric,
    max_fee_per_gas numeric,
    max_priority_fee_per_gas numeric,
    block_number integer,
    block_hash text,
    transaction_index integer,
    confirmations integer DEFAULT 0,
    memo text,
    destination_tag integer,
    transfer_type text DEFAULT 'standard'::text,
    network_fee numeric,
    estimated_confirmation_time interval,
    project_id uuid,
    CONSTRAINT transactions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'confirmed'::text, 'failed'::text]))),
    CONSTRAINT transactions_transfer_type_check CHECK ((transfer_type = ANY (ARRAY['standard'::text, 'token'::text, 'nft'::text, 'multisig'::text]))),
    CONSTRAINT transactions_type_check CHECK ((type = ANY (ARRAY['transfer'::text, 'token_transfer'::text, 'nft_transfer'::text])))
);


--
-- Name: TABLE transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.transactions IS 'General blockchain transactions table for tracking transfers and operations';


--
-- Name: transfer_batches; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transfer_batches (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    transfer_ids uuid[] NOT NULL,
    status text NOT NULL,
    gas_optimization jsonb,
    total_gas_saved text,
    executed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT transfer_batches_status_check CHECK ((status = ANY (ARRAY['preparing'::text, 'executing'::text, 'completed'::text, 'failed'::text])))
);


--
-- Name: TABLE transfer_batches; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.transfer_batches IS 'Stage 11: Batched transfers for gas optimization';


--
-- Name: transfer_history; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.transfer_history AS
 SELECT t.id,
    t.transaction_hash AS hash,
    t.from_address,
    t.to_address,
    t.value AS amount,
    t.token_symbol AS asset,
    t.blockchain,
    t.status,
    t.type AS transfer_type,
    t.network_fee,
    t.gas_used,
    t.block_number,
    t.confirmations,
    t.memo,
    t.created_at,
    t.updated_at
   FROM public.transactions t
  WHERE (t.type = ANY (ARRAY['transfer'::text, 'token_transfer'::text, 'nft_transfer'::text]))
  ORDER BY t.created_at DESC;


--
-- Name: VIEW transfer_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.transfer_history IS 'Unified view of all transfer transactions across different blockchains';


--
-- Name: transfer_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transfer_operations (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    redemption_id uuid NOT NULL,
    type text NOT NULL,
    status text NOT NULL,
    from_wallet text NOT NULL,
    to_wallet text NOT NULL,
    token_address text NOT NULL,
    amount text NOT NULL,
    gas_estimate jsonb,
    transaction_hash text,
    confirmations integer DEFAULT 0,
    block_number bigint,
    chain_id integer NOT NULL,
    error jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    confirmed_at timestamp with time zone,
    CONSTRAINT transfer_operations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'simulating'::text, 'approved'::text, 'broadcasting'::text, 'confirming'::text, 'confirmed'::text, 'failed'::text, 'reversed'::text]))),
    CONSTRAINT transfer_operations_type_check CHECK ((type = ANY (ARRAY['token_collection'::text, 'settlement_payment'::text])))
);


--
-- Name: TABLE transfer_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.transfer_operations IS 'Stage 11: Automated transfer operations for redemptions';


--
-- Name: user_activity_summary; Type: MATERIALIZED VIEW; Schema: public; Owner: -
--

CREATE MATERIALIZED VIEW public.user_activity_summary AS
 SELECT audit_logs.user_id,
    audit_logs.username,
    count(*) AS total_activities,
    count(DISTINCT audit_logs.action) AS unique_actions,
    count(DISTINCT audit_logs.source) AS unique_sources,
    max(audit_logs."timestamp") AS last_activity,
    min(audit_logs."timestamp") AS first_activity,
    count(
        CASE
            WHEN (audit_logs.status = 'success'::text) THEN 1
            ELSE NULL::integer
        END) AS successful_activities,
    count(
        CASE
            WHEN (audit_logs.status = 'failure'::text) THEN 1
            ELSE NULL::integer
        END) AS failed_activities
   FROM public.audit_logs
  WHERE ((audit_logs.user_id IS NOT NULL) AND (audit_logs."timestamp" >= (CURRENT_TIMESTAMP - '30 days'::interval)))
  GROUP BY audit_logs.user_id, audit_logs.username
  WITH NO DATA;


--
-- Name: user_addresses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_addresses (
    user_id uuid,
    blockchain text,
    address text,
    encrypted_private_key text,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    signing_method text DEFAULT 'private_key'::text,
    key_vault_reference text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT user_addresses_signing_method_check CHECK ((signing_method = ANY (ARRAY['private_key'::text, 'hardware_wallet'::text, 'mpc'::text])))
);


--
-- Name: TABLE user_addresses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_addresses IS 'Execution Layer: Stores blockchain addresses for users. Each user typically has one address per chain (mainnet + testnet). These addresses are used for on-chain execution across all contract roles defined in user_contract_roles.';


--
-- Name: COLUMN user_addresses.signing_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_addresses.signing_method IS 'How the user signs transactions: private_key, hardware_wallet, or mpc';


--
-- Name: COLUMN user_addresses.key_vault_reference; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_addresses.key_vault_reference IS 'Reference to encrypted private key in KeyVault';


--
-- Name: COLUMN user_addresses.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_addresses.is_active IS 'Whether this address is active (soft delete flag)';


--
-- Name: user_approval_conditions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_approval_conditions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    field text NOT NULL,
    operator text NOT NULL,
    value jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_contract_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_contract_roles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    contract_roles jsonb DEFAULT '[]'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: TABLE user_contract_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_contract_roles IS 'Authorization Layer: Defines what contract roles a user is permitted to manage/assign. The contract_roles jsonb column contains a mapping of contract addresses to arrays of role names.';


--
-- Name: user_mfa_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_mfa_settings (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid NOT NULL,
    enabled boolean DEFAULT false NOT NULL,
    verified boolean DEFAULT false NOT NULL,
    secret text,
    backup_codes jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_operations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    user_op_hash text NOT NULL,
    sender_address text NOT NULL,
    nonce bigint NOT NULL,
    init_code text,
    call_data text NOT NULL,
    call_gas_limit bigint NOT NULL,
    verification_gas_limit bigint NOT NULL,
    pre_verification_gas bigint NOT NULL,
    max_fee_per_gas bigint NOT NULL,
    max_priority_fee_per_gas bigint NOT NULL,
    paymaster_and_data text,
    signature_data text NOT NULL,
    status text DEFAULT 'pending'::text,
    transaction_hash text,
    block_number bigint,
    gas_used bigint,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    actual_gas_cost bigint,
    failure_reason text,
    CONSTRAINT user_operations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'included'::text, 'failed'::text, 'cancelled'::text])))
);


--
-- Name: TABLE user_operations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_operations IS 'EIP-4337 UserOperations with complete lifecycle tracking';


--
-- Name: user_organization_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_organization_roles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    role_id uuid NOT NULL,
    organization_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_roles (
    user_id uuid NOT NULL,
    role_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: user_permissions_view; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.user_permissions_view AS
 SELECT u.id AS user_id,
    u.name AS user_name,
    u.email,
    r.name AS role_name,
    p.name AS permission_name,
    p.description AS permission_description,
    NULL::uuid AS organization_id,
    'global'::text AS scope
   FROM ((((public.users u
     JOIN public.user_roles ur ON ((u.id = ur.user_id)))
     JOIN public.roles r ON ((ur.role_id = r.id)))
     JOIN public.role_permissions rp ON ((r.id = rp.role_id)))
     JOIN public.permissions p ON ((rp.permission_name = p.name)))
UNION ALL
 SELECT u.id AS user_id,
    u.name AS user_name,
    u.email,
    r.name AS role_name,
    p.name AS permission_name,
    p.description AS permission_description,
    uor.organization_id,
        CASE
            WHEN (uor.organization_id IS NULL) THEN 'all_organizations'::text
            ELSE 'organization_specific'::text
        END AS scope
   FROM ((((public.users u
     JOIN public.user_organization_roles uor ON ((u.id = uor.user_id)))
     JOIN public.roles r ON ((uor.role_id = r.id)))
     JOIN public.role_permissions rp ON ((r.id = rp.role_id)))
     JOIN public.permissions p ON ((rp.permission_name = p.name)));


--
-- Name: user_preferences; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_preferences (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    notification_preferences jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_sessions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_sessions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    user_id uuid,
    session_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    last_active_at timestamp with time zone DEFAULT now(),
    ip_address text,
    user_agent text,
    device_info jsonb
);


--
-- Name: user_sidebar_preferences; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_sidebar_preferences (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    organization_id uuid,
    collapsed_sections text[],
    hidden_items text[],
    custom_order jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_token_access; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_token_access (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    token_id uuid NOT NULL,
    has_access boolean DEFAULT false,
    access_level text DEFAULT 'view'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_verifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_verifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    kyc_verified boolean DEFAULT false,
    kyc_verified_at timestamp with time zone,
    aml_verified boolean DEFAULT false,
    aml_verified_at timestamp with time zone,
    verification_level text,
    documents jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: valid_policy_approvers; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.valid_policy_approvers AS
 SELECT a.id,
    a.policy_rule_id,
    a.user_id,
    a.created_by,
    a.created_at,
    a.status,
    a.comment,
    a."timestamp"
   FROM (public.policy_rule_approvers a
     JOIN public.rules r ON ((a.policy_rule_id = r.rule_id)));


--
-- Name: validation_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.validation_alerts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    alert_type text NOT NULL,
    severity text NOT NULL,
    transaction_data jsonb,
    validation_data jsonb,
    resolved boolean DEFAULT false,
    resolved_by uuid,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT validation_alerts_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: validation_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.validation_cache (
    cache_key text NOT NULL,
    validation_result jsonb NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    hit_count integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: valuation_price_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.valuation_price_history (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    token_id uuid NOT NULL,
    period_start timestamp with time zone NOT NULL,
    period_end timestamp with time zone NOT NULL,
    open_price numeric(20,8),
    high_price numeric(20,8),
    low_price numeric(20,8),
    close_price numeric(20,8),
    volume numeric(30,0),
    price_count integer DEFAULT 0,
    sources text[] DEFAULT ARRAY[]::text[],
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE valuation_price_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.valuation_price_history IS 'OHLCV data for 4-hour valuation periods';


--
-- Name: COLUMN valuation_price_history.period_start; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.valuation_price_history.period_start IS 'Start of 4-hour period (UTC)';


--
-- Name: COLUMN valuation_price_history.sources; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.valuation_price_history.sources IS 'Array of data sources used for this period';


--
-- Name: violation_patterns; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.violation_patterns (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    operator text NOT NULL,
    pattern_type text NOT NULL,
    count integer NOT NULL,
    severity text NOT NULL,
    timeframe integer,
    first_occurrence timestamp with time zone,
    last_occurrence timestamp with time zone,
    violation_ids text[],
    detected_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT violation_patterns_severity_check CHECK ((severity = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])))
);


--
-- Name: TABLE violation_patterns; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.violation_patterns IS 'Detected patterns in compliance violations';


--
-- Name: wallet_access_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.wallet_access_summary AS
 SELECT wal.wallet_id,
    pw.wallet_address,
    pw.chain_id AS network,
    p.name AS project_name,
    count(*) AS access_count,
    count(*) FILTER (WHERE (wal.success = false)) AS failed_count,
    max(wal.created_at) AS last_access,
    json_agg(json_build_object('action', wal.action, 'success', wal.success, 'timestamp', wal.created_at, 'user_id', wal.accessed_by) ORDER BY wal.created_at DESC) FILTER (WHERE (wal.created_at >= (now() - '24:00:00'::interval))) AS recent_activity
   FROM ((public.wallet_access_logs wal
     JOIN public.project_wallets pw ON ((wal.wallet_id = pw.id)))
     JOIN public.projects p ON ((pw.project_id = p.id)))
  GROUP BY wal.wallet_id, pw.wallet_address, pw.chain_id, p.name;


--
-- Name: VIEW wallet_access_summary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.wallet_access_summary IS 'Summary of wallet access logs with chain_id as network identifier';


--
-- Name: wallet_details; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_details (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    wallet_id uuid,
    blockchain_specific_data jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: wallet_facets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_facets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    facet_name text NOT NULL,
    facet_address text NOT NULL,
    function_selectors text[] DEFAULT '{}'::text[] NOT NULL,
    is_active boolean DEFAULT true,
    added_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: wallet_guardians; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_guardians (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    guardian_address text NOT NULL,
    guardian_name text,
    status text DEFAULT 'pending_add'::text,
    requested_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    confirmed_at timestamp with time zone,
    security_period_ends timestamp with time zone,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT wallet_guardians_status_check CHECK ((status = ANY (ARRAY['pending_add'::text, 'active'::text, 'pending_remove'::text])))
);


--
-- Name: TABLE wallet_guardians; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallet_guardians IS 'Guardian addresses for social recovery with time-delayed security';


--
-- Name: wallet_locks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_locks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    lock_type text NOT NULL,
    is_locked boolean DEFAULT true NOT NULL,
    locked_by text NOT NULL,
    locked_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    unlock_time timestamp with time zone,
    lock_reason text,
    lock_nonce integer DEFAULT 1 NOT NULL,
    unlock_hash text,
    can_unlock_early boolean DEFAULT true NOT NULL,
    unlocked_by text,
    unlocked_at timestamp with time zone,
    unlock_reason text,
    lock_data jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT wallet_locks_lock_type_check CHECK ((lock_type = ANY (ARRAY['emergency'::text, 'security'::text, 'maintenance'::text, 'guardian_triggered'::text])))
);


--
-- Name: TABLE wallet_locks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallet_locks IS 'Manages emergency lock/unlock functionality with guardian recovery';


--
-- Name: COLUMN wallet_locks.lock_nonce; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_locks.lock_nonce IS 'Incremental nonce for replay protection in unlock signatures';


--
-- Name: COLUMN wallet_locks.unlock_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_locks.unlock_hash IS 'Hash for signature verification during early unlock';


--
-- Name: wallet_restriction_rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_restriction_rules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    rule_type text NOT NULL,
    name text NOT NULL,
    description text,
    is_active boolean DEFAULT true NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    rule_data jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT wallet_restriction_rules_rule_type_check CHECK ((rule_type = ANY (ARRAY['whitelist'::text, 'blacklist'::text, 'daily_limit'::text, 'time_restriction'::text, 'amount_limit'::text, 'custom'::text])))
);


--
-- Name: TABLE wallet_restriction_rules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallet_restriction_rules IS 'Defines transaction restriction rules for smart contract wallets (compliance, limits, etc.)';


--
-- Name: COLUMN wallet_restriction_rules.rule_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_restriction_rules.rule_data IS 'JSON configuration for the specific restriction type';


--
-- Name: wallet_signatories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_signatories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_address text NOT NULL,
    name text NOT NULL,
    email text NOT NULL,
    role text NOT NULL,
    status text DEFAULT 'pending'::text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT wallet_signatories_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'active'::text, 'suspended'::text])))
);


--
-- Name: wallet_transaction_drafts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_transaction_drafts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_id text NOT NULL,
    wallet_id uuid NOT NULL,
    blockchain text NOT NULL,
    from_address text NOT NULL,
    to_address text NOT NULL,
    amount numeric NOT NULL,
    raw_transaction text NOT NULL,
    nonce integer,
    data jsonb DEFAULT '{}'::jsonb,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE wallet_transaction_drafts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallet_transaction_drafts IS 'Temporary storage for unsigned transactions during the signing process';


--
-- Name: COLUMN wallet_transaction_drafts.transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transaction_drafts.transaction_id IS 'Unique transaction identifier for client reference';


--
-- Name: COLUMN wallet_transaction_drafts.raw_transaction; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transaction_drafts.raw_transaction IS 'Unsigned transaction ready for signing';


--
-- Name: COLUMN wallet_transaction_drafts.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transaction_drafts.expires_at IS 'When this draft expires and should be cleaned up';


--
-- Name: wallet_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallet_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    chain_id text,
    data jsonb,
    from_address text,
    gas_limit numeric,
    gas_price numeric,
    nonce integer,
    to_address text,
    value numeric,
    created_at timestamp with time zone DEFAULT now(),
    tx_hash text,
    status text DEFAULT 'pending'::text,
    token_symbol text,
    token_address text,
    confirmation_count integer DEFAULT 0,
    updated_at timestamp with time zone DEFAULT now(),
    project_id uuid,
    amount text,
    blockchain text,
    wallet_id uuid,
    transaction_hash text,
    transaction_type text
);


--
-- Name: COLUMN wallet_transactions.amount; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transactions.amount IS 'Human-readable amount (string format), use value for numeric calculations';


--
-- Name: COLUMN wallet_transactions.blockchain; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transactions.blockchain IS 'Blockchain network name (e.g., ethereum, polygon)';


--
-- Name: COLUMN wallet_transactions.wallet_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transactions.wallet_id IS 'Reference to wallets table - nullable because transactions can come from project_wallets. Use from_address as primary identifier.';


--
-- Name: COLUMN wallet_transactions.transaction_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transactions.transaction_hash IS 'Alias for tx_hash to support both naming conventions';


--
-- Name: COLUMN wallet_transactions.transaction_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallet_transactions.transaction_type IS 'Type of transaction (e.g., transfer, deployment, contract_call)';


--
-- Name: wallets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.wallets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    investor_id uuid NOT NULL,
    wallet_address text,
    wallet_type text NOT NULL,
    blockchain text DEFAULT 'ethereum'::text NOT NULL,
    is_multi_sig_enabled boolean DEFAULT false NOT NULL,
    guardian_policy jsonb DEFAULT '{}'::jsonb NOT NULL,
    signatories jsonb DEFAULT '[]'::jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    user_id uuid,
    mnemonic text,
    private_key text,
    project_id uuid NOT NULL,
    public_key text,
    private_key_vault_id uuid,
    mnemonic_vault_id uuid,
    public_key_vault_id uuid
);


--
-- Name: TABLE wallets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.wallets IS 'Wallet management for investors';


--
-- Name: COLUMN wallets.investor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.investor_id IS 'Reference to investor who owns the wallet';


--
-- Name: COLUMN wallets.wallet_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.wallet_address IS 'Blockchain wallet address';


--
-- Name: COLUMN wallets.wallet_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.wallet_type IS 'Type of wallet (guardian, external, etc.)';


--
-- Name: COLUMN wallets.blockchain; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.blockchain IS 'Blockchain network (ethereum, polygon, etc.)';


--
-- Name: COLUMN wallets.is_multi_sig_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.is_multi_sig_enabled IS 'Whether multi-signature is enabled';


--
-- Name: COLUMN wallets.guardian_policy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.guardian_policy IS 'Guardian wallet policy configuration';


--
-- Name: COLUMN wallets.signatories; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.signatories IS 'Array of wallet signatories';


--
-- Name: COLUMN wallets.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.status IS 'Wallet status (pending, active, inactive)';


--
-- Name: COLUMN wallets.mnemonic; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.mnemonic IS 'DEPRECATED: Use mnemonic_vault_id instead. Kept for backward compatibility.';


--
-- Name: COLUMN wallets.private_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.private_key IS 'DEPRECATED: Use private_key_vault_id instead. Kept for backward compatibility.';


--
-- Name: COLUMN wallets.public_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.public_key IS 'DEPRECATED: Use public_key_vault_id instead. Kept for backward compatibility.';


--
-- Name: COLUMN wallets.private_key_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.private_key_vault_id IS 'Reference to encrypted private key in key_vault_keys table (preferred over direct storage)';


--
-- Name: COLUMN wallets.mnemonic_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.mnemonic_vault_id IS 'Reference to encrypted mnemonic in key_vault_keys table (preferred over direct storage)';


--
-- Name: COLUMN wallets.public_key_vault_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.wallets.public_key_vault_id IS 'Reference to public key in key_vault_keys table (preferred over direct storage)';


--
-- Name: wallet_with_keys; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.wallet_with_keys AS
 SELECT w.id,
    w.investor_id,
    w.wallet_address,
    w.wallet_type,
    w.blockchain,
    w.status,
    w.project_id,
    w.private_key_vault_id,
    w.mnemonic_vault_id,
    w.public_key_vault_id,
    pk.encrypted_key AS private_key_from_vault,
    mn.encrypted_key AS mnemonic_from_vault,
    pub.encrypted_key AS public_key_from_vault,
    w.private_key AS private_key_legacy,
    w.mnemonic AS mnemonic_legacy,
    w.public_key AS public_key_legacy,
    w.created_at,
    w.updated_at
   FROM (((public.wallets w
     LEFT JOIN public.key_vault_keys pk ON ((w.private_key_vault_id = pk.id)))
     LEFT JOIN public.key_vault_keys mn ON ((w.mnemonic_vault_id = mn.id)))
     LEFT JOIN public.key_vault_keys pub ON ((w.public_key_vault_id = pub.id)));


--
-- Name: VIEW wallet_with_keys; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.wallet_with_keys IS 'View combining wallets with their keys from key_vault_keys table';


--
-- Name: weather_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.weather_cache (
    cache_id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    cache_key character varying(255) NOT NULL,
    weather_data jsonb NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    provider character varying(50) DEFAULT 'open-meteo'::character varying,
    location_lat numeric(10,7),
    location_lon numeric(10,7),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE weather_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.weather_cache IS 'Cache for free weather API data';


--
-- Name: weather_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.weather_data (
    weather_id uuid DEFAULT gen_random_uuid() NOT NULL,
    location character varying(255) NOT NULL,
    date date NOT NULL,
    sunlight_hours numeric(5,2),
    wind_speed numeric(5,2),
    temperature numeric(5,2),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: webauthn_challenges; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.webauthn_challenges (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    challenge text NOT NULL,
    challenge_type text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    is_used boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT webauthn_challenges_challenge_type_check CHECK ((challenge_type = ANY (ARRAY['registration'::text, 'authentication'::text])))
);


--
-- Name: TABLE webauthn_challenges; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.webauthn_challenges IS 'WebAuthn ceremony challenges for registration and authentication';


--
-- Name: webauthn_credentials; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.webauthn_credentials (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    wallet_id uuid NOT NULL,
    credential_id text NOT NULL,
    public_key_x text NOT NULL,
    public_key_y text NOT NULL,
    authenticator_data text,
    is_primary boolean DEFAULT false,
    device_name text,
    platform text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE webauthn_credentials; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.webauthn_credentials IS 'WebAuthn/Passkey credentials for P-256 signature verification';


--
-- Name: whitelist_entries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.whitelist_entries (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id text NOT NULL,
    address text NOT NULL,
    label text,
    added_by text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: whitelist_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.whitelist_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid,
    name text NOT NULL,
    description text,
    rule_id uuid,
    required_approvals integer NOT NULL,
    total_approvers integer NOT NULL,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT whitelist_settings_check CHECK ((total_approvers >= required_approvals)),
    CONSTRAINT whitelist_settings_required_approvals_check CHECK ((required_approvals > 0))
);


--
-- Name: whitelist_signatories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.whitelist_signatories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    whitelist_id uuid,
    user_id uuid,
    approved boolean DEFAULT false,
    approved_at timestamp with time zone
);


--
-- Name: workflow_stages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.workflow_stages (
    id text NOT NULL,
    organization_id text NOT NULL,
    name text NOT NULL,
    description text,
    status text NOT NULL,
    completion_percentage integer DEFAULT 0 NOT NULL,
    "order" integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: nav_calculation_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_history ALTER COLUMN id SET DEFAULT nextval('public.nav_calculation_history_id_seq'::regclass);


--
-- Name: abs_cash_flows abs_cash_flows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_cash_flows
    ADD CONSTRAINT abs_cash_flows_pkey PRIMARY KEY (id);


--
-- Name: abs_collateral_pools abs_collateral_pools_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_collateral_pools
    ADD CONSTRAINT abs_collateral_pools_pkey PRIMARY KEY (id);


--
-- Name: abs_loss_projections abs_loss_projections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_loss_projections
    ADD CONSTRAINT abs_loss_projections_pkey PRIMARY KEY (id);


--
-- Name: abs_prepayment_speeds abs_prepayment_speeds_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_prepayment_speeds
    ADD CONSTRAINT abs_prepayment_speeds_pkey PRIMARY KEY (id);


--
-- Name: abs_tranches abs_tranches_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_tranches
    ADD CONSTRAINT abs_tranches_pkey PRIMARY KEY (id);


--
-- Name: alerts alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.alerts
    ADD CONSTRAINT alerts_pkey PRIMARY KEY (id);


--
-- Name: approval_config_approvers approval_config_approvers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT approval_config_approvers_pkey PRIMARY KEY (id);


--
-- Name: approval_config_history approval_config_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_history
    ADD CONSTRAINT approval_config_history_pkey PRIMARY KEY (id);


--
-- Name: approval_configs approval_configs_permission_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_configs
    ADD CONSTRAINT approval_configs_permission_id_key UNIQUE (permission_id);


--
-- Name: approval_configs approval_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_configs
    ADD CONSTRAINT approval_configs_pkey PRIMARY KEY (id);


--
-- Name: approval_delegations approval_delegations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_delegations
    ADD CONSTRAINT approval_delegations_pkey PRIMARY KEY (id);


--
-- Name: approval_notifications approval_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_notifications
    ADD CONSTRAINT approval_notifications_pkey PRIMARY KEY (id);


--
-- Name: approval_processes approval_processes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_processes
    ADD CONSTRAINT approval_processes_pkey PRIMARY KEY (id);


--
-- Name: approval_requests approval_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_requests
    ADD CONSTRAINT approval_requests_pkey PRIMARY KEY (id);


--
-- Name: approval_signatures approval_signatures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_signatures
    ADD CONSTRAINT approval_signatures_pkey PRIMARY KEY (id);


--
-- Name: approval_workflows approval_workflows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_workflows
    ADD CONSTRAINT approval_workflows_pkey PRIMARY KEY (id);


--
-- Name: asset_backed_products asset_backed_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_backed_products
    ADD CONSTRAINT asset_backed_products_pkey PRIMARY KEY (id);


--
-- Name: asset_backed_products asset_backed_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_backed_products
    ADD CONSTRAINT asset_backed_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT asset_backed_products_project_id_key ON asset_backed_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT asset_backed_products_project_id_key ON public.asset_backed_products IS 'Ensures only one product per project in this table';


--
-- Name: asset_holdings asset_holdings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_holdings
    ADD CONSTRAINT asset_holdings_pkey PRIMARY KEY (id);


--
-- Name: asset_nav_data asset_nav_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_nav_data
    ADD CONSTRAINT asset_nav_data_pkey PRIMARY KEY (id);


--
-- Name: auction_comparables auction_comparables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.auction_comparables
    ADD CONSTRAINT auction_comparables_pkey PRIMARY KEY (id);


--
-- Name: audit_logs audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_logs
    ADD CONSTRAINT audit_logs_pkey PRIMARY KEY (id);


--
-- Name: auth_events auth_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.auth_events
    ADD CONSTRAINT auth_events_pkey PRIMARY KEY (id);


--
-- Name: authorized_activities authorized_activities_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.authorized_activities
    ADD CONSTRAINT authorized_activities_pkey PRIMARY KEY (id);


--
-- Name: authorized_signatories authorized_signatories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.authorized_signatories
    ADD CONSTRAINT authorized_signatories_pkey PRIMARY KEY (id);


--
-- Name: batch_operations batch_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.batch_operations
    ADD CONSTRAINT batch_operations_pkey PRIMARY KEY (id);


--
-- Name: benchmark_index_mappings benchmark_index_mappings_benchmark_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benchmark_index_mappings
    ADD CONSTRAINT benchmark_index_mappings_benchmark_name_key UNIQUE (benchmark_name);


--
-- Name: benchmark_index_mappings benchmark_index_mappings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benchmark_index_mappings
    ADD CONSTRAINT benchmark_index_mappings_pkey PRIMARY KEY (id);


--
-- Name: blacklisted_addresses blacklisted_addresses_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.blacklisted_addresses
    ADD CONSTRAINT blacklisted_addresses_address_key UNIQUE (address);


--
-- Name: blacklisted_addresses blacklisted_addresses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.blacklisted_addresses
    ADD CONSTRAINT blacklisted_addresses_pkey PRIMARY KEY (id);


--
-- Name: blackout_periods blackout_periods_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.blackout_periods
    ADD CONSTRAINT blackout_periods_pkey PRIMARY KEY (id);


--
-- Name: bond_amortization_schedule bond_amortization_schedule_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_amortization_schedule
    ADD CONSTRAINT bond_amortization_schedule_pkey PRIMARY KEY (id);


--
-- Name: bond_call_put_schedules bond_call_put_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_call_put_schedules
    ADD CONSTRAINT bond_call_put_schedules_pkey PRIMARY KEY (id);


--
-- Name: bond_coupon_payments bond_coupon_payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_coupon_payments
    ADD CONSTRAINT bond_coupon_payments_pkey PRIMARY KEY (id);


--
-- Name: bond_covenants bond_covenants_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_covenants
    ADD CONSTRAINT bond_covenants_pkey PRIMARY KEY (id);


--
-- Name: bond_credit_ratings bond_credit_ratings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_credit_ratings
    ADD CONSTRAINT bond_credit_ratings_pkey PRIMARY KEY (id);


--
-- Name: bond_credit_ratings bond_credit_ratings_unique_agency_date; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_credit_ratings
    ADD CONSTRAINT bond_credit_ratings_unique_agency_date UNIQUE (bond_product_id, rating_agency, rating_date);


--
-- Name: bond_events bond_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_events
    ADD CONSTRAINT bond_events_pkey PRIMARY KEY (id);


--
-- Name: bond_market_prices bond_market_prices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_market_prices
    ADD CONSTRAINT bond_market_prices_pkey PRIMARY KEY (id);


--
-- Name: bond_market_prices bond_market_prices_unique_timestamp; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_market_prices
    ADD CONSTRAINT bond_market_prices_unique_timestamp UNIQUE (bond_product_id, price_date, price_time, data_source);


--
-- Name: bond_products bond_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_products
    ADD CONSTRAINT bond_products_pkey PRIMARY KEY (id);


--
-- Name: bond_sinking_fund bond_sinking_fund_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_sinking_fund
    ADD CONSTRAINT bond_sinking_fund_pkey PRIMARY KEY (id);


--
-- Name: bulk_operations bulk_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bulk_operations
    ADD CONSTRAINT bulk_operations_pkey PRIMARY KEY (id);


--
-- Name: bundler_configurations bundler_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bundler_configurations
    ADD CONSTRAINT bundler_configurations_pkey PRIMARY KEY (id);


--
-- Name: bundler_operations bundler_operations_bundle_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bundler_operations
    ADD CONSTRAINT bundler_operations_bundle_hash_key UNIQUE (bundle_hash);


--
-- Name: bundler_operations bundler_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bundler_operations
    ADD CONSTRAINT bundler_operations_pkey PRIMARY KEY (id);


--
-- Name: cap_table_investors cap_table_investors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cap_table_investors
    ADD CONSTRAINT cap_table_investors_pkey PRIMARY KEY (id);


--
-- Name: cap_tables cap_tables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cap_tables
    ADD CONSTRAINT cap_tables_pkey PRIMARY KEY (id);


--
-- Name: carbon_market_prices carbon_market_prices_asset_id_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.carbon_market_prices
    ADD CONSTRAINT carbon_market_prices_asset_id_as_of_date_key UNIQUE NULLS NOT DISTINCT (asset_id, as_of_date);


--
-- Name: carbon_market_prices carbon_market_prices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.carbon_market_prices
    ADD CONSTRAINT carbon_market_prices_pkey PRIMARY KEY (id);


--
-- Name: carbon_offsets carbon_offsets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.carbon_offsets
    ADD CONSTRAINT carbon_offsets_pkey PRIMARY KEY (offset_id);


--
-- Name: cf_allocations cf_allocations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cf_allocations
    ADD CONSTRAINT cf_allocations_pkey PRIMARY KEY (id);


--
-- Name: cf_cash_flows cf_cash_flows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cf_cash_flows
    ADD CONSTRAINT cf_cash_flows_pkey PRIMARY KEY (id);


--
-- Name: cf_holdings cf_holdings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cf_holdings
    ADD CONSTRAINT cf_holdings_pkey PRIMARY KEY (id);


--
-- Name: cf_performance_attribution cf_performance_attribution_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cf_performance_attribution
    ADD CONSTRAINT cf_performance_attribution_pkey PRIMARY KEY (id);


--
-- Name: cf_rebalancing_events cf_rebalancing_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cf_rebalancing_events
    ADD CONSTRAINT cf_rebalancing_events_pkey PRIMARY KEY (id);


--
-- Name: climate_cash_flow_projections climate_cash_flow_projections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_cash_flow_projections
    ADD CONSTRAINT climate_cash_flow_projections_pkey PRIMARY KEY (projection_id);


--
-- Name: climate_incentives climate_incentives_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_incentives
    ADD CONSTRAINT climate_incentives_pkey PRIMARY KEY (incentive_id);


--
-- Name: climate_investor_pools climate_investor_pools_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_investor_pools
    ADD CONSTRAINT climate_investor_pools_pkey PRIMARY KEY (investor_id, pool_id);


--
-- Name: climate_market_data_cache climate_market_data_cache_cache_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_market_data_cache
    ADD CONSTRAINT climate_market_data_cache_cache_key_key UNIQUE (cache_key);


--
-- Name: climate_market_data_cache climate_market_data_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_market_data_cache
    ADD CONSTRAINT climate_market_data_cache_pkey PRIMARY KEY (cache_id);


--
-- Name: climate_nav_calculations climate_nav_calculations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_nav_calculations
    ADD CONSTRAINT climate_nav_calculations_pkey PRIMARY KEY (id);


--
-- Name: climate_payers climate_payers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_payers
    ADD CONSTRAINT climate_payers_pkey PRIMARY KEY (payer_id);


--
-- Name: climate_policies climate_policies_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policies
    ADD CONSTRAINT climate_policies_name_key UNIQUE (name);


--
-- Name: climate_policies climate_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policies
    ADD CONSTRAINT climate_policies_pkey PRIMARY KEY (policy_id);


--
-- Name: climate_policy_impacts climate_policy_impacts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policy_impacts
    ADD CONSTRAINT climate_policy_impacts_pkey PRIMARY KEY (impact_id);


--
-- Name: climate_pool_energy_assets climate_pool_energy_assets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_energy_assets
    ADD CONSTRAINT climate_pool_energy_assets_pkey PRIMARY KEY (pool_id, asset_id);


--
-- Name: climate_pool_incentives climate_pool_incentives_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_incentives
    ADD CONSTRAINT climate_pool_incentives_pkey PRIMARY KEY (pool_id, incentive_id);


--
-- Name: climate_pool_receivables climate_pool_receivables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_receivables
    ADD CONSTRAINT climate_pool_receivables_pkey PRIMARY KEY (pool_id, receivable_id);


--
-- Name: climate_pool_recs climate_pool_recs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_recs
    ADD CONSTRAINT climate_pool_recs_pkey PRIMARY KEY (pool_id, rec_id);


--
-- Name: climate_receivables climate_receivables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_receivables
    ADD CONSTRAINT climate_receivables_pkey PRIMARY KEY (receivable_id);


--
-- Name: climate_reports climate_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_reports
    ADD CONSTRAINT climate_reports_pkey PRIMARY KEY (report_id);


--
-- Name: climate_risk_calculations climate_risk_calculations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_risk_calculations
    ADD CONSTRAINT climate_risk_calculations_pkey PRIMARY KEY (id);


--
-- Name: climate_risk_factors climate_risk_factors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_risk_factors
    ADD CONSTRAINT climate_risk_factors_pkey PRIMARY KEY (factor_id);


--
-- Name: climate_tokenization_pools climate_tokenization_pools_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_tokenization_pools
    ADD CONSTRAINT climate_tokenization_pools_pkey PRIMARY KEY (pool_id);


--
-- Name: climate_user_data_cache climate_user_data_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_user_data_cache
    ADD CONSTRAINT climate_user_data_cache_pkey PRIMARY KEY (cache_id);


--
-- Name: climate_user_data_sources climate_user_data_sources_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_user_data_sources
    ADD CONSTRAINT climate_user_data_sources_pkey PRIMARY KEY (source_id);


--
-- Name: collectibles_appraisals collectibles_appraisals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_appraisals
    ADD CONSTRAINT collectibles_appraisals_pkey PRIMARY KEY (id);


--
-- Name: collectibles_authentication_records collectibles_authentication_records_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_authentication_records
    ADD CONSTRAINT collectibles_authentication_records_pkey PRIMARY KEY (id);


--
-- Name: collectibles_condition_reports collectibles_condition_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_condition_reports
    ADD CONSTRAINT collectibles_condition_reports_pkey PRIMARY KEY (id);


--
-- Name: collectibles_insurance_policies collectibles_insurance_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_insurance_policies
    ADD CONSTRAINT collectibles_insurance_policies_pkey PRIMARY KEY (id);


--
-- Name: collectibles_insurance_valuations collectibles_insurance_valuations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_insurance_valuations
    ADD CONSTRAINT collectibles_insurance_valuations_pkey PRIMARY KEY (id);


--
-- Name: collectibles_market_comparables collectibles_market_comparables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_market_comparables
    ADD CONSTRAINT collectibles_market_comparables_pkey PRIMARY KEY (id);


--
-- Name: collectibles_market_metrics collectibles_market_metrics_asset_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_market_metrics
    ADD CONSTRAINT collectibles_market_metrics_asset_type_key UNIQUE (asset_type);


--
-- Name: collectibles_market_metrics collectibles_market_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_market_metrics
    ADD CONSTRAINT collectibles_market_metrics_pkey PRIMARY KEY (id);


--
-- Name: collectibles_products collectibles_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_products
    ADD CONSTRAINT collectibles_products_pkey PRIMARY KEY (id);


--
-- Name: collectibles_products collectibles_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_products
    ADD CONSTRAINT collectibles_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT collectibles_products_project_id_key ON collectibles_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT collectibles_products_project_id_key ON public.collectibles_products IS 'Ensures only one product per project in this table';


--
-- Name: collectibles_provenance collectibles_provenance_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_provenance
    ADD CONSTRAINT collectibles_provenance_pkey PRIMARY KEY (id);


--
-- Name: collectibles_provenance_records collectibles_provenance_records_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_provenance_records
    ADD CONSTRAINT collectibles_provenance_records_pkey PRIMARY KEY (id);


--
-- Name: collectibles_rarity_scores collectibles_rarity_scores_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_rarity_scores
    ADD CONSTRAINT collectibles_rarity_scores_pkey PRIMARY KEY (id);


--
-- Name: collectibles_risk_assessments collectibles_risk_assessments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_risk_assessments
    ADD CONSTRAINT collectibles_risk_assessments_pkey PRIMARY KEY (id);


--
-- Name: collectibles_storage_facilities collectibles_storage_facilities_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_storage_facilities
    ADD CONSTRAINT collectibles_storage_facilities_pkey PRIMARY KEY (id);


--
-- Name: commodities_products commodities_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodities_products
    ADD CONSTRAINT commodities_products_pkey PRIMARY KEY (id);


--
-- Name: commodities_products commodities_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodities_products
    ADD CONSTRAINT commodities_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT commodities_products_project_id_key ON commodities_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT commodities_products_project_id_key ON public.commodities_products IS 'Ensures only one product per project in this table';


--
-- Name: commodity_collateral commodity_collateral_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_collateral
    ADD CONSTRAINT commodity_collateral_pkey PRIMARY KEY (id);


--
-- Name: commodity_debt commodity_debt_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_debt
    ADD CONSTRAINT commodity_debt_pkey PRIMARY KEY (id);


--
-- Name: commodity_handling_costs commodity_handling_costs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_handling_costs
    ADD CONSTRAINT commodity_handling_costs_pkey PRIMARY KEY (id);


--
-- Name: commodity_implied_volatility commodity_implied_volatility_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_implied_volatility
    ADD CONSTRAINT commodity_implied_volatility_pkey PRIMARY KEY (id);


--
-- Name: commodity_insurance_rates commodity_insurance_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_insurance_rates
    ADD CONSTRAINT commodity_insurance_rates_pkey PRIMARY KEY (id);


--
-- Name: commodity_market_data commodity_market_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_market_data
    ADD CONSTRAINT commodity_market_data_pkey PRIMARY KEY (id);


--
-- Name: commodity_pool_config commodity_pool_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_pool_config
    ADD CONSTRAINT commodity_pool_config_pkey PRIMARY KEY (id);


--
-- Name: commodity_positions commodity_positions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_positions
    ADD CONSTRAINT commodity_positions_pkey PRIMARY KEY (id);


--
-- Name: commodity_prices commodity_prices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_prices
    ADD CONSTRAINT commodity_prices_pkey PRIMARY KEY (id);


--
-- Name: commodity_quality_multipliers commodity_quality_multipliers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_quality_multipliers
    ADD CONSTRAINT commodity_quality_multipliers_pkey PRIMARY KEY (id);


--
-- Name: commodity_risk_metrics commodity_risk_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_risk_metrics
    ADD CONSTRAINT commodity_risk_metrics_pkey PRIMARY KEY (id);


--
-- Name: commodity_storage_rates commodity_storage_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_storage_rates
    ADD CONSTRAINT commodity_storage_rates_pkey PRIMARY KEY (id);


--
-- Name: compliance_alerts compliance_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_alerts
    ADD CONSTRAINT compliance_alerts_pkey PRIMARY KEY (id);


--
-- Name: compliance_audit_logs compliance_audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_audit_logs
    ADD CONSTRAINT compliance_audit_logs_pkey PRIMARY KEY (id);


--
-- Name: compliance_checks compliance_checks_investor_id_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_checks
    ADD CONSTRAINT compliance_checks_investor_id_project_id_key UNIQUE (investor_id, project_id);


--
-- Name: compliance_checks compliance_checks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_checks
    ADD CONSTRAINT compliance_checks_pkey PRIMARY KEY (id);


--
-- Name: compliance_metrics compliance_metrics_metric_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_metrics
    ADD CONSTRAINT compliance_metrics_metric_date_key UNIQUE (metric_date);


--
-- Name: compliance_metrics compliance_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_metrics
    ADD CONSTRAINT compliance_metrics_pkey PRIMARY KEY (id);


--
-- Name: compliance_reports compliance_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_reports
    ADD CONSTRAINT compliance_reports_pkey PRIMARY KEY (id);


--
-- Name: compliance_settings compliance_settings_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_settings
    ADD CONSTRAINT compliance_settings_organization_id_key UNIQUE (organization_id);


--
-- Name: compliance_settings compliance_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_settings
    ADD CONSTRAINT compliance_settings_pkey PRIMARY KEY (id);


--
-- Name: compliance_violations compliance_violations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_pkey PRIMARY KEY (id);


--
-- Name: compliance_violations compliance_violations_violation_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_violation_id_key UNIQUE (violation_id);


--
-- Name: consensus_settings consensus_settings_consensus_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consensus_settings
    ADD CONSTRAINT consensus_settings_consensus_type_key UNIQUE (consensus_type);


--
-- Name: consensus_settings consensus_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consensus_settings
    ADD CONSTRAINT consensus_settings_pkey PRIMARY KEY (id);


--
-- Name: contract_master_versions contract_master_versions_contract_type_version_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_master_versions
    ADD CONSTRAINT contract_master_versions_contract_type_version_key UNIQUE (contract_type, version);


--
-- Name: contract_master_versions contract_master_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_master_versions
    ADD CONSTRAINT contract_master_versions_pkey PRIMARY KEY (id);


--
-- Name: contract_masters_backup contract_masters_backup_network_environment_contract_addres_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters_backup
    ADD CONSTRAINT contract_masters_backup_network_environment_contract_addres_key UNIQUE (network, environment, contract_address);


--
-- Name: contract_masters_backup contract_masters_backup_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters_backup
    ADD CONSTRAINT contract_masters_backup_pkey PRIMARY KEY (id);


--
-- Name: contract_masters contract_masters_network_environment_address_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters
    ADD CONSTRAINT contract_masters_network_environment_address_unique UNIQUE (network, environment, contract_address);


--
-- Name: contract_masters contract_masters_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters
    ADD CONSTRAINT contract_masters_pkey PRIMARY KEY (id);


--
-- Name: contract_role_assignments contract_role_assignments_multi_sig_wallet_address_contract_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_role_assignments
    ADD CONSTRAINT contract_role_assignments_multi_sig_wallet_address_contract_key UNIQUE (multi_sig_wallet_address, contract_address, role_name);


--
-- Name: contract_role_assignments contract_role_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_role_assignments
    ADD CONSTRAINT contract_role_assignments_pkey PRIMARY KEY (id);


--
-- Name: corporate_actions corporate_actions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.corporate_actions
    ADD CONSTRAINT corporate_actions_pkey PRIMARY KEY (id);


--
-- Name: credential_usage_logs credential_usage_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.credential_usage_logs
    ADD CONSTRAINT credential_usage_logs_pkey PRIMARY KEY (id);


--
-- Name: critical_alerts critical_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.critical_alerts
    ADD CONSTRAINT critical_alerts_pkey PRIMARY KEY (id);


--
-- Name: crypto_symbol_mappings crypto_symbol_mappings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.crypto_symbol_mappings
    ADD CONSTRAINT crypto_symbol_mappings_pkey PRIMARY KEY (id);


--
-- Name: crypto_symbol_mappings crypto_symbol_mappings_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.crypto_symbol_mappings
    ADD CONSTRAINT crypto_symbol_mappings_unique UNIQUE (symbol, coingecko_id);


--
-- Name: dashboard_updates dashboard_updates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dashboard_updates
    ADD CONSTRAINT dashboard_updates_pkey PRIMARY KEY (id);


--
-- Name: data_source_mappings data_source_mappings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.data_source_mappings
    ADD CONSTRAINT data_source_mappings_pkey PRIMARY KEY (mapping_id);


--
-- Name: deployment_audit_logs deployment_audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.deployment_audit_logs
    ADD CONSTRAINT deployment_audit_logs_pkey PRIMARY KEY (id);


--
-- Name: deployment_rate_limits deployment_rate_limits_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.deployment_rate_limits
    ADD CONSTRAINT deployment_rate_limits_pkey PRIMARY KEY (id);


--
-- Name: dfns_activity_logs dfns_activity_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_activity_logs
    ADD CONSTRAINT dfns_activity_logs_pkey PRIMARY KEY (id);


--
-- Name: dfns_api_requests dfns_api_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_api_requests
    ADD CONSTRAINT dfns_api_requests_pkey PRIMARY KEY (id);


--
-- Name: dfns_applications dfns_applications_app_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_applications
    ADD CONSTRAINT dfns_applications_app_id_key UNIQUE (app_id);


--
-- Name: dfns_applications dfns_applications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_applications
    ADD CONSTRAINT dfns_applications_pkey PRIMARY KEY (id);


--
-- Name: dfns_authentication_challenges dfns_authentication_challenges_challenge_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_authentication_challenges
    ADD CONSTRAINT dfns_authentication_challenges_challenge_id_key UNIQUE (challenge_id);


--
-- Name: dfns_authentication_challenges dfns_authentication_challenges_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_authentication_challenges
    ADD CONSTRAINT dfns_authentication_challenges_pkey PRIMARY KEY (id);


--
-- Name: dfns_broadcast_transactions dfns_broadcast_transactions_broadcast_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_broadcast_transactions
    ADD CONSTRAINT dfns_broadcast_transactions_broadcast_id_key UNIQUE (broadcast_id);


--
-- Name: dfns_broadcast_transactions dfns_broadcast_transactions_dfns_broadcast_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_broadcast_transactions
    ADD CONSTRAINT dfns_broadcast_transactions_dfns_broadcast_id_key UNIQUE (dfns_broadcast_id);


--
-- Name: dfns_broadcast_transactions dfns_broadcast_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_broadcast_transactions
    ADD CONSTRAINT dfns_broadcast_transactions_pkey PRIMARY KEY (id);


--
-- Name: dfns_credential_challenges dfns_credential_challenges_challenge_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credential_challenges
    ADD CONSTRAINT dfns_credential_challenges_challenge_id_key UNIQUE (challenge_id);


--
-- Name: dfns_credential_challenges dfns_credential_challenges_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credential_challenges
    ADD CONSTRAINT dfns_credential_challenges_pkey PRIMARY KEY (id);


--
-- Name: dfns_credentials dfns_credentials_credential_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credentials
    ADD CONSTRAINT dfns_credentials_credential_id_key UNIQUE (credential_id);


--
-- Name: dfns_credentials dfns_credentials_dfns_credential_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credentials
    ADD CONSTRAINT dfns_credentials_dfns_credential_id_key UNIQUE (dfns_credential_id);


--
-- Name: dfns_credentials dfns_credentials_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credentials
    ADD CONSTRAINT dfns_credentials_pkey PRIMARY KEY (id);


--
-- Name: dfns_exchange_accounts dfns_exchange_accounts_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_accounts
    ADD CONSTRAINT dfns_exchange_accounts_account_id_key UNIQUE (account_id);


--
-- Name: dfns_exchange_accounts dfns_exchange_accounts_dfns_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_accounts
    ADD CONSTRAINT dfns_exchange_accounts_dfns_account_id_key UNIQUE (dfns_account_id);


--
-- Name: dfns_exchange_accounts dfns_exchange_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_accounts
    ADD CONSTRAINT dfns_exchange_accounts_pkey PRIMARY KEY (id);


--
-- Name: dfns_exchange_balances dfns_exchange_balances_account_id_asset_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_balances
    ADD CONSTRAINT dfns_exchange_balances_account_id_asset_key UNIQUE (account_id, asset);


--
-- Name: dfns_exchange_balances dfns_exchange_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_balances
    ADD CONSTRAINT dfns_exchange_balances_pkey PRIMARY KEY (id);


--
-- Name: dfns_exchange_integrations dfns_exchange_integrations_dfns_exchange_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_integrations
    ADD CONSTRAINT dfns_exchange_integrations_dfns_exchange_id_key UNIQUE (dfns_exchange_id);


--
-- Name: dfns_exchange_integrations dfns_exchange_integrations_integration_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_integrations
    ADD CONSTRAINT dfns_exchange_integrations_integration_id_key UNIQUE (integration_id);


--
-- Name: dfns_exchange_integrations dfns_exchange_integrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_integrations
    ADD CONSTRAINT dfns_exchange_integrations_pkey PRIMARY KEY (id);


--
-- Name: dfns_fee_sponsors dfns_fee_sponsors_dfns_sponsor_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fee_sponsors
    ADD CONSTRAINT dfns_fee_sponsors_dfns_sponsor_id_key UNIQUE (dfns_sponsor_id);


--
-- Name: dfns_fee_sponsors dfns_fee_sponsors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fee_sponsors
    ADD CONSTRAINT dfns_fee_sponsors_pkey PRIMARY KEY (id);


--
-- Name: dfns_fee_sponsors dfns_fee_sponsors_sponsor_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fee_sponsors
    ADD CONSTRAINT dfns_fee_sponsors_sponsor_id_key UNIQUE (sponsor_id);


--
-- Name: dfns_fiat_activity_logs dfns_fiat_activity_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_activity_logs
    ADD CONSTRAINT dfns_fiat_activity_logs_pkey PRIMARY KEY (id);


--
-- Name: dfns_fiat_provider_configs dfns_fiat_provider_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_provider_configs
    ADD CONSTRAINT dfns_fiat_provider_configs_pkey PRIMARY KEY (id);


--
-- Name: dfns_fiat_provider_configs dfns_fiat_provider_configs_provider_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_provider_configs
    ADD CONSTRAINT dfns_fiat_provider_configs_provider_key UNIQUE (provider);


--
-- Name: dfns_fiat_quotes dfns_fiat_quotes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_quotes
    ADD CONSTRAINT dfns_fiat_quotes_pkey PRIMARY KEY (id);


--
-- Name: dfns_fiat_transactions dfns_fiat_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_transactions
    ADD CONSTRAINT dfns_fiat_transactions_pkey PRIMARY KEY (id);


--
-- Name: dfns_fiat_transactions dfns_fiat_transactions_provider_provider_transaction_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_transactions
    ADD CONSTRAINT dfns_fiat_transactions_provider_provider_transaction_id_key UNIQUE (provider, provider_transaction_id);


--
-- Name: dfns_permission_assignments dfns_permission_assignments_permission_id_identity_id_ident_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permission_assignments
    ADD CONSTRAINT dfns_permission_assignments_permission_id_identity_id_ident_key UNIQUE (permission_id, identity_id, identity_kind);


--
-- Name: dfns_permission_assignments dfns_permission_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permission_assignments
    ADD CONSTRAINT dfns_permission_assignments_pkey PRIMARY KEY (id);


--
-- Name: dfns_permissions dfns_permissions_dfns_permission_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permissions
    ADD CONSTRAINT dfns_permissions_dfns_permission_id_key UNIQUE (dfns_permission_id);


--
-- Name: dfns_permissions dfns_permissions_permission_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permissions
    ADD CONSTRAINT dfns_permissions_permission_id_key UNIQUE (permission_id);


--
-- Name: dfns_permissions dfns_permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permissions
    ADD CONSTRAINT dfns_permissions_pkey PRIMARY KEY (id);


--
-- Name: dfns_personal_access_tokens dfns_personal_access_tokens_dfns_token_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_personal_access_tokens
    ADD CONSTRAINT dfns_personal_access_tokens_dfns_token_id_key UNIQUE (dfns_token_id);


--
-- Name: dfns_personal_access_tokens dfns_personal_access_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_personal_access_tokens
    ADD CONSTRAINT dfns_personal_access_tokens_pkey PRIMARY KEY (id);


--
-- Name: dfns_policies dfns_policies_dfns_policy_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policies
    ADD CONSTRAINT dfns_policies_dfns_policy_id_key UNIQUE (dfns_policy_id);


--
-- Name: dfns_policies dfns_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policies
    ADD CONSTRAINT dfns_policies_pkey PRIMARY KEY (id);


--
-- Name: dfns_policies dfns_policies_policy_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policies
    ADD CONSTRAINT dfns_policies_policy_id_key UNIQUE (policy_id);


--
-- Name: dfns_policy_approval_decisions dfns_policy_approval_decisions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approval_decisions
    ADD CONSTRAINT dfns_policy_approval_decisions_pkey PRIMARY KEY (id);


--
-- Name: dfns_policy_approval_groups dfns_policy_approval_groups_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approval_groups
    ADD CONSTRAINT dfns_policy_approval_groups_pkey PRIMARY KEY (id);


--
-- Name: dfns_policy_approvals dfns_policy_approvals_approval_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approvals
    ADD CONSTRAINT dfns_policy_approvals_approval_id_key UNIQUE (approval_id);


--
-- Name: dfns_policy_approvals dfns_policy_approvals_dfns_approval_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approvals
    ADD CONSTRAINT dfns_policy_approvals_dfns_approval_id_key UNIQUE (dfns_approval_id);


--
-- Name: dfns_policy_approvals dfns_policy_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approvals
    ADD CONSTRAINT dfns_policy_approvals_pkey PRIMARY KEY (id);


--
-- Name: dfns_policy_change_requests dfns_policy_change_requests_dfns_change_request_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_change_requests
    ADD CONSTRAINT dfns_policy_change_requests_dfns_change_request_id_key UNIQUE (dfns_change_request_id);


--
-- Name: dfns_policy_change_requests dfns_policy_change_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_change_requests
    ADD CONSTRAINT dfns_policy_change_requests_pkey PRIMARY KEY (id);


--
-- Name: dfns_policy_evaluations dfns_policy_evaluations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_evaluations
    ADD CONSTRAINT dfns_policy_evaluations_pkey PRIMARY KEY (id);


--
-- Name: dfns_service_accounts dfns_service_accounts_dfns_service_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_service_accounts
    ADD CONSTRAINT dfns_service_accounts_dfns_service_account_id_key UNIQUE (dfns_service_account_id);


--
-- Name: dfns_service_accounts dfns_service_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_service_accounts
    ADD CONSTRAINT dfns_service_accounts_pkey PRIMARY KEY (id);


--
-- Name: dfns_signatures dfns_signatures_dfns_signature_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signatures
    ADD CONSTRAINT dfns_signatures_dfns_signature_id_key UNIQUE (dfns_signature_id);


--
-- Name: dfns_signatures dfns_signatures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signatures
    ADD CONSTRAINT dfns_signatures_pkey PRIMARY KEY (id);


--
-- Name: dfns_signatures dfns_signatures_signature_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signatures
    ADD CONSTRAINT dfns_signatures_signature_id_key UNIQUE (signature_id);


--
-- Name: dfns_signing_keys dfns_signing_keys_dfns_key_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signing_keys
    ADD CONSTRAINT dfns_signing_keys_dfns_key_id_key UNIQUE (dfns_key_id);


--
-- Name: dfns_signing_keys dfns_signing_keys_key_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signing_keys
    ADD CONSTRAINT dfns_signing_keys_key_id_key UNIQUE (key_id);


--
-- Name: dfns_signing_keys dfns_signing_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signing_keys
    ADD CONSTRAINT dfns_signing_keys_pkey PRIMARY KEY (id);


--
-- Name: dfns_sponsored_fees dfns_sponsored_fees_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sponsored_fees
    ADD CONSTRAINT dfns_sponsored_fees_pkey PRIMARY KEY (id);


--
-- Name: dfns_sponsored_fees dfns_sponsored_fees_sponsored_fee_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sponsored_fees
    ADD CONSTRAINT dfns_sponsored_fees_sponsored_fee_id_key UNIQUE (sponsored_fee_id);


--
-- Name: dfns_staking_integrations dfns_staking_integrations_dfns_staking_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_staking_integrations
    ADD CONSTRAINT dfns_staking_integrations_dfns_staking_id_key UNIQUE (dfns_staking_id);


--
-- Name: dfns_staking_integrations dfns_staking_integrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_staking_integrations
    ADD CONSTRAINT dfns_staking_integrations_pkey PRIMARY KEY (id);


--
-- Name: dfns_staking_integrations dfns_staking_integrations_staking_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_staking_integrations
    ADD CONSTRAINT dfns_staking_integrations_staking_id_key UNIQUE (staking_id);


--
-- Name: dfns_sync_status dfns_sync_status_entity_type_entity_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sync_status
    ADD CONSTRAINT dfns_sync_status_entity_type_entity_id_key UNIQUE (entity_type, entity_id);


--
-- Name: dfns_sync_status dfns_sync_status_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sync_status
    ADD CONSTRAINT dfns_sync_status_pkey PRIMARY KEY (id);


--
-- Name: dfns_transaction_history dfns_transaction_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transaction_history
    ADD CONSTRAINT dfns_transaction_history_pkey PRIMARY KEY (id);


--
-- Name: dfns_transaction_history dfns_transaction_history_wallet_id_tx_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transaction_history
    ADD CONSTRAINT dfns_transaction_history_wallet_id_tx_hash_key UNIQUE (wallet_id, tx_hash);


--
-- Name: dfns_transfers dfns_transfers_dfns_transfer_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transfers
    ADD CONSTRAINT dfns_transfers_dfns_transfer_id_key UNIQUE (dfns_transfer_id);


--
-- Name: dfns_transfers dfns_transfers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transfers
    ADD CONSTRAINT dfns_transfers_pkey PRIMARY KEY (id);


--
-- Name: dfns_transfers dfns_transfers_transfer_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transfers
    ADD CONSTRAINT dfns_transfers_transfer_id_key UNIQUE (transfer_id);


--
-- Name: dfns_user_action_challenges dfns_user_action_challenges_challenge_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_user_action_challenges
    ADD CONSTRAINT dfns_user_action_challenges_challenge_id_key UNIQUE (challenge_id);


--
-- Name: dfns_user_action_challenges dfns_user_action_challenges_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_user_action_challenges
    ADD CONSTRAINT dfns_user_action_challenges_pkey PRIMARY KEY (id);


--
-- Name: dfns_user_sessions dfns_user_sessions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_user_sessions
    ADD CONSTRAINT dfns_user_sessions_pkey PRIMARY KEY (id);


--
-- Name: dfns_user_sessions dfns_user_sessions_session_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_user_sessions
    ADD CONSTRAINT dfns_user_sessions_session_id_key UNIQUE (session_id);


--
-- Name: dfns_users dfns_users_dfns_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_users
    ADD CONSTRAINT dfns_users_dfns_user_id_key UNIQUE (dfns_user_id);


--
-- Name: dfns_users dfns_users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_users
    ADD CONSTRAINT dfns_users_pkey PRIMARY KEY (id);


--
-- Name: dfns_users dfns_users_username_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_users
    ADD CONSTRAINT dfns_users_username_key UNIQUE (username);


--
-- Name: dfns_validators dfns_validators_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_validators
    ADD CONSTRAINT dfns_validators_pkey PRIMARY KEY (id);


--
-- Name: dfns_validators dfns_validators_validator_address_network_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_validators
    ADD CONSTRAINT dfns_validators_validator_address_network_key UNIQUE (validator_address, network);


--
-- Name: dfns_wallet_balances dfns_wallet_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_balances
    ADD CONSTRAINT dfns_wallet_balances_pkey PRIMARY KEY (id);


--
-- Name: dfns_wallet_balances dfns_wallet_balances_wallet_id_asset_symbol_contract_addres_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_balances
    ADD CONSTRAINT dfns_wallet_balances_wallet_id_asset_symbol_contract_addres_key UNIQUE (wallet_id, asset_symbol, contract_address);


--
-- Name: dfns_wallet_nfts dfns_wallet_nfts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_nfts
    ADD CONSTRAINT dfns_wallet_nfts_pkey PRIMARY KEY (id);


--
-- Name: dfns_wallet_nfts dfns_wallet_nfts_wallet_id_contract_token_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_nfts
    ADD CONSTRAINT dfns_wallet_nfts_wallet_id_contract_token_id_key UNIQUE (wallet_id, contract, token_id);


--
-- Name: dfns_wallets dfns_wallets_dfns_wallet_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallets
    ADD CONSTRAINT dfns_wallets_dfns_wallet_id_key UNIQUE (dfns_wallet_id);


--
-- Name: dfns_wallets dfns_wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallets
    ADD CONSTRAINT dfns_wallets_pkey PRIMARY KEY (id);


--
-- Name: dfns_wallets dfns_wallets_wallet_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallets
    ADD CONSTRAINT dfns_wallets_wallet_id_key UNIQUE (wallet_id);


--
-- Name: dfns_webhook_deliveries dfns_webhook_deliveries_delivery_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhook_deliveries
    ADD CONSTRAINT dfns_webhook_deliveries_delivery_id_key UNIQUE (delivery_id);


--
-- Name: dfns_webhook_deliveries dfns_webhook_deliveries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhook_deliveries
    ADD CONSTRAINT dfns_webhook_deliveries_pkey PRIMARY KEY (id);


--
-- Name: dfns_webhooks dfns_webhooks_dfns_webhook_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhooks
    ADD CONSTRAINT dfns_webhooks_dfns_webhook_id_key UNIQUE (dfns_webhook_id);


--
-- Name: dfns_webhooks dfns_webhooks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhooks
    ADD CONSTRAINT dfns_webhooks_pkey PRIMARY KEY (id);


--
-- Name: dfns_webhooks dfns_webhooks_webhook_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhooks
    ADD CONSTRAINT dfns_webhooks_webhook_id_key UNIQUE (webhook_id);


--
-- Name: digital_tokenised_funds digital_tokenised_funds_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenised_funds
    ADD CONSTRAINT digital_tokenised_funds_pkey PRIMARY KEY (id);


--
-- Name: digital_tokenised_funds digital_tokenised_funds_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenised_funds
    ADD CONSTRAINT digital_tokenised_funds_project_id_key UNIQUE (project_id);


--
-- Name: digital_tokenized_fund_products digital_tokenized_fund_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenized_fund_products
    ADD CONSTRAINT digital_tokenized_fund_products_pkey PRIMARY KEY (id);


--
-- Name: digital_tokenized_fund_products digital_tokenized_fund_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenized_fund_products
    ADD CONSTRAINT digital_tokenized_fund_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT digital_tokenized_fund_products_project_id_key ON digital_tokenized_fund_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT digital_tokenized_fund_products_project_id_key ON public.digital_tokenized_fund_products IS 'Ensures only one product per project in this table';


--
-- Name: distribution_redemptions distribution_redemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distribution_redemptions
    ADD CONSTRAINT distribution_redemptions_pkey PRIMARY KEY (id);


--
-- Name: distribution_redemptions distribution_redemptions_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distribution_redemptions
    ADD CONSTRAINT distribution_redemptions_unique UNIQUE (distribution_id, redemption_request_id);


--
-- Name: distributions distributions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distributions
    ADD CONSTRAINT distributions_pkey PRIMARY KEY (id);


--
-- Name: document_approvals document_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_approvals
    ADD CONSTRAINT document_approvals_pkey PRIMARY KEY (id);


--
-- Name: document_versions document_versions_document_id_version_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_versions
    ADD CONSTRAINT document_versions_document_id_version_number_key UNIQUE (document_id, version_number);


--
-- Name: document_versions document_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_versions
    ADD CONSTRAINT document_versions_pkey PRIMARY KEY (id);


--
-- Name: document_workflows document_workflows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_workflows
    ADD CONSTRAINT document_workflows_pkey PRIMARY KEY (id);


--
-- Name: documents documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_pkey PRIMARY KEY (id);


--
-- Name: dtf_blockchain_events dtf_blockchain_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_blockchain_events
    ADD CONSTRAINT dtf_blockchain_events_pkey PRIMARY KEY (id);


--
-- Name: dtf_minting_history dtf_minting_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_minting_history
    ADD CONSTRAINT dtf_minting_history_pkey PRIMARY KEY (id);


--
-- Name: dtf_minting_history dtf_minting_history_transaction_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_minting_history
    ADD CONSTRAINT dtf_minting_history_transaction_hash_key UNIQUE (transaction_hash);


--
-- Name: dtf_nav_snapshots dtf_nav_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_nav_snapshots
    ADD CONSTRAINT dtf_nav_snapshots_pkey PRIMARY KEY (id);


--
-- Name: dtf_redemption_requests dtf_redemption_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_redemption_requests
    ADD CONSTRAINT dtf_redemption_requests_pkey PRIMARY KEY (id);


--
-- Name: dtf_redemption_requests dtf_redemption_requests_request_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_redemption_requests
    ADD CONSTRAINT dtf_redemption_requests_request_id_key UNIQUE (request_id);


--
-- Name: dtf_token_metadata dtf_token_metadata_contract_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_token_metadata
    ADD CONSTRAINT dtf_token_metadata_contract_address_key UNIQUE (contract_address);


--
-- Name: dtf_token_metadata dtf_token_metadata_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_token_metadata
    ADD CONSTRAINT dtf_token_metadata_pkey PRIMARY KEY (id);


--
-- Name: email_log email_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_log
    ADD CONSTRAINT email_log_pkey PRIMARY KEY (id);


--
-- Name: energy_assets energy_assets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_assets
    ADD CONSTRAINT energy_assets_pkey PRIMARY KEY (asset_id);


--
-- Name: energy_futures_contracts energy_futures_contracts_commodity_contract_month_contract__key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_futures_contracts
    ADD CONSTRAINT energy_futures_contracts_commodity_contract_month_contract__key UNIQUE (commodity, contract_month, contract_date);


--
-- Name: energy_futures_contracts energy_futures_contracts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_futures_contracts
    ADD CONSTRAINT energy_futures_contracts_pkey PRIMARY KEY (id);


--
-- Name: energy_products energy_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_products
    ADD CONSTRAINT energy_products_pkey PRIMARY KEY (id);


--
-- Name: energy_products energy_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_products
    ADD CONSTRAINT energy_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT energy_products_project_id_key ON energy_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT energy_products_project_id_key ON public.energy_products IS 'Ensures only one product per project in this table';


--
-- Name: environmental_certifications environmental_certifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.environmental_certifications
    ADD CONSTRAINT environmental_certifications_pkey PRIMARY KEY (id);


--
-- Name: equity_products equity_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.equity_products
    ADD CONSTRAINT equity_products_pkey PRIMARY KEY (id);


--
-- Name: equity_products equity_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.equity_products
    ADD CONSTRAINT equity_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT equity_products_project_id_key ON equity_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT equity_products_project_id_key ON public.equity_products IS 'Ensures only one product per project in this table';


--
-- Name: escalation_notifications escalation_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.escalation_notifications
    ADD CONSTRAINT escalation_notifications_pkey PRIMARY KEY (id);


--
-- Name: escalation_schedule escalation_schedule_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.escalation_schedule
    ADD CONSTRAINT escalation_schedule_pkey PRIMARY KEY (id);


--
-- Name: etf_creation_redemption etf_creation_redemption_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_creation_redemption
    ADD CONSTRAINT etf_creation_redemption_pkey PRIMARY KEY (id);


--
-- Name: etf_holdings etf_holdings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_holdings
    ADD CONSTRAINT etf_holdings_pkey PRIMARY KEY (id);


--
-- Name: etf_holdings etf_holdings_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_holdings
    ADD CONSTRAINT etf_holdings_unique UNIQUE (fund_product_id, security_ticker, as_of_date);


--
-- Name: etf_metadata etf_metadata_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_metadata
    ADD CONSTRAINT etf_metadata_pkey PRIMARY KEY (id);


--
-- Name: etf_metadata etf_metadata_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_metadata
    ADD CONSTRAINT etf_metadata_unique UNIQUE (fund_product_id);


--
-- Name: etf_nav_history etf_nav_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_nav_history
    ADD CONSTRAINT etf_nav_history_pkey PRIMARY KEY (id);


--
-- Name: etf_nav_history etf_nav_history_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_nav_history
    ADD CONSTRAINT etf_nav_history_unique UNIQUE (fund_product_id, valuation_date);


--
-- Name: etf_rebalancing_history etf_rebalancing_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_rebalancing_history
    ADD CONSTRAINT etf_rebalancing_history_pkey PRIMARY KEY (id);


--
-- Name: etf_token_links etf_token_links_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_token_links
    ADD CONSTRAINT etf_token_links_pkey PRIMARY KEY (id);


--
-- Name: etf_token_links etf_token_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_token_links
    ADD CONSTRAINT etf_token_unique UNIQUE (fund_product_id, token_id);


--
-- Name: etf_tracking_error_history etf_tracking_error_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_tracking_error_history
    ADD CONSTRAINT etf_tracking_error_history_pkey PRIMARY KEY (id);


--
-- Name: etf_tracking_error_history etf_tracking_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_tracking_error_history
    ADD CONSTRAINT etf_tracking_unique UNIQUE (fund_product_id, period_start, period_end, period_type);


--
-- Name: exchange_rate_history exchange_rate_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.exchange_rate_history
    ADD CONSTRAINT exchange_rate_history_pkey PRIMARY KEY (id);


--
-- Name: external_api_cache external_api_cache_cache_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.external_api_cache
    ADD CONSTRAINT external_api_cache_cache_key_key UNIQUE (cache_key);


--
-- Name: external_api_cache external_api_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.external_api_cache
    ADD CONSTRAINT external_api_cache_pkey PRIMARY KEY (cache_id);


--
-- Name: facet_registry facet_registry_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.facet_registry
    ADD CONSTRAINT facet_registry_address_key UNIQUE (address);


--
-- Name: facet_registry facet_registry_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.facet_registry
    ADD CONSTRAINT facet_registry_pkey PRIMARY KEY (id);


--
-- Name: faucet_requests faucet_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.faucet_requests
    ADD CONSTRAINT faucet_requests_pkey PRIMARY KEY (id);


--
-- Name: fiat_quotes fiat_quotes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fiat_quotes
    ADD CONSTRAINT fiat_quotes_pkey PRIMARY KEY (id);


--
-- Name: fiat_transactions fiat_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fiat_transactions
    ADD CONSTRAINT fiat_transactions_pkey PRIMARY KEY (id);


--
-- Name: fiat_transactions fiat_transactions_provider_transaction_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fiat_transactions
    ADD CONSTRAINT fiat_transactions_provider_transaction_unique UNIQUE (provider, provider_transaction_id);


--
-- Name: fund_nav_data fund_nav_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_nav_data
    ADD CONSTRAINT fund_nav_data_pkey PRIMARY KEY (id);


--
-- Name: fund_products fund_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_products
    ADD CONSTRAINT fund_products_pkey PRIMARY KEY (id);


--
-- Name: futures_prices futures_prices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.futures_prices
    ADD CONSTRAINT futures_prices_pkey PRIMARY KEY (id);


--
-- Name: geographic_jurisdictions geographic_jurisdictions_country_code_3_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.geographic_jurisdictions
    ADD CONSTRAINT geographic_jurisdictions_country_code_3_key UNIQUE (country_code_3);


--
-- Name: geographic_jurisdictions geographic_jurisdictions_country_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.geographic_jurisdictions
    ADD CONSTRAINT geographic_jurisdictions_country_code_key UNIQUE (country_code);


--
-- Name: geographic_jurisdictions geographic_jurisdictions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.geographic_jurisdictions
    ADD CONSTRAINT geographic_jurisdictions_pkey PRIMARY KEY (id);


--
-- Name: guardian_api_tests guardian_api_tests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_api_tests
    ADD CONSTRAINT guardian_api_tests_pkey PRIMARY KEY (id);


--
-- Name: guardian_operations guardian_operations_operation_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_operations
    ADD CONSTRAINT guardian_operations_operation_id_key UNIQUE (operation_id);


--
-- Name: guardian_operations guardian_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_operations
    ADD CONSTRAINT guardian_operations_pkey PRIMARY KEY (id);


--
-- Name: guardian_wallets guardian_wallets_guardian_wallet_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_wallets
    ADD CONSTRAINT guardian_wallets_guardian_wallet_id_key UNIQUE (guardian_wallet_id);


--
-- Name: guardian_wallets guardian_wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_wallets
    ADD CONSTRAINT guardian_wallets_pkey PRIMARY KEY (id);


--
-- Name: health_checks health_checks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.health_checks
    ADD CONSTRAINT health_checks_pkey PRIMARY KEY (id);


--
-- Name: health_checks health_checks_service_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.health_checks
    ADD CONSTRAINT health_checks_service_key UNIQUE (service);


--
-- Name: individual_documents individual_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.individual_documents
    ADD CONSTRAINT individual_documents_pkey PRIMARY KEY (id);


--
-- Name: infra_capex_schedule infra_capex_schedule_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_capex_schedule
    ADD CONSTRAINT infra_capex_schedule_pkey PRIMARY KEY (id);


--
-- Name: infra_concessions infra_concessions_contract_reference_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_concessions
    ADD CONSTRAINT infra_concessions_contract_reference_key UNIQUE (contract_reference);


--
-- Name: infra_concessions infra_concessions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_concessions
    ADD CONSTRAINT infra_concessions_pkey PRIMARY KEY (id);


--
-- Name: infra_operating_expenses infra_operating_expenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_operating_expenses
    ADD CONSTRAINT infra_operating_expenses_pkey PRIMARY KEY (id);


--
-- Name: infra_regulatory_filings infra_regulatory_filings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_regulatory_filings
    ADD CONSTRAINT infra_regulatory_filings_pkey PRIMARY KEY (id);


--
-- Name: infra_revenue_streams infra_revenue_streams_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_revenue_streams
    ADD CONSTRAINT infra_revenue_streams_pkey PRIMARY KEY (id);


--
-- Name: infra_usage_metrics infra_usage_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_usage_metrics
    ADD CONSTRAINT infra_usage_metrics_pkey PRIMARY KEY (id);


--
-- Name: infrastructure_products infrastructure_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infrastructure_products
    ADD CONSTRAINT infrastructure_products_pkey PRIMARY KEY (id);


--
-- Name: infrastructure_products infrastructure_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infrastructure_products
    ADD CONSTRAINT infrastructure_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT infrastructure_products_project_id_key ON infrastructure_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT infrastructure_products_project_id_key ON public.infrastructure_products IS 'Ensures only one product per project in this table';


--
-- Name: investor_approvals investor_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_approvals
    ADD CONSTRAINT investor_approvals_pkey PRIMARY KEY (id);


--
-- Name: investor_documents investor_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_documents
    ADD CONSTRAINT investor_documents_pkey PRIMARY KEY (id);


--
-- Name: investor_group_members investor_group_members_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_group_members
    ADD CONSTRAINT investor_group_members_pkey PRIMARY KEY (group_id, investor_id);


--
-- Name: investor_groups_investors investor_groups_investors_group_id_investor_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups_investors
    ADD CONSTRAINT investor_groups_investors_group_id_investor_id_key UNIQUE (group_id, investor_id);


--
-- Name: investor_groups_investors investor_groups_investors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups_investors
    ADD CONSTRAINT investor_groups_investors_pkey PRIMARY KEY (id);


--
-- Name: investor_groups investor_groups_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups
    ADD CONSTRAINT investor_groups_pkey PRIMARY KEY (id);


--
-- Name: investors investors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investors
    ADD CONSTRAINT investors_pkey PRIMARY KEY (investor_id);


--
-- Name: invoice_aging_buckets invoice_aging_buckets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_aging_buckets
    ADD CONSTRAINT invoice_aging_buckets_pkey PRIMARY KEY (id);


--
-- Name: invoice_collection_history invoice_collection_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_collection_history
    ADD CONSTRAINT invoice_collection_history_pkey PRIMARY KEY (id);


--
-- Name: invoice_debtor_ratings invoice_debtor_ratings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_debtor_ratings
    ADD CONSTRAINT invoice_debtor_ratings_pkey PRIMARY KEY (id);


--
-- Name: invoice invoice_invoice_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice
    ADD CONSTRAINT invoice_invoice_number_key UNIQUE (invoice_number);


--
-- Name: invoice_payments invoice_payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_payments
    ADD CONSTRAINT invoice_payments_pkey PRIMARY KEY (id);


--
-- Name: invoice invoice_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice
    ADD CONSTRAINT invoice_pkey PRIMARY KEY (invoice_id);


--
-- Name: invoice_receivables invoice_receivables_invoice_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_receivables
    ADD CONSTRAINT invoice_receivables_invoice_number_key UNIQUE (invoice_number);


--
-- Name: invoice_receivables invoice_receivables_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_receivables
    ADD CONSTRAINT invoice_receivables_pkey PRIMARY KEY (id);


--
-- Name: invoices invoices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_pkey PRIMARY KEY (id);


--
-- Name: issuer_access_roles issuer_access_roles_issuer_id_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_access_roles
    ADD CONSTRAINT issuer_access_roles_issuer_id_user_id_key UNIQUE (issuer_id, user_id);


--
-- Name: issuer_access_roles issuer_access_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_access_roles
    ADD CONSTRAINT issuer_access_roles_pkey PRIMARY KEY (id);


--
-- Name: issuer_detail_documents issuer_detail_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_detail_documents
    ADD CONSTRAINT issuer_detail_documents_pkey PRIMARY KEY (id);


--
-- Name: issuer_documents issuer_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_documents
    ADD CONSTRAINT issuer_documents_pkey PRIMARY KEY (id);


--
-- Name: key_vault_keys key_vault_keys_key_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT key_vault_keys_key_id_key UNIQUE (key_id);


--
-- Name: key_vault_keys key_vault_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT key_vault_keys_pkey PRIMARY KEY (id);


--
-- Name: kyc_screening_logs kyc_screening_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kyc_screening_logs
    ADD CONSTRAINT kyc_screening_logs_pkey PRIMARY KEY (id);


--
-- Name: lease_agreements lease_agreements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lease_agreements
    ADD CONSTRAINT lease_agreements_pkey PRIMARY KEY (id);


--
-- Name: market_data_providers market_data_providers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_data_providers
    ADD CONSTRAINT market_data_providers_pkey PRIMARY KEY (id);


--
-- Name: market_data_providers market_data_providers_provider_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_data_providers
    ADD CONSTRAINT market_data_providers_provider_name_key UNIQUE (provider_name);


--
-- Name: market_data_snapshots market_data_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_data_snapshots
    ADD CONSTRAINT market_data_snapshots_pkey PRIMARY KEY (snapshot_id);


--
-- Name: market_indices market_indices_index_symbol_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_indices
    ADD CONSTRAINT market_indices_index_symbol_key UNIQUE (index_symbol);


--
-- Name: market_indices market_indices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_indices
    ADD CONSTRAINT market_indices_pkey PRIMARY KEY (id);


--
-- Name: market_rent_data market_rent_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.market_rent_data
    ADD CONSTRAINT market_rent_data_pkey PRIMARY KEY (id);


--
-- Name: mfa_policies mfa_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mfa_policies
    ADD CONSTRAINT mfa_policies_pkey PRIMARY KEY (id);


--
-- Name: ml_baseline_statistics ml_baseline_statistics_operator_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ml_baseline_statistics
    ADD CONSTRAINT ml_baseline_statistics_operator_key UNIQUE (operator);


--
-- Name: ml_baseline_statistics ml_baseline_statistics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ml_baseline_statistics
    ADD CONSTRAINT ml_baseline_statistics_pkey PRIMARY KEY (id);


--
-- Name: mmf_allocation_history mmf_allocation_history_fund_product_id_as_of_date_asset_cla_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_allocation_history
    ADD CONSTRAINT mmf_allocation_history_fund_product_id_as_of_date_asset_cla_key UNIQUE (fund_product_id, as_of_date, asset_class);


--
-- Name: mmf_allocation_history mmf_allocation_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_allocation_history
    ADD CONSTRAINT mmf_allocation_history_pkey PRIMARY KEY (id);


--
-- Name: mmf_credit_ratings mmf_credit_ratings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_credit_ratings
    ADD CONSTRAINT mmf_credit_ratings_pkey PRIMARY KEY (id);


--
-- Name: mmf_fees_gates mmf_fees_gates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_fees_gates
    ADD CONSTRAINT mmf_fees_gates_pkey PRIMARY KEY (id);


--
-- Name: mmf_holdings mmf_holdings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_holdings
    ADD CONSTRAINT mmf_holdings_pkey PRIMARY KEY (id);


--
-- Name: mmf_liquidity_buckets mmf_liquidity_buckets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_liquidity_buckets
    ADD CONSTRAINT mmf_liquidity_buckets_pkey PRIMARY KEY (id);


--
-- Name: mmf_nav_history mmf_nav_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_nav_history
    ADD CONSTRAINT mmf_nav_history_pkey PRIMARY KEY (id);


--
-- Name: mmf_transactions mmf_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_transactions
    ADD CONSTRAINT mmf_transactions_pkey PRIMARY KEY (id);


--
-- Name: monitoring_metrics monitoring_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.monitoring_metrics
    ADD CONSTRAINT monitoring_metrics_pkey PRIMARY KEY (id);


--
-- Name: moonpay_asset_cache moonpay_asset_cache_contract_address_token_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_asset_cache
    ADD CONSTRAINT moonpay_asset_cache_contract_address_token_id_key UNIQUE (contract_address, token_id);


--
-- Name: moonpay_asset_cache moonpay_asset_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_asset_cache
    ADD CONSTRAINT moonpay_asset_cache_pkey PRIMARY KEY (id);


--
-- Name: moonpay_compliance_alerts moonpay_compliance_alerts_alert_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_compliance_alerts
    ADD CONSTRAINT moonpay_compliance_alerts_alert_id_key UNIQUE (alert_id);


--
-- Name: moonpay_compliance_alerts moonpay_compliance_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_compliance_alerts
    ADD CONSTRAINT moonpay_compliance_alerts_pkey PRIMARY KEY (id);


--
-- Name: moonpay_customers moonpay_customers_external_customer_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_customers
    ADD CONSTRAINT moonpay_customers_external_customer_id_key UNIQUE (external_customer_id);


--
-- Name: moonpay_customers moonpay_customers_moonpay_customer_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_customers
    ADD CONSTRAINT moonpay_customers_moonpay_customer_id_key UNIQUE (moonpay_customer_id);


--
-- Name: moonpay_customers moonpay_customers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_customers
    ADD CONSTRAINT moonpay_customers_pkey PRIMARY KEY (id);


--
-- Name: moonpay_passes moonpay_passes_external_pass_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_passes
    ADD CONSTRAINT moonpay_passes_external_pass_id_key UNIQUE (external_pass_id);


--
-- Name: moonpay_passes moonpay_passes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_passes
    ADD CONSTRAINT moonpay_passes_pkey PRIMARY KEY (id);


--
-- Name: moonpay_policies moonpay_policies_external_policy_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_policies
    ADD CONSTRAINT moonpay_policies_external_policy_id_key UNIQUE (external_policy_id);


--
-- Name: moonpay_policies moonpay_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_policies
    ADD CONSTRAINT moonpay_policies_pkey PRIMARY KEY (id);


--
-- Name: moonpay_policy_logs moonpay_policy_logs_log_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_policy_logs
    ADD CONSTRAINT moonpay_policy_logs_log_id_key UNIQUE (log_id);


--
-- Name: moonpay_policy_logs moonpay_policy_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_policy_logs
    ADD CONSTRAINT moonpay_policy_logs_pkey PRIMARY KEY (id);


--
-- Name: moonpay_projects moonpay_projects_external_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_projects
    ADD CONSTRAINT moonpay_projects_external_project_id_key UNIQUE (external_project_id);


--
-- Name: moonpay_projects moonpay_projects_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_projects
    ADD CONSTRAINT moonpay_projects_pkey PRIMARY KEY (id);


--
-- Name: moonpay_swap_transactions moonpay_swap_transactions_external_transaction_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_swap_transactions
    ADD CONSTRAINT moonpay_swap_transactions_external_transaction_id_key UNIQUE (external_transaction_id);


--
-- Name: moonpay_swap_transactions moonpay_swap_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_swap_transactions
    ADD CONSTRAINT moonpay_swap_transactions_pkey PRIMARY KEY (id);


--
-- Name: moonpay_transactions moonpay_transactions_external_transaction_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_transactions
    ADD CONSTRAINT moonpay_transactions_external_transaction_id_key UNIQUE (external_transaction_id);


--
-- Name: moonpay_transactions moonpay_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_transactions
    ADD CONSTRAINT moonpay_transactions_pkey PRIMARY KEY (id);


--
-- Name: moonpay_webhook_config moonpay_webhook_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_webhook_config
    ADD CONSTRAINT moonpay_webhook_config_pkey PRIMARY KEY (id);


--
-- Name: moonpay_webhook_config moonpay_webhook_config_webhook_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_webhook_config
    ADD CONSTRAINT moonpay_webhook_config_webhook_id_key UNIQUE (webhook_id);


--
-- Name: moonpay_webhook_events moonpay_webhook_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.moonpay_webhook_events
    ADD CONSTRAINT moonpay_webhook_events_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_audit_log multi_sig_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_audit_log
    ADD CONSTRAINT multi_sig_audit_log_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_configurations multi_sig_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_configurations
    ADD CONSTRAINT multi_sig_configurations_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_configurations multi_sig_configurations_wallet_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_configurations
    ADD CONSTRAINT multi_sig_configurations_wallet_id_key UNIQUE (wallet_id);


--
-- Name: multi_sig_on_chain_confirmations multi_sig_on_chain_confirmati_on_chain_transaction_id_signe_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_confirmations
    ADD CONSTRAINT multi_sig_on_chain_confirmati_on_chain_transaction_id_signe_key UNIQUE (on_chain_transaction_id, signer_address);


--
-- Name: multi_sig_on_chain_confirmations multi_sig_on_chain_confirmations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_confirmations
    ADD CONSTRAINT multi_sig_on_chain_confirmations_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_on_chain_transactions multi_sig_on_chain_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_transactions
    ADD CONSTRAINT multi_sig_on_chain_transactions_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_on_chain_transactions multi_sig_on_chain_transactions_wallet_id_on_chain_tx_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_transactions
    ADD CONSTRAINT multi_sig_on_chain_transactions_wallet_id_on_chain_tx_id_key UNIQUE (wallet_id, on_chain_tx_id);


--
-- Name: multi_sig_proposals multi_sig_proposals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_proposals
    ADD CONSTRAINT multi_sig_proposals_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_pkey PRIMARY KEY (id);


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_wallet_id_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_wallet_id_user_id_key UNIQUE (wallet_id, user_id);


--
-- Name: multi_sig_wallets multi_sig_wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallets
    ADD CONSTRAINT multi_sig_wallets_pkey PRIMARY KEY (id);


--
-- Name: nav_approvals nav_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_approvals
    ADD CONSTRAINT nav_approvals_pkey PRIMARY KEY (id);


--
-- Name: nav_asset_type_adjustments nav_asset_type_adjustments_asset_type_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_asset_type_adjustments
    ADD CONSTRAINT nav_asset_type_adjustments_asset_type_as_of_date_key UNIQUE (asset_type, as_of_date);


--
-- Name: nav_asset_type_adjustments nav_asset_type_adjustments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_asset_type_adjustments
    ADD CONSTRAINT nav_asset_type_adjustments_pkey PRIMARY KEY (id);


--
-- Name: nav_calculation_default_configs nav_calculation_default_configs_etf_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_default_configs
    ADD CONSTRAINT nav_calculation_default_configs_etf_type_key UNIQUE (etf_type);


--
-- Name: nav_calculation_default_configs nav_calculation_default_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_default_configs
    ADD CONSTRAINT nav_calculation_default_configs_pkey PRIMARY KEY (id);


--
-- Name: nav_calculation_history nav_calculation_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_history
    ADD CONSTRAINT nav_calculation_history_pkey PRIMARY KEY (id);


--
-- Name: nav_calculation_runs nav_calculation_runs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_runs
    ADD CONSTRAINT nav_calculation_runs_pkey PRIMARY KEY (id);


--
-- Name: nav_calculator_parameters nav_calculator_parameters_calculator_type_parameter_key_ass_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculator_parameters
    ADD CONSTRAINT nav_calculator_parameters_calculator_type_parameter_key_ass_key UNIQUE (calculator_type, parameter_key, asset_subtype);


--
-- Name: nav_calculator_parameters nav_calculator_parameters_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculator_parameters
    ADD CONSTRAINT nav_calculator_parameters_pkey PRIMARY KEY (id);


--
-- Name: nav_credit_quality_multipliers nav_credit_quality_multipliers_credit_quality_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_credit_quality_multipliers
    ADD CONSTRAINT nav_credit_quality_multipliers_credit_quality_as_of_date_key UNIQUE (credit_quality, as_of_date);


--
-- Name: nav_credit_quality_multipliers nav_credit_quality_multipliers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_credit_quality_multipliers
    ADD CONSTRAINT nav_credit_quality_multipliers_pkey PRIMARY KEY (id);


--
-- Name: nav_credit_spreads nav_credit_spreads_credit_rating_asset_class_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_credit_spreads
    ADD CONSTRAINT nav_credit_spreads_credit_rating_asset_class_as_of_date_key UNIQUE (credit_rating, asset_class, as_of_date);


--
-- Name: nav_credit_spreads nav_credit_spreads_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_credit_spreads
    ADD CONSTRAINT nav_credit_spreads_pkey PRIMARY KEY (id);


--
-- Name: nav_default_rates nav_default_rates_asset_type_credit_rating_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_default_rates
    ADD CONSTRAINT nav_default_rates_asset_type_credit_rating_as_of_date_key UNIQUE (asset_type, credit_rating, as_of_date);


--
-- Name: nav_default_rates nav_default_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_default_rates
    ADD CONSTRAINT nav_default_rates_pkey PRIMARY KEY (id);


--
-- Name: nav_delinquency_adjustments nav_delinquency_adjustments_days_past_due_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_delinquency_adjustments
    ADD CONSTRAINT nav_delinquency_adjustments_days_past_due_as_of_date_key UNIQUE (days_past_due, as_of_date);


--
-- Name: nav_delinquency_adjustments nav_delinquency_adjustments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_delinquency_adjustments
    ADD CONSTRAINT nav_delinquency_adjustments_pkey PRIMARY KEY (id);


--
-- Name: nav_economic_capital nav_economic_capital_credit_rating_confidence_level_as_of_d_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_economic_capital
    ADD CONSTRAINT nav_economic_capital_credit_rating_confidence_level_as_of_d_key UNIQUE (credit_rating, confidence_level, as_of_date);


--
-- Name: nav_economic_capital nav_economic_capital_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_economic_capital
    ADD CONSTRAINT nav_economic_capital_pkey PRIMARY KEY (id);


--
-- Name: nav_fx_rates nav_fx_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_fx_rates
    ADD CONSTRAINT nav_fx_rates_pkey PRIMARY KEY (base_ccy, quote_ccy, as_of);


--
-- Name: nav_liquidity_discounts nav_liquidity_discounts_credit_rating_asset_class_as_of_dat_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_liquidity_discounts
    ADD CONSTRAINT nav_liquidity_discounts_credit_rating_asset_class_as_of_dat_key UNIQUE (credit_rating, asset_class, as_of_date);


--
-- Name: nav_liquidity_discounts nav_liquidity_discounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_liquidity_discounts
    ADD CONSTRAINT nav_liquidity_discounts_pkey PRIMARY KEY (id);


--
-- Name: nav_loss_given_default nav_loss_given_default_asset_type_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_loss_given_default
    ADD CONSTRAINT nav_loss_given_default_asset_type_as_of_date_key UNIQUE (asset_type, as_of_date);


--
-- Name: nav_loss_given_default nav_loss_given_default_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_loss_given_default
    ADD CONSTRAINT nav_loss_given_default_pkey PRIMARY KEY (id);


--
-- Name: nav_oracle_configs nav_oracle_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_oracle_configs
    ADD CONSTRAINT nav_oracle_configs_pkey PRIMARY KEY (id);


--
-- Name: nav_prepayment_rates nav_prepayment_rates_asset_type_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_prepayment_rates
    ADD CONSTRAINT nav_prepayment_rates_asset_type_as_of_date_key UNIQUE (asset_type, as_of_date);


--
-- Name: nav_prepayment_rates nav_prepayment_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_prepayment_rates
    ADD CONSTRAINT nav_prepayment_rates_pkey PRIMARY KEY (id);


--
-- Name: nav_price_cache nav_price_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_price_cache
    ADD CONSTRAINT nav_price_cache_pkey PRIMARY KEY (instrument_key, source, as_of);


--
-- Name: nav_probability_of_default nav_probability_of_default_credit_rating_time_horizon_years_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_probability_of_default
    ADD CONSTRAINT nav_probability_of_default_credit_rating_time_horizon_years_key UNIQUE (credit_rating, time_horizon_years, as_of_date);


--
-- Name: nav_probability_of_default nav_probability_of_default_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_probability_of_default
    ADD CONSTRAINT nav_probability_of_default_pkey PRIMARY KEY (id);


--
-- Name: nav_recovery_rates nav_recovery_rates_asset_type_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_recovery_rates
    ADD CONSTRAINT nav_recovery_rates_asset_type_as_of_date_key UNIQUE (asset_type, as_of_date);


--
-- Name: nav_recovery_rates nav_recovery_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_recovery_rates
    ADD CONSTRAINT nav_recovery_rates_pkey PRIMARY KEY (id);


--
-- Name: nav_redemptions nav_redemptions_asset_id_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_redemptions
    ADD CONSTRAINT nav_redemptions_asset_id_as_of_date_key UNIQUE (asset_id, as_of_date);


--
-- Name: nav_redemptions nav_redemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_redemptions
    ADD CONSTRAINT nav_redemptions_pkey PRIMARY KEY (id);


--
-- Name: nav_unexpected_loss nav_unexpected_loss_credit_rating_as_of_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_unexpected_loss
    ADD CONSTRAINT nav_unexpected_loss_credit_rating_as_of_date_key UNIQUE (credit_rating, as_of_date);


--
-- Name: nav_unexpected_loss nav_unexpected_loss_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_unexpected_loss
    ADD CONSTRAINT nav_unexpected_loss_pkey PRIMARY KEY (id);


--
-- Name: nav_validation_results nav_validation_results_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_validation_results
    ADD CONSTRAINT nav_validation_results_pkey PRIMARY KEY (id);


--
-- Name: notification_settings notification_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_settings
    ADD CONSTRAINT notification_settings_pkey PRIMARY KEY (id);


--
-- Name: notifications notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_pkey PRIMARY KEY (id);


--
-- Name: onboarding_restrictions onboarding_restrictions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onboarding_restrictions
    ADD CONSTRAINT onboarding_restrictions_pkey PRIMARY KEY (id);


--
-- Name: onchain_claims onchain_claims_identity_id_issuer_id_topic_signature_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_claims
    ADD CONSTRAINT onchain_claims_identity_id_issuer_id_topic_signature_key UNIQUE (identity_id, issuer_id, topic, signature);


--
-- Name: onchain_claims onchain_claims_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_claims
    ADD CONSTRAINT onchain_claims_pkey PRIMARY KEY (id);


--
-- Name: onchain_identities onchain_identities_identity_address_blockchain_network_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_identities
    ADD CONSTRAINT onchain_identities_identity_address_blockchain_network_key UNIQUE (identity_address, blockchain, network);


--
-- Name: onchain_identities onchain_identities_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_identities
    ADD CONSTRAINT onchain_identities_pkey PRIMARY KEY (id);


--
-- Name: onchain_identities onchain_identities_user_id_blockchain_network_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_identities
    ADD CONSTRAINT onchain_identities_user_id_blockchain_network_key UNIQUE (user_id, blockchain, network);


--
-- Name: onchain_issuers onchain_issuers_issuer_address_blockchain_network_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_issuers
    ADD CONSTRAINT onchain_issuers_issuer_address_blockchain_network_key UNIQUE (issuer_address, blockchain, network);


--
-- Name: onchain_issuers onchain_issuers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_issuers
    ADD CONSTRAINT onchain_issuers_pkey PRIMARY KEY (id);


--
-- Name: onchain_verification_history onchain_verification_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_verification_history
    ADD CONSTRAINT onchain_verification_history_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_properties one_erc1155_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_properties
    ADD CONSTRAINT one_erc1155_property_per_token UNIQUE (token_id);


--
-- Name: token_erc1400_properties one_erc1400_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_properties
    ADD CONSTRAINT one_erc1400_property_per_token UNIQUE (token_id);


--
-- Name: token_erc3525_properties one_erc3525_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_properties
    ADD CONSTRAINT one_erc3525_property_per_token UNIQUE (token_id);


--
-- Name: token_erc4626_properties one_erc4626_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_properties
    ADD CONSTRAINT one_erc4626_property_per_token UNIQUE (token_id);


--
-- Name: token_erc721_properties one_erc721_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_properties
    ADD CONSTRAINT one_erc721_property_per_token UNIQUE (token_id);


--
-- Name: token_erc20_properties one_property_per_token; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc20_properties
    ADD CONSTRAINT one_property_per_token UNIQUE (token_id);


--
-- Name: operation_metadata operation_metadata_operation_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_metadata
    ADD CONSTRAINT operation_metadata_operation_id_key UNIQUE (operation_id);


--
-- Name: operation_metadata operation_metadata_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_metadata
    ADD CONSTRAINT operation_metadata_pkey PRIMARY KEY (id);


--
-- Name: operation_validations operation_validations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_validations
    ADD CONSTRAINT operation_validations_pkey PRIMARY KEY (id);


--
-- Name: operator_status operator_status_operator_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operator_status
    ADD CONSTRAINT operator_status_operator_key UNIQUE (operator);


--
-- Name: operator_status operator_status_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operator_status
    ADD CONSTRAINT operator_status_pkey PRIMARY KEY (id);


--
-- Name: organization_details organization_details_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_details
    ADD CONSTRAINT organization_details_pkey PRIMARY KEY (id);


--
-- Name: organizations organizations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_pkey PRIMARY KEY (id);


--
-- Name: payer payer_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payer
    ADD CONSTRAINT payer_pkey PRIMARY KEY (payer_id);


--
-- Name: paymaster_operations paymaster_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.paymaster_operations
    ADD CONSTRAINT paymaster_operations_pkey PRIMARY KEY (id);


--
-- Name: paymaster_policies paymaster_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.paymaster_policies
    ADD CONSTRAINT paymaster_policies_pkey PRIMARY KEY (id);


--
-- Name: pd_collateral pd_collateral_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_collateral
    ADD CONSTRAINT pd_collateral_pkey PRIMARY KEY (id);


--
-- Name: pd_covenants pd_covenants_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_covenants
    ADD CONSTRAINT pd_covenants_pkey PRIMARY KEY (id);


--
-- Name: pd_credit_ratings pd_credit_ratings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_credit_ratings
    ADD CONSTRAINT pd_credit_ratings_pkey PRIMARY KEY (id);


--
-- Name: pd_default_events pd_default_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_default_events
    ADD CONSTRAINT pd_default_events_pkey PRIMARY KEY (id);


--
-- Name: pd_loan_schedules pd_loan_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_loan_schedules
    ADD CONSTRAINT pd_loan_schedules_pkey PRIMARY KEY (id);


--
-- Name: pd_payment_history pd_payment_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_payment_history
    ADD CONSTRAINT pd_payment_history_pkey PRIMARY KEY (id);


--
-- Name: pe_capital_calls pe_capital_calls_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_capital_calls
    ADD CONSTRAINT pe_capital_calls_pkey PRIMARY KEY (id);


--
-- Name: pe_distributions pe_distributions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_distributions
    ADD CONSTRAINT pe_distributions_pkey PRIMARY KEY (id);


--
-- Name: pe_performance_metrics pe_performance_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_performance_metrics
    ADD CONSTRAINT pe_performance_metrics_pkey PRIMARY KEY (id);


--
-- Name: pe_portfolio_companies pe_portfolio_companies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_portfolio_companies
    ADD CONSTRAINT pe_portfolio_companies_pkey PRIMARY KEY (id);


--
-- Name: pe_valuations pe_valuations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_valuations
    ADD CONSTRAINT pe_valuations_pkey PRIMARY KEY (id);


--
-- Name: permissions permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.permissions
    ADD CONSTRAINT permissions_pkey PRIMARY KEY (name);


--
-- Name: policy_operation_mappings policy_operation_mappings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_operation_mappings
    ADD CONSTRAINT policy_operation_mappings_pkey PRIMARY KEY (id);


--
-- Name: policy_rule_approvers policy_rule_approvers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_rule_approvers
    ADD CONSTRAINT policy_rule_approvers_pkey PRIMARY KEY (id);


--
-- Name: policy_template_approvers policy_template_approvers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_template_approvers
    ADD CONSTRAINT policy_template_approvers_pkey PRIMARY KEY (template_id, user_id);


--
-- Name: policy_templates policy_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_templates
    ADD CONSTRAINT policy_templates_pkey PRIMARY KEY (template_id);


--
-- Name: policy_violations policy_violations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_violations
    ADD CONSTRAINT policy_violations_pkey PRIMARY KEY (id);


--
-- Name: pool pool_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pool
    ADD CONSTRAINT pool_pkey PRIMARY KEY (pool_id);


--
-- Name: private_debt_products private_debt_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_debt_products
    ADD CONSTRAINT private_debt_products_pkey PRIMARY KEY (id);


--
-- Name: private_debt_products private_debt_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_debt_products
    ADD CONSTRAINT private_debt_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT private_debt_products_project_id_key ON private_debt_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT private_debt_products_project_id_key ON public.private_debt_products IS 'Ensures only one product per project in this table';


--
-- Name: private_equity_products private_equity_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_equity_products
    ADD CONSTRAINT private_equity_products_pkey PRIMARY KEY (id);


--
-- Name: private_equity_products private_equity_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_equity_products
    ADD CONSTRAINT private_equity_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT private_equity_products_project_id_key ON private_equity_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT private_equity_products_project_id_key ON public.private_equity_products IS 'Ensures only one product per project in this table';


--
-- Name: product_lifecycle_events product_lifecycle_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product_lifecycle_events
    ADD CONSTRAINT product_lifecycle_events_pkey PRIMARY KEY (id);


--
-- Name: production_data production_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.production_data
    ADD CONSTRAINT production_data_pkey PRIMARY KEY (production_id);


--
-- Name: profiles profiles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_pkey PRIMARY KEY (id);


--
-- Name: project_organization_assignments project_organization_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_organization_assignments
    ADD CONSTRAINT project_organization_assignments_pkey PRIMARY KEY (id);


--
-- Name: project_wallets project_wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_wallets
    ADD CONSTRAINT project_wallets_pkey PRIMARY KEY (id);


--
-- Name: projects projects_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT projects_pkey PRIMARY KEY (id);


--
-- Name: property_expenses property_expenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_expenses
    ADD CONSTRAINT property_expenses_pkey PRIMARY KEY (id);


--
-- Name: property_insurance property_insurance_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_insurance
    ADD CONSTRAINT property_insurance_pkey PRIMARY KEY (id);


--
-- Name: property_tax_rates property_tax_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_tax_rates
    ADD CONSTRAINT property_tax_rates_pkey PRIMARY KEY (id);


--
-- Name: property_valuations property_valuations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_valuations
    ADD CONSTRAINT property_valuations_pkey PRIMARY KEY (id);


--
-- Name: proposal_signatures proposal_signatures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proposal_signatures
    ADD CONSTRAINT proposal_signatures_pkey PRIMARY KEY (id);


--
-- Name: proposal_signatures proposal_signatures_proposal_id_signer_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proposal_signatures
    ADD CONSTRAINT proposal_signatures_proposal_id_signer_address_key UNIQUE (proposal_id, signer_address);


--
-- Name: provider provider_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.provider
    ADD CONSTRAINT provider_pkey PRIMARY KEY (provider_id);


--
-- Name: proxy_approvals proxy_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proxy_approvals
    ADD CONSTRAINT proxy_approvals_pkey PRIMARY KEY (id);


--
-- Name: psp_api_keys psp_api_keys_key_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_api_keys
    ADD CONSTRAINT psp_api_keys_key_hash_key UNIQUE (key_hash);


--
-- Name: psp_api_keys psp_api_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_api_keys
    ADD CONSTRAINT psp_api_keys_pkey PRIMARY KEY (id);


--
-- Name: psp_balances psp_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_balances
    ADD CONSTRAINT psp_balances_pkey PRIMARY KEY (id);


--
-- Name: psp_balances psp_balances_project_id_virtual_account_id_asset_symbol_net_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_balances
    ADD CONSTRAINT psp_balances_project_id_virtual_account_id_asset_symbol_net_key UNIQUE (project_id, virtual_account_id, asset_symbol, network);


--
-- Name: psp_external_accounts psp_external_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_external_accounts
    ADD CONSTRAINT psp_external_accounts_pkey PRIMARY KEY (id);


--
-- Name: psp_external_accounts psp_external_accounts_warp_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_external_accounts
    ADD CONSTRAINT psp_external_accounts_warp_account_id_key UNIQUE (warp_account_id);


--
-- Name: psp_fiat_crypto_spreads psp_fiat_crypto_spreads_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_fiat_crypto_spreads
    ADD CONSTRAINT psp_fiat_crypto_spreads_pkey PRIMARY KEY (id);


--
-- Name: psp_fiat_crypto_spreads psp_fiat_crypto_spreads_project_id_crypto_asset_network_tie_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_fiat_crypto_spreads
    ADD CONSTRAINT psp_fiat_crypto_spreads_project_id_crypto_asset_network_tie_key UNIQUE (project_id, crypto_asset, network, tier_min, tier_max);


--
-- Name: psp_identity_cases psp_identity_cases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_identity_cases
    ADD CONSTRAINT psp_identity_cases_pkey PRIMARY KEY (id);


--
-- Name: psp_identity_cases psp_identity_cases_warp_case_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_identity_cases
    ADD CONSTRAINT psp_identity_cases_warp_case_id_key UNIQUE (warp_case_id);


--
-- Name: psp_payment_settings psp_payment_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payment_settings
    ADD CONSTRAINT psp_payment_settings_pkey PRIMARY KEY (id);


--
-- Name: psp_payment_settings psp_payment_settings_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payment_settings
    ADD CONSTRAINT psp_payment_settings_project_id_key UNIQUE (project_id);


--
-- Name: psp_payments psp_payments_idempotency_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payments
    ADD CONSTRAINT psp_payments_idempotency_key_key UNIQUE (idempotency_key);


--
-- Name: psp_payments psp_payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payments
    ADD CONSTRAINT psp_payments_pkey PRIMARY KEY (id);


--
-- Name: psp_payments psp_payments_warp_payment_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payments
    ADD CONSTRAINT psp_payments_warp_payment_id_key UNIQUE (warp_payment_id);


--
-- Name: psp_trades psp_trades_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_trades
    ADD CONSTRAINT psp_trades_pkey PRIMARY KEY (id);


--
-- Name: psp_trades psp_trades_warp_trade_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_trades
    ADD CONSTRAINT psp_trades_warp_trade_id_key UNIQUE (warp_trade_id);


--
-- Name: psp_virtual_accounts psp_virtual_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_virtual_accounts
    ADD CONSTRAINT psp_virtual_accounts_pkey PRIMARY KEY (id);


--
-- Name: psp_virtual_accounts psp_virtual_accounts_warp_virtual_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_virtual_accounts
    ADD CONSTRAINT psp_virtual_accounts_warp_virtual_account_id_key UNIQUE (warp_virtual_account_id);


--
-- Name: psp_webhook_events psp_webhook_events_event_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhook_events
    ADD CONSTRAINT psp_webhook_events_event_id_key UNIQUE (event_id);


--
-- Name: psp_webhook_events psp_webhook_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhook_events
    ADD CONSTRAINT psp_webhook_events_pkey PRIMARY KEY (id);


--
-- Name: psp_webhooks psp_webhooks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhooks
    ADD CONSTRAINT psp_webhooks_pkey PRIMARY KEY (id);


--
-- Name: quant_backtests quant_backtests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_backtests
    ADD CONSTRAINT quant_backtests_pkey PRIMARY KEY (id);


--
-- Name: quant_factors quant_factors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_factors
    ADD CONSTRAINT quant_factors_pkey PRIMARY KEY (id);


--
-- Name: quant_performance_attribution quant_performance_attribution_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_performance_attribution
    ADD CONSTRAINT quant_performance_attribution_pkey PRIMARY KEY (id);


--
-- Name: quant_risk_metrics quant_risk_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_risk_metrics
    ADD CONSTRAINT quant_risk_metrics_pkey PRIMARY KEY (id);


--
-- Name: quant_signals quant_signals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_signals
    ADD CONSTRAINT quant_signals_pkey PRIMARY KEY (id);


--
-- Name: quantitative_investment_strategies_products quantitative_investment_strategies_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_investment_strategies_products
    ADD CONSTRAINT quantitative_investment_strategies_products_pkey PRIMARY KEY (id);


--
-- Name: quantitative_investment_strategies_products quantitative_investment_strategies_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_investment_strategies_products
    ADD CONSTRAINT quantitative_investment_strategies_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT quantitative_investment_strategies_products_project_id_key ON quantitative_investment_strategies_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT quantitative_investment_strategies_products_project_id_key ON public.quantitative_investment_strategies_products IS 'Ensures only one product per project in this table';


--
-- Name: quantitative_strategies quantitative_strategies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_strategies
    ADD CONSTRAINT quantitative_strategies_pkey PRIMARY KEY (id);


--
-- Name: quantitative_strategies quantitative_strategies_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_strategies
    ADD CONSTRAINT quantitative_strategies_project_id_key UNIQUE (project_id);


--
-- Name: ramp_network_config ramp_network_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_network_config
    ADD CONSTRAINT ramp_network_config_pkey PRIMARY KEY (id);


--
-- Name: ramp_supported_assets ramp_supported_assets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_supported_assets
    ADD CONSTRAINT ramp_supported_assets_pkey PRIMARY KEY (id);


--
-- Name: ramp_supported_assets ramp_supported_assets_symbol_chain_flow_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_supported_assets
    ADD CONSTRAINT ramp_supported_assets_symbol_chain_flow_unique UNIQUE (symbol, chain, flow_type);


--
-- Name: ramp_transaction_events ramp_transaction_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_transaction_events
    ADD CONSTRAINT ramp_transaction_events_pkey PRIMARY KEY (id);


--
-- Name: ramp_webhook_events ramp_webhook_events_event_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_webhook_events
    ADD CONSTRAINT ramp_webhook_events_event_id_key UNIQUE (event_id);


--
-- Name: ramp_webhook_events ramp_webhook_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_webhook_events
    ADD CONSTRAINT ramp_webhook_events_pkey PRIMARY KEY (id);


--
-- Name: real_estate_products real_estate_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.real_estate_products
    ADD CONSTRAINT real_estate_products_pkey PRIMARY KEY (id);


--
-- Name: real_estate_products real_estate_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.real_estate_products
    ADD CONSTRAINT real_estate_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT real_estate_products_project_id_key ON real_estate_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT real_estate_products_project_id_key ON public.real_estate_products IS 'Ensures only one product per project in this table';


--
-- Name: rec_price_cache rec_price_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rec_price_cache
    ADD CONSTRAINT rec_price_cache_pkey PRIMARY KEY (cache_id);


--
-- Name: recent_address_selections recent_address_selections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.recent_address_selections
    ADD CONSTRAINT recent_address_selections_pkey PRIMARY KEY (id);


--
-- Name: redemption_analytics redemption_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_analytics
    ADD CONSTRAINT redemption_analytics_pkey PRIMARY KEY (id);


--
-- Name: redemption_approvers redemption_approvers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_approvers
    ADD CONSTRAINT redemption_approvers_pkey PRIMARY KEY (id);


--
-- Name: redemption_notifications redemption_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_notifications
    ADD CONSTRAINT redemption_notifications_pkey PRIMARY KEY (id);


--
-- Name: redemption_requests redemption_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT redemption_requests_pkey PRIMARY KEY (id);


--
-- Name: redemption_rules redemption_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_rules
    ADD CONSTRAINT redemption_rules_pkey PRIMARY KEY (id);


--
-- Name: redemption_settlements redemption_settlements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_settlements
    ADD CONSTRAINT redemption_settlements_pkey PRIMARY KEY (id);


--
-- Name: redemption_window_templates redemption_window_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_window_templates
    ADD CONSTRAINT redemption_window_templates_pkey PRIMARY KEY (id);


--
-- Name: redemption_windows redemption_windows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT redemption_windows_pkey PRIMARY KEY (id);


--
-- Name: regulatory_equivalence_mapping regulatory_equivalence_mappin_home_jurisdiction_equivalent__key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_equivalence_mapping
    ADD CONSTRAINT regulatory_equivalence_mappin_home_jurisdiction_equivalent__key UNIQUE (home_jurisdiction, equivalent_jurisdiction, regulatory_framework);


--
-- Name: regulatory_equivalence_mapping regulatory_equivalence_mapping_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_equivalence_mapping
    ADD CONSTRAINT regulatory_equivalence_mapping_pkey PRIMARY KEY (id);


--
-- Name: regulatory_exemptions regulatory_exemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_exemptions
    ADD CONSTRAINT regulatory_exemptions_pkey PRIMARY KEY (id);


--
-- Name: regulatory_registrations regulatory_registrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_registrations
    ADD CONSTRAINT regulatory_registrations_pkey PRIMARY KEY (id);


--
-- Name: regulatory_registrations regulatory_registrations_registration_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_registrations
    ADD CONSTRAINT regulatory_registrations_registration_number_key UNIQUE (registration_number);


--
-- Name: regulatory_reports regulatory_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_reports
    ADD CONSTRAINT regulatory_reports_pkey PRIMARY KEY (id);


--
-- Name: remediation_actions remediation_actions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.remediation_actions
    ADD CONSTRAINT remediation_actions_pkey PRIMARY KEY (id);


--
-- Name: renewable_energy_credits renewable_energy_credits_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.renewable_energy_credits
    ADD CONSTRAINT renewable_energy_credits_pkey PRIMARY KEY (rec_id);


--
-- Name: restriction_validation_logs restriction_validation_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.restriction_validation_logs
    ADD CONSTRAINT restriction_validation_logs_pkey PRIMARY KEY (id);


--
-- Name: ripple_dex_orders ripple_dex_orders_account_sequence_network_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_dex_orders
    ADD CONSTRAINT ripple_dex_orders_account_sequence_network_type_key UNIQUE (account, sequence, network_type);


--
-- Name: ripple_dex_orders ripple_dex_orders_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_dex_orders
    ADD CONSTRAINT ripple_dex_orders_pkey PRIMARY KEY (id);


--
-- Name: ripple_escrows ripple_escrows_escrow_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_escrows
    ADD CONSTRAINT ripple_escrows_escrow_id_key UNIQUE (escrow_id);


--
-- Name: ripple_escrows ripple_escrows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_escrows
    ADD CONSTRAINT ripple_escrows_pkey PRIMARY KEY (id);


--
-- Name: ripple_issuers ripple_issuers_address_network_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_issuers
    ADD CONSTRAINT ripple_issuers_address_network_type_key UNIQUE (address, network_type);


--
-- Name: ripple_issuers ripple_issuers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_issuers
    ADD CONSTRAINT ripple_issuers_pkey PRIMARY KEY (id);


--
-- Name: ripple_multisig_accounts ripple_multisig_accounts_address_network_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_multisig_accounts
    ADD CONSTRAINT ripple_multisig_accounts_address_network_type_key UNIQUE (address, network_type);


--
-- Name: ripple_multisig_accounts ripple_multisig_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_multisig_accounts
    ADD CONSTRAINT ripple_multisig_accounts_pkey PRIMARY KEY (id);


--
-- Name: ripple_multisig_proposals ripple_multisig_proposals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_multisig_proposals
    ADD CONSTRAINT ripple_multisig_proposals_pkey PRIMARY KEY (id);


--
-- Name: ripple_payments ripple_payments_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_payments
    ADD CONSTRAINT ripple_payments_hash_key UNIQUE (hash);


--
-- Name: ripple_payments ripple_payments_hash_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_payments
    ADD CONSTRAINT ripple_payments_hash_unique UNIQUE (hash);


--
-- Name: ripple_payments ripple_payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_payments
    ADD CONSTRAINT ripple_payments_pkey PRIMARY KEY (id);


--
-- Name: ripple_tokens ripple_tokens_currency_issuer_network_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_tokens
    ADD CONSTRAINT ripple_tokens_currency_issuer_network_type_key UNIQUE (currency, issuer, network_type);


--
-- Name: ripple_tokens ripple_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_tokens
    ADD CONSTRAINT ripple_tokens_pkey PRIMARY KEY (id);


--
-- Name: ripple_trust_lines ripple_trust_lines_account_currency_issuer_network_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_trust_lines
    ADD CONSTRAINT ripple_trust_lines_account_currency_issuer_network_type_key UNIQUE (account, currency, issuer, network_type);


--
-- Name: ripple_trust_lines ripple_trust_lines_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_trust_lines
    ADD CONSTRAINT ripple_trust_lines_pkey PRIMARY KEY (id);


--
-- Name: risk_assessments risk_assessments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_assessments
    ADD CONSTRAINT risk_assessments_pkey PRIMARY KEY (id);


--
-- Name: risk_thresholds risk_thresholds_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_thresholds
    ADD CONSTRAINT risk_thresholds_pkey PRIMARY KEY (id);


--
-- Name: role_addresses role_addresses_blockchain_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_addresses
    ADD CONSTRAINT role_addresses_blockchain_address_key UNIQUE (blockchain, address);


--
-- Name: role_addresses role_addresses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_addresses
    ADD CONSTRAINT role_addresses_pkey PRIMARY KEY (id);


--
-- Name: role_contracts role_contracts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_contracts
    ADD CONSTRAINT role_contracts_pkey PRIMARY KEY (id);


--
-- Name: role_permissions role_permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_permissions
    ADD CONSTRAINT role_permissions_pkey PRIMARY KEY (role_id, permission_name);


--
-- Name: roles roles_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.roles
    ADD CONSTRAINT roles_name_key UNIQUE (name);


--
-- Name: roles roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.roles
    ADD CONSTRAINT roles_pkey PRIMARY KEY (id);


--
-- Name: rule_conflicts rule_conflicts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_conflicts
    ADD CONSTRAINT rule_conflicts_pkey PRIMARY KEY (id);


--
-- Name: rule_evaluations rule_evaluations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_evaluations
    ADD CONSTRAINT rule_evaluations_pkey PRIMARY KEY (id);


--
-- Name: rules rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rules
    ADD CONSTRAINT rules_pkey UNIQUE (rule_id);


--
-- Name: sc_algorithm_parameters sc_algorithm_parameters_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_algorithm_parameters
    ADD CONSTRAINT sc_algorithm_parameters_pkey PRIMARY KEY (id);


--
-- Name: sc_minting_events sc_minting_events_mint_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_minting_events
    ADD CONSTRAINT sc_minting_events_mint_id_key UNIQUE (mint_id);


--
-- Name: sc_minting_events sc_minting_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_minting_events
    ADD CONSTRAINT sc_minting_events_pkey PRIMARY KEY (id);


--
-- Name: sc_peg_history sc_peg_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_peg_history
    ADD CONSTRAINT sc_peg_history_pkey PRIMARY KEY (id);


--
-- Name: sc_redemptions sc_redemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_redemptions
    ADD CONSTRAINT sc_redemptions_pkey PRIMARY KEY (id);


--
-- Name: sc_redemptions sc_redemptions_redemption_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_redemptions
    ADD CONSTRAINT sc_redemptions_redemption_id_key UNIQUE (redemption_id);


--
-- Name: sc_reserve_audits sc_reserve_audits_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_reserve_audits
    ADD CONSTRAINT sc_reserve_audits_pkey PRIMARY KEY (id);


--
-- Name: security_audit_logs security_audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.security_audit_logs
    ADD CONSTRAINT security_audit_logs_pkey PRIMARY KEY (id);


--
-- Name: security_events security_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.security_events
    ADD CONSTRAINT security_events_pkey PRIMARY KEY (id);


--
-- Name: session_key_usage session_key_usage_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.session_key_usage
    ADD CONSTRAINT session_key_usage_pkey PRIMARY KEY (id);


--
-- Name: session_keys session_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.session_keys
    ADD CONSTRAINT session_keys_pkey PRIMARY KEY (id);


--
-- Name: settlement_metrics settlement_metrics_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settlement_metrics
    ADD CONSTRAINT settlement_metrics_date_key UNIQUE (date);


--
-- Name: settlement_metrics settlement_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settlement_metrics
    ADD CONSTRAINT settlement_metrics_pkey PRIMARY KEY (id);


--
-- Name: settlement_operations settlement_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settlement_operations
    ADD CONSTRAINT settlement_operations_pkey PRIMARY KEY (id);


--
-- Name: sidebar_configurations sidebar_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_configurations
    ADD CONSTRAINT sidebar_configurations_pkey PRIMARY KEY (id);


--
-- Name: sidebar_items sidebar_items_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT sidebar_items_pkey PRIMARY KEY (id);


--
-- Name: sidebar_sections sidebar_sections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_sections
    ADD CONSTRAINT sidebar_sections_pkey PRIMARY KEY (id);


--
-- Name: signature_migration_approvals signature_migration_approvals_migration_id_approver_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signature_migration_approvals
    ADD CONSTRAINT signature_migration_approvals_migration_id_approver_address_key UNIQUE (migration_id, approver_address);


--
-- Name: signature_migration_approvals signature_migration_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signature_migration_approvals
    ADD CONSTRAINT signature_migration_approvals_pkey PRIMARY KEY (id);


--
-- Name: signature_migrations signature_migrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signature_migrations
    ADD CONSTRAINT signature_migrations_pkey PRIMARY KEY (id);


--
-- Name: signatures signatures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signatures
    ADD CONSTRAINT signatures_pkey PRIMARY KEY (id);


--
-- Name: signer_keys signer_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signer_keys
    ADD CONSTRAINT signer_keys_pkey PRIMARY KEY (id);


--
-- Name: signer_keys signer_keys_user_id_address_chain_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signer_keys
    ADD CONSTRAINT signer_keys_user_id_address_chain_type_key UNIQUE (user_id, address, chain_type);


--
-- Name: smart_contract_wallets smart_contract_wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.smart_contract_wallets
    ADD CONSTRAINT smart_contract_wallets_pkey PRIMARY KEY (id);


--
-- Name: sp_barrier_events sp_barrier_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_barrier_events
    ADD CONSTRAINT sp_barrier_events_pkey PRIMARY KEY (id);


--
-- Name: sp_components sp_components_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_components
    ADD CONSTRAINT sp_components_pkey PRIMARY KEY (id);


--
-- Name: sp_coupon_schedules sp_coupon_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_coupon_schedules
    ADD CONSTRAINT sp_coupon_schedules_pkey PRIMARY KEY (id);


--
-- Name: sp_payoff_structures sp_payoff_structures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_payoff_structures
    ADD CONSTRAINT sp_payoff_structures_pkey PRIMARY KEY (id);


--
-- Name: sp_performance_tracking sp_performance_tracking_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_performance_tracking
    ADD CONSTRAINT sp_performance_tracking_pkey PRIMARY KEY (id);


--
-- Name: sp_redemption_features sp_redemption_features_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_redemption_features
    ADD CONSTRAINT sp_redemption_features_pkey PRIMARY KEY (id);


--
-- Name: stablecoin_collateral stablecoin_collateral_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stablecoin_collateral
    ADD CONSTRAINT stablecoin_collateral_pkey PRIMARY KEY (id);


--
-- Name: stablecoin_products stablecoin_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stablecoin_products
    ADD CONSTRAINT stablecoin_products_pkey PRIMARY KEY (id);


--
-- Name: stablecoin_products stablecoin_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stablecoin_products
    ADD CONSTRAINT stablecoin_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT stablecoin_products_project_id_key ON stablecoin_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT stablecoin_products_project_id_key ON public.stablecoin_products IS 'Ensures only one product per project in this table';


--
-- Name: stage_requirements stage_requirements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stage_requirements
    ADD CONSTRAINT stage_requirements_pkey PRIMARY KEY (id);


--
-- Name: staking_apr_config staking_apr_config_blockchain_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.staking_apr_config
    ADD CONSTRAINT staking_apr_config_blockchain_key UNIQUE (blockchain);


--
-- Name: staking_apr_config staking_apr_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.staking_apr_config
    ADD CONSTRAINT staking_apr_config_pkey PRIMARY KEY (id);


--
-- Name: stock_dividends stock_dividends_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stock_dividends
    ADD CONSTRAINT stock_dividends_pkey PRIMARY KEY (id);


--
-- Name: stock_exchanges stock_exchanges_exchange_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stock_exchanges
    ADD CONSTRAINT stock_exchanges_exchange_code_key UNIQUE (exchange_code);


--
-- Name: stock_exchanges stock_exchanges_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stock_exchanges
    ADD CONSTRAINT stock_exchanges_pkey PRIMARY KEY (id);


--
-- Name: stripe_conversion_transactions stripe_conversion_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_conversion_transactions
    ADD CONSTRAINT stripe_conversion_transactions_pkey PRIMARY KEY (id);


--
-- Name: stripe_stablecoin_accounts stripe_stablecoin_accounts_account_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_stablecoin_accounts
    ADD CONSTRAINT stripe_stablecoin_accounts_account_id_key UNIQUE (account_id);


--
-- Name: stripe_stablecoin_accounts stripe_stablecoin_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_stablecoin_accounts
    ADD CONSTRAINT stripe_stablecoin_accounts_pkey PRIMARY KEY (id);


--
-- Name: stripe_webhook_events stripe_webhook_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_webhook_events
    ADD CONSTRAINT stripe_webhook_events_pkey PRIMARY KEY (id);


--
-- Name: stripe_webhook_events stripe_webhook_events_stripe_event_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_webhook_events
    ADD CONSTRAINT stripe_webhook_events_stripe_event_id_key UNIQUE (stripe_event_id);


--
-- Name: structured_products structured_products_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.structured_products
    ADD CONSTRAINT structured_products_pkey PRIMARY KEY (id);


--
-- Name: structured_products structured_products_project_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.structured_products
    ADD CONSTRAINT structured_products_project_id_key UNIQUE (project_id);


--
-- Name: CONSTRAINT structured_products_project_id_key ON structured_products; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT structured_products_project_id_key ON public.structured_products IS 'Ensures only one product per project in this table';


--
-- Name: subscriptions subscriptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_pkey PRIMARY KEY (id);


--
-- Name: suspicious_activity_reports suspicious_activity_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspicious_activity_reports
    ADD CONSTRAINT suspicious_activity_reports_pkey PRIMARY KEY (id);


--
-- Name: system_processes system_processes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_processes
    ADD CONSTRAINT system_processes_pkey PRIMARY KEY (id);


--
-- Name: system_settings system_settings_key_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_settings
    ADD CONSTRAINT system_settings_key_unique UNIQUE (key);


--
-- Name: system_settings system_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_settings
    ADD CONSTRAINT system_settings_pkey PRIMARY KEY (id);


--
-- Name: threshold_breaches threshold_breaches_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.threshold_breaches
    ADD CONSTRAINT threshold_breaches_pkey PRIMARY KEY (id);


--
-- Name: token_allocations token_allocations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_allocations
    ADD CONSTRAINT token_allocations_pkey PRIMARY KEY (id);


--
-- Name: token_climate_properties token_climate_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_climate_properties
    ADD CONSTRAINT token_climate_properties_pkey PRIMARY KEY (token_id);


--
-- Name: token_deployment_history token_deployment_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_history
    ADD CONSTRAINT token_deployment_history_pkey PRIMARY KEY (id);


--
-- Name: token_deployment_verifications token_deployment_verifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_verifications
    ADD CONSTRAINT token_deployment_verifications_pkey PRIMARY KEY (id);


--
-- Name: token_deployments token_deployments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployments
    ADD CONSTRAINT token_deployments_pkey PRIMARY KEY (id);


--
-- Name: token_designs token_designs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_designs
    ADD CONSTRAINT token_designs_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_balances token_erc1155_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_balances
    ADD CONSTRAINT token_erc1155_balances_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_crafting_recipes token_erc1155_crafting_recipes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_crafting_recipes
    ADD CONSTRAINT token_erc1155_crafting_recipes_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_discount_tiers token_erc1155_discount_tiers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_discount_tiers
    ADD CONSTRAINT token_erc1155_discount_tiers_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_properties token_erc1155_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_properties
    ADD CONSTRAINT token_erc1155_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_type_configs token_erc1155_type_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_type_configs
    ADD CONSTRAINT token_erc1155_type_configs_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_type_configs token_erc1155_type_configs_token_id_token_type_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_type_configs
    ADD CONSTRAINT token_erc1155_type_configs_token_id_token_type_id_key UNIQUE (token_id, token_type_id);


--
-- Name: token_erc1155_types token_erc1155_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_types
    ADD CONSTRAINT token_erc1155_types_pkey PRIMARY KEY (id);


--
-- Name: token_erc1155_uri_mappings token_erc1155_uri_mappings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_uri_mappings
    ADD CONSTRAINT token_erc1155_uri_mappings_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_controllers token_erc1400_controllers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_controllers
    ADD CONSTRAINT token_erc1400_controllers_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_documents token_erc1400_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_documents
    ADD CONSTRAINT token_erc1400_documents_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_partition_balances token_erc1400_partition_balance_partition_id_holder_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_balances
    ADD CONSTRAINT token_erc1400_partition_balance_partition_id_holder_address_key UNIQUE (partition_id, holder_address);


--
-- Name: token_erc1400_partition_balances token_erc1400_partition_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_balances
    ADD CONSTRAINT token_erc1400_partition_balances_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_partition_operators token_erc1400_partition_opera_partition_id_holder_address_o_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_operators
    ADD CONSTRAINT token_erc1400_partition_opera_partition_id_holder_address_o_key UNIQUE (partition_id, holder_address, operator_address);


--
-- Name: token_erc1400_partition_operators token_erc1400_partition_operators_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_operators
    ADD CONSTRAINT token_erc1400_partition_operators_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_partition_transfers token_erc1400_partition_transfers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_transfers
    ADD CONSTRAINT token_erc1400_partition_transfers_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_partitions token_erc1400_partitions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partitions
    ADD CONSTRAINT token_erc1400_partitions_pkey PRIMARY KEY (id);


--
-- Name: token_erc1400_properties token_erc1400_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_properties
    ADD CONSTRAINT token_erc1400_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc20_properties token_erc20_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc20_properties
    ADD CONSTRAINT token_erc20_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_allocations token_erc3525_allocations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_allocations
    ADD CONSTRAINT token_erc3525_allocations_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_payment_schedules token_erc3525_payment_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_payment_schedules
    ADD CONSTRAINT token_erc3525_payment_schedules_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_properties token_erc3525_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_properties
    ADD CONSTRAINT token_erc3525_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_slot_configs token_erc3525_slot_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slot_configs
    ADD CONSTRAINT token_erc3525_slot_configs_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_slot_configs token_erc3525_slot_configs_token_id_slot_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slot_configs
    ADD CONSTRAINT token_erc3525_slot_configs_token_id_slot_id_key UNIQUE (token_id, slot_id);


--
-- Name: token_erc3525_slots token_erc3525_slots_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slots
    ADD CONSTRAINT token_erc3525_slots_pkey PRIMARY KEY (id);


--
-- Name: token_erc3525_value_adjustments token_erc3525_value_adjustments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_value_adjustments
    ADD CONSTRAINT token_erc3525_value_adjustments_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_asset_allocations token_erc4626_asset_allocations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_asset_allocations
    ADD CONSTRAINT token_erc4626_asset_allocations_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_fee_tiers token_erc4626_fee_tiers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_fee_tiers
    ADD CONSTRAINT token_erc4626_fee_tiers_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_performance_metrics token_erc4626_performance_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_performance_metrics
    ADD CONSTRAINT token_erc4626_performance_metrics_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_performance_metrics token_erc4626_performance_metrics_token_id_metric_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_performance_metrics
    ADD CONSTRAINT token_erc4626_performance_metrics_token_id_metric_date_key UNIQUE (token_id, metric_date);


--
-- Name: token_erc4626_properties token_erc4626_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_properties
    ADD CONSTRAINT token_erc4626_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_strategy_params token_erc4626_strategy_params_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_strategy_params
    ADD CONSTRAINT token_erc4626_strategy_params_pkey PRIMARY KEY (id);


--
-- Name: token_erc4626_vault_strategies token_erc4626_vault_strategies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_vault_strategies
    ADD CONSTRAINT token_erc4626_vault_strategies_pkey PRIMARY KEY (id);


--
-- Name: token_erc721_attributes token_erc721_attributes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_attributes
    ADD CONSTRAINT token_erc721_attributes_pkey PRIMARY KEY (id);


--
-- Name: token_erc721_mint_phases token_erc721_mint_phases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_mint_phases
    ADD CONSTRAINT token_erc721_mint_phases_pkey PRIMARY KEY (id);


--
-- Name: token_erc721_mint_phases token_erc721_mint_phases_token_id_phase_order_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_mint_phases
    ADD CONSTRAINT token_erc721_mint_phases_token_id_phase_order_key UNIQUE (token_id, phase_order);


--
-- Name: token_erc721_properties token_erc721_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_properties
    ADD CONSTRAINT token_erc721_properties_pkey PRIMARY KEY (id);


--
-- Name: token_erc721_trait_definitions token_erc721_trait_definitions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_trait_definitions
    ADD CONSTRAINT token_erc721_trait_definitions_pkey PRIMARY KEY (id);


--
-- Name: token_erc721_trait_definitions token_erc721_trait_definitions_token_id_trait_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_trait_definitions
    ADD CONSTRAINT token_erc721_trait_definitions_token_id_trait_name_key UNIQUE (token_id, trait_name);


--
-- Name: token_events token_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_events
    ADD CONSTRAINT token_events_pkey PRIMARY KEY (id);


--
-- Name: token_exchange_configs token_exchange_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_exchange_configs
    ADD CONSTRAINT token_exchange_configs_pkey PRIMARY KEY (id);


--
-- Name: token_exchange_configs token_exchange_configs_token_id_currency_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_exchange_configs
    ADD CONSTRAINT token_exchange_configs_token_id_currency_key UNIQUE (token_id, currency);


--
-- Name: token_extensions token_extensions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_extensions
    ADD CONSTRAINT token_extensions_pkey PRIMARY KEY (id);


--
-- Name: token_extensions token_extensions_token_id_extension_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_extensions
    ADD CONSTRAINT token_extensions_token_id_extension_type_key UNIQUE (token_id, extension_type);


--
-- Name: token_geographic_restrictions token_geographic_restrictions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_geographic_restrictions
    ADD CONSTRAINT token_geographic_restrictions_pkey PRIMARY KEY (id);


--
-- Name: token_geographic_restrictions token_geographic_restrictions_token_id_country_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_geographic_restrictions
    ADD CONSTRAINT token_geographic_restrictions_token_id_country_code_key UNIQUE (token_id, country_code);


--
-- Name: token_modules token_modules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_modules
    ADD CONSTRAINT token_modules_pkey PRIMARY KEY (id);


--
-- Name: token_operations token_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_operations
    ADD CONSTRAINT token_operations_pkey PRIMARY KEY (id);


--
-- Name: token_sanctions_rules token_sanctions_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_sanctions_rules
    ADD CONSTRAINT token_sanctions_rules_pkey PRIMARY KEY (id);


--
-- Name: token_templates token_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_templates
    ADD CONSTRAINT token_templates_pkey PRIMARY KEY (id);


--
-- Name: token_versions token_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_versions
    ADD CONSTRAINT token_versions_pkey PRIMARY KEY (id);


--
-- Name: token_whitelists token_whitelists_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_whitelists
    ADD CONSTRAINT token_whitelists_pkey PRIMARY KEY (id);


--
-- Name: tokens tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tokens
    ADD CONSTRAINT tokens_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_auction_executions trade_finance_auction_executions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_auction_executions
    ADD CONSTRAINT trade_finance_auction_executions_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_authorized_claimers trade_finance_authorized_clai_user_address_claimer_address__key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_authorized_claimers
    ADD CONSTRAINT trade_finance_authorized_clai_user_address_claimer_address__key UNIQUE (user_address, claimer_address, chain_id);


--
-- Name: trade_finance_authorized_claimers trade_finance_authorized_claimers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_authorized_claimers
    ADD CONSTRAINT trade_finance_authorized_claimers_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_commodity_emission_configs trade_finance_commodity_emission_configs_commodity_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_commodity_emission_configs
    ADD CONSTRAINT trade_finance_commodity_emission_configs_commodity_type_key UNIQUE (commodity_type);


--
-- Name: trade_finance_commodity_emission_configs trade_finance_commodity_emission_configs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_commodity_emission_configs
    ADD CONSTRAINT trade_finance_commodity_emission_configs_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_dutch_auctions trade_finance_dutch_auctions_auction_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_dutch_auctions
    ADD CONSTRAINT trade_finance_dutch_auctions_auction_id_key UNIQUE (auction_id);


--
-- Name: trade_finance_dutch_auctions trade_finance_dutch_auctions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_dutch_auctions
    ADD CONSTRAINT trade_finance_dutch_auctions_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_emission_admins trade_finance_emission_admins_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_emission_admins
    ADD CONSTRAINT trade_finance_emission_admins_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_emission_admins trade_finance_emission_admins_reward_token_address_chain_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_emission_admins
    ADD CONSTRAINT trade_finance_emission_admins_reward_token_address_chain_id_key UNIQUE (reward_token_address, chain_id);


--
-- Name: trade_finance_fee_accumulations trade_finance_fee_accumulations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_fee_accumulations
    ADD CONSTRAINT trade_finance_fee_accumulations_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_fee_accumulations trade_finance_fee_accumulations_token_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_fee_accumulations
    ADD CONSTRAINT trade_finance_fee_accumulations_token_address_key UNIQUE (token_address);


--
-- Name: trade_finance_fee_collections trade_finance_fee_collections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_fee_collections
    ADD CONSTRAINT trade_finance_fee_collections_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_fee_distributions trade_finance_fee_distributions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_fee_distributions
    ADD CONSTRAINT trade_finance_fee_distributions_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_flash_liquidations trade_finance_flash_liquidations_liquidation_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_flash_liquidations
    ADD CONSTRAINT trade_finance_flash_liquidations_liquidation_id_key UNIQUE (liquidation_id);


--
-- Name: trade_finance_flash_liquidations trade_finance_flash_liquidations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_flash_liquidations
    ADD CONSTRAINT trade_finance_flash_liquidations_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_health_warnings trade_finance_health_warnings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_health_warnings
    ADD CONSTRAINT trade_finance_health_warnings_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_insurance_claims trade_finance_insurance_claims_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_insurance_claims
    ADD CONSTRAINT trade_finance_insurance_claims_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_interest_rate_config trade_finance_interest_rate_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_interest_rate_config
    ADD CONSTRAINT trade_finance_interest_rate_config_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_interest_rate_config trade_finance_interest_rate_config_reserve_address_chain_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_interest_rate_config
    ADD CONSTRAINT trade_finance_interest_rate_config_reserve_address_chain_id_key UNIQUE (reserve_address, chain_id);


--
-- Name: trade_finance_margin_calls trade_finance_margin_calls_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_margin_calls
    ADD CONSTRAINT trade_finance_margin_calls_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_partial_liquidations trade_finance_partial_liquidations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_partial_liquidations
    ADD CONSTRAINT trade_finance_partial_liquidations_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_payment_streams trade_finance_payment_streams_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_payment_streams
    ADD CONSTRAINT trade_finance_payment_streams_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_payment_streams trade_finance_payment_streams_stream_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_payment_streams
    ADD CONSTRAINT trade_finance_payment_streams_stream_id_key UNIQUE (stream_id);


--
-- Name: trade_finance_protocol_reserve trade_finance_protocol_reserve_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_protocol_reserve
    ADD CONSTRAINT trade_finance_protocol_reserve_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_protocol_reserve trade_finance_protocol_reserve_token_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_protocol_reserve
    ADD CONSTRAINT trade_finance_protocol_reserve_token_address_key UNIQUE (token_address);


--
-- Name: trade_finance_rate_history trade_finance_rate_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rate_history
    ADD CONSTRAINT trade_finance_rate_history_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_rate_simulations trade_finance_rate_simulations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rate_simulations
    ADD CONSTRAINT trade_finance_rate_simulations_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_reserve_transactions trade_finance_reserve_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_reserve_transactions
    ADD CONSTRAINT trade_finance_reserve_transactions_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_revenue_recipients trade_finance_revenue_recipients_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_revenue_recipients
    ADD CONSTRAINT trade_finance_revenue_recipients_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_revenue_recipients trade_finance_revenue_recipients_recipient_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_revenue_recipients
    ADD CONSTRAINT trade_finance_revenue_recipients_recipient_id_key UNIQUE (recipient_id);


--
-- Name: trade_finance_rewards_claims trade_finance_rewards_claims_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rewards_claims
    ADD CONSTRAINT trade_finance_rewards_claims_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_rewards_config trade_finance_rewards_config_asset_address_reward_token_add_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rewards_config
    ADD CONSTRAINT trade_finance_rewards_config_asset_address_reward_token_add_key UNIQUE (asset_address, reward_token_address, chain_id);


--
-- Name: trade_finance_rewards_config trade_finance_rewards_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rewards_config
    ADD CONSTRAINT trade_finance_rewards_config_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_rewards_snapshots trade_finance_rewards_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_rewards_snapshots
    ADD CONSTRAINT trade_finance_rewards_snapshots_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_seasonal_multipliers trade_finance_seasonal_multipliers_commodity_type_month_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_seasonal_multipliers
    ADD CONSTRAINT trade_finance_seasonal_multipliers_commodity_type_month_key UNIQUE (commodity_type, month);


--
-- Name: trade_finance_seasonal_multipliers trade_finance_seasonal_multipliers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_seasonal_multipliers
    ADD CONSTRAINT trade_finance_seasonal_multipliers_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_stata_operations trade_finance_stata_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stata_operations
    ADD CONSTRAINT trade_finance_stata_operations_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_stata_tokens trade_finance_stata_tokens_ctoken_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stata_tokens
    ADD CONSTRAINT trade_finance_stata_tokens_ctoken_address_key UNIQUE (ctoken_address);


--
-- Name: trade_finance_stata_tokens trade_finance_stata_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stata_tokens
    ADD CONSTRAINT trade_finance_stata_tokens_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_stata_tokens trade_finance_stata_tokens_stata_token_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stata_tokens
    ADD CONSTRAINT trade_finance_stata_tokens_stata_token_address_key UNIQUE (stata_token_address);


--
-- Name: trade_finance_stream_withdrawals trade_finance_stream_withdrawals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stream_withdrawals
    ADD CONSTRAINT trade_finance_stream_withdrawals_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_transfer_strategies trade_finance_transfer_strategies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_transfer_strategies
    ADD CONSTRAINT trade_finance_transfer_strategies_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_transfer_strategies trade_finance_transfer_strategies_strategy_address_chain_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_transfer_strategies
    ADD CONSTRAINT trade_finance_transfer_strategies_strategy_address_chain_id_key UNIQUE (strategy_address, chain_id);


--
-- Name: trade_finance_treasury_snapshots trade_finance_treasury_snapshot_token_address_snapshot_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_treasury_snapshots
    ADD CONSTRAINT trade_finance_treasury_snapshot_token_address_snapshot_date_key UNIQUE (token_address, snapshot_date);


--
-- Name: trade_finance_treasury_snapshots trade_finance_treasury_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_treasury_snapshots
    ADD CONSTRAINT trade_finance_treasury_snapshots_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_user_rewards trade_finance_user_rewards_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_user_rewards
    ADD CONSTRAINT trade_finance_user_rewards_pkey PRIMARY KEY (id);


--
-- Name: trade_finance_user_rewards trade_finance_user_rewards_user_address_asset_address_rewar_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_user_rewards
    ADD CONSTRAINT trade_finance_user_rewards_user_address_asset_address_rewar_key UNIQUE (user_address, asset_address, reward_token_address, chain_id);


--
-- Name: transaction_events transaction_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_events
    ADD CONSTRAINT transaction_events_pkey PRIMARY KEY (id);


--
-- Name: transaction_notifications transaction_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_notifications
    ADD CONSTRAINT transaction_notifications_pkey PRIMARY KEY (id);


--
-- Name: transaction_signatures transaction_signatures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_signatures
    ADD CONSTRAINT transaction_signatures_pkey PRIMARY KEY (id);


--
-- Name: transaction_validations transaction_validations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_validations
    ADD CONSTRAINT transaction_validations_pkey PRIMARY KEY (id);


--
-- Name: transactions transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transactions
    ADD CONSTRAINT transactions_pkey PRIMARY KEY (id);


--
-- Name: transactions transactions_transaction_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transactions
    ADD CONSTRAINT transactions_transaction_hash_key UNIQUE (transaction_hash);


--
-- Name: transfer_batches transfer_batches_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transfer_batches
    ADD CONSTRAINT transfer_batches_pkey PRIMARY KEY (id);


--
-- Name: transfer_operations transfer_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transfer_operations
    ADD CONSTRAINT transfer_operations_pkey PRIMARY KEY (id);


--
-- Name: asset_nav_data unique_asset_date; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_nav_data
    ADD CONSTRAINT unique_asset_date UNIQUE (asset_id, date);


--
-- Name: commodity_risk_metrics unique_commodity_risk_per_project; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_risk_metrics
    ADD CONSTRAINT unique_commodity_risk_per_project UNIQUE (project_id, commodity_type, calculated_at);


--
-- Name: approval_config_approvers unique_config_role_approver; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT unique_config_role_approver UNIQUE (approval_config_id, approver_role_id);


--
-- Name: approval_config_approvers unique_config_user_approver; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT unique_config_user_approver UNIQUE (approval_config_id, approver_user_id);


--
-- Name: sidebar_configurations unique_default_per_new_target; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_configurations
    ADD CONSTRAINT unique_default_per_new_target UNIQUE (target_role_ids, target_profile_type_enums, is_default, organization_id) DEFERRABLE;


--
-- Name: energy_assets unique_energy_asset_combination; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_assets
    ADD CONSTRAINT unique_energy_asset_combination UNIQUE (name, type, location, capacity);


--
-- Name: fund_nav_data unique_fund_date; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_nav_data
    ADD CONSTRAINT unique_fund_date UNIQUE (fund_id, date);


--
-- Name: sidebar_items unique_item_per_section; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT unique_item_per_section UNIQUE (item_id, section_id);


--
-- Name: commodity_pool_config unique_pool_config_per_commodity; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_pool_config
    ADD CONSTRAINT unique_pool_config_per_commodity UNIQUE (project_id, commodity_type);


--
-- Name: commodity_positions unique_position_per_wallet; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_positions
    ADD CONSTRAINT unique_position_per_wallet UNIQUE (project_id, wallet_address);


--
-- Name: project_organization_assignments unique_project_organization_relationship; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_organization_assignments
    ADD CONSTRAINT unique_project_organization_relationship UNIQUE (project_id, organization_id, relationship_type);


--
-- Name: regulatory_exemptions unique_region_country_exemption_type; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_exemptions
    ADD CONSTRAINT unique_region_country_exemption_type UNIQUE (region, country, exemption_type);


--
-- Name: sidebar_sections unique_section_per_org; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_sections
    ADD CONSTRAINT unique_section_per_org UNIQUE (section_id, organization_id);


--
-- Name: token_erc3525_allocations unique_token_allocation; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_allocations
    ADD CONSTRAINT unique_token_allocation UNIQUE (token_id, slot_id, token_id_within_slot);


--
-- Name: token_erc1400_controllers unique_token_controller; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_controllers
    ADD CONSTRAINT unique_token_controller UNIQUE (token_id, address);


--
-- Name: deployment_rate_limits unique_token_deployment; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.deployment_rate_limits
    ADD CONSTRAINT unique_token_deployment UNIQUE (token_id, started_at);


--
-- Name: token_erc1400_partitions unique_token_partition; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partitions
    ADD CONSTRAINT unique_token_partition UNIQUE (token_id, partition_id);


--
-- Name: token_erc3525_slots unique_token_slot; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slots
    ADD CONSTRAINT unique_token_slot UNIQUE (token_id, slot_id);


--
-- Name: token_erc4626_strategy_params unique_token_strategy_param; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_strategy_params
    ADD CONSTRAINT unique_token_strategy_param UNIQUE (token_id, name);


--
-- Name: token_erc721_attributes unique_token_trait; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_attributes
    ADD CONSTRAINT unique_token_trait UNIQUE (token_id, trait_type);


--
-- Name: token_erc1155_types unique_token_type; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_types
    ADD CONSTRAINT unique_token_type UNIQUE (token_id, token_type_id);


--
-- Name: user_sidebar_preferences unique_user_prefs; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sidebar_preferences
    ADD CONSTRAINT unique_user_prefs UNIQUE (user_id, organization_id);


--
-- Name: token_whitelists unique_whitelist_token_wallet; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_whitelists
    ADD CONSTRAINT unique_whitelist_token_wallet UNIQUE (token_id, wallet_address);


--
-- Name: project_wallets uq_project_wallets_wallet_address; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_wallets
    ADD CONSTRAINT uq_project_wallets_wallet_address UNIQUE (wallet_address);


--
-- Name: user_addresses user_addresses_blockchain_address_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_addresses
    ADD CONSTRAINT user_addresses_blockchain_address_unique UNIQUE (blockchain, address);


--
-- Name: user_addresses user_addresses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_addresses
    ADD CONSTRAINT user_addresses_pkey PRIMARY KEY (id);


--
-- Name: user_addresses user_addresses_user_blockchain_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_addresses
    ADD CONSTRAINT user_addresses_user_blockchain_unique UNIQUE (user_id, blockchain);


--
-- Name: user_addresses user_addresses_user_id_blockchain_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_addresses
    ADD CONSTRAINT user_addresses_user_id_blockchain_key UNIQUE (user_id, blockchain);


--
-- Name: user_approval_conditions user_approval_conditions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_approval_conditions
    ADD CONSTRAINT user_approval_conditions_pkey PRIMARY KEY (id);


--
-- Name: user_contract_roles user_contract_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contract_roles
    ADD CONSTRAINT user_contract_roles_pkey PRIMARY KEY (id);


--
-- Name: user_contract_roles user_contract_roles_user_id_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contract_roles
    ADD CONSTRAINT user_contract_roles_user_id_unique UNIQUE (user_id);


--
-- Name: user_mfa_settings user_mfa_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_mfa_settings
    ADD CONSTRAINT user_mfa_settings_pkey PRIMARY KEY (id);


--
-- Name: user_operations user_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_operations
    ADD CONSTRAINT user_operations_pkey PRIMARY KEY (id);


--
-- Name: user_operations user_operations_user_op_hash_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_operations
    ADD CONSTRAINT user_operations_user_op_hash_key UNIQUE (user_op_hash);


--
-- Name: user_organization_roles user_organization_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_organization_roles
    ADD CONSTRAINT user_organization_roles_pkey PRIMARY KEY (id);


--
-- Name: user_organization_roles user_organization_roles_user_id_role_id_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_organization_roles
    ADD CONSTRAINT user_organization_roles_user_id_role_id_organization_id_key UNIQUE (user_id, role_id, organization_id);


--
-- Name: user_preferences user_preferences_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_preferences
    ADD CONSTRAINT user_preferences_pkey PRIMARY KEY (id);


--
-- Name: user_preferences user_preferences_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_preferences
    ADD CONSTRAINT user_preferences_user_id_key UNIQUE (user_id);


--
-- Name: user_roles user_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_roles
    ADD CONSTRAINT user_roles_pkey PRIMARY KEY (user_id);


--
-- Name: user_sessions user_sessions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sessions
    ADD CONSTRAINT user_sessions_pkey PRIMARY KEY (id);


--
-- Name: user_sidebar_preferences user_sidebar_preferences_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sidebar_preferences
    ADD CONSTRAINT user_sidebar_preferences_pkey PRIMARY KEY (id);


--
-- Name: user_token_access user_token_access_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_token_access
    ADD CONSTRAINT user_token_access_pkey PRIMARY KEY (id);


--
-- Name: user_verifications user_verifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_verifications
    ADD CONSTRAINT user_verifications_pkey PRIMARY KEY (id);


--
-- Name: user_verifications user_verifications_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_verifications
    ADD CONSTRAINT user_verifications_user_id_key UNIQUE (user_id);


--
-- Name: users users_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);


--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- Name: validation_alerts validation_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.validation_alerts
    ADD CONSTRAINT validation_alerts_pkey PRIMARY KEY (id);


--
-- Name: validation_cache validation_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.validation_cache
    ADD CONSTRAINT validation_cache_pkey PRIMARY KEY (cache_key);


--
-- Name: valuation_price_history valuation_price_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.valuation_price_history
    ADD CONSTRAINT valuation_price_history_pkey PRIMARY KEY (id);


--
-- Name: valuation_price_history valuation_price_history_token_id_period_start_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.valuation_price_history
    ADD CONSTRAINT valuation_price_history_token_id_period_start_key UNIQUE (token_id, period_start);


--
-- Name: violation_patterns violation_patterns_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.violation_patterns
    ADD CONSTRAINT violation_patterns_pkey PRIMARY KEY (id);


--
-- Name: wallet_access_logs wallet_access_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_access_logs
    ADD CONSTRAINT wallet_access_logs_pkey PRIMARY KEY (id);


--
-- Name: wallet_details wallet_details_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_details
    ADD CONSTRAINT wallet_details_pkey PRIMARY KEY (id);


--
-- Name: wallet_facets wallet_facets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_facets
    ADD CONSTRAINT wallet_facets_pkey PRIMARY KEY (id);


--
-- Name: wallet_guardians wallet_guardians_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_guardians
    ADD CONSTRAINT wallet_guardians_pkey PRIMARY KEY (id);


--
-- Name: wallet_locks wallet_locks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_locks
    ADD CONSTRAINT wallet_locks_pkey PRIMARY KEY (id);


--
-- Name: wallet_restriction_rules wallet_restriction_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_restriction_rules
    ADD CONSTRAINT wallet_restriction_rules_pkey PRIMARY KEY (id);


--
-- Name: wallet_signatories wallet_signatories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_signatories
    ADD CONSTRAINT wallet_signatories_pkey PRIMARY KEY (id);


--
-- Name: wallet_signatories wallet_signatories_wallet_address_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_signatories
    ADD CONSTRAINT wallet_signatories_wallet_address_email_key UNIQUE (wallet_address, email);


--
-- Name: wallet_transaction_drafts wallet_transaction_drafts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_transaction_drafts
    ADD CONSTRAINT wallet_transaction_drafts_pkey PRIMARY KEY (id);


--
-- Name: wallet_transaction_drafts wallet_transaction_drafts_transaction_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_transaction_drafts
    ADD CONSTRAINT wallet_transaction_drafts_transaction_id_key UNIQUE (transaction_id);


--
-- Name: wallet_transactions wallet_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_transactions
    ADD CONSTRAINT wallet_transactions_pkey PRIMARY KEY (id);


--
-- Name: wallets wallets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallets
    ADD CONSTRAINT wallets_pkey PRIMARY KEY (id);


--
-- Name: weather_cache weather_cache_cache_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.weather_cache
    ADD CONSTRAINT weather_cache_cache_key_key UNIQUE (cache_key);


--
-- Name: weather_cache weather_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.weather_cache
    ADD CONSTRAINT weather_cache_pkey PRIMARY KEY (cache_id);


--
-- Name: weather_data weather_data_location_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.weather_data
    ADD CONSTRAINT weather_data_location_date_key UNIQUE (location, date);


--
-- Name: weather_data weather_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.weather_data
    ADD CONSTRAINT weather_data_pkey PRIMARY KEY (weather_id);


--
-- Name: webauthn_challenges webauthn_challenges_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webauthn_challenges
    ADD CONSTRAINT webauthn_challenges_pkey PRIMARY KEY (id);


--
-- Name: webauthn_credentials webauthn_credentials_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webauthn_credentials
    ADD CONSTRAINT webauthn_credentials_pkey PRIMARY KEY (id);


--
-- Name: whitelist_entries whitelist_entries_organization_id_address_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_entries
    ADD CONSTRAINT whitelist_entries_organization_id_address_key UNIQUE (organization_id, address);


--
-- Name: whitelist_entries whitelist_entries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_entries
    ADD CONSTRAINT whitelist_entries_pkey PRIMARY KEY (id);


--
-- Name: whitelist_settings whitelist_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_settings
    ADD CONSTRAINT whitelist_settings_pkey PRIMARY KEY (id);


--
-- Name: whitelist_signatories whitelist_signatories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_signatories
    ADD CONSTRAINT whitelist_signatories_pkey PRIMARY KEY (id);


--
-- Name: whitelist_signatories whitelist_signatories_whitelist_id_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_signatories
    ADD CONSTRAINT whitelist_signatories_whitelist_id_user_id_key UNIQUE (whitelist_id, user_id);


--
-- Name: workflow_stages workflow_stages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.workflow_stages
    ADD CONSTRAINT workflow_stages_pkey PRIMARY KEY (id);


--
-- Name: contract_masters_backup_contract_address_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_contract_address_idx ON public.contract_masters_backup USING btree (contract_address);


--
-- Name: contract_masters_backup_contract_type_is_active_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_contract_type_is_active_idx ON public.contract_masters_backup USING btree (contract_type, is_active);


--
-- Name: contract_masters_backup_is_active_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_is_active_idx ON public.contract_masters_backup USING btree (is_active) WHERE (is_active = true);


--
-- Name: contract_masters_backup_is_template_network_environment_is__idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_is_template_network_environment_is__idx ON public.contract_masters_backup USING btree (is_template, network, environment, is_active);


--
-- Name: contract_masters_backup_network_environment_contract_type_i_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_network_environment_contract_type_i_idx ON public.contract_masters_backup USING btree (network, environment, contract_type, is_active) WHERE (is_active = true);


--
-- Name: contract_masters_backup_network_environment_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contract_masters_backup_network_environment_idx ON public.contract_masters_backup USING btree (network, environment);


--
-- Name: idx_abs_cash_flows_abs_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_cash_flows_abs_product ON public.abs_cash_flows USING btree (asset_backed_product_id);


--
-- Name: idx_abs_cash_flows_actual; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_cash_flows_actual ON public.abs_cash_flows USING btree (is_actual);


--
-- Name: idx_abs_cash_flows_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_cash_flows_payment_date ON public.abs_cash_flows USING btree (payment_date);


--
-- Name: idx_abs_cash_flows_tranche; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_cash_flows_tranche ON public.abs_cash_flows USING btree (abs_tranche_id);


--
-- Name: idx_abs_collateral_pools_abs_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_collateral_pools_abs_product ON public.abs_collateral_pools USING btree (asset_backed_product_id);


--
-- Name: idx_abs_collateral_pools_period_end; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_collateral_pools_period_end ON public.abs_collateral_pools USING btree (reporting_period_end);


--
-- Name: idx_abs_collateral_pools_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_collateral_pools_type ON public.abs_collateral_pools USING btree (collateral_type);


--
-- Name: idx_abs_loss_projections_abs_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_loss_projections_abs_product ON public.abs_loss_projections USING btree (asset_backed_product_id);


--
-- Name: idx_abs_loss_projections_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_loss_projections_date ON public.abs_loss_projections USING btree (projection_date);


--
-- Name: idx_abs_loss_projections_scenario; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_loss_projections_scenario ON public.abs_loss_projections USING btree (scenario_name);


--
-- Name: idx_abs_prepayment_speeds_abs_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_prepayment_speeds_abs_product ON public.abs_prepayment_speeds USING btree (asset_backed_product_id);


--
-- Name: idx_abs_prepayment_speeds_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_prepayment_speeds_date ON public.abs_prepayment_speeds USING btree (observation_date);


--
-- Name: idx_abs_prepayment_speeds_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_prepayment_speeds_type ON public.abs_prepayment_speeds USING btree (prepayment_type);


--
-- Name: idx_abs_tranches_abs_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_tranches_abs_product ON public.abs_tranches USING btree (asset_backed_product_id);


--
-- Name: idx_abs_tranches_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_tranches_class ON public.abs_tranches USING btree (tranche_class);


--
-- Name: idx_abs_tranches_seniority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_tranches_seniority ON public.abs_tranches USING btree (seniority_level);


--
-- Name: idx_abs_tranches_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_abs_tranches_status ON public.abs_tranches USING btree (status);


--
-- Name: idx_alerts_service; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alerts_service ON public.alerts USING btree (service);


--
-- Name: idx_alerts_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alerts_severity ON public.alerts USING btree (severity);


--
-- Name: idx_alerts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alerts_status ON public.alerts USING btree (status);


--
-- Name: idx_alerts_unresolved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alerts_unresolved ON public.validation_alerts USING btree (resolved) WHERE (resolved = false);


--
-- Name: idx_approval_config_approvers_config_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_approvers_config_id ON public.approval_config_approvers USING btree (approval_config_id);


--
-- Name: idx_approval_config_approvers_role_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_approvers_role_id ON public.approval_config_approvers USING btree (approver_role_id);


--
-- Name: idx_approval_config_approvers_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_approvers_type ON public.approval_config_approvers USING btree (approver_type);


--
-- Name: idx_approval_config_approvers_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_approvers_user_id ON public.approval_config_approvers USING btree (approver_user_id);


--
-- Name: idx_approval_config_history_changed_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_history_changed_by ON public.approval_config_history USING btree (changed_by);


--
-- Name: idx_approval_config_history_config_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_history_config_id ON public.approval_config_history USING btree (approval_config_id);


--
-- Name: idx_approval_config_history_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_config_history_created_at ON public.approval_config_history USING btree (created_at);


--
-- Name: idx_approval_configs_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_configs_active ON public.approval_configs USING btree (active);


--
-- Name: idx_approval_configs_approval_mode; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_configs_approval_mode ON public.approval_configs USING btree (approval_mode);


--
-- Name: idx_approval_configs_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_configs_created_by ON public.approval_configs USING btree (created_by);


--
-- Name: idx_approval_delegations_delegate; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_delegations_delegate ON public.approval_delegations USING btree (delegate_id, is_active);


--
-- Name: idx_approval_delegations_delegator; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_delegations_delegator ON public.approval_delegations USING btree (delegator_id, is_active);


--
-- Name: idx_approval_notifications_request; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_notifications_request ON public.approval_notifications USING btree (request_id);


--
-- Name: idx_approval_processes_request; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_processes_request ON public.approval_processes USING btree (request_id);


--
-- Name: idx_approval_processes_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_processes_status ON public.approval_processes USING btree (status, deadline);


--
-- Name: idx_approval_processes_workflow; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_processes_workflow ON public.approval_processes USING btree (workflow_id);


--
-- Name: idx_approval_workflows_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_workflows_token ON public.approval_workflows USING btree (token_id, status);


--
-- Name: idx_asset_backed_products_asset_number; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_backed_products_asset_number ON public.asset_backed_products USING btree (asset_number);


--
-- Name: idx_asset_backed_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_backed_products_project_id ON public.asset_backed_products USING btree (project_id);


--
-- Name: idx_asset_backed_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_asset_backed_products_project_id_unique ON public.asset_backed_products USING btree (project_id);


--
-- Name: idx_asset_holdings_asset_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_holdings_asset_id ON public.asset_holdings USING btree (asset_id);


--
-- Name: idx_asset_holdings_maturity_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_holdings_maturity_date ON public.asset_holdings USING btree (maturity_date);


--
-- Name: idx_asset_holdings_updated_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_holdings_updated_at ON public.asset_holdings USING btree (updated_at);


--
-- Name: idx_asset_nav_data_asset_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_asset_date ON public.asset_nav_data USING btree (asset_id, date);


--
-- Name: idx_asset_nav_data_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_created_at ON public.asset_nav_data USING btree (created_at);


--
-- Name: idx_asset_nav_data_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_fund_date ON public.asset_nav_data USING btree (asset_id, date DESC);


--
-- Name: idx_asset_nav_data_project_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_project_date ON public.asset_nav_data USING btree (project_id, date);


--
-- Name: idx_asset_nav_data_source_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_source_status ON public.asset_nav_data USING btree (source, validated);


--
-- Name: idx_asset_nav_data_validated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_asset_nav_data_validated ON public.asset_nav_data USING btree (validated, date DESC);


--
-- Name: idx_auction_comparables_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auction_comparables_asset_type ON public.auction_comparables USING btree (asset_type);


--
-- Name: idx_auction_comparables_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auction_comparables_date ON public.auction_comparables USING btree (date DESC);


--
-- Name: idx_auction_executions_auction; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auction_executions_auction ON public.trade_finance_auction_executions USING btree (auction_id);


--
-- Name: idx_audit_actor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_actor ON public.multi_sig_audit_log USING btree (actor);


--
-- Name: idx_audit_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_created_at ON public.multi_sig_audit_log USING btree (created_at DESC);


--
-- Name: idx_audit_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_action ON public.audit_logs USING btree (action);


--
-- Name: idx_audit_logs_action_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_action_type ON public.audit_logs USING btree (action_type);


--
-- Name: idx_audit_logs_batch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_batch ON public.audit_logs USING btree (batch_operation_id) WHERE (batch_operation_id IS NOT NULL);


--
-- Name: idx_audit_logs_batch_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_batch_operation ON public.audit_logs USING btree (batch_operation_id);


--
-- Name: idx_audit_logs_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_category ON public.audit_logs USING btree (category);


--
-- Name: idx_audit_logs_compliance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_compliance ON public.compliance_audit_logs USING btree (((compliance_status ->> 'level'::text)));


--
-- Name: idx_audit_logs_correlation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_correlation ON public.audit_logs USING btree (correlation_id) WHERE (correlation_id IS NOT NULL);


--
-- Name: idx_audit_logs_correlation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_correlation_id ON public.audit_logs USING btree (correlation_id);


--
-- Name: idx_audit_logs_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_created ON public.compliance_audit_logs USING btree (created_at);


--
-- Name: idx_audit_logs_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_entity ON public.audit_logs USING btree (entity_type, entity_id);


--
-- Name: idx_audit_logs_entity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_entity_type ON public.audit_logs USING btree (entity_type);


--
-- Name: idx_audit_logs_is_automated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_is_automated ON public.audit_logs USING btree (is_automated);


--
-- Name: idx_audit_logs_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_operation ON public.compliance_audit_logs USING btree (operation_id);


--
-- Name: idx_audit_logs_parent_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_parent_id ON public.audit_logs USING btree (parent_id);


--
-- Name: idx_audit_logs_performance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_performance ON public.audit_logs USING btree ("timestamp" DESC, source, status);


--
-- Name: idx_audit_logs_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_project ON public.audit_logs USING btree (project_id, "timestamp" DESC) WHERE (project_id IS NOT NULL);


--
-- Name: idx_audit_logs_search; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_search ON public.audit_logs USING gin (to_tsvector('english'::regconfig, ((action || ' '::text) || COALESCE(details, ''::text))));


--
-- Name: idx_audit_logs_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_session_id ON public.audit_logs USING btree (session_id);


--
-- Name: idx_audit_logs_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_severity ON public.audit_logs USING btree (severity);


--
-- Name: idx_audit_logs_source; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_source ON public.audit_logs USING btree (source);


--
-- Name: idx_audit_logs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_status ON public.audit_logs USING btree (status);


--
-- Name: idx_audit_logs_system_process; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_system_process ON public.audit_logs USING btree (system_process_id);


--
-- Name: idx_audit_logs_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_timestamp ON public.audit_logs USING btree ("timestamp" DESC);


--
-- Name: idx_audit_logs_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_user ON public.audit_logs USING btree (username);


--
-- Name: idx_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_user_id ON public.audit_logs USING btree (user_id);


--
-- Name: idx_audit_proposal_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_proposal_id ON public.multi_sig_audit_log USING btree (proposal_id);


--
-- Name: idx_audit_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_wallet_id ON public.multi_sig_audit_log USING btree (wallet_id);


--
-- Name: idx_batch_operations_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_batch_operations_index ON public.batch_operations USING btree (operation_index);


--
-- Name: idx_batch_operations_success; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_batch_operations_success ON public.batch_operations USING btree (success);


--
-- Name: idx_batch_operations_target; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_batch_operations_target ON public.batch_operations USING btree (target_address);


--
-- Name: idx_batch_operations_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_batch_operations_unique ON public.batch_operations USING btree (user_operation_id, operation_index);


--
-- Name: idx_batch_operations_user_op; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_batch_operations_user_op ON public.batch_operations USING btree (user_operation_id);


--
-- Name: idx_benchmark_index_mappings_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benchmark_index_mappings_name ON public.benchmark_index_mappings USING btree (benchmark_name) WHERE (is_active = true);


--
-- Name: idx_blacklisted_addresses_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_blacklisted_addresses_address ON public.blacklisted_addresses USING btree (address);


--
-- Name: idx_blackout_periods_date_range; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_blackout_periods_date_range ON public.blackout_periods USING btree (start_date, end_date) WHERE (active = true);


--
-- Name: idx_blackout_periods_operations; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_blackout_periods_operations ON public.blackout_periods USING gin (affected_operations);


--
-- Name: idx_blackout_periods_project_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_blackout_periods_project_active ON public.blackout_periods USING btree (project_id, active) WHERE (active = true);


--
-- Name: idx_bond_amortization_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_amortization_bond_id ON public.bond_amortization_schedule USING btree (bond_product_id);


--
-- Name: idx_bond_amortization_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_amortization_payment_date ON public.bond_amortization_schedule USING btree (payment_date);


--
-- Name: idx_bond_call_put_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_call_put_bond_id ON public.bond_call_put_schedules USING btree (bond_product_id);


--
-- Name: idx_bond_call_put_option_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_call_put_option_date ON public.bond_call_put_schedules USING btree (option_date);


--
-- Name: idx_bond_coupon_payments_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_coupon_payments_bond_id ON public.bond_coupon_payments USING btree (bond_product_id);


--
-- Name: idx_bond_coupon_payments_future; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_coupon_payments_future ON public.bond_coupon_payments USING btree (bond_product_id, payment_date) WHERE ((payment_status)::text = 'scheduled'::text);


--
-- Name: idx_bond_coupon_payments_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_coupon_payments_payment_date ON public.bond_coupon_payments USING btree (payment_date);


--
-- Name: idx_bond_coupon_payments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_coupon_payments_status ON public.bond_coupon_payments USING btree (payment_status);


--
-- Name: idx_bond_covenants_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_covenants_bond_id ON public.bond_covenants USING btree (bond_product_id);


--
-- Name: idx_bond_covenants_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_covenants_type ON public.bond_covenants USING btree (covenant_type);


--
-- Name: idx_bond_credit_ratings_bond_agency_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_credit_ratings_bond_agency_date ON public.bond_credit_ratings USING btree (bond_product_id, rating_agency, rating_date DESC);


--
-- Name: idx_bond_credit_ratings_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_credit_ratings_bond_id ON public.bond_credit_ratings USING btree (bond_product_id);


--
-- Name: idx_bond_events_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_events_bond_id ON public.bond_events USING btree (bond_product_id);


--
-- Name: idx_bond_events_event_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_events_event_date ON public.bond_events USING btree (event_date DESC);


--
-- Name: idx_bond_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_events_event_type ON public.bond_events USING btree (event_type);


--
-- Name: idx_bond_market_prices_bond_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_market_prices_bond_date ON public.bond_market_prices USING btree (bond_product_id, price_date DESC);


--
-- Name: idx_bond_market_prices_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_market_prices_bond_id ON public.bond_market_prices USING btree (bond_product_id);


--
-- Name: idx_bond_market_prices_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_market_prices_date ON public.bond_market_prices USING btree (price_date DESC);


--
-- Name: idx_bond_market_prices_official_close; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_market_prices_official_close ON public.bond_market_prices USING btree (bond_product_id, price_date DESC) WHERE (is_official_close = true);


--
-- Name: idx_bond_products_accounting_treatment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_accounting_treatment ON public.bond_products USING btree (accounting_treatment);


--
-- Name: idx_bond_products_bond_isin_cusip; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_bond_isin_cusip ON public.bond_products USING btree (bond_isin_cusip);


--
-- Name: idx_bond_products_credit_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_credit_rating ON public.bond_products USING btree (credit_rating);


--
-- Name: idx_bond_products_cusip; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_cusip ON public.bond_products USING btree (cusip) WHERE (cusip IS NOT NULL);


--
-- Name: idx_bond_products_isin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_isin ON public.bond_products USING btree (isin) WHERE (isin IS NOT NULL);


--
-- Name: idx_bond_products_maturity_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_maturity_date ON public.bond_products USING btree (maturity_date);


--
-- Name: idx_bond_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_project_id ON public.bond_products USING btree (project_id);


--
-- Name: idx_bond_products_sedol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_products_sedol ON public.bond_products USING btree (sedol) WHERE (sedol IS NOT NULL);


--
-- Name: idx_bond_sinking_fund_bond_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_sinking_fund_bond_id ON public.bond_sinking_fund USING btree (bond_product_id);


--
-- Name: idx_bond_sinking_fund_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bond_sinking_fund_payment_date ON public.bond_sinking_fund USING btree (payment_date);


--
-- Name: idx_bulk_operations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bulk_operations_created_at ON public.bulk_operations USING btree (created_at DESC);


--
-- Name: idx_bulk_operations_operation_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bulk_operations_operation_type ON public.bulk_operations USING btree (operation_type);


--
-- Name: idx_bulk_operations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bulk_operations_status ON public.bulk_operations USING btree (status);


--
-- Name: idx_bundler_configurations_chain_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bundler_configurations_chain_active ON public.bundler_configurations USING btree (chain_id, is_active);


--
-- Name: idx_bundler_operations_chain_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bundler_operations_chain_id ON public.bundler_operations USING btree (chain_id);


--
-- Name: idx_bundler_operations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bundler_operations_created_at ON public.bundler_operations USING btree (created_at);


--
-- Name: idx_bundler_operations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_bundler_operations_status ON public.bundler_operations USING btree (status);


--
-- Name: idx_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cache_expires ON public.validation_cache USING btree (expires_at);


--
-- Name: idx_cap_table_investors_cap_table_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cap_table_investors_cap_table_id ON public.cap_table_investors USING btree (cap_table_id);


--
-- Name: idx_cap_table_investors_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cap_table_investors_investor_id ON public.cap_table_investors USING btree (investor_id);


--
-- Name: idx_carbon_market_prices_asset_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_carbon_market_prices_asset_date ON public.carbon_market_prices USING btree (asset_id, as_of_date DESC);


--
-- Name: idx_carbon_market_prices_latest; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_carbon_market_prices_latest ON public.carbon_market_prices USING btree (as_of_date DESC);


--
-- Name: idx_cf_allocations_asset_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_allocations_asset_class ON public.cf_allocations USING btree (asset_class);


--
-- Name: idx_cf_allocations_effective_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_allocations_effective_date ON public.cf_allocations USING btree (effective_date);


--
-- Name: idx_cf_allocations_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_allocations_fund ON public.cf_allocations USING btree (composite_fund_id);


--
-- Name: idx_cf_cash_flows_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_cash_flows_date ON public.cf_cash_flows USING btree (cash_flow_date);


--
-- Name: idx_cf_cash_flows_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_cash_flows_fund ON public.cf_cash_flows USING btree (composite_fund_id);


--
-- Name: idx_cf_cash_flows_investor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_cash_flows_investor ON public.cf_cash_flows USING btree (investor_id);


--
-- Name: idx_cf_cash_flows_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_cash_flows_type ON public.cf_cash_flows USING btree (cash_flow_type);


--
-- Name: idx_cf_holdings_asset_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_holdings_asset_class ON public.cf_holdings USING btree (asset_class);


--
-- Name: idx_cf_holdings_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_holdings_fund ON public.cf_holdings USING btree (composite_fund_id);


--
-- Name: idx_cf_holdings_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_holdings_product_id ON public.cf_holdings USING btree (product_id);


--
-- Name: idx_cf_holdings_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_holdings_status ON public.cf_holdings USING btree (status);


--
-- Name: idx_cf_holdings_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_holdings_ticker ON public.cf_holdings USING btree (ticker_symbol);


--
-- Name: idx_cf_performance_attribution_asset_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_performance_attribution_asset_class ON public.cf_performance_attribution USING btree (asset_class);


--
-- Name: idx_cf_performance_attribution_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_performance_attribution_fund ON public.cf_performance_attribution USING btree (composite_fund_id);


--
-- Name: idx_cf_performance_attribution_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_performance_attribution_level ON public.cf_performance_attribution USING btree (attribution_level);


--
-- Name: idx_cf_performance_attribution_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_performance_attribution_period ON public.cf_performance_attribution USING btree (period_start_date, period_end_date);


--
-- Name: idx_cf_rebalancing_events_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_rebalancing_events_date ON public.cf_rebalancing_events USING btree (rebalancing_date);


--
-- Name: idx_cf_rebalancing_events_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_rebalancing_events_fund ON public.cf_rebalancing_events USING btree (composite_fund_id);


--
-- Name: idx_cf_rebalancing_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cf_rebalancing_events_type ON public.cf_rebalancing_events USING btree (rebalancing_type);


--
-- Name: idx_claims_chain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_claims_chain ON public.trade_finance_rewards_claims USING btree (chain_id);


--
-- Name: idx_claims_reward; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_claims_reward ON public.trade_finance_rewards_claims USING btree (reward_token_address);


--
-- Name: idx_claims_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_claims_timestamp ON public.trade_finance_rewards_claims USING btree (claimed_at);


--
-- Name: idx_claims_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_claims_user ON public.trade_finance_rewards_claims USING btree (user_address);


--
-- Name: idx_climate_incentives_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_incentives_asset ON public.climate_incentives USING btree (asset_id);


--
-- Name: idx_climate_incentives_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_incentives_project_id ON public.climate_incentives USING btree (project_id);


--
-- Name: idx_climate_incentives_receivable; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_incentives_receivable ON public.climate_incentives USING btree (receivable_id);


--
-- Name: idx_climate_incentives_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_incentives_type ON public.climate_incentives USING btree (type);


--
-- Name: idx_climate_market_data_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_market_data_cache_expires ON public.climate_market_data_cache USING btree (expires_at);


--
-- Name: idx_climate_market_data_cache_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_market_data_cache_key ON public.climate_market_data_cache USING btree (cache_key);


--
-- Name: idx_climate_nav_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_nav_asset ON public.climate_nav_calculations USING btree (asset_id);


--
-- Name: idx_climate_nav_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_nav_created ON public.climate_nav_calculations USING btree (created_at);


--
-- Name: idx_climate_nav_receivable; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_nav_receivable ON public.climate_nav_calculations USING btree (receivable_id);


--
-- Name: idx_climate_nav_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_nav_type ON public.climate_nav_calculations USING btree (calculation_type);


--
-- Name: idx_climate_policies_effective_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_policies_effective_date ON public.climate_policies USING btree (effective_date);


--
-- Name: idx_climate_pool_energy_assets_asset_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_energy_assets_asset_id ON public.climate_pool_energy_assets USING btree (asset_id);


--
-- Name: idx_climate_pool_energy_assets_pool_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_energy_assets_pool_id ON public.climate_pool_energy_assets USING btree (pool_id);


--
-- Name: idx_climate_pool_energy_assets_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_energy_assets_project_id ON public.climate_pool_energy_assets USING btree (project_id);


--
-- Name: idx_climate_pool_incentives_incentive_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_incentives_incentive_id ON public.climate_pool_incentives USING btree (incentive_id);


--
-- Name: idx_climate_pool_incentives_pool_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_incentives_pool_id ON public.climate_pool_incentives USING btree (pool_id);


--
-- Name: idx_climate_pool_incentives_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_incentives_project_id ON public.climate_pool_incentives USING btree (project_id);


--
-- Name: idx_climate_pool_recs_pool_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_recs_pool_id ON public.climate_pool_recs USING btree (pool_id);


--
-- Name: idx_climate_pool_recs_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_recs_project_id ON public.climate_pool_recs USING btree (project_id);


--
-- Name: idx_climate_pool_recs_rec_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_pool_recs_rec_id ON public.climate_pool_recs USING btree (rec_id);


--
-- Name: idx_climate_receivables_payer_due; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_receivables_payer_due ON public.climate_receivables USING btree (payer_id, due_date);


--
-- Name: idx_climate_risk_calculations_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_risk_calculations_active ON public.climate_risk_calculations USING btree (receivable_id, next_review_date);


--
-- Name: idx_climate_risk_calculations_calculated_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_risk_calculations_calculated_at ON public.climate_risk_calculations USING btree (calculated_at);


--
-- Name: idx_climate_risk_calculations_next_review; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_risk_calculations_next_review ON public.climate_risk_calculations USING btree (next_review_date);


--
-- Name: idx_climate_risk_calculations_receivable_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_risk_calculations_receivable_id ON public.climate_risk_calculations USING btree (receivable_id);


--
-- Name: idx_climate_risk_calculations_risk_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_risk_calculations_risk_level ON public.climate_risk_calculations USING btree (composite_risk_level);


--
-- Name: idx_climate_tokenization_pools_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_tokenization_pools_project_id ON public.climate_tokenization_pools USING btree (project_id);


--
-- Name: idx_climate_user_data_cache_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_cache_entity ON public.climate_user_data_cache USING btree (entity_id);


--
-- Name: idx_climate_user_data_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_cache_expires ON public.climate_user_data_cache USING btree (expires_at);


--
-- Name: idx_climate_user_data_cache_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_cache_type ON public.climate_user_data_cache USING btree (data_type);


--
-- Name: idx_climate_user_data_sources_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_sources_active ON public.climate_user_data_sources USING btree (is_active);


--
-- Name: idx_climate_user_data_sources_type_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_sources_type_status ON public.climate_user_data_sources USING btree (source_type, processing_status);


--
-- Name: idx_climate_user_data_sources_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_climate_user_data_sources_user_id ON public.climate_user_data_sources USING btree (user_id);


--
-- Name: idx_collateral_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collateral_commodity ON public.commodity_collateral USING btree (commodity_type);


--
-- Name: idx_collateral_position; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collateral_position ON public.commodity_collateral USING btree (position_id);


--
-- Name: idx_collateral_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collateral_token ON public.commodity_collateral USING btree (token_address);


--
-- Name: idx_collectibles_appraisals_appraiser; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_appraisals_appraiser ON public.collectibles_appraisals USING btree (appraiser_name);


--
-- Name: idx_collectibles_appraisals_collectible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_appraisals_collectible ON public.collectibles_appraisals USING btree (collectibles_product_id);


--
-- Name: idx_collectibles_appraisals_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_appraisals_date ON public.collectibles_appraisals USING btree (appraisal_date);


--
-- Name: idx_collectibles_appraisals_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_appraisals_type ON public.collectibles_appraisals USING btree (appraisal_type);


--
-- Name: idx_collectibles_authentication_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_authentication_product_id ON public.collectibles_authentication_records USING btree (product_id);


--
-- Name: idx_collectibles_condition_reports_collectible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_condition_reports_collectible ON public.collectibles_condition_reports USING btree (collectibles_product_id);


--
-- Name: idx_collectibles_condition_reports_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_condition_reports_date ON public.collectibles_condition_reports USING btree (report_date);


--
-- Name: idx_collectibles_condition_reports_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_condition_reports_grade ON public.collectibles_condition_reports USING btree (overall_condition_grade);


--
-- Name: idx_collectibles_insurance_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_insurance_product_id ON public.collectibles_insurance_policies USING btree (product_id);


--
-- Name: idx_collectibles_insurance_valuations_collectible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_insurance_valuations_collectible ON public.collectibles_insurance_valuations USING btree (collectibles_product_id);


--
-- Name: idx_collectibles_insurance_valuations_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_insurance_valuations_date ON public.collectibles_insurance_valuations USING btree (valuation_date);


--
-- Name: idx_collectibles_insurance_valuations_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_insurance_valuations_policy ON public.collectibles_insurance_valuations USING btree (policy_number);


--
-- Name: idx_collectibles_insurance_valuations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_insurance_valuations_status ON public.collectibles_insurance_valuations USING btree (status);


--
-- Name: idx_collectibles_market_comparables_collectible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_market_comparables_collectible ON public.collectibles_market_comparables USING btree (collectibles_product_id);


--
-- Name: idx_collectibles_market_comparables_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_market_comparables_date ON public.collectibles_market_comparables USING btree (sale_date);


--
-- Name: idx_collectibles_market_comparables_similarity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_market_comparables_similarity ON public.collectibles_market_comparables USING btree (similarity_score);


--
-- Name: idx_collectibles_market_comparables_venue; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_market_comparables_venue ON public.collectibles_market_comparables USING btree (sale_venue);


--
-- Name: idx_collectibles_products_asset_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_products_asset_id ON public.collectibles_products USING btree (asset_id);


--
-- Name: idx_collectibles_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_products_project_id ON public.collectibles_products USING btree (project_id);


--
-- Name: idx_collectibles_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_collectibles_products_project_id_unique ON public.collectibles_products USING btree (project_id);


--
-- Name: idx_collectibles_provenance_collectible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_provenance_collectible ON public.collectibles_provenance USING btree (collectibles_product_id);


--
-- Name: idx_collectibles_provenance_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_provenance_dates ON public.collectibles_provenance USING btree (ownership_period_start, ownership_period_end);


--
-- Name: idx_collectibles_provenance_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_provenance_product_id ON public.collectibles_provenance_records USING btree (product_id);


--
-- Name: idx_collectibles_provenance_sequence; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_provenance_sequence ON public.collectibles_provenance USING btree (sequence_number);


--
-- Name: idx_collectibles_rarity_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_rarity_product_id ON public.collectibles_rarity_scores USING btree (product_id);


--
-- Name: idx_collectibles_risk_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_risk_product_id ON public.collectibles_risk_assessments USING btree (product_id);


--
-- Name: idx_collectibles_storage_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_collectibles_storage_product_id ON public.collectibles_storage_facilities USING btree (product_id);


--
-- Name: idx_commodities_products_commodity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodities_products_commodity_id ON public.commodities_products USING btree (commodity_id);


--
-- Name: idx_commodities_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodities_products_project_id ON public.commodities_products USING btree (project_id);


--
-- Name: idx_commodities_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_commodities_products_project_id_unique ON public.commodities_products USING btree (project_id);


--
-- Name: idx_commodity_handling_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_handling_commodity ON public.commodity_handling_costs USING btree (commodity_type);


--
-- Name: idx_commodity_handling_unit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_handling_unit ON public.commodity_handling_costs USING btree (unit_of_measure);


--
-- Name: idx_commodity_insurance_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_insurance_commodity ON public.commodity_insurance_rates USING btree (commodity_type);


--
-- Name: idx_commodity_market_data_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_market_data_date ON public.commodity_market_data USING btree (market_date DESC);


--
-- Name: idx_commodity_market_data_instrument; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_market_data_instrument ON public.commodity_market_data USING btree (instrument_key);


--
-- Name: idx_commodity_prices_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_prices_commodity ON public.commodity_prices USING btree (commodity_type);


--
-- Name: idx_commodity_prices_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_prices_project ON public.commodity_prices USING btree (project_id);


--
-- Name: idx_commodity_prices_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_prices_timestamp ON public.commodity_prices USING btree ("timestamp" DESC);


--
-- Name: idx_commodity_quality_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_quality_commodity ON public.commodity_quality_multipliers USING btree (commodity_type);


--
-- Name: idx_commodity_quality_commodity_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_commodity_quality_commodity_grade ON public.commodity_quality_multipliers USING btree (commodity_type, grade) WHERE (expiration_date IS NULL);


--
-- Name: idx_commodity_quality_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_quality_grade ON public.commodity_quality_multipliers USING btree (grade);


--
-- Name: idx_commodity_risk_calculated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_risk_calculated ON public.commodity_risk_metrics USING btree (calculated_at DESC);


--
-- Name: idx_commodity_risk_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_risk_commodity ON public.commodity_risk_metrics USING btree (commodity_type);


--
-- Name: idx_commodity_risk_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_risk_project ON public.commodity_risk_metrics USING btree (project_id);


--
-- Name: idx_commodity_storage_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_storage_commodity ON public.commodity_storage_rates USING btree (commodity_type);


--
-- Name: idx_commodity_storage_location; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_storage_location ON public.commodity_storage_rates USING btree (storage_location);


--
-- Name: idx_commodity_volatility_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_volatility_date ON public.commodity_implied_volatility USING btree (calculation_date DESC);


--
-- Name: idx_commodity_volatility_instrument; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_commodity_volatility_instrument ON public.commodity_implied_volatility USING btree (instrument_key);


--
-- Name: idx_compliance_alerts_unacknowledged; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_alerts_unacknowledged ON public.compliance_alerts USING btree (acknowledged) WHERE (acknowledged = false);


--
-- Name: idx_compliance_checks_project_risk; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_checks_project_risk ON public.compliance_checks USING btree (project_id, risk_level);


--
-- Name: idx_compliance_reports_generated_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_reports_generated_at ON public.compliance_reports USING btree (generated_at);


--
-- Name: idx_compliance_reports_issuer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_reports_issuer_id ON public.compliance_reports USING btree (issuer_id);


--
-- Name: idx_compliance_reports_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_reports_status ON public.compliance_reports USING btree (status);


--
-- Name: idx_compliance_violations_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_violations_operation ON public.compliance_violations USING btree (operation_id);


--
-- Name: idx_compliance_violations_unresolved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_compliance_violations_unresolved ON public.compliance_violations USING btree (resolved) WHERE (resolved = false);


--
-- Name: idx_config_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_config_wallet_id ON public.multi_sig_configurations USING btree (wallet_id);


--
-- Name: idx_contract_masters_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_active ON public.contract_masters USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_contract_masters_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_address ON public.contract_masters USING btree (contract_address);


--
-- Name: idx_contract_masters_contract_details_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_contract_details_category ON public.contract_masters USING gin (contract_details);


--
-- Name: idx_contract_masters_deployment_data_proxy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_deployment_data_proxy ON public.contract_masters USING gin (deployment_data);


--
-- Name: idx_contract_masters_is_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_is_template ON public.contract_masters USING btree (is_template, network, environment, is_active);


--
-- Name: idx_contract_masters_lookup; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_lookup ON public.contract_masters USING btree (network, environment, contract_type, is_active) WHERE (is_active = true);


--
-- Name: idx_contract_masters_network_env; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_network_env ON public.contract_masters USING btree (network, environment);


--
-- Name: idx_contract_masters_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_masters_type ON public.contract_masters USING btree (contract_type, is_active);


--
-- Name: idx_contract_versions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_versions_active ON public.contract_master_versions USING btree (contract_type, deprecated_at) WHERE (deprecated_at IS NULL);


--
-- Name: idx_contract_versions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_versions_type ON public.contract_master_versions USING btree (contract_type);


--
-- Name: idx_corporate_actions_effective_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_corporate_actions_effective_date ON public.corporate_actions USING btree (effective_date);


--
-- Name: idx_corporate_actions_equity_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_corporate_actions_equity_product ON public.corporate_actions USING btree (equity_product_id);


--
-- Name: idx_corporate_actions_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_corporate_actions_ticker ON public.corporate_actions USING btree (ticker_symbol);


--
-- Name: idx_corporate_actions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_corporate_actions_type ON public.corporate_actions USING btree (action_type);


--
-- Name: idx_credential_usage_logs_credential_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_credential_usage_logs_credential_id ON public.credential_usage_logs USING btree (credential_id);


--
-- Name: idx_critical_alerts_escalated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_critical_alerts_escalated ON public.critical_alerts USING btree (escalated, escalation_level);


--
-- Name: idx_crypto_symbol_mappings_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_crypto_symbol_mappings_symbol ON public.crypto_symbol_mappings USING btree (symbol) WHERE (is_active = true);


--
-- Name: idx_data_source_mappings_source; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_data_source_mappings_source ON public.data_source_mappings USING btree (source_id);


--
-- Name: idx_debt_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_debt_asset ON public.commodity_debt USING btree (asset_address);


--
-- Name: idx_debt_position; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_debt_position ON public.commodity_debt USING btree (position_id);


--
-- Name: idx_deployment_audit_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_audit_logs_action ON public.deployment_audit_logs USING btree (action);


--
-- Name: idx_deployment_audit_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_audit_logs_created_at ON public.deployment_audit_logs USING btree (created_at DESC);


--
-- Name: idx_deployment_audit_logs_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_audit_logs_network ON public.deployment_audit_logs USING btree (network);


--
-- Name: idx_deployment_audit_logs_success; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_audit_logs_success ON public.deployment_audit_logs USING btree (success);


--
-- Name: idx_deployment_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_audit_logs_user_id ON public.deployment_audit_logs USING btree (user_id);


--
-- Name: idx_deployment_rate_limits_started_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_rate_limits_started_at ON public.deployment_rate_limits USING btree (started_at);


--
-- Name: idx_deployment_rate_limits_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_rate_limits_status ON public.deployment_rate_limits USING btree (status);


--
-- Name: idx_deployment_rate_limits_user_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_deployment_rate_limits_user_project ON public.deployment_rate_limits USING btree (user_id, project_id);


--
-- Name: idx_dfns_activity_logs_activity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_activity_logs_activity_type ON public.dfns_activity_logs USING btree (activity_type);


--
-- Name: idx_dfns_activity_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_activity_logs_created_at ON public.dfns_activity_logs USING btree (created_at);


--
-- Name: idx_dfns_activity_logs_entity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_activity_logs_entity_id ON public.dfns_activity_logs USING btree (entity_id);


--
-- Name: idx_dfns_activity_logs_entity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_activity_logs_entity_type ON public.dfns_activity_logs USING btree (entity_type);


--
-- Name: idx_dfns_api_requests_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_api_requests_created_at ON public.dfns_api_requests USING btree (created_at);


--
-- Name: idx_dfns_api_requests_endpoint; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_api_requests_endpoint ON public.dfns_api_requests USING btree (endpoint);


--
-- Name: idx_dfns_api_requests_status_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_api_requests_status_code ON public.dfns_api_requests USING btree (status_code);


--
-- Name: idx_dfns_applications_app_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_applications_app_id ON public.dfns_applications USING btree (app_id);


--
-- Name: idx_dfns_applications_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_applications_organization_id ON public.dfns_applications USING btree (organization_id);


--
-- Name: idx_dfns_applications_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_applications_status ON public.dfns_applications USING btree (status);


--
-- Name: idx_dfns_authentication_challenges_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_authentication_challenges_expires_at ON public.dfns_authentication_challenges USING btree (expires_at);


--
-- Name: idx_dfns_authentication_challenges_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_authentication_challenges_status ON public.dfns_authentication_challenges USING btree (status);


--
-- Name: idx_dfns_authentication_challenges_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_authentication_challenges_user_id ON public.dfns_authentication_challenges USING btree (user_id);


--
-- Name: idx_dfns_credential_challenges_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credential_challenges_expires_at ON public.dfns_credential_challenges USING btree (expires_at);


--
-- Name: idx_dfns_credential_challenges_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credential_challenges_status ON public.dfns_credential_challenges USING btree (status);


--
-- Name: idx_dfns_credential_challenges_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credential_challenges_user_id ON public.dfns_credential_challenges USING btree (user_id);


--
-- Name: idx_dfns_credentials_credential_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credentials_credential_id ON public.dfns_credentials USING btree (credential_id);


--
-- Name: idx_dfns_credentials_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credentials_status ON public.dfns_credentials USING btree (status);


--
-- Name: idx_dfns_credentials_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_credentials_user_id ON public.dfns_credentials USING btree (user_id);


--
-- Name: idx_dfns_fiat_activity_logs_activity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_activity_logs_activity_type ON public.dfns_fiat_activity_logs USING btree (activity_type);


--
-- Name: idx_dfns_fiat_activity_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_activity_logs_created_at ON public.dfns_fiat_activity_logs USING btree (created_at);


--
-- Name: idx_dfns_fiat_activity_logs_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_activity_logs_transaction_id ON public.dfns_fiat_activity_logs USING btree (transaction_id);


--
-- Name: idx_dfns_fiat_quotes_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_quotes_created_at ON public.dfns_fiat_quotes USING btree (created_at);


--
-- Name: idx_dfns_fiat_quotes_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_quotes_expires_at ON public.dfns_fiat_quotes USING btree (expires_at);


--
-- Name: idx_dfns_fiat_quotes_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_quotes_provider ON public.dfns_fiat_quotes USING btree (provider);


--
-- Name: idx_dfns_fiat_quotes_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_quotes_type ON public.dfns_fiat_quotes USING btree (type);


--
-- Name: idx_dfns_fiat_transactions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_created_at ON public.dfns_fiat_transactions USING btree (created_at);


--
-- Name: idx_dfns_fiat_transactions_crypto_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_crypto_asset ON public.dfns_fiat_transactions USING btree (crypto_asset);


--
-- Name: idx_dfns_fiat_transactions_currency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_currency ON public.dfns_fiat_transactions USING btree (currency);


--
-- Name: idx_dfns_fiat_transactions_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_organization_id ON public.dfns_fiat_transactions USING btree (organization_id);


--
-- Name: idx_dfns_fiat_transactions_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_project_id ON public.dfns_fiat_transactions USING btree (project_id);


--
-- Name: idx_dfns_fiat_transactions_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_provider ON public.dfns_fiat_transactions USING btree (provider);


--
-- Name: idx_dfns_fiat_transactions_provider_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_provider_status ON public.dfns_fiat_transactions USING btree (provider, status);


--
-- Name: idx_dfns_fiat_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_status ON public.dfns_fiat_transactions USING btree (status);


--
-- Name: idx_dfns_fiat_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_type ON public.dfns_fiat_transactions USING btree (type);


--
-- Name: idx_dfns_fiat_transactions_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_user_id ON public.dfns_fiat_transactions USING btree (user_id);


--
-- Name: idx_dfns_fiat_transactions_user_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_user_status ON public.dfns_fiat_transactions USING btree (user_id, status);


--
-- Name: idx_dfns_fiat_transactions_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_wallet_id ON public.dfns_fiat_transactions USING btree (wallet_id);


--
-- Name: idx_dfns_fiat_transactions_wallet_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_fiat_transactions_wallet_type ON public.dfns_fiat_transactions USING btree (wallet_id, type);


--
-- Name: idx_dfns_policies_action_kind; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_action_kind ON public.dfns_policies USING btree (action_kind);


--
-- Name: idx_dfns_policies_activity_kind; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_activity_kind ON public.dfns_policies USING btree (activity_kind);


--
-- Name: idx_dfns_policies_dfns_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_dfns_id ON public.dfns_policies USING btree (dfns_policy_id);


--
-- Name: idx_dfns_policies_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_org ON public.dfns_policies USING btree (organization_id);


--
-- Name: idx_dfns_policies_policy_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_policy_id ON public.dfns_policies USING btree (policy_id);


--
-- Name: idx_dfns_policies_rule_kind; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_rule_kind ON public.dfns_policies USING btree (rule_kind);


--
-- Name: idx_dfns_policies_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policies_status ON public.dfns_policies USING btree (status);


--
-- Name: idx_dfns_policy_approval_decisions_approval; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approval_decisions_approval ON public.dfns_policy_approval_decisions USING btree (approval_id);


--
-- Name: idx_dfns_policy_approval_decisions_dfns_approval; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approval_decisions_dfns_approval ON public.dfns_policy_approval_decisions USING btree (dfns_approval_id);


--
-- Name: idx_dfns_policy_approval_decisions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approval_decisions_user ON public.dfns_policy_approval_decisions USING btree (user_id);


--
-- Name: idx_dfns_policy_approval_groups_dfns_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approval_groups_dfns_policy ON public.dfns_policy_approval_groups USING btree (dfns_policy_id);


--
-- Name: idx_dfns_policy_approval_groups_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approval_groups_policy ON public.dfns_policy_approval_groups USING btree (policy_id);


--
-- Name: idx_dfns_policy_approvals_activity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approvals_activity ON public.dfns_policy_approvals USING btree (activity_id);


--
-- Name: idx_dfns_policy_approvals_dfns_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approvals_dfns_id ON public.dfns_policy_approvals USING btree (dfns_approval_id);


--
-- Name: idx_dfns_policy_approvals_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approvals_org ON public.dfns_policy_approvals USING btree (organization_id);


--
-- Name: idx_dfns_policy_approvals_policy_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approvals_policy_id ON public.dfns_policy_approvals USING btree (policy_id);


--
-- Name: idx_dfns_policy_approvals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_approvals_status ON public.dfns_policy_approvals USING btree (status);


--
-- Name: idx_dfns_policy_change_requests_dfns_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_change_requests_dfns_id ON public.dfns_policy_change_requests USING btree (dfns_change_request_id);


--
-- Name: idx_dfns_policy_change_requests_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_change_requests_entity ON public.dfns_policy_change_requests USING btree (entity_id);


--
-- Name: idx_dfns_policy_change_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_change_requests_status ON public.dfns_policy_change_requests USING btree (status);


--
-- Name: idx_dfns_policy_evaluations_activity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_evaluations_activity ON public.dfns_policy_evaluations USING btree (activity_id);


--
-- Name: idx_dfns_policy_evaluations_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_evaluations_policy ON public.dfns_policy_evaluations USING btree (dfns_policy_id);


--
-- Name: idx_dfns_policy_evaluations_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_evaluations_timestamp ON public.dfns_policy_evaluations USING btree (evaluation_timestamp);


--
-- Name: idx_dfns_policy_evaluations_trigger_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_policy_evaluations_trigger_status ON public.dfns_policy_evaluations USING btree (trigger_status);


--
-- Name: idx_dfns_signing_keys_key_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_signing_keys_key_id ON public.dfns_signing_keys USING btree (key_id);


--
-- Name: idx_dfns_signing_keys_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_signing_keys_network ON public.dfns_signing_keys USING btree (network);


--
-- Name: idx_dfns_signing_keys_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_signing_keys_status ON public.dfns_signing_keys USING btree (status);


--
-- Name: idx_dfns_sync_status_entity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_sync_status_entity_type ON public.dfns_sync_status USING btree (entity_type);


--
-- Name: idx_dfns_sync_status_last_sync_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_sync_status_last_sync_at ON public.dfns_sync_status USING btree (last_sync_at);


--
-- Name: idx_dfns_sync_status_sync_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_sync_status_sync_status ON public.dfns_sync_status USING btree (sync_status);


--
-- Name: idx_dfns_transaction_history_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transaction_history_timestamp ON public.dfns_transaction_history USING btree ("timestamp");


--
-- Name: idx_dfns_transaction_history_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transaction_history_tx_hash ON public.dfns_transaction_history USING btree (tx_hash);


--
-- Name: idx_dfns_transaction_history_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transaction_history_wallet_id ON public.dfns_transaction_history USING btree (wallet_id);


--
-- Name: idx_dfns_transfers_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transfers_status ON public.dfns_transfers USING btree (status);


--
-- Name: idx_dfns_transfers_transfer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transfers_transfer_id ON public.dfns_transfers USING btree (transfer_id);


--
-- Name: idx_dfns_transfers_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transfers_tx_hash ON public.dfns_transfers USING btree (tx_hash);


--
-- Name: idx_dfns_transfers_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_transfers_wallet_id ON public.dfns_transfers USING btree (wallet_id);


--
-- Name: idx_dfns_user_action_challenges_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_action_challenges_expires_at ON public.dfns_user_action_challenges USING btree (expires_at);


--
-- Name: idx_dfns_user_action_challenges_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_action_challenges_status ON public.dfns_user_action_challenges USING btree (status);


--
-- Name: idx_dfns_user_action_challenges_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_action_challenges_user_id ON public.dfns_user_action_challenges USING btree (user_id);


--
-- Name: idx_dfns_user_sessions_access_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_sessions_access_token ON public.dfns_user_sessions USING btree (access_token);


--
-- Name: idx_dfns_user_sessions_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_sessions_expires_at ON public.dfns_user_sessions USING btree (expires_at);


--
-- Name: idx_dfns_user_sessions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_sessions_status ON public.dfns_user_sessions USING btree (status);


--
-- Name: idx_dfns_user_sessions_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_user_sessions_user_id ON public.dfns_user_sessions USING btree (user_id);


--
-- Name: idx_dfns_users_dfns_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_users_dfns_user_id ON public.dfns_users USING btree (dfns_user_id);


--
-- Name: idx_dfns_users_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_users_email ON public.dfns_users USING btree (email);


--
-- Name: idx_dfns_users_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_users_status ON public.dfns_users USING btree (status);


--
-- Name: idx_dfns_users_username; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_users_username ON public.dfns_users USING btree (username);


--
-- Name: idx_dfns_wallet_balances_asset_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallet_balances_asset_symbol ON public.dfns_wallet_balances USING btree (asset_symbol);


--
-- Name: idx_dfns_wallet_balances_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallet_balances_wallet_id ON public.dfns_wallet_balances USING btree (wallet_id);


--
-- Name: idx_dfns_wallets_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_address ON public.dfns_wallets USING btree (address);


--
-- Name: idx_dfns_wallets_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_investor_id ON public.dfns_wallets USING btree (investor_id);


--
-- Name: idx_dfns_wallets_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_network ON public.dfns_wallets USING btree (network);


--
-- Name: idx_dfns_wallets_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_project_id ON public.dfns_wallets USING btree (project_id);


--
-- Name: idx_dfns_wallets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_status ON public.dfns_wallets USING btree (status);


--
-- Name: idx_dfns_wallets_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dfns_wallets_wallet_id ON public.dfns_wallets USING btree (wallet_id);


--
-- Name: idx_digital_tokenised_funds_asset_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_digital_tokenised_funds_asset_symbol ON public.digital_tokenised_funds USING btree (asset_symbol);


--
-- Name: idx_digital_tokenised_funds_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_digital_tokenised_funds_project_id_unique ON public.digital_tokenised_funds USING btree (project_id);


--
-- Name: idx_distributions_distribution_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_distributions_distribution_date ON public.distributions USING btree (distribution_date);


--
-- Name: idx_distributions_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_distributions_investor_id ON public.distributions USING btree (investor_id);


--
-- Name: idx_distributions_redemption_tracking; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_distributions_redemption_tracking ON public.distributions USING btree (investor_id, project_id, remaining_amount) WHERE (remaining_amount > (0)::numeric);


--
-- Name: idx_distributions_token_allocation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_distributions_token_allocation_id ON public.distributions USING btree (token_allocation_id);


--
-- Name: idx_document_approvals_document_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_approvals_document_id ON public.document_approvals USING btree (document_id);


--
-- Name: idx_document_versions_document_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_versions_document_id ON public.document_versions USING btree (document_id);


--
-- Name: idx_document_workflows_document_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_workflows_document_id ON public.document_workflows USING btree (document_id);


--
-- Name: idx_document_workflows_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_workflows_status ON public.document_workflows USING btree (status);


--
-- Name: idx_documents_entity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_entity_id ON public.documents USING btree (entity_id);


--
-- Name: idx_documents_entity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_entity_type ON public.documents USING btree (entity_type);


--
-- Name: idx_documents_expiry_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_expiry_date ON public.documents USING btree (expiry_date);


--
-- Name: idx_documents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_status ON public.documents USING btree (status);


--
-- Name: idx_documents_workflow_stage; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_workflow_stage ON public.documents USING btree (workflow_stage_id);


--
-- Name: idx_dtf_blockchain_events_dtf_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_dtf_product ON public.dtf_blockchain_events USING btree (digital_tokenized_fund_product_id);


--
-- Name: idx_dtf_blockchain_events_from; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_from ON public.dtf_blockchain_events USING btree (from_address);


--
-- Name: idx_dtf_blockchain_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_timestamp ON public.dtf_blockchain_events USING btree (event_timestamp);


--
-- Name: idx_dtf_blockchain_events_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_to ON public.dtf_blockchain_events USING btree (to_address);


--
-- Name: idx_dtf_blockchain_events_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_token ON public.dtf_blockchain_events USING btree (dtf_token_metadata_id);


--
-- Name: idx_dtf_blockchain_events_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_tx_hash ON public.dtf_blockchain_events USING btree (transaction_hash);


--
-- Name: idx_dtf_blockchain_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_blockchain_events_type ON public.dtf_blockchain_events USING btree (event_type);


--
-- Name: idx_dtf_minting_history_dtf_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_minting_history_dtf_product ON public.dtf_minting_history USING btree (digital_tokenized_fund_product_id);


--
-- Name: idx_dtf_minting_history_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_minting_history_recipient ON public.dtf_minting_history USING btree (recipient_address);


--
-- Name: idx_dtf_minting_history_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_minting_history_timestamp ON public.dtf_minting_history USING btree (mint_timestamp);


--
-- Name: idx_dtf_minting_history_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_minting_history_token ON public.dtf_minting_history USING btree (dtf_token_metadata_id);


--
-- Name: idx_dtf_minting_history_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_minting_history_tx_hash ON public.dtf_minting_history USING btree (transaction_hash);


--
-- Name: idx_dtf_nav_snapshots_dtf_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_nav_snapshots_dtf_product ON public.dtf_nav_snapshots USING btree (digital_tokenized_fund_product_id);


--
-- Name: idx_dtf_nav_snapshots_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_nav_snapshots_timestamp ON public.dtf_nav_snapshots USING btree (snapshot_timestamp);


--
-- Name: idx_dtf_nav_snapshots_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_nav_snapshots_token ON public.dtf_nav_snapshots USING btree (dtf_token_metadata_id);


--
-- Name: idx_dtf_nav_snapshots_valuation_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_nav_snapshots_valuation_date ON public.dtf_nav_snapshots USING btree (valuation_date);


--
-- Name: idx_dtf_redemption_requests_dtf_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_dtf_product ON public.dtf_redemption_requests USING btree (digital_tokenized_fund_product_id);


--
-- Name: idx_dtf_redemption_requests_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_id ON public.dtf_redemption_requests USING btree (request_id);


--
-- Name: idx_dtf_redemption_requests_requester; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_requester ON public.dtf_redemption_requests USING btree (requester_address);


--
-- Name: idx_dtf_redemption_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_status ON public.dtf_redemption_requests USING btree (status);


--
-- Name: idx_dtf_redemption_requests_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_timestamp ON public.dtf_redemption_requests USING btree (request_timestamp);


--
-- Name: idx_dtf_redemption_requests_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_redemption_requests_token ON public.dtf_redemption_requests USING btree (dtf_token_metadata_id);


--
-- Name: idx_dtf_token_metadata_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_token_metadata_contract ON public.dtf_token_metadata USING btree (contract_address);


--
-- Name: idx_dtf_token_metadata_dtf_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_token_metadata_dtf_product ON public.dtf_token_metadata USING btree (digital_tokenized_fund_product_id);


--
-- Name: idx_dtf_token_metadata_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dtf_token_metadata_network ON public.dtf_token_metadata USING btree (blockchain_network);


--
-- Name: idx_dutch_auctions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dutch_auctions_active ON public.trade_finance_dutch_auctions USING btree (active) WHERE (active = true);


--
-- Name: idx_dutch_auctions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dutch_auctions_user ON public.trade_finance_dutch_auctions USING btree (user_address);


--
-- Name: idx_email_log_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_log_user ON public.email_log USING btree (user_id, sent_at);


--
-- Name: idx_energy_assets_capacity_factor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_assets_capacity_factor ON public.energy_assets USING btree (capacity_factor_actual);


--
-- Name: idx_energy_assets_competitiveness; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_assets_competitiveness ON public.energy_assets USING btree (lcoe_competitiveness_ratio);


--
-- Name: idx_energy_assets_duplicate_check; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_assets_duplicate_check ON public.energy_assets USING btree (name, type, location, capacity);


--
-- Name: idx_energy_assets_lcoe_calculated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_assets_lcoe_calculated ON public.energy_assets USING btree (lcoe_calculated);


--
-- Name: idx_energy_futures_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_futures_commodity ON public.energy_futures_contracts USING btree (commodity);


--
-- Name: idx_energy_futures_contract_month; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_futures_contract_month ON public.energy_futures_contracts USING btree (contract_month);


--
-- Name: idx_energy_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_products_project_id ON public.energy_products USING btree (project_id);


--
-- Name: idx_energy_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_energy_products_project_id_unique ON public.energy_products USING btree (project_id);


--
-- Name: idx_energy_products_project_identifier; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_energy_products_project_identifier ON public.energy_products USING btree (project_identifier);


--
-- Name: idx_env_certifications_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_env_certifications_date ON public.environmental_certifications USING btree (certified_date);


--
-- Name: idx_env_certifications_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_env_certifications_level ON public.environmental_certifications USING btree (certification_level);


--
-- Name: idx_env_certifications_re_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_env_certifications_re_product ON public.environmental_certifications USING btree (real_estate_product_id);


--
-- Name: idx_env_certifications_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_env_certifications_type ON public.environmental_certifications USING btree (certification_type);


--
-- Name: idx_equity_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_equity_products_project_id ON public.equity_products USING btree (project_id);


--
-- Name: idx_equity_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_equity_products_project_id_unique ON public.equity_products USING btree (project_id);


--
-- Name: idx_equity_products_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_equity_products_status ON public.equity_products USING btree (status);


--
-- Name: idx_equity_products_ticker_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_equity_products_ticker_symbol ON public.equity_products USING btree (ticker_symbol);


--
-- Name: idx_erc1155_compliance_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1155_compliance_module ON public.token_erc1155_properties USING btree (compliance_module_address) WHERE (compliance_module_address IS NOT NULL);


--
-- Name: idx_erc1155_policy_engine; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1155_policy_engine ON public.token_erc1155_properties USING btree (policy_engine_address) WHERE (policy_engine_address IS NOT NULL);


--
-- Name: idx_erc1155_royalty_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1155_royalty_config ON public.token_erc1155_properties USING gin (royalty_config);


--
-- Name: idx_erc1155_supply_cap_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1155_supply_cap_config ON public.token_erc1155_properties USING gin (supply_cap_config);


--
-- Name: idx_erc1155_uri_management_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1155_uri_management_config ON public.token_erc1155_properties USING gin (uri_management_config);


--
-- Name: idx_erc1400_compliance_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1400_compliance_module ON public.token_erc1400_properties USING btree (compliance_module_address) WHERE (compliance_module_address IS NOT NULL);


--
-- Name: idx_erc1400_controller_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1400_controller_config ON public.token_erc1400_properties USING gin (controller_config);


--
-- Name: idx_erc1400_controller_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1400_controller_module ON public.token_erc1400_properties USING btree (controller_module_address) WHERE (controller_module_address IS NOT NULL);


--
-- Name: idx_erc1400_transfer_restrictions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc1400_transfer_restrictions ON public.token_erc1400_properties USING gin (enhanced_transfer_restrictions_config);


--
-- Name: idx_erc20_document_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_document_config ON public.token_erc20_properties USING gin (document_config);


--
-- Name: idx_erc20_flash_mint; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_flash_mint ON public.token_erc20_properties USING btree (flash_mint_module_address) WHERE (flash_mint_module_address IS NOT NULL);


--
-- Name: idx_erc20_permit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_permit ON public.token_erc20_properties USING btree (permit_module_address) WHERE (permit_module_address IS NOT NULL);


--
-- Name: idx_erc20_snapshot; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_snapshot ON public.token_erc20_properties USING btree (snapshot_module_address) WHERE (snapshot_module_address IS NOT NULL);


--
-- Name: idx_erc20_vesting_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_vesting_config ON public.token_erc20_properties USING gin (vesting_config);


--
-- Name: idx_erc20_votes; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc20_votes ON public.token_erc20_properties USING btree (votes_module_address) WHERE (votes_module_address IS NOT NULL);


--
-- Name: idx_erc3525_compliance_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_compliance_module ON public.token_erc3525_properties USING btree (compliance_module_address) WHERE (compliance_module_address IS NOT NULL);


--
-- Name: idx_erc3525_derivative_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_derivative_type ON public.token_erc3525_properties USING btree (derivative_type);


--
-- Name: idx_erc3525_expiration_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_expiration_date ON public.token_erc3525_properties USING btree (expiration_date);


--
-- Name: idx_erc3525_financial_instrument; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_financial_instrument ON public.token_erc3525_properties USING btree (financial_instrument_type);


--
-- Name: idx_erc3525_maturity_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_maturity_date ON public.token_erc3525_properties USING btree (maturity_date);


--
-- Name: idx_erc3525_slot_manager; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_slot_manager ON public.token_erc3525_properties USING btree (slot_manager_module_address) WHERE (slot_manager_module_address IS NOT NULL);


--
-- Name: idx_erc3525_slot_manager_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_slot_manager_config ON public.token_erc3525_properties USING gin (slot_manager_config);


--
-- Name: idx_erc3525_value_exchange_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc3525_value_exchange_config ON public.token_erc3525_properties USING gin (value_exchange_config);


--
-- Name: idx_erc4626_async_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_async_vault ON public.token_erc4626_properties USING btree (async_vault_module_address) WHERE (async_vault_module_address IS NOT NULL);


--
-- Name: idx_erc4626_async_vault_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_async_vault_config ON public.token_erc4626_properties USING gin (async_vault_config);


--
-- Name: idx_erc4626_compliance_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_compliance_module ON public.token_erc4626_properties USING btree (compliance_module_address) WHERE (compliance_module_address IS NOT NULL);


--
-- Name: idx_erc4626_compound_frequency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_compound_frequency ON public.token_erc4626_properties USING btree (compound_frequency);


--
-- Name: idx_erc4626_fee_strategy_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_fee_strategy_config ON public.token_erc4626_properties USING gin (fee_strategy_config);


--
-- Name: idx_erc4626_multi_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_multi_asset ON public.token_erc4626_properties USING btree (multi_asset_enabled);


--
-- Name: idx_erc4626_multi_asset_vault_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_multi_asset_vault_config ON public.token_erc4626_properties USING gin (multi_asset_vault_config);


--
-- Name: idx_erc4626_native_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_native_vault ON public.token_erc4626_properties USING btree (native_vault_module_address) WHERE (native_vault_module_address IS NOT NULL);


--
-- Name: idx_erc4626_rebalancing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_rebalancing ON public.token_erc4626_properties USING btree (rebalancing_enabled);


--
-- Name: idx_erc4626_router; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_router ON public.token_erc4626_properties USING btree (router_module_address) WHERE (router_module_address IS NOT NULL);


--
-- Name: idx_erc4626_strategy_complexity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_strategy_complexity ON public.token_erc4626_properties USING btree (strategy_complexity);


--
-- Name: idx_erc4626_withdrawal_queue_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_withdrawal_queue_config ON public.token_erc4626_properties USING gin (withdrawal_queue_config);


--
-- Name: idx_erc4626_yield_strategy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_yield_strategy ON public.token_erc4626_properties USING btree (yield_strategy_module_address) WHERE (yield_strategy_module_address IS NOT NULL);


--
-- Name: idx_erc4626_yield_strategy_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc4626_yield_strategy_config ON public.token_erc4626_properties USING gin (yield_strategy_config);


--
-- Name: idx_erc721_compliance_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_compliance_config ON public.token_erc721_properties USING gin (compliance_config);


--
-- Name: idx_erc721_compliance_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_compliance_module ON public.token_erc721_properties USING btree (compliance_module_address) WHERE (compliance_module_address IS NOT NULL);


--
-- Name: idx_erc721_consecutive; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_consecutive ON public.token_erc721_properties USING btree (consecutive) WHERE (consecutive = true);


--
-- Name: idx_erc721_document_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_document_config ON public.token_erc721_properties USING gin (document_config);


--
-- Name: idx_erc721_fractionalization_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_fractionalization_config ON public.token_erc721_properties USING gin (fractionalization_config);


--
-- Name: idx_erc721_metadata_events; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_metadata_events ON public.token_erc721_properties USING btree (metadata_events) WHERE (metadata_events = true);


--
-- Name: idx_erc721_policy_engine; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_policy_engine ON public.token_erc721_properties USING btree (policy_engine_address) WHERE (policy_engine_address IS NOT NULL);


--
-- Name: idx_erc721_rental_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_rental_config ON public.token_erc721_properties USING gin (rental_config);


--
-- Name: idx_erc721_royalty_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_royalty_module ON public.token_erc721_properties USING btree (royalty_module_address) WHERE (royalty_module_address IS NOT NULL);


--
-- Name: idx_erc721_vesting_config; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_erc721_vesting_config ON public.token_erc721_properties USING gin (vesting_config);


--
-- Name: idx_escalation_notifications_process; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_escalation_notifications_process ON public.escalation_notifications USING btree (process_id);


--
-- Name: idx_escalation_schedule_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_escalation_schedule_status ON public.escalation_schedule USING btree (status, scheduled_at);


--
-- Name: idx_etf_creation_redemption_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_creation_redemption_date ON public.etf_creation_redemption USING btree (transaction_date);


--
-- Name: idx_etf_creation_redemption_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_creation_redemption_fund ON public.etf_creation_redemption USING btree (fund_product_id);


--
-- Name: idx_etf_creation_redemption_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_creation_redemption_type ON public.etf_creation_redemption USING btree (transaction_type);


--
-- Name: idx_etf_holdings_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_blockchain ON public.etf_holdings USING btree (blockchain) WHERE (blockchain IS NOT NULL);


--
-- Name: idx_etf_holdings_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_date ON public.etf_holdings USING btree (as_of_date);


--
-- Name: idx_etf_holdings_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_fund ON public.etf_holdings USING btree (fund_product_id);


--
-- Name: idx_etf_holdings_staked; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_staked ON public.etf_holdings USING btree (is_staked) WHERE (is_staked = true);


--
-- Name: idx_etf_holdings_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_ticker ON public.etf_holdings USING btree (security_ticker);


--
-- Name: idx_etf_holdings_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_holdings_type ON public.etf_holdings USING btree (security_type);


--
-- Name: idx_etf_metadata_crypto; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_metadata_crypto ON public.etf_metadata USING btree (is_crypto_etf) WHERE (is_crypto_etf = true);


--
-- Name: idx_etf_metadata_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_metadata_fund ON public.etf_metadata USING btree (fund_product_id);


--
-- Name: idx_etf_nav_history_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_nav_history_date ON public.etf_nav_history USING btree (valuation_date);


--
-- Name: idx_etf_nav_history_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_nav_history_fund ON public.etf_nav_history USING btree (fund_product_id);


--
-- Name: idx_etf_nav_history_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_nav_history_fund_date ON public.etf_nav_history USING btree (fund_product_id, valuation_date DESC);


--
-- Name: idx_etf_rebalancing_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_rebalancing_date ON public.etf_rebalancing_history USING btree (rebalance_date);


--
-- Name: idx_etf_rebalancing_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_rebalancing_fund ON public.etf_rebalancing_history USING btree (fund_product_id);


--
-- Name: idx_etf_token_links_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_token_links_active ON public.etf_token_links USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_etf_token_links_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_token_links_fund ON public.etf_token_links USING btree (fund_product_id);


--
-- Name: idx_etf_token_links_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_token_links_token ON public.etf_token_links USING btree (token_id);


--
-- Name: idx_etf_tracking_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_tracking_fund ON public.etf_tracking_error_history USING btree (fund_product_id);


--
-- Name: idx_etf_tracking_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_etf_tracking_period ON public.etf_tracking_error_history USING btree (period_start, period_end);


--
-- Name: idx_exchange_rate_token_currency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_exchange_rate_token_currency ON public.exchange_rate_history USING btree (token_id, currency, effective_from DESC);


--
-- Name: idx_external_api_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_external_api_cache_expires ON public.external_api_cache USING btree (expires_at);


--
-- Name: idx_external_api_cache_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_external_api_cache_key ON public.external_api_cache USING btree (cache_key);


--
-- Name: idx_facet_registry_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facet_registry_active ON public.facet_registry USING btree (is_active, audit_status);


--
-- Name: idx_facet_registry_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facet_registry_address ON public.facet_registry USING btree (address);


--
-- Name: idx_facet_registry_selectors; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facet_registry_selectors ON public.facet_registry USING gin (function_selectors);


--
-- Name: idx_faucet_requests_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faucet_requests_created_at ON public.faucet_requests USING btree (created_at);


--
-- Name: idx_faucet_requests_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faucet_requests_network ON public.faucet_requests USING btree (network);


--
-- Name: idx_faucet_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faucet_requests_status ON public.faucet_requests USING btree (status);


--
-- Name: idx_faucet_requests_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faucet_requests_wallet_address ON public.faucet_requests USING btree (wallet_address);


--
-- Name: idx_fee_collections_source; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fee_collections_source ON public.trade_finance_fee_collections USING btree (fee_source);


--
-- Name: idx_fee_collections_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fee_collections_time ON public.trade_finance_fee_collections USING btree (collected_at);


--
-- Name: idx_fee_collections_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fee_collections_token ON public.trade_finance_fee_collections USING btree (token_address);


--
-- Name: idx_fee_distributions_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fee_distributions_recipient ON public.trade_finance_fee_distributions USING btree (recipient_id);


--
-- Name: idx_fee_distributions_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fee_distributions_token ON public.trade_finance_fee_distributions USING btree (token_address);


--
-- Name: idx_fiat_quotes_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_created_at ON public.fiat_quotes USING btree (created_at DESC);


--
-- Name: idx_fiat_quotes_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_expires_at ON public.fiat_quotes USING btree (expires_at);


--
-- Name: idx_fiat_quotes_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_provider ON public.fiat_quotes USING btree (provider);


--
-- Name: idx_fiat_quotes_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_session_id ON public.fiat_quotes USING btree (session_id);


--
-- Name: idx_fiat_quotes_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_type ON public.fiat_quotes USING btree (type);


--
-- Name: idx_fiat_quotes_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_quotes_user_id ON public.fiat_quotes USING btree (user_id);


--
-- Name: idx_fiat_transactions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_created_at ON public.fiat_transactions USING btree (created_at DESC);


--
-- Name: idx_fiat_transactions_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_provider ON public.fiat_transactions USING btree (provider);


--
-- Name: idx_fiat_transactions_provider_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_provider_transaction_id ON public.fiat_transactions USING btree (provider_transaction_id);


--
-- Name: idx_fiat_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_status ON public.fiat_transactions USING btree (status);


--
-- Name: idx_fiat_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_type ON public.fiat_transactions USING btree (type);


--
-- Name: idx_fiat_transactions_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_user_id ON public.fiat_transactions USING btree (user_id);


--
-- Name: idx_fiat_transactions_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiat_transactions_wallet_address ON public.fiat_transactions USING btree (wallet_address);


--
-- Name: idx_flash_liquidations_initiator; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_flash_liquidations_initiator ON public.trade_finance_flash_liquidations USING btree (initiator_address);


--
-- Name: idx_fund_nav_data_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_nav_data_fund_date ON public.fund_nav_data USING btree (fund_id, date DESC);


--
-- Name: idx_fund_nav_data_validated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_nav_data_validated ON public.fund_nav_data USING btree (validated, date DESC);


--
-- Name: idx_fund_products_fund_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_fund_ticker ON public.fund_products USING btree (fund_ticker);


--
-- Name: idx_fund_products_parent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_parent ON public.fund_products USING btree (parent_fund_id);


--
-- Name: idx_fund_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_project_id ON public.fund_products USING btree (project_id);


--
-- Name: idx_fund_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_fund_products_project_id_unique ON public.fund_products USING btree (project_id);


--
-- Name: idx_fund_products_registration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_registration ON public.fund_products USING btree (registration_status);


--
-- Name: idx_fund_products_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_ticker ON public.fund_products USING btree (fund_ticker);


--
-- Name: idx_fund_products_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fund_products_type ON public.fund_products USING btree (fund_type);


--
-- Name: idx_futures_prices_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_futures_prices_date ON public.futures_prices USING btree (price_date DESC);


--
-- Name: idx_futures_prices_instrument; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_futures_prices_instrument ON public.futures_prices USING btree (instrument_key);


--
-- Name: idx_futures_prices_maturity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_futures_prices_maturity ON public.futures_prices USING btree (days_to_maturity);


--
-- Name: idx_geographic_restrictions_effective; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_geographic_restrictions_effective ON public.token_geographic_restrictions USING btree (effective_date, expiry_date);


--
-- Name: idx_geographic_restrictions_token_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_geographic_restrictions_token_country ON public.token_geographic_restrictions USING btree (token_id, country_code);


--
-- Name: idx_geographic_restrictions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_geographic_restrictions_type ON public.token_geographic_restrictions USING btree (restriction_type);


--
-- Name: idx_guardian_api_tests_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_api_tests_created_at ON public.guardian_api_tests USING btree (created_at);


--
-- Name: idx_guardian_api_tests_guardian_operation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_api_tests_guardian_operation_id ON public.guardian_api_tests USING btree (guardian_operation_id);


--
-- Name: idx_guardian_api_tests_guardian_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_api_tests_guardian_wallet_id ON public.guardian_api_tests USING btree (guardian_wallet_id);


--
-- Name: idx_guardian_api_tests_test_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_api_tests_test_type ON public.guardian_api_tests USING btree (test_type);


--
-- Name: idx_guardian_operations_operation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_operations_operation_id ON public.guardian_operations USING btree (operation_id);


--
-- Name: idx_guardian_operations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_operations_status ON public.guardian_operations USING btree (operation_status);


--
-- Name: idx_guardian_operations_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_operations_wallet_id ON public.guardian_operations USING btree (guardian_wallet_id);


--
-- Name: idx_guardian_wallets_guardian_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_wallets_guardian_wallet_id ON public.guardian_wallets USING btree (guardian_wallet_id);


--
-- Name: idx_guardian_wallets_requested_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_wallets_requested_at ON public.guardian_wallets USING btree (requested_at);


--
-- Name: idx_guardian_wallets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_guardian_wallets_status ON public.guardian_wallets USING btree (wallet_status);


--
-- Name: idx_health_checks_service; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_health_checks_service ON public.health_checks USING btree (service);


--
-- Name: idx_health_warnings_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_health_warnings_user ON public.trade_finance_health_warnings USING btree (user_address);


--
-- Name: idx_individual_documents_entity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_individual_documents_entity_id ON public.individual_documents USING btree (entity_id);


--
-- Name: idx_individual_documents_entity_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_individual_documents_entity_type ON public.individual_documents USING btree (entity_type);


--
-- Name: idx_individual_documents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_individual_documents_status ON public.individual_documents USING btree (status);


--
-- Name: idx_individual_documents_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_individual_documents_type ON public.individual_documents USING btree (document_type);


--
-- Name: idx_infra_capex_schedule_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_capex_schedule_category ON public.infra_capex_schedule USING btree (capex_category);


--
-- Name: idx_infra_capex_schedule_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_capex_schedule_infra_product ON public.infra_capex_schedule USING btree (infrastructure_product_id);


--
-- Name: idx_infra_capex_schedule_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_capex_schedule_project ON public.infra_capex_schedule USING btree (project_id);


--
-- Name: idx_infra_capex_schedule_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_capex_schedule_start_date ON public.infra_capex_schedule USING btree (planned_start_date);


--
-- Name: idx_infra_capex_schedule_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_capex_schedule_status ON public.infra_capex_schedule USING btree (status);


--
-- Name: idx_infra_concessions_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_concessions_expiration ON public.infra_concessions USING btree (expiration_date);


--
-- Name: idx_infra_concessions_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_concessions_infra_product ON public.infra_concessions USING btree (infrastructure_product_id);


--
-- Name: idx_infra_concessions_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_concessions_project ON public.infra_concessions USING btree (project_id);


--
-- Name: idx_infra_operating_expenses_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_operating_expenses_category ON public.infra_operating_expenses USING btree (expense_category);


--
-- Name: idx_infra_operating_expenses_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_operating_expenses_date ON public.infra_operating_expenses USING btree (expense_date);


--
-- Name: idx_infra_operating_expenses_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_operating_expenses_infra_product ON public.infra_operating_expenses USING btree (infrastructure_product_id);


--
-- Name: idx_infra_operating_expenses_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_operating_expenses_project ON public.infra_operating_expenses USING btree (project_id);


--
-- Name: idx_infra_regulatory_filings_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_regulatory_filings_due_date ON public.infra_regulatory_filings USING btree (due_date);


--
-- Name: idx_infra_regulatory_filings_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_regulatory_filings_infra_product ON public.infra_regulatory_filings USING btree (infrastructure_product_id);


--
-- Name: idx_infra_regulatory_filings_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_regulatory_filings_project ON public.infra_regulatory_filings USING btree (project_id);


--
-- Name: idx_infra_regulatory_filings_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_regulatory_filings_status ON public.infra_regulatory_filings USING btree (compliance_status);


--
-- Name: idx_infra_regulatory_filings_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_regulatory_filings_type ON public.infra_regulatory_filings USING btree (filing_type);


--
-- Name: idx_infra_revenue_streams_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_revenue_streams_infra_product ON public.infra_revenue_streams USING btree (infrastructure_product_id);


--
-- Name: idx_infra_revenue_streams_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_revenue_streams_project ON public.infra_revenue_streams USING btree (project_id);


--
-- Name: idx_infra_revenue_streams_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_revenue_streams_type ON public.infra_revenue_streams USING btree (stream_type);


--
-- Name: idx_infra_usage_metrics_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_usage_metrics_date ON public.infra_usage_metrics USING btree (metric_date);


--
-- Name: idx_infra_usage_metrics_infra_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_usage_metrics_infra_product ON public.infra_usage_metrics USING btree (infrastructure_product_id);


--
-- Name: idx_infra_usage_metrics_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_usage_metrics_project ON public.infra_usage_metrics USING btree (project_id);


--
-- Name: idx_infra_usage_metrics_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infra_usage_metrics_type ON public.infra_usage_metrics USING btree (metric_type);


--
-- Name: idx_infrastructure_products_asset_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infrastructure_products_asset_id ON public.infrastructure_products USING btree (asset_id);


--
-- Name: idx_infrastructure_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_infrastructure_products_project_id ON public.infrastructure_products USING btree (project_id);


--
-- Name: idx_infrastructure_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_infrastructure_products_project_id_unique ON public.infrastructure_products USING btree (project_id);


--
-- Name: idx_insurance_claims_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_insurance_claims_status ON public.trade_finance_insurance_claims USING btree (status);


--
-- Name: idx_insurance_claims_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_insurance_claims_user ON public.trade_finance_insurance_claims USING btree (user_address);


--
-- Name: idx_interest_rate_config_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_interest_rate_config_commodity ON public.trade_finance_interest_rate_config USING btree (commodity_type);


--
-- Name: idx_interest_rate_config_reserve; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_interest_rate_config_reserve ON public.trade_finance_interest_rate_config USING btree (reserve_address);


--
-- Name: idx_investor_approvals_approval_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_approvals_approval_type ON public.investor_approvals USING btree (approval_type);


--
-- Name: idx_investor_approvals_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_approvals_investor_id ON public.investor_approvals USING btree (investor_id);


--
-- Name: idx_investor_approvals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_approvals_status ON public.investor_approvals USING btree (status);


--
-- Name: idx_investor_documents_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_documents_created_at ON public.investor_documents USING btree (created_at);


--
-- Name: idx_investor_documents_document_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_documents_document_type ON public.investor_documents USING btree (document_type);


--
-- Name: idx_investor_documents_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_documents_investor_id ON public.investor_documents USING btree (investor_id);


--
-- Name: idx_investor_documents_is_public; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_documents_is_public ON public.investor_documents USING btree (is_public);


--
-- Name: idx_investor_documents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_documents_status ON public.investor_documents USING btree (status);


--
-- Name: idx_investor_groups_investors_group_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_groups_investors_group_id ON public.investor_groups_investors USING btree (group_id);


--
-- Name: idx_investor_groups_investors_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investor_groups_investors_investor_id ON public.investor_groups_investors USING btree (investor_id);


--
-- Name: idx_investors_compliance_checked_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_compliance_checked_at ON public.investors USING btree (compliance_checked_at);


--
-- Name: idx_investors_compliance_checked_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_compliance_checked_by ON public.investors USING btree (compliance_checked_by);


--
-- Name: idx_investors_kyc_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_kyc_status ON public.investors USING btree (kyc_status);


--
-- Name: idx_investors_last_compliance_check; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_last_compliance_check ON public.investors USING btree (last_compliance_check);


--
-- Name: idx_investors_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_type ON public.investors USING btree (type);


--
-- Name: idx_investors_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_investors_user_id ON public.investors USING btree (user_id);


--
-- Name: idx_invoice_aging_buckets_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_aging_buckets_date ON public.invoice_aging_buckets USING btree (as_of_date);


--
-- Name: idx_invoice_aging_buckets_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_aging_buckets_name ON public.invoice_aging_buckets USING btree (bucket_name);


--
-- Name: idx_invoice_aging_buckets_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_aging_buckets_project ON public.invoice_aging_buckets USING btree (project_id);


--
-- Name: idx_invoice_collection_history_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_collection_history_period ON public.invoice_collection_history USING btree (period_start_date, period_end_date);


--
-- Name: idx_invoice_collection_history_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_collection_history_project ON public.invoice_collection_history USING btree (project_id);


--
-- Name: idx_invoice_debtor_ratings_approved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_debtor_ratings_approved ON public.invoice_debtor_ratings USING btree (is_approved_debtor);


--
-- Name: idx_invoice_debtor_ratings_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_debtor_ratings_date ON public.invoice_debtor_ratings USING btree (rating_date);


--
-- Name: idx_invoice_debtor_ratings_debtor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_debtor_ratings_debtor ON public.invoice_debtor_ratings USING btree (debtor_name);


--
-- Name: idx_invoice_payer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_payer_id ON public.invoice USING btree (payer_id);


--
-- Name: idx_invoice_payments_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_payments_date ON public.invoice_payments USING btree (payment_date);


--
-- Name: idx_invoice_payments_invoice; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_payments_invoice ON public.invoice_payments USING btree (invoice_receivable_id);


--
-- Name: idx_invoice_pool_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_pool_id ON public.invoice USING btree (pool_id);


--
-- Name: idx_invoice_provider_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_provider_id ON public.invoice USING btree (provider_id);


--
-- Name: idx_invoice_receivables_debtor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_receivables_debtor ON public.invoice_receivables USING btree (debtor_name);


--
-- Name: idx_invoice_receivables_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_receivables_due_date ON public.invoice_receivables USING btree (due_date);


--
-- Name: idx_invoice_receivables_number; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_receivables_number ON public.invoice_receivables USING btree (invoice_number);


--
-- Name: idx_invoice_receivables_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_receivables_project ON public.invoice_receivables USING btree (project_id);


--
-- Name: idx_invoice_receivables_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoice_receivables_status ON public.invoice_receivables USING btree (status);


--
-- Name: idx_issuer_access_roles_issuer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_access_roles_issuer_id ON public.issuer_access_roles USING btree (issuer_id);


--
-- Name: idx_issuer_access_roles_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_access_roles_role ON public.issuer_access_roles USING btree (role);


--
-- Name: idx_issuer_access_roles_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_access_roles_user_id ON public.issuer_access_roles USING btree (user_id);


--
-- Name: idx_issuer_documents_document_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_document_name ON public.issuer_documents USING btree (document_name);


--
-- Name: idx_issuer_documents_document_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_document_type ON public.issuer_documents USING btree (document_type);


--
-- Name: idx_issuer_documents_downloads; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_downloads ON public.issuer_documents USING btree (id, status) WHERE (status = 'active'::public.document_status);


--
-- Name: idx_issuer_documents_is_public; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_is_public ON public.issuer_documents USING btree (is_public);


--
-- Name: idx_issuer_documents_issuer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_issuer_id ON public.issuer_documents USING btree (issuer_id);


--
-- Name: idx_issuer_documents_lookup; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_lookup ON public.issuer_documents USING btree (issuer_id, document_type, status, created_at DESC);


--
-- Name: idx_issuer_documents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_status ON public.issuer_documents USING btree (status);


--
-- Name: idx_issuer_documents_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_issuer_documents_type ON public.issuer_documents USING btree (document_type);


--
-- Name: idx_issuer_documents_unique_combo; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_issuer_documents_unique_combo ON public.issuer_documents USING btree (issuer_id, document_type, document_name) WHERE (status = 'active'::public.document_status);


--
-- Name: idx_jurisdictions_region; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_jurisdictions_region ON public.geographic_jurisdictions USING btree (region, regulatory_regime);


--
-- Name: idx_jurisdictions_sanctions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_jurisdictions_sanctions ON public.geographic_jurisdictions USING btree (is_ofac_sanctioned, is_eu_sanctioned, is_un_sanctioned);


--
-- Name: idx_key_vault_keys_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_created_by ON public.key_vault_keys USING btree (created_by);


--
-- Name: idx_key_vault_keys_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_investor_id ON public.key_vault_keys USING btree (investor_id);


--
-- Name: idx_key_vault_keys_key_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_key_id ON public.key_vault_keys USING btree (key_id);


--
-- Name: idx_key_vault_keys_key_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_key_type ON public.key_vault_keys USING btree (key_type);


--
-- Name: idx_key_vault_keys_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_metadata ON public.key_vault_keys USING gin (metadata);


--
-- Name: idx_key_vault_keys_project_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_project_wallet_id ON public.key_vault_keys USING btree (project_wallet_id);


--
-- Name: idx_key_vault_keys_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_user_id ON public.key_vault_keys USING btree (user_id);


--
-- Name: idx_key_vault_keys_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_key_vault_keys_wallet_id ON public.key_vault_keys USING btree (wallet_id);


--
-- Name: idx_lease_agreements_end_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lease_agreements_end_date ON public.lease_agreements USING btree (lease_end_date);


--
-- Name: idx_lease_agreements_re_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lease_agreements_re_product ON public.lease_agreements USING btree (real_estate_product_id);


--
-- Name: idx_lease_agreements_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lease_agreements_start_date ON public.lease_agreements USING btree (lease_start_date);


--
-- Name: idx_lease_agreements_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lease_agreements_status ON public.lease_agreements USING btree (status);


--
-- Name: idx_lease_agreements_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lease_agreements_tenant ON public.lease_agreements USING btree (tenant_name);


--
-- Name: idx_lifecycle_events_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lifecycle_events_product_id ON public.product_lifecycle_events USING btree (product_id);


--
-- Name: idx_margin_calls_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_margin_calls_active ON public.trade_finance_margin_calls USING btree (resolved, liquidated) WHERE ((NOT resolved) AND (NOT liquidated));


--
-- Name: idx_margin_calls_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_margin_calls_user ON public.trade_finance_margin_calls USING btree (user_address);


--
-- Name: idx_market_data_providers_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_data_providers_active ON public.market_data_providers USING btree (is_active, priority);


--
-- Name: idx_market_data_snapshots_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_data_snapshots_date ON public.market_data_snapshots USING btree (snapshot_date);


--
-- Name: idx_market_indices_asset_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_indices_asset_class ON public.market_indices USING btree (asset_class);


--
-- Name: idx_market_indices_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_indices_symbol ON public.market_indices USING btree (index_symbol);


--
-- Name: idx_market_rent_data_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_rent_data_date ON public.market_rent_data USING btree (as_of_date);


--
-- Name: idx_market_rent_data_location; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_rent_data_location ON public.market_rent_data USING btree (city, state_province, country);


--
-- Name: idx_market_rent_data_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_market_rent_data_type ON public.market_rent_data USING btree (property_type);


--
-- Name: idx_metrics_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_metrics_date ON public.compliance_metrics USING btree (metric_date);


--
-- Name: idx_mmf_allocation_asset_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_allocation_asset_class ON public.mmf_allocation_history USING btree (asset_class);


--
-- Name: idx_mmf_allocation_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_allocation_date ON public.mmf_allocation_history USING btree (as_of_date DESC);


--
-- Name: idx_mmf_allocation_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_allocation_fund_date ON public.mmf_allocation_history USING btree (fund_product_id, as_of_date DESC);


--
-- Name: idx_mmf_credit_ratings_agency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_credit_ratings_agency ON public.mmf_credit_ratings USING btree (rating_agency);


--
-- Name: idx_mmf_credit_ratings_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_credit_ratings_date ON public.mmf_credit_ratings USING btree (rating_date);


--
-- Name: idx_mmf_credit_ratings_eligible; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_credit_ratings_eligible ON public.mmf_credit_ratings USING btree (is_eligible_mmf_holding);


--
-- Name: idx_mmf_credit_ratings_issuer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_credit_ratings_issuer ON public.mmf_credit_ratings USING btree (issuer_name);


--
-- Name: idx_mmf_fees_gates_date_range; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_fees_gates_date_range ON public.mmf_fees_gates USING btree (effective_date, end_date);


--
-- Name: idx_mmf_fees_gates_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_fees_gates_fund ON public.mmf_fees_gates USING btree (fund_product_id, effective_date DESC);


--
-- Name: idx_mmf_fees_gates_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_fees_gates_status ON public.mmf_fees_gates USING btree (status);


--
-- Name: idx_mmf_fees_gates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_fees_gates_type ON public.mmf_fees_gates USING btree (fee_type);


--
-- Name: idx_mmf_holdings_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_fund ON public.mmf_holdings USING btree (fund_product_id);


--
-- Name: idx_mmf_holdings_fund_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_fund_status ON public.mmf_holdings USING btree (fund_product_id, status);


--
-- Name: idx_mmf_holdings_issuer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_issuer ON public.mmf_holdings USING btree (issuer_name);


--
-- Name: idx_mmf_holdings_maturity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_maturity ON public.mmf_holdings USING btree (effective_maturity_date);


--
-- Name: idx_mmf_holdings_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_rating ON public.mmf_holdings USING btree (credit_rating);


--
-- Name: idx_mmf_holdings_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_holdings_type ON public.mmf_holdings USING btree (holding_type);


--
-- Name: idx_mmf_liquidity_buckets_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_liquidity_buckets_date ON public.mmf_liquidity_buckets USING btree (as_of_date);


--
-- Name: idx_mmf_liquidity_buckets_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_liquidity_buckets_fund ON public.mmf_liquidity_buckets USING btree (fund_product_id);


--
-- Name: idx_mmf_liquidity_buckets_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_liquidity_buckets_type ON public.mmf_liquidity_buckets USING btree (bucket_type);


--
-- Name: idx_mmf_nav_history_breaking_buck; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_nav_history_breaking_buck ON public.mmf_nav_history USING btree (is_breaking_the_buck);


--
-- Name: idx_mmf_nav_history_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_nav_history_date ON public.mmf_nav_history USING btree (valuation_date);


--
-- Name: idx_mmf_nav_history_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_nav_history_fund ON public.mmf_nav_history USING btree (fund_product_id);


--
-- Name: idx_mmf_nav_history_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_nav_history_fund_date ON public.mmf_nav_history USING btree (fund_product_id, valuation_date DESC);


--
-- Name: idx_mmf_transactions_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_date ON public.mmf_transactions USING btree (transaction_date);


--
-- Name: idx_mmf_transactions_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_fund ON public.mmf_transactions USING btree (fund_product_id);


--
-- Name: idx_mmf_transactions_fund_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_fund_date ON public.mmf_transactions USING btree (fund_product_id, transaction_date DESC);


--
-- Name: idx_mmf_transactions_holding; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_holding ON public.mmf_transactions USING btree (holding_id);


--
-- Name: idx_mmf_transactions_investor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_investor ON public.mmf_transactions USING btree (investor_id);


--
-- Name: idx_mmf_transactions_subscription; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_subscription ON public.mmf_transactions USING btree (subscription_id);


--
-- Name: idx_mmf_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mmf_transactions_type ON public.mmf_transactions USING btree (transaction_type);


--
-- Name: idx_monitoring_metrics_metric_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_monitoring_metrics_metric_name ON public.monitoring_metrics USING btree (metric_name);


--
-- Name: idx_monitoring_metrics_service_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_monitoring_metrics_service_time ON public.monitoring_metrics USING btree (service, recorded_at);


--
-- Name: idx_moonpay_asset_cache_contract_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_asset_cache_contract_token ON public.moonpay_asset_cache USING btree (contract_address, token_id);


--
-- Name: idx_moonpay_asset_cache_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_asset_cache_expires_at ON public.moonpay_asset_cache USING btree (expires_at);


--
-- Name: idx_moonpay_compliance_alerts_alert_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_alert_id ON public.moonpay_compliance_alerts USING btree (alert_id);


--
-- Name: idx_moonpay_compliance_alerts_assigned_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_assigned_to ON public.moonpay_compliance_alerts USING btree (assigned_to);


--
-- Name: idx_moonpay_compliance_alerts_customer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_customer_id ON public.moonpay_compliance_alerts USING btree (customer_id);


--
-- Name: idx_moonpay_compliance_alerts_details; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_details ON public.moonpay_compliance_alerts USING gin (details);


--
-- Name: idx_moonpay_compliance_alerts_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_entity ON public.moonpay_compliance_alerts USING btree (entity_type, entity_id);


--
-- Name: idx_moonpay_compliance_alerts_risk_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_risk_level ON public.moonpay_compliance_alerts USING btree (risk_level);


--
-- Name: idx_moonpay_compliance_alerts_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_severity ON public.moonpay_compliance_alerts USING btree (severity);


--
-- Name: idx_moonpay_compliance_alerts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_status ON public.moonpay_compliance_alerts USING btree (status);


--
-- Name: idx_moonpay_compliance_alerts_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_transaction_id ON public.moonpay_compliance_alerts USING btree (transaction_id);


--
-- Name: idx_moonpay_compliance_alerts_triggered_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_triggered_at ON public.moonpay_compliance_alerts USING btree (triggered_at);


--
-- Name: idx_moonpay_compliance_alerts_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_compliance_alerts_type ON public.moonpay_compliance_alerts USING btree (alert_type);


--
-- Name: idx_moonpay_customers_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_customers_email ON public.moonpay_customers USING btree (email);


--
-- Name: idx_moonpay_customers_external_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_customers_external_id ON public.moonpay_customers USING btree (external_customer_id);


--
-- Name: idx_moonpay_customers_moonpay_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_customers_moonpay_id ON public.moonpay_customers USING btree (moonpay_customer_id);


--
-- Name: idx_moonpay_passes_contract_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_passes_contract_token ON public.moonpay_passes USING btree (contract_address, token_id);


--
-- Name: idx_moonpay_passes_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_passes_owner ON public.moonpay_passes USING btree (owner_address);


--
-- Name: idx_moonpay_passes_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_passes_project_id ON public.moonpay_passes USING btree (project_id);


--
-- Name: idx_moonpay_passes_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_passes_status ON public.moonpay_passes USING btree (status);


--
-- Name: idx_moonpay_policy_logs_action_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_action_type ON public.moonpay_policy_logs USING btree (action_type);


--
-- Name: idx_moonpay_policy_logs_correlation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_correlation_id ON public.moonpay_policy_logs USING btree (correlation_id);


--
-- Name: idx_moonpay_policy_logs_customer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_customer_id ON public.moonpay_policy_logs USING btree (customer_id);


--
-- Name: idx_moonpay_policy_logs_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_entity ON public.moonpay_policy_logs USING btree (entity_type, entity_id);


--
-- Name: idx_moonpay_policy_logs_executed_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_executed_at ON public.moonpay_policy_logs USING btree (executed_at);


--
-- Name: idx_moonpay_policy_logs_execution_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_execution_status ON public.moonpay_policy_logs USING btree (execution_status);


--
-- Name: idx_moonpay_policy_logs_log_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_log_id ON public.moonpay_policy_logs USING btree (log_id);


--
-- Name: idx_moonpay_policy_logs_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_metadata ON public.moonpay_policy_logs USING gin (metadata);


--
-- Name: idx_moonpay_policy_logs_policy_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_policy_id ON public.moonpay_policy_logs USING btree (policy_id);


--
-- Name: idx_moonpay_policy_logs_policy_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_policy_type ON public.moonpay_policy_logs USING btree (policy_type);


--
-- Name: idx_moonpay_policy_logs_requires_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_requires_action ON public.moonpay_policy_logs USING btree (requires_action);


--
-- Name: idx_moonpay_policy_logs_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_severity ON public.moonpay_policy_logs USING btree (severity);


--
-- Name: idx_moonpay_policy_logs_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_policy_logs_transaction_id ON public.moonpay_policy_logs USING btree (transaction_id);


--
-- Name: idx_moonpay_swap_transactions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_swap_transactions_created_at ON public.moonpay_swap_transactions USING btree (created_at);


--
-- Name: idx_moonpay_swap_transactions_external_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_swap_transactions_external_id ON public.moonpay_swap_transactions USING btree (external_transaction_id);


--
-- Name: idx_moonpay_swap_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_swap_transactions_status ON public.moonpay_swap_transactions USING btree (status);


--
-- Name: idx_moonpay_transactions_composite; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_composite ON public.moonpay_transactions USING btree (wallet_address, type, status, created_at);


--
-- Name: idx_moonpay_transactions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_created_at ON public.moonpay_transactions USING btree (created_at);


--
-- Name: idx_moonpay_transactions_customer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_customer_id ON public.moonpay_transactions USING btree (customer_id);


--
-- Name: idx_moonpay_transactions_external_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_external_id ON public.moonpay_transactions USING btree (external_transaction_id);


--
-- Name: idx_moonpay_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_status ON public.moonpay_transactions USING btree (status);


--
-- Name: idx_moonpay_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_type ON public.moonpay_transactions USING btree (type);


--
-- Name: idx_moonpay_transactions_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_transactions_wallet_address ON public.moonpay_transactions USING btree (wallet_address);


--
-- Name: idx_moonpay_webhook_config_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_config_created_at ON public.moonpay_webhook_config USING btree (created_at);


--
-- Name: idx_moonpay_webhook_config_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_config_environment ON public.moonpay_webhook_config USING btree (environment);


--
-- Name: idx_moonpay_webhook_config_events; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_config_events ON public.moonpay_webhook_config USING gin (events);


--
-- Name: idx_moonpay_webhook_config_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_config_status ON public.moonpay_webhook_config USING btree (status);


--
-- Name: idx_moonpay_webhook_config_webhook_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_config_webhook_id ON public.moonpay_webhook_config USING btree (webhook_id);


--
-- Name: idx_moonpay_webhook_events_processed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_events_processed ON public.moonpay_webhook_events USING btree (processed);


--
-- Name: idx_moonpay_webhook_events_received_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_events_received_at ON public.moonpay_webhook_events USING btree (received_at);


--
-- Name: idx_moonpay_webhook_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_moonpay_webhook_events_type ON public.moonpay_webhook_events USING btree (event_type);


--
-- Name: idx_multi_sig_proposals_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_blockchain ON public.multi_sig_proposals USING btree (blockchain);


--
-- Name: idx_multi_sig_proposals_chain_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_chain_type ON public.multi_sig_proposals USING btree (chain_type);


--
-- Name: idx_multi_sig_proposals_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_created_at ON public.multi_sig_proposals USING btree (created_at);


--
-- Name: idx_multi_sig_proposals_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_created_by ON public.multi_sig_proposals USING btree (created_by);


--
-- Name: idx_multi_sig_proposals_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_id ON public.multi_sig_proposals USING btree (id);


--
-- Name: idx_multi_sig_proposals_on_chain_tx_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_on_chain_tx_id ON public.multi_sig_proposals USING btree (on_chain_tx_id);


--
-- Name: idx_multi_sig_proposals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_status ON public.multi_sig_proposals USING btree (status);


--
-- Name: idx_multi_sig_proposals_to_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_to_address ON public.multi_sig_proposals USING btree (to_address);


--
-- Name: idx_multi_sig_proposals_token_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_token_address ON public.multi_sig_proposals USING btree (token_address);


--
-- Name: idx_multi_sig_proposals_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_proposals_wallet_id ON public.multi_sig_proposals USING btree (wallet_id);


--
-- Name: idx_multi_sig_wallets_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_wallets_address ON public.multi_sig_wallets USING btree (address);


--
-- Name: idx_multi_sig_wallets_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_wallets_blockchain ON public.multi_sig_wallets USING btree (blockchain);


--
-- Name: idx_multi_sig_wallets_funded_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_wallets_funded_by ON public.multi_sig_wallets USING btree (funded_by_wallet_id);


--
-- Name: idx_multi_sig_wallets_investor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_wallets_investor ON public.multi_sig_wallets USING btree (investor_id);


--
-- Name: idx_multi_sig_wallets_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multi_sig_wallets_project ON public.multi_sig_wallets USING btree (project_id);


--
-- Name: idx_multisig_owners_user_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multisig_owners_user_address ON public.multi_sig_wallet_owners USING btree (user_address_id);


--
-- Name: idx_multisig_owners_user_wallet; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_multisig_owners_user_wallet ON public.multi_sig_wallet_owners USING btree (wallet_id, user_id);


--
-- Name: idx_nav_approvals_requested_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_approvals_requested_by ON public.nav_approvals USING btree (requested_by);


--
-- Name: idx_nav_approvals_run_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_approvals_run_status ON public.nav_approvals USING btree (run_id, status);


--
-- Name: idx_nav_approvals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_approvals_status ON public.nav_approvals USING btree (status);


--
-- Name: idx_nav_asset_type_adj_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_asset_type_adj_as_of ON public.nav_asset_type_adjustments USING btree (as_of_date DESC);


--
-- Name: idx_nav_asset_type_adj_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_asset_type_adj_asset_type ON public.nav_asset_type_adjustments USING btree (asset_type);


--
-- Name: idx_nav_calc_params_subtype; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_params_subtype ON public.nav_calculator_parameters USING btree (calculator_type, asset_subtype);


--
-- Name: idx_nav_calc_params_type_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_params_type_key ON public.nav_calculator_parameters USING btree (calculator_type, parameter_key);


--
-- Name: idx_nav_calc_runs_asset_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_runs_asset_date ON public.nav_calculation_runs USING btree (asset_id, valuation_date);


--
-- Name: idx_nav_calc_runs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_runs_created_at ON public.nav_calculation_runs USING btree (created_at);


--
-- Name: idx_nav_calc_runs_project_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_runs_project_date ON public.nav_calculation_runs USING btree (project_id, valuation_date);


--
-- Name: idx_nav_calc_runs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_calc_runs_status ON public.nav_calculation_runs USING btree (status);


--
-- Name: idx_nav_credit_qual_mult_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_credit_qual_mult_as_of ON public.nav_credit_quality_multipliers USING btree (as_of_date DESC);


--
-- Name: idx_nav_credit_qual_mult_quality; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_credit_qual_mult_quality ON public.nav_credit_quality_multipliers USING btree (credit_quality);


--
-- Name: idx_nav_credit_spreads_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_credit_spreads_as_of ON public.nav_credit_spreads USING btree (as_of_date DESC);


--
-- Name: idx_nav_credit_spreads_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_credit_spreads_class ON public.nav_credit_spreads USING btree (asset_class);


--
-- Name: idx_nav_credit_spreads_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_credit_spreads_rating ON public.nav_credit_spreads USING btree (credit_rating);


--
-- Name: idx_nav_default_rates_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_default_rates_as_of ON public.nav_default_rates USING btree (as_of_date DESC);


--
-- Name: idx_nav_default_rates_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_default_rates_asset_type ON public.nav_default_rates USING btree (asset_type);


--
-- Name: idx_nav_default_rates_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_default_rates_rating ON public.nav_default_rates USING btree (credit_rating);


--
-- Name: idx_nav_delinq_adj_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_delinq_adj_as_of ON public.nav_delinquency_adjustments USING btree (as_of_date DESC);


--
-- Name: idx_nav_delinq_adj_days; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_delinq_adj_days ON public.nav_delinquency_adjustments USING btree (days_past_due);


--
-- Name: idx_nav_ec_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_ec_as_of ON public.nav_economic_capital USING btree (as_of_date DESC);


--
-- Name: idx_nav_ec_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_ec_rating ON public.nav_economic_capital USING btree (credit_rating);


--
-- Name: idx_nav_fx_pair_asof; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_fx_pair_asof ON public.nav_fx_rates USING btree (base_ccy, quote_ccy, as_of DESC);


--
-- Name: idx_nav_fx_rates_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_fx_rates_as_of ON public.nav_fx_rates USING btree (as_of);


--
-- Name: idx_nav_fx_rates_currencies; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_fx_rates_currencies ON public.nav_fx_rates USING btree (base_ccy, quote_ccy);


--
-- Name: idx_nav_history_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_history_asset ON public.nav_calculation_history USING btree (asset_id);


--
-- Name: idx_nav_history_run; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_history_run ON public.nav_calculation_history USING btree (run_id);


--
-- Name: idx_nav_lgd_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_lgd_as_of ON public.nav_loss_given_default USING btree (as_of_date DESC);


--
-- Name: idx_nav_lgd_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_lgd_asset_type ON public.nav_loss_given_default USING btree (asset_type);


--
-- Name: idx_nav_liq_disc_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_liq_disc_as_of ON public.nav_liquidity_discounts USING btree (as_of_date DESC);


--
-- Name: idx_nav_liq_disc_class; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_liq_disc_class ON public.nav_liquidity_discounts USING btree (asset_class);


--
-- Name: idx_nav_liq_disc_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_liq_disc_rating ON public.nav_liquidity_discounts USING btree (credit_rating);


--
-- Name: idx_nav_oracle_configs_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_oracle_configs_active ON public.nav_oracle_configs USING btree (active);


--
-- Name: idx_nav_oracle_configs_fund_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_oracle_configs_fund_id ON public.nav_oracle_configs USING btree (fund_id);


--
-- Name: idx_nav_pd_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_pd_as_of ON public.nav_probability_of_default USING btree (as_of_date DESC);


--
-- Name: idx_nav_pd_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_pd_rating ON public.nav_probability_of_default USING btree (credit_rating);


--
-- Name: idx_nav_prepay_rates_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_prepay_rates_as_of ON public.nav_prepayment_rates USING btree (as_of_date DESC);


--
-- Name: idx_nav_prepay_rates_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_prepay_rates_asset_type ON public.nav_prepayment_rates USING btree (asset_type);


--
-- Name: idx_nav_price_cache_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_price_cache_as_of ON public.nav_price_cache USING btree (as_of);


--
-- Name: idx_nav_price_cache_instrument; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_price_cache_instrument ON public.nav_price_cache USING btree (instrument_key);


--
-- Name: idx_nav_recovery_rates_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_recovery_rates_as_of ON public.nav_recovery_rates USING btree (as_of_date DESC);


--
-- Name: idx_nav_recovery_rates_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_recovery_rates_asset_type ON public.nav_recovery_rates USING btree (asset_type);


--
-- Name: idx_nav_redemptions_asset_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_redemptions_asset_date ON public.nav_redemptions USING btree (asset_id, as_of_date);


--
-- Name: idx_nav_redemptions_product_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_redemptions_product_type ON public.nav_redemptions USING btree (product_type);


--
-- Name: idx_nav_ul_as_of; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_ul_as_of ON public.nav_unexpected_loss USING btree (as_of_date DESC);


--
-- Name: idx_nav_ul_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_ul_rating ON public.nav_unexpected_loss USING btree (credit_rating);


--
-- Name: idx_nav_validation_rule_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_validation_rule_severity ON public.nav_validation_results USING btree (rule_code, severity);


--
-- Name: idx_nav_validation_run; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_nav_validation_run ON public.nav_validation_results USING btree (run_id);


--
-- Name: idx_notification_settings_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_settings_project_id ON public.notification_settings USING btree (project_id);


--
-- Name: idx_notification_settings_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_settings_user_id ON public.notification_settings USING btree (user_id);


--
-- Name: idx_on_chain_confirmations_tx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_on_chain_confirmations_tx ON public.multi_sig_on_chain_confirmations USING btree (on_chain_transaction_id);


--
-- Name: idx_on_chain_tx_executed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_on_chain_tx_executed ON public.multi_sig_on_chain_transactions USING btree (executed);


--
-- Name: idx_on_chain_tx_wallet; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_on_chain_tx_wallet ON public.multi_sig_on_chain_transactions USING btree (wallet_id);


--
-- Name: idx_onchain_claims_identity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_claims_identity_id ON public.onchain_claims USING btree (identity_id);


--
-- Name: idx_onchain_claims_issuer_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_claims_issuer_id ON public.onchain_claims USING btree (issuer_id);


--
-- Name: idx_onchain_claims_topic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_claims_topic ON public.onchain_claims USING btree (topic);


--
-- Name: idx_onchain_identities_identity_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_identities_identity_address ON public.onchain_identities USING btree (identity_address);


--
-- Name: idx_onchain_identities_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_identities_user_id ON public.onchain_identities USING btree (user_id);


--
-- Name: idx_onchain_verification_history_identity_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_onchain_verification_history_identity_id ON public.onchain_verification_history USING btree (identity_id);


--
-- Name: idx_operation_metadata_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_operation_metadata_operation ON public.operation_metadata USING btree (operation_id);


--
-- Name: idx_operation_validations_op; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_operation_validations_op ON public.operation_validations USING btree (operation_id);


--
-- Name: idx_operator_status_operator; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_operator_status_operator ON public.operator_status USING btree (operator, status);


--
-- Name: idx_organizations_entity_structure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_organizations_entity_structure ON public.organizations USING btree (entity_structure);


--
-- Name: idx_organizations_governance_model; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_organizations_governance_model ON public.organizations USING btree (governance_model);


--
-- Name: idx_organizations_issuer_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_organizations_issuer_type ON public.organizations USING btree (issuer_type);


--
-- Name: idx_partition_balances_holder_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_balances_holder_address ON public.token_erc1400_partition_balances USING btree (holder_address);


--
-- Name: idx_partition_balances_partition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_balances_partition_id ON public.token_erc1400_partition_balances USING btree (partition_id);


--
-- Name: idx_partition_operators_partition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_operators_partition_id ON public.token_erc1400_partition_operators USING btree (partition_id);


--
-- Name: idx_partition_transfers_from_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_transfers_from_address ON public.token_erc1400_partition_transfers USING btree (from_address);


--
-- Name: idx_partition_transfers_partition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_transfers_partition_id ON public.token_erc1400_partition_transfers USING btree (partition_id);


--
-- Name: idx_partition_transfers_to_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partition_transfers_to_address ON public.token_erc1400_partition_transfers USING btree (to_address);


--
-- Name: idx_paymaster_operations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_operations_created_at ON public.paymaster_operations USING btree (created_at);


--
-- Name: idx_paymaster_operations_paymaster; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_operations_paymaster ON public.paymaster_operations USING btree (paymaster_address);


--
-- Name: idx_paymaster_operations_paymaster_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_operations_paymaster_created ON public.paymaster_operations USING btree (paymaster_address, created_at);


--
-- Name: idx_paymaster_operations_sponsor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_operations_sponsor ON public.paymaster_operations USING btree (sponsor_address);


--
-- Name: idx_paymaster_operations_user_op; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_operations_user_op ON public.paymaster_operations USING btree (user_operation_id);


--
-- Name: idx_paymaster_policies_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_policies_active ON public.paymaster_policies USING btree (is_active);


--
-- Name: idx_paymaster_policies_chain_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_policies_chain_active ON public.paymaster_policies USING btree (chain_id, is_active);


--
-- Name: idx_paymaster_policies_chain_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_paymaster_policies_chain_id ON public.paymaster_policies USING btree (chain_id);


--
-- Name: idx_payment_streams_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payment_streams_active ON public.trade_finance_payment_streams USING btree (canceled) WHERE (NOT canceled);


--
-- Name: idx_payment_streams_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payment_streams_recipient ON public.trade_finance_payment_streams USING btree (recipient_address);


--
-- Name: idx_pd_collateral_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_collateral_loan ON public.pd_collateral USING btree (loan_id);


--
-- Name: idx_pd_collateral_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_collateral_pd_product ON public.pd_collateral USING btree (private_debt_product_id);


--
-- Name: idx_pd_collateral_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_collateral_status ON public.pd_collateral USING btree (status);


--
-- Name: idx_pd_collateral_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_collateral_type ON public.pd_collateral USING btree (collateral_type);


--
-- Name: idx_pd_covenants_compliance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_covenants_compliance ON public.pd_covenants USING btree (is_compliant);


--
-- Name: idx_pd_covenants_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_covenants_loan ON public.pd_covenants USING btree (loan_id);


--
-- Name: idx_pd_covenants_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_covenants_pd_product ON public.pd_covenants USING btree (private_debt_product_id);


--
-- Name: idx_pd_covenants_test_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_covenants_test_date ON public.pd_covenants USING btree (test_date);


--
-- Name: idx_pd_covenants_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_covenants_type ON public.pd_covenants USING btree (covenant_type);


--
-- Name: idx_pd_credit_ratings_agency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_credit_ratings_agency ON public.pd_credit_ratings USING btree (rating_agency);


--
-- Name: idx_pd_credit_ratings_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_credit_ratings_date ON public.pd_credit_ratings USING btree (rating_date);


--
-- Name: idx_pd_credit_ratings_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_credit_ratings_loan ON public.pd_credit_ratings USING btree (loan_id);


--
-- Name: idx_pd_credit_ratings_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_credit_ratings_pd_product ON public.pd_credit_ratings USING btree (private_debt_product_id);


--
-- Name: idx_pd_default_events_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_default_events_date ON public.pd_default_events USING btree (event_date);


--
-- Name: idx_pd_default_events_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_default_events_loan ON public.pd_default_events USING btree (loan_id);


--
-- Name: idx_pd_default_events_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_default_events_pd_product ON public.pd_default_events USING btree (private_debt_product_id);


--
-- Name: idx_pd_default_events_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_default_events_status ON public.pd_default_events USING btree (status);


--
-- Name: idx_pd_default_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_default_events_type ON public.pd_default_events USING btree (event_type);


--
-- Name: idx_pd_loan_schedules_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_loan_schedules_date ON public.pd_loan_schedules USING btree (payment_date);


--
-- Name: idx_pd_loan_schedules_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_loan_schedules_loan ON public.pd_loan_schedules USING btree (loan_id);


--
-- Name: idx_pd_loan_schedules_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_loan_schedules_pd_product ON public.pd_loan_schedules USING btree (private_debt_product_id);


--
-- Name: idx_pd_payment_history_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_payment_history_date ON public.pd_payment_history USING btree (payment_date);


--
-- Name: idx_pd_payment_history_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_payment_history_due_date ON public.pd_payment_history USING btree (due_date);


--
-- Name: idx_pd_payment_history_loan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_payment_history_loan ON public.pd_payment_history USING btree (loan_id);


--
-- Name: idx_pd_payment_history_pd_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pd_payment_history_pd_product ON public.pd_payment_history USING btree (private_debt_product_id);


--
-- Name: idx_pe_capital_calls_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_capital_calls_date ON public.pe_capital_calls USING btree (call_date);


--
-- Name: idx_pe_capital_calls_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_capital_calls_fund ON public.pe_capital_calls USING btree (fund_id);


--
-- Name: idx_pe_capital_calls_pe_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_capital_calls_pe_product ON public.pe_capital_calls USING btree (private_equity_product_id);


--
-- Name: idx_pe_capital_calls_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_capital_calls_status ON public.pe_capital_calls USING btree (status);


--
-- Name: idx_pe_distributions_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_distributions_date ON public.pe_distributions USING btree (distribution_date);


--
-- Name: idx_pe_distributions_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_distributions_fund ON public.pe_distributions USING btree (fund_id);


--
-- Name: idx_pe_distributions_pe_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_distributions_pe_product ON public.pe_distributions USING btree (private_equity_product_id);


--
-- Name: idx_pe_distributions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_distributions_type ON public.pe_distributions USING btree (distribution_type);


--
-- Name: idx_pe_performance_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_performance_date ON public.pe_performance_metrics USING btree (as_of_date);


--
-- Name: idx_pe_performance_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_performance_fund ON public.pe_performance_metrics USING btree (fund_id);


--
-- Name: idx_pe_performance_pe_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_performance_pe_product ON public.pe_performance_metrics USING btree (private_equity_product_id);


--
-- Name: idx_pe_portfolio_companies_fund; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_portfolio_companies_fund ON public.pe_portfolio_companies USING btree (fund_id);


--
-- Name: idx_pe_portfolio_companies_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_portfolio_companies_name ON public.pe_portfolio_companies USING btree (company_name);


--
-- Name: idx_pe_portfolio_companies_pe_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_portfolio_companies_pe_product ON public.pe_portfolio_companies USING btree (private_equity_product_id);


--
-- Name: idx_pe_portfolio_companies_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_portfolio_companies_status ON public.pe_portfolio_companies USING btree (status);


--
-- Name: idx_pe_valuations_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_valuations_date ON public.pe_valuations USING btree (valuation_date);


--
-- Name: idx_pe_valuations_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_valuations_entity ON public.pe_valuations USING btree (entity_id);


--
-- Name: idx_pe_valuations_method; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_valuations_method ON public.pe_valuations USING btree (valuation_method);


--
-- Name: idx_pe_valuations_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pe_valuations_type ON public.pe_valuations USING btree (entity_type);


--
-- Name: idx_policy_op_mappings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_op_mappings ON public.policy_operation_mappings USING btree (operation_type, chain_id);


--
-- Name: idx_policy_rule_approvers_rule_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_rule_approvers_rule_id ON public.policy_rule_approvers USING btree (policy_rule_id);


--
-- Name: idx_policy_rule_approvers_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_rule_approvers_user_id ON public.policy_rule_approvers USING btree (user_id);


--
-- Name: idx_policy_template_approvers_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_template_approvers_template_id ON public.policy_template_approvers USING btree (template_id);


--
-- Name: idx_policy_templates_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_templates_created_at ON public.policy_templates USING btree (created_at DESC);


--
-- Name: idx_policy_templates_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_templates_name ON public.policy_templates USING btree (template_name);


--
-- Name: idx_policy_templates_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_templates_status ON public.policy_templates USING btree (status);


--
-- Name: idx_policy_templates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_templates_type ON public.policy_templates USING btree (template_type);


--
-- Name: idx_policy_violations_unresolved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_policy_violations_unresolved ON public.policy_violations USING btree (resolved) WHERE (resolved = false);


--
-- Name: idx_pool_config_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pool_config_commodity ON public.commodity_pool_config USING btree (commodity_type);


--
-- Name: idx_pool_config_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pool_config_project ON public.commodity_pool_config USING btree (project_id);


--
-- Name: idx_positions_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_positions_project ON public.commodity_positions USING btree (project_id);


--
-- Name: idx_positions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_positions_status ON public.commodity_positions USING btree (status);


--
-- Name: idx_positions_wallet; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_positions_wallet ON public.commodity_positions USING btree (wallet_address);


--
-- Name: idx_private_debt_products_deal_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_private_debt_products_deal_id ON public.private_debt_products USING btree (deal_id);


--
-- Name: idx_private_debt_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_private_debt_products_project_id ON public.private_debt_products USING btree (project_id);


--
-- Name: idx_private_debt_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_private_debt_products_project_id_unique ON public.private_debt_products USING btree (project_id);


--
-- Name: idx_private_equity_products_fund_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_private_equity_products_fund_id ON public.private_equity_products USING btree (fund_id);


--
-- Name: idx_private_equity_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_private_equity_products_project_id ON public.private_equity_products USING btree (project_id);


--
-- Name: idx_private_equity_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_private_equity_products_project_id_unique ON public.private_equity_products USING btree (project_id);


--
-- Name: idx_product_lifecycle_events_event_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_lifecycle_events_event_date ON public.product_lifecycle_events USING btree (event_date);


--
-- Name: idx_product_lifecycle_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_lifecycle_events_event_type ON public.product_lifecycle_events USING btree (event_type);


--
-- Name: idx_product_lifecycle_events_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_lifecycle_events_product_id ON public.product_lifecycle_events USING btree (product_id);


--
-- Name: idx_product_lifecycle_events_product_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_lifecycle_events_product_type ON public.product_lifecycle_events USING btree (product_type);


--
-- Name: idx_production_asset_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_production_asset_date ON public.production_data USING btree (asset_id, production_date);


--
-- Name: idx_project_organization_assignments_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_organization_assignments_active ON public.project_organization_assignments USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_project_organization_assignments_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_organization_assignments_organization_id ON public.project_organization_assignments USING btree (organization_id);


--
-- Name: idx_project_organization_assignments_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_organization_assignments_project_id ON public.project_organization_assignments USING btree (project_id);


--
-- Name: idx_project_organization_assignments_relationship_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_organization_assignments_relationship_type ON public.project_organization_assignments USING btree (relationship_type);


--
-- Name: idx_project_wallets_evm_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_evm_address ON public.project_wallets USING btree (evm_address) WHERE (evm_address IS NOT NULL);


--
-- Name: idx_project_wallets_evm_chain_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_evm_chain_id ON public.project_wallets USING btree (evm_chain_id) WHERE (evm_chain_id IS NOT NULL);


--
-- Name: idx_project_wallets_mnemonic_vault_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_mnemonic_vault_id ON public.project_wallets USING btree (mnemonic_vault_id);


--
-- Name: idx_project_wallets_private_key_vault_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_private_key_vault_id ON public.project_wallets USING btree (private_key_vault_id);


--
-- Name: idx_project_wallets_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_project_id ON public.project_wallets USING btree (project_id);


--
-- Name: idx_project_wallets_wallet_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_wallets_wallet_type ON public.project_wallets USING btree (wallet_type);


--
-- Name: idx_projects_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_created_at ON public.projects USING btree (created_at);


--
-- Name: idx_projects_investment_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_investment_status ON public.projects USING btree (investment_status);


--
-- Name: idx_projects_is_primary; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_is_primary ON public.projects USING btree (is_primary) WHERE (is_primary = true);


--
-- Name: idx_projects_org_investment_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_org_investment_status ON public.projects USING btree (organization_id, investment_status);


--
-- Name: idx_projects_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_organization_id ON public.projects USING btree (organization_id);


--
-- Name: idx_projects_project_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_project_type ON public.projects USING btree (project_type);


--
-- Name: idx_projects_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_status ON public.projects USING btree (status);


--
-- Name: idx_property_expenses_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_expenses_category ON public.property_expenses USING btree (expense_category);


--
-- Name: idx_property_expenses_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_expenses_date ON public.property_expenses USING btree (expense_date);


--
-- Name: idx_property_expenses_re_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_expenses_re_product ON public.property_expenses USING btree (real_estate_product_id);


--
-- Name: idx_property_expenses_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_expenses_type ON public.property_expenses USING btree (expense_type);


--
-- Name: idx_property_insurance_end_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_insurance_end_date ON public.property_insurance USING btree (policy_end_date);


--
-- Name: idx_property_insurance_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_insurance_policy ON public.property_insurance USING btree (policy_number);


--
-- Name: idx_property_insurance_re_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_insurance_re_product ON public.property_insurance USING btree (real_estate_product_id);


--
-- Name: idx_property_insurance_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_insurance_start_date ON public.property_insurance USING btree (policy_start_date);


--
-- Name: idx_property_insurance_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_insurance_type ON public.property_insurance USING btree (insurance_type);


--
-- Name: idx_property_tax_rates_jurisdiction; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_tax_rates_jurisdiction ON public.property_tax_rates USING btree (jurisdiction);


--
-- Name: idx_property_tax_rates_location; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_tax_rates_location ON public.property_tax_rates USING btree (state_province, country);


--
-- Name: idx_property_tax_rates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_tax_rates_type ON public.property_tax_rates USING btree (property_type);


--
-- Name: idx_property_tax_rates_year; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_tax_rates_year ON public.property_tax_rates USING btree (tax_year);


--
-- Name: idx_property_valuations_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_valuations_date ON public.property_valuations USING btree (valuation_date);


--
-- Name: idx_property_valuations_method; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_valuations_method ON public.property_valuations USING btree (valuation_method);


--
-- Name: idx_property_valuations_re_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_property_valuations_re_product ON public.property_valuations USING btree (real_estate_product_id);


--
-- Name: idx_proposals_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_proposals_created_by ON public.multi_sig_proposals USING btree (created_by);


--
-- Name: idx_proposals_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_proposals_expires_at ON public.multi_sig_proposals USING btree (expires_at);


--
-- Name: idx_proposals_on_chain_tx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_proposals_on_chain_tx ON public.multi_sig_proposals USING btree (on_chain_tx_id);


--
-- Name: idx_proposals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_proposals_status ON public.multi_sig_proposals USING btree (status);


--
-- Name: idx_proposals_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_proposals_wallet_id ON public.multi_sig_proposals USING btree (wallet_id);


--
-- Name: idx_psp_api_keys_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_api_keys_environment ON public.psp_api_keys USING btree (environment);


--
-- Name: idx_psp_api_keys_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_api_keys_project ON public.psp_api_keys USING btree (project_id);


--
-- Name: idx_psp_api_keys_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_api_keys_status ON public.psp_api_keys USING btree (status);


--
-- Name: idx_psp_api_keys_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_api_keys_vault ON public.psp_api_keys USING btree (warp_api_key_vault_id);


--
-- Name: idx_psp_balances_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_balances_asset ON public.psp_balances USING btree (asset_symbol, network);


--
-- Name: idx_psp_balances_asset_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_balances_asset_type ON public.psp_balances USING btree (asset_type);


--
-- Name: idx_psp_balances_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_balances_project ON public.psp_balances USING btree (project_id);


--
-- Name: idx_psp_balances_virtual_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_balances_virtual_account ON public.psp_balances USING btree (virtual_account_id);


--
-- Name: idx_psp_external_accounts_account_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_external_accounts_account_vault ON public.psp_external_accounts USING btree (account_number_vault_id);


--
-- Name: idx_psp_external_accounts_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_external_accounts_project ON public.psp_external_accounts USING btree (project_id);


--
-- Name: idx_psp_external_accounts_routing_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_external_accounts_routing_vault ON public.psp_external_accounts USING btree (routing_number_vault_id);


--
-- Name: idx_psp_external_accounts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_external_accounts_status ON public.psp_external_accounts USING btree (status);


--
-- Name: idx_psp_external_accounts_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_external_accounts_type ON public.psp_external_accounts USING btree (account_type);


--
-- Name: idx_psp_identity_cases_case_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_identity_cases_case_type ON public.psp_identity_cases USING btree (case_type);


--
-- Name: idx_psp_identity_cases_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_identity_cases_project ON public.psp_identity_cases USING btree (project_id);


--
-- Name: idx_psp_identity_cases_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_identity_cases_status ON public.psp_identity_cases USING btree (status);


--
-- Name: idx_psp_identity_cases_warp_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_identity_cases_warp_id ON public.psp_identity_cases USING btree (warp_case_id);


--
-- Name: idx_psp_payment_settings_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payment_settings_project ON public.psp_payment_settings USING btree (project_id);


--
-- Name: idx_psp_payments_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_created_at ON public.psp_payments USING btree (created_at DESC);


--
-- Name: idx_psp_payments_idempotency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_idempotency ON public.psp_payments USING btree (idempotency_key);


--
-- Name: idx_psp_payments_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_project ON public.psp_payments USING btree (project_id);


--
-- Name: idx_psp_payments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_status ON public.psp_payments USING btree (status);


--
-- Name: idx_psp_payments_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_type ON public.psp_payments USING btree (payment_type);


--
-- Name: idx_psp_payments_warp_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_payments_warp_id ON public.psp_payments USING btree (warp_payment_id);


--
-- Name: idx_psp_spreads_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_spreads_active ON public.psp_fiat_crypto_spreads USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_psp_spreads_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_spreads_asset ON public.psp_fiat_crypto_spreads USING btree (crypto_asset);


--
-- Name: idx_psp_spreads_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_spreads_network ON public.psp_fiat_crypto_spreads USING btree (network);


--
-- Name: idx_psp_spreads_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_spreads_project ON public.psp_fiat_crypto_spreads USING btree (project_id);


--
-- Name: idx_psp_spreads_tier; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_spreads_tier ON public.psp_fiat_crypto_spreads USING btree (tier_min, tier_max);


--
-- Name: idx_psp_trades_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_trades_created_at ON public.psp_trades USING btree (created_at DESC);


--
-- Name: idx_psp_trades_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_trades_project ON public.psp_trades USING btree (project_id);


--
-- Name: idx_psp_trades_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_trades_status ON public.psp_trades USING btree (status);


--
-- Name: idx_psp_trades_virtual_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_trades_virtual_account ON public.psp_trades USING btree (virtual_account_id);


--
-- Name: idx_psp_trades_warp_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_trades_warp_id ON public.psp_trades USING btree (warp_trade_id);


--
-- Name: idx_psp_virtual_accounts_identity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_virtual_accounts_identity ON public.psp_virtual_accounts USING btree (identity_case_id);


--
-- Name: idx_psp_virtual_accounts_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_virtual_accounts_project ON public.psp_virtual_accounts USING btree (project_id);


--
-- Name: idx_psp_virtual_accounts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_virtual_accounts_status ON public.psp_virtual_accounts USING btree (status);


--
-- Name: idx_psp_webhook_events_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhook_events_created_at ON public.psp_webhook_events USING btree (created_at DESC);


--
-- Name: idx_psp_webhook_events_event_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhook_events_event_name ON public.psp_webhook_events USING btree (event_name);


--
-- Name: idx_psp_webhook_events_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhook_events_project ON public.psp_webhook_events USING btree (project_id);


--
-- Name: idx_psp_webhook_events_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhook_events_status ON public.psp_webhook_events USING btree (status);


--
-- Name: idx_psp_webhook_events_webhook; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhook_events_webhook ON public.psp_webhook_events USING btree (webhook_id);


--
-- Name: idx_psp_webhooks_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhooks_project ON public.psp_webhooks USING btree (project_id);


--
-- Name: idx_psp_webhooks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhooks_status ON public.psp_webhooks USING btree (status);


--
-- Name: idx_psp_webhooks_vault; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psp_webhooks_vault ON public.psp_webhooks USING btree (auth_password_vault_id);


--
-- Name: idx_quant_backtests_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_backtests_date ON public.quant_backtests USING btree (backtest_date);


--
-- Name: idx_quant_backtests_quant_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_backtests_quant_product ON public.quant_backtests USING btree (quantitative_investment_strategies_product_id);


--
-- Name: idx_quant_backtests_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_backtests_start_date ON public.quant_backtests USING btree (start_date);


--
-- Name: idx_quant_factors_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_factors_category ON public.quant_factors USING btree (factor_category);


--
-- Name: idx_quant_factors_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_factors_name ON public.quant_factors USING btree (factor_name);


--
-- Name: idx_quant_factors_quant_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_factors_quant_product ON public.quant_factors USING btree (quantitative_investment_strategies_product_id);


--
-- Name: idx_quant_performance_attribution_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_performance_attribution_period ON public.quant_performance_attribution USING btree (period_start_date, period_end_date);


--
-- Name: idx_quant_performance_attribution_quant_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_performance_attribution_quant_product ON public.quant_performance_attribution USING btree (quantitative_investment_strategies_product_id);


--
-- Name: idx_quant_risk_metrics_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_risk_metrics_date ON public.quant_risk_metrics USING btree (calculation_date);


--
-- Name: idx_quant_risk_metrics_quant_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_risk_metrics_quant_product ON public.quant_risk_metrics USING btree (quantitative_investment_strategies_product_id);


--
-- Name: idx_quant_signals_quant_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_signals_quant_product ON public.quant_signals USING btree (quantitative_investment_strategies_product_id);


--
-- Name: idx_quant_signals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_signals_status ON public.quant_signals USING btree (signal_status);


--
-- Name: idx_quant_signals_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_signals_ticker ON public.quant_signals USING btree (security_ticker);


--
-- Name: idx_quant_signals_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_signals_timestamp ON public.quant_signals USING btree (signal_timestamp);


--
-- Name: idx_quant_signals_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quant_signals_type ON public.quant_signals USING btree (signal_type);


--
-- Name: idx_quantitative_strategies_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_quantitative_strategies_project_id_unique ON public.quantitative_strategies USING btree (project_id);


--
-- Name: idx_quantitative_strategies_strategy_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_quantitative_strategies_strategy_id ON public.quantitative_strategies USING btree (strategy_id);


--
-- Name: idx_ramp_network_config_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_network_config_environment ON public.ramp_network_config USING btree (environment);


--
-- Name: idx_ramp_network_config_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_network_config_is_active ON public.ramp_network_config USING btree (is_active);


--
-- Name: idx_ramp_network_config_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_network_config_organization_id ON public.ramp_network_config USING btree (organization_id);


--
-- Name: idx_ramp_supported_assets_chain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_supported_assets_chain ON public.ramp_supported_assets USING btree (chain);


--
-- Name: idx_ramp_supported_assets_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_supported_assets_enabled ON public.ramp_supported_assets USING btree (enabled);


--
-- Name: idx_ramp_supported_assets_flow_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_supported_assets_flow_type ON public.ramp_supported_assets USING btree (flow_type);


--
-- Name: idx_ramp_supported_assets_last_updated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_supported_assets_last_updated ON public.ramp_supported_assets USING btree (last_updated DESC);


--
-- Name: idx_ramp_supported_assets_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_supported_assets_symbol ON public.ramp_supported_assets USING btree (symbol);


--
-- Name: idx_ramp_transaction_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_transaction_events_event_type ON public.ramp_transaction_events USING btree (event_type);


--
-- Name: idx_ramp_transaction_events_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_transaction_events_session_id ON public.ramp_transaction_events USING btree (session_id);


--
-- Name: idx_ramp_transaction_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_transaction_events_timestamp ON public.ramp_transaction_events USING btree ("timestamp" DESC);


--
-- Name: idx_ramp_transaction_events_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_transaction_events_transaction_id ON public.ramp_transaction_events USING btree (transaction_id);


--
-- Name: idx_ramp_webhook_events_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_webhook_events_created_at ON public.ramp_webhook_events USING btree (created_at DESC);


--
-- Name: idx_ramp_webhook_events_event_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_webhook_events_event_id ON public.ramp_webhook_events USING btree (event_id);


--
-- Name: idx_ramp_webhook_events_flow_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_webhook_events_flow_type ON public.ramp_webhook_events USING btree (flow_type);


--
-- Name: idx_ramp_webhook_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ramp_webhook_events_type ON public.ramp_webhook_events USING btree (event_type);


--
-- Name: idx_rate_history_reserve; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rate_history_reserve ON public.trade_finance_rate_history USING btree (reserve_address);


--
-- Name: idx_rate_history_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rate_history_timestamp ON public.trade_finance_rate_history USING btree (snapshot_timestamp DESC);


--
-- Name: idx_real_estate_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_real_estate_products_project_id ON public.real_estate_products USING btree (project_id);


--
-- Name: idx_real_estate_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_real_estate_products_project_id_unique ON public.real_estate_products USING btree (project_id);


--
-- Name: idx_real_estate_products_property_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_real_estate_products_property_id ON public.real_estate_products USING btree (property_id);


--
-- Name: idx_rec_price_cache_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rec_price_cache_date ON public.rec_price_cache USING btree (date);


--
-- Name: idx_rec_price_cache_market_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rec_price_cache_market_type ON public.rec_price_cache USING btree (market_type);


--
-- Name: idx_rec_price_cache_region; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rec_price_cache_region ON public.rec_price_cache USING btree (region);


--
-- Name: idx_recent_address_selections_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_recent_address_selections_unique ON public.recent_address_selections USING btree (user_id, COALESCE(project_id, '00000000-0000-0000-0000-000000000000'::uuid), lower(address));


--
-- Name: idx_recent_address_selections_user_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_recent_address_selections_user_project ON public.recent_address_selections USING btree (user_id, project_id, selected_at DESC);


--
-- Name: idx_redemption_analytics_window_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_analytics_window_id ON public.redemption_analytics USING btree (redemption_window_id);


--
-- Name: idx_redemption_approvers_approver_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_approvers_approver_id ON public.redemption_approvers USING btree (approver_id);


--
-- Name: idx_redemption_approvers_redemption_id_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_approvers_redemption_id_status ON public.redemption_approvers USING btree (redemption_id, status);


--
-- Name: idx_redemption_approvers_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_approvers_status ON public.redemption_approvers USING btree (status);


--
-- Name: idx_redemption_notifications_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_notifications_is_read ON public.redemption_notifications USING btree (is_read);


--
-- Name: idx_redemption_notifications_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_notifications_type ON public.redemption_notifications USING btree (notification_type);


--
-- Name: idx_redemption_notifications_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_notifications_user_id ON public.redemption_notifications USING btree (user_id);


--
-- Name: idx_redemption_requests_approved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_approved ON public.redemption_requests USING btree (status, updated_at) WHERE (status = 'approved'::text);


--
-- Name: idx_redemption_requests_compliance_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_compliance_status ON public.redemption_requests USING btree (compliance_status);


--
-- Name: idx_redemption_requests_pending_execution; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_pending_execution ON public.redemption_requests USING btree (status, auto_execute_transfer) WHERE ((status = 'approved'::text) AND (auto_execute_transfer = true));


--
-- Name: idx_redemption_requests_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_priority ON public.redemption_requests USING btree (priority_level);


--
-- Name: idx_redemption_requests_requested_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_requested_by ON public.redemption_requests USING btree (requested_by);


--
-- Name: idx_redemption_requests_validation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_validation ON public.redemption_requests USING btree (project_id, status, created_at);


--
-- Name: idx_redemption_requests_window_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_requests_window_id ON public.redemption_requests USING btree (redemption_window_id);


--
-- Name: idx_redemption_rules_capacity_analysis; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_capacity_analysis ON public.redemption_rules USING btree (project_id, target_raise_amount, is_redemption_open);


--
-- Name: idx_redemption_rules_continuous; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_continuous ON public.redemption_rules USING btree (allow_continuous_redemption) WHERE (allow_continuous_redemption = true);


--
-- Name: idx_redemption_rules_open_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_open_status ON public.redemption_rules USING btree (is_redemption_open, open_after_date);


--
-- Name: idx_redemption_rules_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_product_id ON public.redemption_rules USING btree (product_id) WHERE (product_id IS NOT NULL);


--
-- Name: idx_redemption_rules_product_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_product_type ON public.redemption_rules USING btree (product_type);


--
-- Name: idx_redemption_rules_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_project_id ON public.redemption_rules USING btree (project_id);


--
-- Name: idx_redemption_rules_project_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_project_product ON public.redemption_rules USING btree (project_id, product_id);


--
-- Name: idx_redemption_rules_project_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_project_product_id ON public.redemption_rules USING btree (project_id, product_id);


--
-- Name: idx_redemption_rules_project_product_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_project_product_type ON public.redemption_rules USING btree (project_id, product_type);


--
-- Name: idx_redemption_rules_rule_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_rule_id ON public.redemption_rules USING btree (rule_id);


--
-- Name: idx_redemption_rules_target_raise_amount; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_rules_target_raise_amount ON public.redemption_rules USING btree (target_raise_amount) WHERE (target_raise_amount IS NOT NULL);


--
-- Name: idx_redemption_settlements_burn_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_settlements_burn_status ON public.redemption_settlements USING btree (burn_status);


--
-- Name: idx_redemption_settlements_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_settlements_created_at ON public.redemption_settlements USING btree (created_at);


--
-- Name: idx_redemption_settlements_request_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_settlements_request_id ON public.redemption_settlements USING btree (redemption_request_id);


--
-- Name: idx_redemption_settlements_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_settlements_status ON public.redemption_settlements USING btree (status);


--
-- Name: idx_redemption_settlements_transfer_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_settlements_transfer_status ON public.redemption_settlements USING btree (transfer_status);


--
-- Name: idx_redemption_templates_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_templates_is_active ON public.redemption_window_templates USING btree (is_active);


--
-- Name: idx_redemption_templates_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_templates_project_id ON public.redemption_window_templates USING btree (project_id);


--
-- Name: idx_redemption_windows_auto_process; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_auto_process ON public.redemption_windows USING btree (auto_process);


--
-- Name: idx_redemption_windows_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_dates ON public.redemption_windows USING btree (start_date, end_date);


--
-- Name: idx_redemption_windows_enable_pro_rata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_enable_pro_rata ON public.redemption_windows USING btree (enable_pro_rata_distribution);


--
-- Name: idx_redemption_windows_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_is_active ON public.redemption_windows USING btree (is_active);


--
-- Name: idx_redemption_windows_lockup_days; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_lockup_days ON public.redemption_windows USING btree (lockup_days) WHERE (submission_date_mode = 'relative'::public.submission_date_mode_enum);


--
-- Name: idx_redemption_windows_processing_mode; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_processing_mode ON public.redemption_windows USING btree (processing_date_mode);


--
-- Name: idx_redemption_windows_processing_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_processing_status ON public.redemption_windows USING btree (processing_status);


--
-- Name: idx_redemption_windows_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_project_id ON public.redemption_windows USING btree (project_id);


--
-- Name: idx_redemption_windows_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_status ON public.redemption_windows USING btree (status);


--
-- Name: idx_redemption_windows_submission_mode; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_submission_mode ON public.redemption_windows USING btree (submission_date_mode);


--
-- Name: idx_redemption_windows_submission_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_windows_submission_status ON public.redemption_windows USING btree (submission_status);


--
-- Name: idx_regulatory_exemptions_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_regulatory_exemptions_country ON public.regulatory_exemptions USING btree (country);


--
-- Name: idx_regulatory_exemptions_exemption_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_regulatory_exemptions_exemption_type ON public.regulatory_exemptions USING btree (exemption_type);


--
-- Name: idx_regulatory_exemptions_region; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_regulatory_exemptions_region ON public.regulatory_exemptions USING btree (region);


--
-- Name: idx_regulatory_reports_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_regulatory_reports_period ON public.regulatory_reports USING btree (reporting_period_start, reporting_period_end);


--
-- Name: idx_renewable_energy_credits_incentive_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_renewable_energy_credits_incentive_id ON public.renewable_energy_credits USING btree (incentive_id);


--
-- Name: idx_renewable_energy_credits_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_renewable_energy_credits_project_id ON public.renewable_energy_credits USING btree (project_id);


--
-- Name: idx_renewable_energy_credits_receivable_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_renewable_energy_credits_receivable_id ON public.renewable_energy_credits USING btree (receivable_id) WHERE (receivable_id IS NOT NULL);


--
-- Name: INDEX idx_renewable_energy_credits_receivable_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON INDEX public.idx_renewable_energy_credits_receivable_id IS 'Performance index for RECs linked to climate receivables';


--
-- Name: idx_reserve_transactions_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reserve_transactions_token ON public.trade_finance_reserve_transactions USING btree (token_address);


--
-- Name: idx_reserve_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reserve_transactions_type ON public.trade_finance_reserve_transactions USING btree (transaction_type);


--
-- Name: idx_restriction_validation_logs_validated_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_restriction_validation_logs_validated_at ON public.restriction_validation_logs USING btree (validated_at DESC);


--
-- Name: idx_restriction_validation_logs_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_restriction_validation_logs_wallet_id ON public.restriction_validation_logs USING btree (wallet_id);


--
-- Name: idx_rewards_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rewards_config_active ON public.trade_finance_rewards_config USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_rewards_config_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rewards_config_asset ON public.trade_finance_rewards_config USING btree (asset_address);


--
-- Name: idx_rewards_config_chain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rewards_config_chain ON public.trade_finance_rewards_config USING btree (chain_id);


--
-- Name: idx_rewards_config_reward; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rewards_config_reward ON public.trade_finance_rewards_config USING btree (reward_token_address);


--
-- Name: idx_ripple_dex_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_dex_account ON public.ripple_dex_orders USING btree (account);


--
-- Name: idx_ripple_dex_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_dex_created ON public.ripple_dex_orders USING btree (created_at);


--
-- Name: idx_ripple_dex_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_dex_network ON public.ripple_dex_orders USING btree (network_type);


--
-- Name: idx_ripple_dex_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_dex_owner ON public.ripple_dex_orders USING btree (owner_id);


--
-- Name: idx_ripple_dex_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_dex_status ON public.ripple_dex_orders USING btree (status);


--
-- Name: idx_ripple_escrow_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_escrow_account ON public.ripple_escrows USING btree (account);


--
-- Name: idx_ripple_escrow_destination; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_escrow_destination ON public.ripple_escrows USING btree (destination);


--
-- Name: idx_ripple_escrow_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_escrow_network ON public.ripple_escrows USING btree (network_type);


--
-- Name: idx_ripple_escrow_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_escrow_owner ON public.ripple_escrows USING btree (owner_id);


--
-- Name: idx_ripple_escrow_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_escrow_status ON public.ripple_escrows USING btree (status);


--
-- Name: idx_ripple_issuers_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_issuers_address ON public.ripple_issuers USING btree (address);


--
-- Name: idx_ripple_issuers_domain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_issuers_domain ON public.ripple_issuers USING btree (domain);


--
-- Name: idx_ripple_issuers_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_issuers_network ON public.ripple_issuers USING btree (network_type);


--
-- Name: idx_ripple_issuers_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_issuers_verified ON public.ripple_issuers USING btree (verified);


--
-- Name: idx_ripple_multisig_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_multisig_address ON public.ripple_multisig_accounts USING btree (address);


--
-- Name: idx_ripple_multisig_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_multisig_network ON public.ripple_multisig_accounts USING btree (network_type);


--
-- Name: idx_ripple_multisig_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_multisig_owner ON public.ripple_multisig_accounts USING btree (owner_id);


--
-- Name: idx_ripple_multisig_signers; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_multisig_signers ON public.ripple_multisig_accounts USING gin (signers);


--
-- Name: idx_ripple_payments_composite; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_composite ON public.ripple_payments USING btree (from_account, status, created_at);


--
-- Name: idx_ripple_payments_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_created ON public.ripple_payments USING btree (created_at);


--
-- Name: idx_ripple_payments_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_created_at ON public.ripple_payments USING btree (created_at);


--
-- Name: idx_ripple_payments_currency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_currency ON public.ripple_payments USING btree (currency);


--
-- Name: idx_ripple_payments_from; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_from ON public.ripple_payments USING btree (from_account);


--
-- Name: idx_ripple_payments_from_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_from_account ON public.ripple_payments USING btree (from_account);


--
-- Name: idx_ripple_payments_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_hash ON public.ripple_payments USING btree (hash);


--
-- Name: idx_ripple_payments_issuer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_issuer ON public.ripple_payments USING btree (issuer);


--
-- Name: idx_ripple_payments_ledger; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_ledger ON public.ripple_payments USING btree (ledger_index);


--
-- Name: idx_ripple_payments_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_network ON public.ripple_payments USING btree (network_type);


--
-- Name: idx_ripple_payments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_status ON public.ripple_payments USING btree (status);


--
-- Name: idx_ripple_payments_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_to ON public.ripple_payments USING btree (to_account);


--
-- Name: idx_ripple_payments_to_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_payments_to_account ON public.ripple_payments USING btree (to_account);


--
-- Name: idx_ripple_proposals_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_account ON public.ripple_multisig_proposals USING btree (account);


--
-- Name: idx_ripple_proposals_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_created_by ON public.ripple_multisig_proposals USING btree (created_by);


--
-- Name: idx_ripple_proposals_execution_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_execution_hash ON public.ripple_multisig_proposals USING btree (execution_hash);


--
-- Name: idx_ripple_proposals_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_expires ON public.ripple_multisig_proposals USING btree (expires_at);


--
-- Name: idx_ripple_proposals_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_network ON public.ripple_multisig_proposals USING btree (network_type);


--
-- Name: idx_ripple_proposals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_proposals_status ON public.ripple_multisig_proposals USING btree (status);


--
-- Name: idx_ripple_tokens_currency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_tokens_currency ON public.ripple_tokens USING btree (currency);


--
-- Name: idx_ripple_tokens_issuer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_tokens_issuer ON public.ripple_tokens USING btree (issuer);


--
-- Name: idx_ripple_tokens_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_tokens_network ON public.ripple_tokens USING btree (network_type);


--
-- Name: idx_ripple_tokens_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_tokens_verified ON public.ripple_tokens USING btree (verified);


--
-- Name: idx_ripple_trust_account; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_trust_account ON public.ripple_trust_lines USING btree (account);


--
-- Name: idx_ripple_trust_currency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_trust_currency ON public.ripple_trust_lines USING btree (currency);


--
-- Name: idx_ripple_trust_issuer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_trust_issuer ON public.ripple_trust_lines USING btree (issuer);


--
-- Name: idx_ripple_trust_network; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_trust_network ON public.ripple_trust_lines USING btree (network_type);


--
-- Name: idx_ripple_trust_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ripple_trust_owner ON public.ripple_trust_lines USING btree (owner_id);


--
-- Name: idx_risk_assessments_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_assessments_user_id ON public.risk_assessments USING btree (user_id);


--
-- Name: idx_risk_assessments_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_assessments_wallet_address ON public.risk_assessments USING btree (wallet_address);


--
-- Name: idx_role_addresses_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_addresses_address ON public.role_addresses USING btree (address);


--
-- Name: idx_role_addresses_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_addresses_blockchain ON public.role_addresses USING btree (blockchain);


--
-- Name: idx_role_addresses_blockchain_address; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_role_addresses_blockchain_address ON public.role_addresses USING btree (blockchain, address);


--
-- Name: idx_role_addresses_contract_roles; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_addresses_contract_roles ON public.role_addresses USING gin (contract_roles);


--
-- Name: idx_role_addresses_role_blockchain_address; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_role_addresses_role_blockchain_address ON public.role_addresses USING btree (role_id, blockchain, address);


--
-- Name: idx_role_addresses_role_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_addresses_role_id ON public.role_addresses USING btree (role_id);


--
-- Name: idx_role_assignments_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_assignments_blockchain ON public.contract_role_assignments USING btree (blockchain);


--
-- Name: idx_role_assignments_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_assignments_contract ON public.contract_role_assignments USING btree (contract_address);


--
-- Name: idx_role_assignments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_assignments_status ON public.contract_role_assignments USING btree (status);


--
-- Name: idx_role_assignments_wallet; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_assignments_wallet ON public.contract_role_assignments USING btree (multi_sig_wallet_id);


--
-- Name: idx_rule_conflicts_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rule_conflicts_operation ON public.rule_conflicts USING btree (operation_id);


--
-- Name: idx_rule_evaluations_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rule_evaluations_created ON public.rule_evaluations USING btree (created_at);


--
-- Name: idx_rule_evaluations_operation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rule_evaluations_operation ON public.rule_evaluations USING btree (operation_id);


--
-- Name: idx_rules_is_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rules_is_template ON public.rules USING btree (is_template);


--
-- Name: idx_rules_rule_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rules_rule_id ON public.rules USING btree (rule_id);


--
-- Name: idx_sc_algorithm_parameters_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_algorithm_parameters_active ON public.sc_algorithm_parameters USING btree (is_active);


--
-- Name: idx_sc_algorithm_parameters_effective; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_algorithm_parameters_effective ON public.sc_algorithm_parameters USING btree (effective_timestamp);


--
-- Name: idx_sc_algorithm_parameters_stablecoin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_algorithm_parameters_stablecoin ON public.sc_algorithm_parameters USING btree (stablecoin_product_id);


--
-- Name: idx_sc_minting_events_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_minting_events_id ON public.sc_minting_events USING btree (mint_id);


--
-- Name: idx_sc_minting_events_minter; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_minting_events_minter ON public.sc_minting_events USING btree (minter_address);


--
-- Name: idx_sc_minting_events_stablecoin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_minting_events_stablecoin ON public.sc_minting_events USING btree (stablecoin_product_id);


--
-- Name: idx_sc_minting_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_minting_events_timestamp ON public.sc_minting_events USING btree (mint_timestamp);


--
-- Name: idx_sc_minting_events_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_minting_events_tx_hash ON public.sc_minting_events USING btree (transaction_hash);


--
-- Name: idx_sc_peg_history_deviation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_peg_history_deviation ON public.sc_peg_history USING btree (deviation_percentage);


--
-- Name: idx_sc_peg_history_stablecoin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_peg_history_stablecoin ON public.sc_peg_history USING btree (stablecoin_product_id);


--
-- Name: idx_sc_peg_history_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_peg_history_timestamp ON public.sc_peg_history USING btree ("timestamp");


--
-- Name: idx_sc_redemptions_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_redemptions_id ON public.sc_redemptions USING btree (redemption_id);


--
-- Name: idx_sc_redemptions_requester; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_redemptions_requester ON public.sc_redemptions USING btree (requester_address);


--
-- Name: idx_sc_redemptions_stablecoin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_redemptions_stablecoin ON public.sc_redemptions USING btree (stablecoin_product_id);


--
-- Name: idx_sc_redemptions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_redemptions_status ON public.sc_redemptions USING btree (status);


--
-- Name: idx_sc_redemptions_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_redemptions_timestamp ON public.sc_redemptions USING btree (request_timestamp);


--
-- Name: idx_sc_reserve_audits_auditor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_reserve_audits_auditor ON public.sc_reserve_audits USING btree (auditor_name);


--
-- Name: idx_sc_reserve_audits_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_reserve_audits_date ON public.sc_reserve_audits USING btree (audit_date);


--
-- Name: idx_sc_reserve_audits_stablecoin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sc_reserve_audits_stablecoin ON public.sc_reserve_audits USING btree (stablecoin_product_id);


--
-- Name: idx_seasonal_multipliers_commodity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_seasonal_multipliers_commodity ON public.trade_finance_seasonal_multipliers USING btree (commodity_type);


--
-- Name: idx_security_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_audit_logs_user_id ON public.security_audit_logs USING btree (user_id);


--
-- Name: idx_security_audit_logs_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_audit_logs_wallet_address ON public.security_audit_logs USING btree (wallet_address);


--
-- Name: idx_security_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_event_type ON public.security_events USING btree (event_type);


--
-- Name: idx_security_events_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_severity ON public.security_events USING btree (severity);


--
-- Name: idx_security_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_timestamp ON public.security_events USING btree ("timestamp" DESC);


--
-- Name: idx_security_events_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_user_id ON public.security_events USING btree (user_id);


--
-- Name: idx_security_events_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_wallet_address ON public.security_events USING btree (wallet_address);


--
-- Name: idx_security_events_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_security_events_wallet_id ON public.security_events USING btree (wallet_id);


--
-- Name: idx_session_key_usage_session_key_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_session_key_usage_session_key_id ON public.session_key_usage USING btree (session_key_id);


--
-- Name: idx_session_keys_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_session_keys_status ON public.session_keys USING btree (status);


--
-- Name: idx_session_keys_validity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_session_keys_validity ON public.session_keys USING btree (validity_start, validity_end);


--
-- Name: idx_session_keys_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_session_keys_wallet_id ON public.session_keys USING btree (wallet_id);


--
-- Name: idx_settlement_metrics_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settlement_metrics_date ON public.settlement_metrics USING btree (date DESC);


--
-- Name: idx_settlement_ops_redemption; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settlement_ops_redemption ON public.settlement_operations USING btree (redemption_id);


--
-- Name: idx_settlement_ops_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settlement_ops_status ON public.settlement_operations USING btree (status) WHERE (status = ANY (ARRAY['pending'::text, 'confirming'::text]));


--
-- Name: idx_settlement_ops_token_transfer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settlement_ops_token_transfer ON public.settlement_operations USING btree (token_transfer_id);


--
-- Name: idx_sidebar_configs_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_configs_active ON public.sidebar_configurations USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_sidebar_configs_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_configs_default ON public.sidebar_configurations USING btree (is_default) WHERE (is_default = true);


--
-- Name: idx_sidebar_configs_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_configs_org ON public.sidebar_configurations USING btree (organization_id);


--
-- Name: idx_sidebar_configs_profile_enums; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_configs_profile_enums ON public.sidebar_configurations USING gin (target_profile_type_enums);


--
-- Name: idx_sidebar_configs_role_ids; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_configs_role_ids ON public.sidebar_configurations USING gin (target_role_ids);


--
-- Name: idx_sidebar_items_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_active ON public.sidebar_items USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_sidebar_items_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_order ON public.sidebar_items USING btree (display_order);


--
-- Name: idx_sidebar_items_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_org ON public.sidebar_items USING btree (organization_id);


--
-- Name: idx_sidebar_items_permissions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_permissions ON public.sidebar_items USING gin (required_permissions);


--
-- Name: idx_sidebar_items_roles; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_roles ON public.sidebar_items USING gin (required_roles);


--
-- Name: idx_sidebar_items_section; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_items_section ON public.sidebar_items USING btree (section_id);


--
-- Name: idx_sidebar_sections_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_sections_active ON public.sidebar_sections USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_sidebar_sections_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_sections_order ON public.sidebar_sections USING btree (display_order);


--
-- Name: idx_sidebar_sections_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sidebar_sections_org ON public.sidebar_sections USING btree (organization_id);


--
-- Name: idx_signature_migration_approvals_migration_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signature_migration_approvals_migration_id ON public.signature_migration_approvals USING btree (migration_id);


--
-- Name: idx_signature_migrations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signature_migrations_created_at ON public.signature_migrations USING btree (created_at DESC);


--
-- Name: idx_signature_migrations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signature_migrations_status ON public.signature_migrations USING btree (status);


--
-- Name: idx_signature_migrations_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signature_migrations_wallet_id ON public.signature_migrations USING btree (wallet_id);


--
-- Name: idx_signatures_is_valid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signatures_is_valid ON public.proposal_signatures USING btree (is_valid) WHERE (is_valid = true);


--
-- Name: idx_signatures_proposal_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signatures_proposal_id ON public.proposal_signatures USING btree (proposal_id);


--
-- Name: idx_signatures_signer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signatures_signer ON public.proposal_signatures USING btree (signer_address);


--
-- Name: idx_signer_keys_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signer_keys_address ON public.signer_keys USING btree (address);


--
-- Name: idx_signer_keys_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_signer_keys_user_id ON public.signer_keys USING btree (user_id);


--
-- Name: idx_smart_contract_wallets_proxy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_smart_contract_wallets_proxy ON public.smart_contract_wallets USING btree (diamond_proxy_address);


--
-- Name: idx_smart_contract_wallets_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_smart_contract_wallets_wallet_id ON public.smart_contract_wallets USING btree (wallet_id);


--
-- Name: idx_snapshots_asset_reward; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_snapshots_asset_reward ON public.trade_finance_rewards_snapshots USING btree (asset_address, reward_token_address);


--
-- Name: idx_snapshots_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_snapshots_timestamp ON public.trade_finance_rewards_snapshots USING btree (snapshot_timestamp);


--
-- Name: idx_sp_barrier_events_breach; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_barrier_events_breach ON public.sp_barrier_events USING btree (breach_detected);


--
-- Name: idx_sp_barrier_events_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_barrier_events_sp_product ON public.sp_barrier_events USING btree (structured_product_id);


--
-- Name: idx_sp_barrier_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_barrier_events_timestamp ON public.sp_barrier_events USING btree (event_timestamp);


--
-- Name: idx_sp_barrier_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_barrier_events_type ON public.sp_barrier_events USING btree (barrier_type);


--
-- Name: idx_sp_components_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_components_sp_product ON public.sp_components USING btree (structured_product_id);


--
-- Name: idx_sp_components_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_components_ticker ON public.sp_components USING btree (underlying_ticker);


--
-- Name: idx_sp_components_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_components_type ON public.sp_components USING btree (component_type);


--
-- Name: idx_sp_coupon_schedules_observation_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_coupon_schedules_observation_date ON public.sp_coupon_schedules USING btree (observation_date);


--
-- Name: idx_sp_coupon_schedules_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_coupon_schedules_payment_date ON public.sp_coupon_schedules USING btree (payment_date);


--
-- Name: idx_sp_coupon_schedules_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_coupon_schedules_sp_product ON public.sp_coupon_schedules USING btree (structured_product_id);


--
-- Name: idx_sp_coupon_schedules_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_coupon_schedules_status ON public.sp_coupon_schedules USING btree (payment_status);


--
-- Name: idx_sp_payoff_structures_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_payoff_structures_sp_product ON public.sp_payoff_structures USING btree (structured_product_id);


--
-- Name: idx_sp_payoff_structures_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_payoff_structures_type ON public.sp_payoff_structures USING btree (structure_type);


--
-- Name: idx_sp_performance_tracking_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_performance_tracking_date ON public.sp_performance_tracking USING btree (valuation_date);


--
-- Name: idx_sp_performance_tracking_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_performance_tracking_sp_product ON public.sp_performance_tracking USING btree (structured_product_id);


--
-- Name: idx_sp_redemption_features_effective_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_redemption_features_effective_date ON public.sp_redemption_features USING btree (effective_date);


--
-- Name: idx_sp_redemption_features_sp_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_redemption_features_sp_product ON public.sp_redemption_features USING btree (structured_product_id);


--
-- Name: idx_sp_redemption_features_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_redemption_features_status ON public.sp_redemption_features USING btree (redemption_status);


--
-- Name: idx_sp_redemption_features_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sp_redemption_features_type ON public.sp_redemption_features USING btree (feature_type);


--
-- Name: idx_stablecoin_collateral_coin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stablecoin_collateral_coin ON public.stablecoin_collateral USING btree (stablecoin_id);


--
-- Name: idx_stablecoin_collateral_stablecoin_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stablecoin_collateral_stablecoin_id ON public.stablecoin_collateral USING btree (stablecoin_id);


--
-- Name: idx_stablecoin_collateral_value; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stablecoin_collateral_value ON public.stablecoin_collateral USING btree (stablecoin_id, collateral_value_usd DESC);


--
-- Name: idx_stablecoin_products_asset_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stablecoin_products_asset_symbol ON public.stablecoin_products USING btree (asset_symbol);


--
-- Name: idx_stablecoin_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_stablecoin_products_project_id_unique ON public.stablecoin_products USING btree (project_id);


--
-- Name: idx_staking_apr_config_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staking_apr_config_blockchain ON public.staking_apr_config USING btree (blockchain);


--
-- Name: idx_stata_operations_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stata_operations_token ON public.trade_finance_stata_operations USING btree (stata_token_address);


--
-- Name: idx_stata_operations_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stata_operations_user ON public.trade_finance_stata_operations USING btree (user_address);


--
-- Name: idx_stata_tokens_ctoken; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stata_tokens_ctoken ON public.trade_finance_stata_tokens USING btree (ctoken_address);


--
-- Name: idx_stock_dividends_equity_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_dividends_equity_product ON public.stock_dividends USING btree (equity_product_id);


--
-- Name: idx_stock_dividends_ex_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_dividends_ex_date ON public.stock_dividends USING btree (ex_dividend_date);


--
-- Name: idx_stock_dividends_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_dividends_payment_date ON public.stock_dividends USING btree (payment_date);


--
-- Name: idx_stock_dividends_ticker; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_dividends_ticker ON public.stock_dividends USING btree (ticker_symbol);


--
-- Name: idx_stock_exchanges_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_exchanges_code ON public.stock_exchanges USING btree (exchange_code);


--
-- Name: idx_stock_exchanges_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stock_exchanges_country ON public.stock_exchanges USING btree (country);


--
-- Name: idx_stream_withdrawals_stream; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stream_withdrawals_stream ON public.trade_finance_stream_withdrawals USING btree (stream_id);


--
-- Name: idx_stripe_conversion_transactions_payment_intent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_conversion_transactions_payment_intent ON public.stripe_conversion_transactions USING btree (stripe_payment_intent_id);


--
-- Name: idx_stripe_conversion_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_conversion_transactions_status ON public.stripe_conversion_transactions USING btree (status);


--
-- Name: idx_stripe_conversion_transactions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_conversion_transactions_type ON public.stripe_conversion_transactions USING btree (conversion_type);


--
-- Name: idx_stripe_conversion_transactions_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_conversion_transactions_user_id ON public.stripe_conversion_transactions USING btree (user_id);


--
-- Name: idx_stripe_stablecoin_accounts_account_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_stablecoin_accounts_account_id ON public.stripe_stablecoin_accounts USING btree (account_id);


--
-- Name: idx_stripe_stablecoin_accounts_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_stablecoin_accounts_user_id ON public.stripe_stablecoin_accounts USING btree (user_id);


--
-- Name: idx_stripe_webhook_events_processed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_webhook_events_processed ON public.stripe_webhook_events USING btree (processed);


--
-- Name: idx_stripe_webhook_events_stripe_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_webhook_events_stripe_id ON public.stripe_webhook_events USING btree (stripe_event_id);


--
-- Name: idx_stripe_webhook_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_stripe_webhook_events_type ON public.stripe_webhook_events USING btree (event_type);


--
-- Name: idx_structured_products_maturity_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_structured_products_maturity_date ON public.structured_products USING btree (maturity_date);


--
-- Name: idx_structured_products_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_structured_products_project_id ON public.structured_products USING btree (project_id);


--
-- Name: idx_structured_products_project_id_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_structured_products_project_id_unique ON public.structured_products USING btree (project_id);


--
-- Name: idx_structured_products_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_structured_products_status ON public.structured_products USING btree (status);


--
-- Name: idx_subscriptions_product; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptions_product ON public.subscriptions USING btree (product_id);


--
-- Name: idx_subscriptions_product_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptions_product_project ON public.subscriptions USING btree (product_id, project_id) WHERE (product_id IS NOT NULL);


--
-- Name: idx_subscriptions_transaction_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptions_transaction_type ON public.subscriptions USING btree (transaction_type);


--
-- Name: idx_suspicious_reports_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_suspicious_reports_status ON public.suspicious_activity_reports USING btree (status, filed_at);


--
-- Name: idx_system_processes_process_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_processes_process_name ON public.system_processes USING btree (process_name);


--
-- Name: idx_system_processes_start_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_processes_start_time ON public.system_processes USING btree (start_time DESC);


--
-- Name: idx_system_processes_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_processes_status ON public.system_processes USING btree (status);


--
-- Name: idx_token_allocations_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_allocations_token_id ON public.token_allocations USING btree (token_id);


--
-- Name: idx_token_climate_properties_pool; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_climate_properties_pool ON public.token_climate_properties USING btree (pool_id);


--
-- Name: idx_token_deployment_history_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployment_history_project_id ON public.token_deployment_history USING btree (project_id);


--
-- Name: idx_token_deployment_history_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployment_history_status ON public.token_deployment_history USING btree (status);


--
-- Name: idx_token_deployment_history_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployment_history_timestamp ON public.token_deployment_history USING btree ("timestamp");


--
-- Name: idx_token_deployment_history_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployment_history_token_id ON public.token_deployment_history USING btree (token_id);


--
-- Name: idx_token_deployments_source_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployments_source_verified ON public.token_deployments USING btree (source_verified);


--
-- Name: idx_token_deployments_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_deployments_token_id ON public.token_deployments USING btree (token_id);


--
-- Name: idx_token_erc1155_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1155_properties_initial_owner ON public.token_erc1155_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc1155_types_fungibility_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1155_types_fungibility_type ON public.token_erc1155_types USING btree (fungibility_type);


--
-- Name: idx_token_erc1155_types_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1155_types_token_id ON public.token_erc1155_types USING btree (token_id);


--
-- Name: idx_token_erc1155_whitelist_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1155_whitelist_enabled ON public.token_erc1155_properties USING gin (((whitelist_config -> 'enabled'::text))) WHERE ((whitelist_config -> 'enabled'::text) = 'true'::jsonb);


--
-- Name: idx_token_erc1400_controllers_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1400_controllers_token_id ON public.token_erc1400_controllers USING btree (token_id);


--
-- Name: idx_token_erc1400_documents_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1400_documents_token_id ON public.token_erc1400_documents USING btree (token_id);


--
-- Name: idx_token_erc1400_partitions_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1400_partitions_token_id ON public.token_erc1400_partitions USING btree (token_id);


--
-- Name: idx_token_erc1400_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1400_properties_initial_owner ON public.token_erc1400_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc1400_whitelist_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc1400_whitelist_enabled ON public.token_erc1400_properties USING btree (investor_whitelist_enabled) WHERE (investor_whitelist_enabled = true);


--
-- Name: idx_token_erc20_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc20_properties_initial_owner ON public.token_erc20_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc3525_allocations_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc3525_allocations_token_id ON public.token_erc3525_allocations USING btree (token_id);


--
-- Name: idx_token_erc3525_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc3525_properties_initial_owner ON public.token_erc3525_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc3525_properties_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc3525_properties_token_id ON public.token_erc3525_properties USING btree (token_id);


--
-- Name: idx_token_erc3525_slots_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc3525_slots_token_id ON public.token_erc3525_slots USING btree (token_id);


--
-- Name: idx_token_erc3525_whitelist_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc3525_whitelist_enabled ON public.token_erc3525_properties USING gin (((whitelist_config -> 'enabled'::text))) WHERE ((whitelist_config -> 'enabled'::text) = 'true'::jsonb);


--
-- Name: idx_token_erc4626_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc4626_properties_initial_owner ON public.token_erc4626_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc4626_whitelist_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc4626_whitelist_enabled ON public.token_erc4626_properties USING gin (((whitelist_config -> 'enabled'::text))) WHERE ((whitelist_config -> 'enabled'::text) = 'true'::jsonb);


--
-- Name: idx_token_erc721_attributes_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc721_attributes_token_id ON public.token_erc721_attributes USING btree (token_id);


--
-- Name: idx_token_erc721_properties_initial_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc721_properties_initial_owner ON public.token_erc721_properties USING btree (initial_owner) WHERE (initial_owner IS NOT NULL);


--
-- Name: idx_token_erc721_whitelist_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_erc721_whitelist_enabled ON public.token_erc721_properties USING gin (((whitelist_config -> 'enabled'::text))) WHERE ((whitelist_config -> 'enabled'::text) = 'true'::jsonb);


--
-- Name: idx_token_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_events_event_type ON public.token_events USING btree (event_type);


--
-- Name: idx_token_events_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_events_is_read ON public.token_events USING btree (is_read);


--
-- Name: idx_token_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_events_timestamp ON public.token_events USING btree ("timestamp");


--
-- Name: idx_token_events_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_events_token_id ON public.token_events USING btree (token_id);


--
-- Name: idx_token_extensions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_extensions_active ON public.token_extensions USING btree (token_id, extension_type, is_active) WHERE (is_active = true);


--
-- Name: idx_token_extensions_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_extensions_token ON public.token_extensions USING btree (token_id);


--
-- Name: idx_token_extensions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_extensions_type ON public.token_extensions USING btree (extension_type);


--
-- Name: idx_token_modules_attached_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_attached_at ON public.token_modules USING btree (attached_at);


--
-- Name: idx_token_modules_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_is_active ON public.token_modules USING btree (is_active);


--
-- Name: idx_token_modules_module_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_module_address ON public.token_modules USING btree (module_address);


--
-- Name: idx_token_modules_module_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_module_type ON public.token_modules USING btree (module_type);


--
-- Name: idx_token_modules_source_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_source_verified ON public.token_modules USING btree (source_verified);


--
-- Name: idx_token_modules_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_modules_token_id ON public.token_modules USING btree (token_id);


--
-- Name: idx_token_operations_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_operations_token_id ON public.token_operations USING btree (token_id);


--
-- Name: idx_token_verifications_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_verifications_status ON public.token_deployment_verifications USING btree (verification_status);


--
-- Name: idx_token_verifications_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_verifications_token ON public.token_deployment_verifications USING btree (token_id);


--
-- Name: idx_token_versions_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_versions_token_id ON public.token_versions USING btree (token_id);


--
-- Name: idx_token_versions_token_id_version; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_versions_token_id_version ON public.token_versions USING btree (token_id, version);


--
-- Name: idx_token_whitelists_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_whitelists_active ON public.token_whitelists USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_token_whitelists_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_whitelists_blockchain ON public.token_whitelists USING btree (blockchain);


--
-- Name: idx_token_whitelists_token_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_whitelists_token_id ON public.token_whitelists USING btree (token_id);


--
-- Name: idx_token_whitelists_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_token_whitelists_wallet_address ON public.token_whitelists USING btree (wallet_address);


--
-- Name: idx_tokens_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_blockchain ON public.tokens USING btree (blockchain);


--
-- Name: idx_tokens_deployment_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_deployment_status ON public.tokens USING btree (deployment_status);


--
-- Name: idx_tokens_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_product_id ON public.tokens USING btree (product_id) WHERE (product_id IS NOT NULL);


--
-- Name: idx_tokens_product_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_product_type ON public.tokens USING btree (product_type);


--
-- Name: idx_tokens_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_project_id ON public.tokens USING btree (project_id);


--
-- Name: idx_tokens_standard; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_standard ON public.tokens USING btree (standard);


--
-- Name: idx_tokens_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tokens_status ON public.tokens USING btree (status);


--
-- Name: idx_transaction_events_actor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_events_actor ON public.transaction_events USING btree (actor);


--
-- Name: idx_transaction_events_event_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_events_event_type ON public.transaction_events USING btree (event_type);


--
-- Name: idx_transaction_events_request_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_events_request_id ON public.transaction_events USING btree (request_id);


--
-- Name: idx_transaction_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_events_timestamp ON public.transaction_events USING btree ("timestamp");


--
-- Name: idx_transaction_notifications_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_notifications_read ON public.transaction_notifications USING btree (read);


--
-- Name: idx_transaction_notifications_transaction; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_notifications_transaction ON public.transaction_notifications USING btree (transaction_id);


--
-- Name: idx_transaction_notifications_wallet; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_notifications_wallet ON public.transaction_notifications USING btree (wallet_address);


--
-- Name: idx_transaction_signatures_proposal_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_signatures_proposal_id ON public.transaction_signatures USING btree (proposal_id);


--
-- Name: idx_transaction_signatures_signer_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_signatures_signer_address ON public.transaction_signatures USING btree (signer_address);


--
-- Name: idx_transactions_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_blockchain ON public.transactions USING btree (blockchain);


--
-- Name: idx_transactions_composite; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_composite ON public.transactions USING btree (from_address, status, created_at);


--
-- Name: idx_transactions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_created_at ON public.transactions USING btree (created_at);


--
-- Name: idx_transactions_from_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_from_address ON public.transactions USING btree (from_address);


--
-- Name: idx_transactions_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_hash ON public.transactions USING btree (transaction_hash);


--
-- Name: idx_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_status ON public.transactions USING btree (status);


--
-- Name: idx_transactions_to_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_to_address ON public.transactions USING btree (to_address);


--
-- Name: idx_transfer_ops_redemption; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transfer_ops_redemption ON public.transfer_operations USING btree (redemption_id);


--
-- Name: idx_transfer_ops_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transfer_ops_status ON public.transfer_operations USING btree (status) WHERE (status = ANY (ARRAY['pending'::text, 'confirming'::text]));


--
-- Name: idx_transfer_ops_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transfer_ops_tx_hash ON public.transfer_operations USING btree (transaction_hash) WHERE (transaction_hash IS NOT NULL);


--
-- Name: idx_treasury_snapshots_token_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_treasury_snapshots_token_date ON public.trade_finance_treasury_snapshots USING btree (token_address, snapshot_date);


--
-- Name: idx_user_addresses_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_addresses_active ON public.user_addresses USING btree (is_active);


--
-- Name: idx_user_addresses_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_addresses_blockchain ON public.user_addresses USING btree (blockchain);


--
-- Name: idx_user_addresses_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_addresses_user_id ON public.user_addresses USING btree (user_id);


--
-- Name: idx_user_contract_roles_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_contract_roles_user_id ON public.user_contract_roles USING btree (user_id);


--
-- Name: idx_user_mfa_settings_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_mfa_settings_user_id ON public.user_mfa_settings USING btree (user_id);


--
-- Name: idx_user_operations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_created_at ON public.user_operations USING btree (created_at);


--
-- Name: idx_user_operations_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_hash ON public.user_operations USING btree (user_op_hash);


--
-- Name: idx_user_operations_sender; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_sender ON public.user_operations USING btree (sender_address);


--
-- Name: idx_user_operations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_status ON public.user_operations USING btree (status);


--
-- Name: idx_user_operations_status_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_status_created ON public.user_operations USING btree (status, created_at);


--
-- Name: idx_user_operations_transaction_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_transaction_hash ON public.user_operations USING btree (transaction_hash);


--
-- Name: idx_user_operations_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_wallet_id ON public.user_operations USING btree (wallet_id);


--
-- Name: idx_user_operations_wallet_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_operations_wallet_status ON public.user_operations USING btree (wallet_id, status);


--
-- Name: idx_user_organization_roles_org_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_organization_roles_org_id ON public.user_organization_roles USING btree (organization_id);


--
-- Name: idx_user_organization_roles_role_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_organization_roles_role_id ON public.user_organization_roles USING btree (role_id);


--
-- Name: idx_user_organization_roles_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_organization_roles_user_id ON public.user_organization_roles USING btree (user_id);


--
-- Name: idx_user_rewards_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_rewards_asset ON public.trade_finance_user_rewards USING btree (asset_address);


--
-- Name: idx_user_rewards_chain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_rewards_chain ON public.trade_finance_user_rewards USING btree (chain_id);


--
-- Name: idx_user_rewards_reward; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_rewards_reward ON public.trade_finance_user_rewards USING btree (reward_token_address);


--
-- Name: idx_user_rewards_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_rewards_user ON public.trade_finance_user_rewards USING btree (user_address);


--
-- Name: idx_user_sidebar_prefs_org; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_sidebar_prefs_org ON public.user_sidebar_preferences USING btree (organization_id);


--
-- Name: idx_user_sidebar_prefs_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_sidebar_prefs_user ON public.user_sidebar_preferences USING btree (user_id);


--
-- Name: idx_validations_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_validations_created ON public.transaction_validations USING btree (created_at);


--
-- Name: idx_validations_from; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_validations_from ON public.transaction_validations USING btree (from_address);


--
-- Name: idx_valuation_token_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_valuation_token_period ON public.valuation_price_history USING btree (token_id, period_start DESC);


--
-- Name: idx_violation_patterns_detected; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_patterns_detected ON public.violation_patterns USING btree (detected_at DESC);


--
-- Name: idx_violation_patterns_operator; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_patterns_operator ON public.violation_patterns USING btree (operator, pattern_type);


--
-- Name: idx_wallet_access_logs_accessed_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_access_logs_accessed_by ON public.wallet_access_logs USING btree (accessed_by);


--
-- Name: idx_wallet_access_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_access_logs_action ON public.wallet_access_logs USING btree (action);


--
-- Name: idx_wallet_access_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_access_logs_created_at ON public.wallet_access_logs USING btree (created_at DESC);


--
-- Name: idx_wallet_access_logs_success; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_access_logs_success ON public.wallet_access_logs USING btree (success);


--
-- Name: idx_wallet_access_logs_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_access_logs_wallet_id ON public.wallet_access_logs USING btree (wallet_id);


--
-- Name: idx_wallet_facets_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_facets_address ON public.wallet_facets USING btree (facet_address);


--
-- Name: idx_wallet_facets_selectors; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_facets_selectors ON public.wallet_facets USING gin (function_selectors);


--
-- Name: idx_wallet_facets_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_facets_wallet_id ON public.wallet_facets USING btree (wallet_id);


--
-- Name: idx_wallet_guardians_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_guardians_address ON public.wallet_guardians USING btree (guardian_address);


--
-- Name: idx_wallet_guardians_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_guardians_status ON public.wallet_guardians USING btree (status);


--
-- Name: idx_wallet_guardians_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_guardians_wallet_id ON public.wallet_guardians USING btree (wallet_id);


--
-- Name: idx_wallet_locks_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_locks_active ON public.wallet_locks USING btree (wallet_id, is_locked) WHERE (is_locked = true);


--
-- Name: idx_wallet_locks_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_locks_created_at ON public.wallet_locks USING btree (created_at DESC);


--
-- Name: idx_wallet_locks_unlock_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_locks_unlock_time ON public.wallet_locks USING btree (unlock_time) WHERE ((unlock_time IS NOT NULL) AND (is_locked = true));


--
-- Name: idx_wallet_locks_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_locks_wallet_id ON public.wallet_locks USING btree (wallet_id);


--
-- Name: idx_wallet_owners_role_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_owners_role_id ON public.multi_sig_wallet_owners USING btree (role_id);


--
-- Name: idx_wallet_owners_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_owners_user_id ON public.multi_sig_wallet_owners USING btree (user_id);


--
-- Name: idx_wallet_owners_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_owners_wallet_id ON public.multi_sig_wallet_owners USING btree (wallet_id);


--
-- Name: idx_wallet_restriction_rules_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_restriction_rules_active ON public.wallet_restriction_rules USING btree (wallet_id, is_active) WHERE (is_active = true);


--
-- Name: idx_wallet_restriction_rules_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_restriction_rules_priority ON public.wallet_restriction_rules USING btree (wallet_id, priority);


--
-- Name: idx_wallet_restriction_rules_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_restriction_rules_wallet_id ON public.wallet_restriction_rules USING btree (wallet_id);


--
-- Name: idx_wallet_signatories_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_signatories_status ON public.wallet_signatories USING btree (status);


--
-- Name: idx_wallet_signatories_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_signatories_wallet_address ON public.wallet_signatories USING btree (wallet_address);


--
-- Name: idx_wallet_transaction_drafts_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transaction_drafts_expires_at ON public.wallet_transaction_drafts USING btree (expires_at);


--
-- Name: idx_wallet_transaction_drafts_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transaction_drafts_transaction_id ON public.wallet_transaction_drafts USING btree (transaction_id);


--
-- Name: idx_wallet_transaction_drafts_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transaction_drafts_wallet_id ON public.wallet_transaction_drafts USING btree (wallet_id);


--
-- Name: idx_wallet_transactions_blockchain; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_blockchain ON public.wallet_transactions USING btree (blockchain);


--
-- Name: idx_wallet_transactions_from_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_from_address ON public.wallet_transactions USING btree (from_address);


--
-- Name: idx_wallet_transactions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_status ON public.wallet_transactions USING btree (status);


--
-- Name: idx_wallet_transactions_transaction_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_transaction_hash ON public.wallet_transactions USING btree (transaction_hash);


--
-- Name: idx_wallet_transactions_tx_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_tx_hash ON public.wallet_transactions USING btree (tx_hash);


--
-- Name: idx_wallet_transactions_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallet_transactions_wallet_id ON public.wallet_transactions USING btree (wallet_id);


--
-- Name: idx_wallets_investor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_investor_id ON public.wallets USING btree (investor_id);


--
-- Name: idx_wallets_mnemonic_vault_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_mnemonic_vault_id ON public.wallets USING btree (mnemonic_vault_id);


--
-- Name: idx_wallets_private_key_vault_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_private_key_vault_id ON public.wallets USING btree (private_key_vault_id);


--
-- Name: idx_wallets_public_key_vault_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_public_key_vault_id ON public.wallets USING btree (public_key_vault_id);


--
-- Name: idx_wallets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_status ON public.wallets USING btree (status);


--
-- Name: idx_wallets_wallet_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_wallet_address ON public.wallets USING btree (wallet_address);


--
-- Name: idx_wallets_wallet_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_wallets_wallet_type ON public.wallets USING btree (wallet_type);


--
-- Name: idx_weather_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_weather_cache_expires ON public.weather_cache USING btree (expires_at);


--
-- Name: idx_weather_cache_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_weather_cache_key ON public.weather_cache USING btree (cache_key);


--
-- Name: idx_weather_cache_location; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_weather_cache_location ON public.weather_cache USING btree (location_lat, location_lon);


--
-- Name: idx_webauthn_challenges_challenge; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webauthn_challenges_challenge ON public.webauthn_challenges USING btree (challenge);


--
-- Name: idx_webauthn_challenges_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webauthn_challenges_expires ON public.webauthn_challenges USING btree (expires_at);


--
-- Name: idx_webauthn_challenges_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webauthn_challenges_wallet_id ON public.webauthn_challenges USING btree (wallet_id);


--
-- Name: idx_webauthn_credentials_credential_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webauthn_credentials_credential_id ON public.webauthn_credentials USING btree (credential_id);


--
-- Name: idx_webauthn_credentials_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_webauthn_credentials_unique ON public.webauthn_credentials USING btree (wallet_id, credential_id);


--
-- Name: idx_webauthn_credentials_wallet_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webauthn_credentials_wallet_id ON public.webauthn_credentials USING btree (wallet_id);


--
-- Name: idx_whitelist_entries_address; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_whitelist_entries_address ON public.whitelist_entries USING btree (address);


--
-- Name: idx_whitelist_entries_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_whitelist_entries_organization_id ON public.whitelist_entries USING btree (organization_id);


--
-- Name: multi_sig_wallets_blockchain_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX multi_sig_wallets_blockchain_idx ON public.multi_sig_wallets USING btree (blockchain);


--
-- Name: profiles_profile_type_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX profiles_profile_type_idx ON public.profiles USING btree (profile_type);


--
-- Name: profiles_user_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX profiles_user_id_idx ON public.profiles USING btree (user_id);


--
-- Name: redemption_rules_standard_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX redemption_rules_standard_unique ON public.redemption_rules USING btree (project_id) WHERE (redemption_type = 'standard'::text);


--
-- Name: users_auth_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX users_auth_id_idx ON public.users USING btree (auth_id);


--
-- Name: crypto_etf_holdings_summary _RETURN; Type: RULE; Schema: public; Owner: -
--

CREATE OR REPLACE VIEW public.crypto_etf_holdings_summary AS
 SELECT fp.id AS fund_product_id,
    fp.fund_ticker,
    fp.fund_name,
    h.blockchain,
    count(DISTINCT h.id) AS num_holdings,
    sum(h.market_value) AS total_value,
    ((sum(h.market_value) / NULLIF(fp.assets_under_management, (0)::numeric)) * (100)::numeric) AS percentage_of_aum,
    count(*) FILTER (WHERE h.is_staked) AS num_staked_holdings,
    sum(h.staking_rewards_accrued) AS total_staking_rewards,
    avg(h.staking_apr) FILTER (WHERE h.is_staked) AS avg_staking_apr,
    h.as_of_date
   FROM ((public.fund_products fp
     JOIN public.etf_metadata em ON ((fp.id = em.fund_product_id)))
     JOIN public.etf_holdings h ON ((fp.id = h.fund_product_id)))
  WHERE ((em.is_crypto_etf = true) AND ((h.security_type)::text = 'crypto'::text) AND ((h.status)::text = 'active'::text))
  GROUP BY fp.id, fp.fund_ticker, fp.fund_name, h.blockchain, h.as_of_date
  ORDER BY fp.fund_ticker, h.blockchain;


--
-- Name: distribution_redemptions after_distribution_redemption_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER after_distribution_redemption_insert AFTER INSERT ON public.distribution_redemptions FOR EACH ROW EXECUTE FUNCTION public.update_distribution_remaining_amount();


--
-- Name: token_allocations after_token_allocation_distributed; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER after_token_allocation_distributed AFTER UPDATE ON public.token_allocations FOR EACH ROW WHEN (((old.distributed = false) AND (new.distributed = true))) EXECUTE FUNCTION public.handle_token_distribution();


--
-- Name: token_allocations before_token_allocation_delete; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER before_token_allocation_delete BEFORE DELETE ON public.token_allocations FOR EACH ROW EXECUTE FUNCTION public.handle_token_allocation_deletion();


--
-- Name: blackout_periods blackout_periods_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER blackout_periods_updated_at BEFORE UPDATE ON public.blackout_periods FOR EACH ROW EXECUTE FUNCTION public.update_blackout_periods_updated_at();


--
-- Name: tokens create_token_version_on_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER create_token_version_on_insert AFTER INSERT ON public.tokens FOR EACH ROW EXECUTE FUNCTION public.create_token_version();


--
-- Name: tokens create_token_version_on_update; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER create_token_version_on_update AFTER UPDATE ON public.tokens FOR EACH ROW WHEN ((old.* IS DISTINCT FROM new.*)) EXECUTE FUNCTION public.create_token_version();


--
-- Name: documents document_expiry_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER document_expiry_trigger AFTER INSERT OR UPDATE OF expiry_date ON public.documents FOR EACH ROW EXECUTE FUNCTION public.check_document_expiry();


--
-- Name: documents document_version_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER document_version_trigger BEFORE UPDATE ON public.documents FOR EACH ROW EXECUTE FUNCTION public.create_document_version();


--
-- Name: subscriptions enforce_subscription_project_consistency; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER enforce_subscription_project_consistency BEFORE INSERT OR UPDATE ON public.subscriptions FOR EACH ROW WHEN ((new.product_id IS NOT NULL)) EXECUTE FUNCTION public.validate_subscription_project_consistency();


--
-- Name: TRIGGER enforce_subscription_project_consistency ON subscriptions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TRIGGER enforce_subscription_project_consistency ON public.subscriptions IS 'Validates and auto-sets project_id based on product_id relationship';


--
-- Name: audit_logs extract_metadata_values_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER extract_metadata_values_trigger BEFORE INSERT OR UPDATE ON public.audit_logs FOR EACH ROW EXECUTE FUNCTION public.extract_severity_from_metadata();


--
-- Name: users on_public_user_upsert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER on_public_user_upsert AFTER INSERT OR UPDATE OF auth_id ON public.users FOR EACH ROW WHEN ((new.auth_id IS NOT NULL)) EXECUTE FUNCTION public.sync_user_to_profile();


--
-- Name: issuer_documents prevent_issuer_document_duplicates; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER prevent_issuer_document_duplicates BEFORE INSERT OR UPDATE ON public.issuer_documents FOR EACH ROW EXECUTE FUNCTION public.check_issuer_document_duplicates();


--
-- Name: redemption_approvers redemption_approvers_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER redemption_approvers_updated_at BEFORE UPDATE ON public.redemption_approvers FOR EACH ROW EXECUTE FUNCTION public.update_redemption_approvers_updated_at();


--
-- Name: ripple_dex_orders ripple_dex_orders_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_dex_orders_updated_at BEFORE UPDATE ON public.ripple_dex_orders FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_escrows ripple_escrows_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_escrows_updated_at BEFORE UPDATE ON public.ripple_escrows FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_issuers ripple_issuers_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_issuers_updated_at BEFORE UPDATE ON public.ripple_issuers FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_multisig_accounts ripple_multisig_accounts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_multisig_accounts_updated_at BEFORE UPDATE ON public.ripple_multisig_accounts FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_multisig_proposals ripple_multisig_proposals_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_multisig_proposals_updated_at BEFORE UPDATE ON public.ripple_multisig_proposals FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_payments ripple_payments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_payments_updated_at BEFORE UPDATE ON public.ripple_payments FOR EACH ROW EXECUTE FUNCTION public.update_ripple_payments_updated_at();


--
-- Name: ripple_tokens ripple_tokens_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_tokens_updated_at BEFORE UPDATE ON public.ripple_tokens FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: ripple_trust_lines ripple_trust_lines_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER ripple_trust_lines_updated_at BEFORE UPDATE ON public.ripple_trust_lines FOR EACH ROW EXECUTE FUNCTION public.update_ripple_updated_at();


--
-- Name: rules rule_approval_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER rule_approval_trigger BEFORE INSERT OR UPDATE ON public.rules FOR EACH ROW EXECUTE FUNCTION public.add_rule_to_approval_queue();


--
-- Name: rules rules_update_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER rules_update_timestamp BEFORE UPDATE ON public.rules FOR EACH ROW EXECUTE FUNCTION public.update_rules_updated_at();


--
-- Name: climate_incentives set_climate_incentives_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_climate_incentives_updated_at BEFORE UPDATE ON public.climate_incentives FOR EACH ROW EXECUTE FUNCTION public.trigger_set_updated_at();


--
-- Name: investor_documents set_investor_documents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_investor_documents_updated_at BEFORE UPDATE ON public.investor_documents FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: renewable_energy_credits set_renewable_energy_credits_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_renewable_energy_credits_updated_at BEFORE UPDATE ON public.renewable_energy_credits FOR EACH ROW EXECUTE FUNCTION public.trigger_set_updated_at();


--
-- Name: distributions set_standard_on_distribution_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_standard_on_distribution_insert BEFORE INSERT ON public.distributions FOR EACH ROW EXECUTE FUNCTION public.set_distribution_standard();


--
-- Name: distributions set_standard_on_distribution_update; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_standard_on_distribution_update BEFORE UPDATE ON public.distributions FOR EACH ROW WHEN (((old.standard IS DISTINCT FROM new.standard) AND (new.standard IS NULL))) EXECUTE FUNCTION public.set_distribution_standard();


--
-- Name: token_allocations set_standard_on_token_allocation_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_standard_on_token_allocation_insert BEFORE INSERT ON public.token_allocations FOR EACH ROW EXECUTE FUNCTION public.set_token_allocation_standard();


--
-- Name: token_allocations set_standard_on_token_allocation_update; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_standard_on_token_allocation_update BEFORE UPDATE ON public.token_allocations FOR EACH ROW WHEN (((old.token_id IS DISTINCT FROM new.token_id) OR (new.standard IS NULL))) EXECUTE FUNCTION public.set_token_allocation_standard();


--
-- Name: token_whitelists set_token_whitelists_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_token_whitelists_updated_at BEFORE UPDATE ON public.token_whitelists FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: alerts set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.alerts FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: approval_config_approvers set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.approval_config_approvers FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: approval_configs set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.approval_configs FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: compliance_reports set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.compliance_reports FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_activity_logs set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_activity_logs FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_api_requests set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_api_requests FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_applications set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_applications FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_broadcast_transactions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_broadcast_transactions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_credentials set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_credentials FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_exchange_accounts set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_exchange_accounts FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_exchange_balances set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_exchange_balances FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_exchange_integrations set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_exchange_integrations FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_fee_sponsors set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_fee_sponsors FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_fiat_provider_configs set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_fiat_provider_configs FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_fiat_transactions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_fiat_transactions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_permission_assignments set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_permission_assignments FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_permissions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_permissions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_personal_access_tokens set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_personal_access_tokens FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_policies set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_policies FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_policy_approvals set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_policy_approvals FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_service_accounts set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_service_accounts FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_signatures set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_signatures FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_signing_keys set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_signing_keys FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_sponsored_fees set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_sponsored_fees FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_staking_integrations set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_staking_integrations FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_sync_status set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_sync_status FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_transaction_history set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_transaction_history FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_transfers set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_transfers FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_users set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_users FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_validators set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_validators FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_wallet_balances set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_wallet_balances FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_wallet_nfts set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_wallet_nfts FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_wallets set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_wallets FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_webhook_deliveries set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_webhook_deliveries FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: dfns_webhooks set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.dfns_webhooks FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: document_workflows set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.document_workflows FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: fiat_transactions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.fiat_transactions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: health_checks set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.health_checks FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: investor_groups set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.investor_groups FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: investors set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.investors FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: issuer_access_roles set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.issuer_access_roles FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: issuer_documents set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.issuer_documents FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_compliance_alerts set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_compliance_alerts FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_customers set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_customers FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_passes set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_passes FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_policies set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_policies FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_policy_logs set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_policy_logs FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_projects set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_projects FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_swap_transactions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_swap_transactions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_transactions set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_transactions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: moonpay_webhook_config set_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.moonpay_webhook_config FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- Name: security_events set_updated_at_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER set_updated_at_timestamp BEFORE UPDATE ON public.security_events FOR EACH ROW EXECUTE FUNCTION public.update_security_events_updated_at();


--
-- Name: settlement_operations settlement_operations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER settlement_operations_updated_at BEFORE UPDATE ON public.settlement_operations FOR EACH ROW EXECUTE FUNCTION public.update_settlement_operations_updated_at();


--
-- Name: policy_templates template_approval_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER template_approval_trigger BEFORE INSERT OR UPDATE ON public.policy_templates FOR EACH ROW EXECUTE FUNCTION public.add_template_to_approval_queue();


--
-- Name: token_exchange_configs token_exchange_configs_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER token_exchange_configs_updated_at BEFORE UPDATE ON public.token_exchange_configs FOR EACH ROW EXECUTE FUNCTION public.update_token_exchange_configs_updated_at();


--
-- Name: tokens token_insert_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER token_insert_trigger AFTER INSERT ON public.tokens FOR EACH ROW EXECUTE FUNCTION public.insert_token_properties();


--
-- Name: token_modules token_modules_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER token_modules_updated_at BEFORE UPDATE ON public.token_modules FOR EACH ROW EXECUTE FUNCTION public.update_token_modules_updated_at();


--
-- Name: product_lifecycle_events tr_prevent_duplicate_lifecycle_events; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_prevent_duplicate_lifecycle_events BEFORE INSERT ON public.product_lifecycle_events FOR EACH ROW EXECUTE FUNCTION public.prevent_duplicate_lifecycle_events();


--
-- Name: redemption_requests tr_redemption_requests_update_statistics; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_redemption_requests_update_statistics AFTER INSERT OR DELETE OR UPDATE ON public.redemption_requests FOR EACH ROW EXECUTE FUNCTION public.trigger_update_redemption_statistics();


--
-- Name: redemption_windows tr_redemption_windows_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_redemption_windows_updated_at BEFORE UPDATE ON public.redemption_windows FOR EACH ROW EXECUTE FUNCTION public.update_redemption_window_timestamp();


--
-- Name: transfer_operations transfer_operations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER transfer_operations_updated_at BEFORE UPDATE ON public.transfer_operations FOR EACH ROW EXECUTE FUNCTION public.update_transfer_operations_updated_at();


--
-- Name: asset_nav_data trigger_calculate_asset_nav_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_calculate_asset_nav_change BEFORE INSERT OR UPDATE ON public.asset_nav_data FOR EACH ROW EXECUTE FUNCTION public.calculate_nav_change();


--
-- Name: fund_nav_data trigger_calculate_nav_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_calculate_nav_change BEFORE INSERT OR UPDATE ON public.fund_nav_data FOR EACH ROW EXECUTE FUNCTION public.calculate_nav_change();


--
-- Name: trade_finance_commodity_emission_configs trigger_commodity_emission_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_commodity_emission_updated BEFORE UPDATE ON public.trade_finance_commodity_emission_configs FOR EACH ROW EXECUTE FUNCTION public.update_trade_finance_rewards_timestamp();


--
-- Name: consensus_settings trigger_consensus_settings_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_consensus_settings_updated_at BEFORE UPDATE ON public.consensus_settings FOR EACH ROW EXECUTE FUNCTION public.update_consensus_settings_updated_at();


--
-- Name: facet_registry trigger_facet_registry_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_facet_registry_updated_at BEFORE UPDATE ON public.facet_registry FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: trade_finance_rewards_config trigger_rewards_config_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_rewards_config_updated BEFORE UPDATE ON public.trade_finance_rewards_config FOR EACH ROW EXECUTE FUNCTION public.update_trade_finance_rewards_timestamp();


--
-- Name: redemption_rules trigger_set_redemption_product_type_on_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_set_redemption_product_type_on_insert BEFORE INSERT ON public.redemption_rules FOR EACH ROW EXECUTE FUNCTION public.set_redemption_product_type_on_insert();


--
-- Name: smart_contract_wallets trigger_smart_contract_wallets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_smart_contract_wallets_updated_at BEFORE UPDATE ON public.smart_contract_wallets FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: asset_backed_products trigger_sync_redemption_on_asset_backed_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_asset_backed_products_change AFTER INSERT OR DELETE ON public.asset_backed_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: bond_products trigger_sync_redemption_on_bond_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_bond_products_change AFTER INSERT OR DELETE ON public.bond_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: collectibles_products trigger_sync_redemption_on_collectibles_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_collectibles_products_change AFTER INSERT OR DELETE ON public.collectibles_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: commodities_products trigger_sync_redemption_on_commodities_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_commodities_products_change AFTER INSERT OR DELETE ON public.commodities_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: digital_tokenized_fund_products trigger_sync_redemption_on_digital_tokenized_fund_products_chan; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_digital_tokenized_fund_products_chan AFTER INSERT OR DELETE ON public.digital_tokenized_fund_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: energy_products trigger_sync_redemption_on_energy_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_energy_products_change AFTER INSERT OR DELETE ON public.energy_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: equity_products trigger_sync_redemption_on_equity_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_equity_products_change AFTER INSERT OR DELETE ON public.equity_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: fund_products trigger_sync_redemption_on_fund_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_fund_products_change AFTER INSERT OR DELETE ON public.fund_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: infrastructure_products trigger_sync_redemption_on_infrastructure_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_infrastructure_products_change AFTER INSERT OR DELETE ON public.infrastructure_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: private_debt_products trigger_sync_redemption_on_private_debt_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_private_debt_products_change AFTER INSERT OR DELETE ON public.private_debt_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: private_equity_products trigger_sync_redemption_on_private_equity_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_private_equity_products_change AFTER INSERT OR DELETE ON public.private_equity_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: quantitative_investment_strategies_products trigger_sync_redemption_on_quantitative_investment_strategies_p; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_quantitative_investment_strategies_p AFTER INSERT OR DELETE ON public.quantitative_investment_strategies_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: real_estate_products trigger_sync_redemption_on_real_estate_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_real_estate_products_change AFTER INSERT OR DELETE ON public.real_estate_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: stablecoin_products trigger_sync_redemption_on_stablecoin_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_stablecoin_products_change AFTER INSERT OR DELETE ON public.stablecoin_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: structured_products trigger_sync_redemption_on_structured_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_on_structured_products_change AFTER INSERT OR DELETE ON public.structured_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_rules_on_product_change();


--
-- Name: projects trigger_sync_redemption_product_type; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_redemption_product_type AFTER UPDATE OF project_type, organization_id ON public.projects FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_product_type();


--
-- Name: asset_backed_products trigger_sync_target_raise_on_asset_backed_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_asset_backed_products_change AFTER UPDATE ON public.asset_backed_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: bond_products trigger_sync_target_raise_on_bond_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_bond_products_change AFTER UPDATE ON public.bond_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: collectibles_products trigger_sync_target_raise_on_collectibles_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_collectibles_products_change AFTER UPDATE ON public.collectibles_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: commodities_products trigger_sync_target_raise_on_commodities_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_commodities_products_change AFTER UPDATE ON public.commodities_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: digital_tokenized_fund_products trigger_sync_target_raise_on_digital_tokenized_fund_products_ch; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_digital_tokenized_fund_products_ch AFTER UPDATE ON public.digital_tokenized_fund_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: energy_products trigger_sync_target_raise_on_energy_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_energy_products_change AFTER UPDATE ON public.energy_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: equity_products trigger_sync_target_raise_on_equity_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_equity_products_change AFTER UPDATE ON public.equity_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: fund_products trigger_sync_target_raise_on_fund_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_fund_products_change AFTER UPDATE ON public.fund_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: infrastructure_products trigger_sync_target_raise_on_infrastructure_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_infrastructure_products_change AFTER UPDATE ON public.infrastructure_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: private_debt_products trigger_sync_target_raise_on_private_debt_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_private_debt_products_change AFTER UPDATE ON public.private_debt_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: private_equity_products trigger_sync_target_raise_on_private_equity_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_private_equity_products_change AFTER UPDATE ON public.private_equity_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: quantitative_investment_strategies_products trigger_sync_target_raise_on_quantitative_investment_strategies; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_quantitative_investment_strategies AFTER UPDATE ON public.quantitative_investment_strategies_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: real_estate_products trigger_sync_target_raise_on_real_estate_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_real_estate_products_change AFTER UPDATE ON public.real_estate_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: stablecoin_products trigger_sync_target_raise_on_stablecoin_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_stablecoin_products_change AFTER UPDATE ON public.stablecoin_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: structured_products trigger_sync_target_raise_on_structured_products_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_target_raise_on_structured_products_change AFTER UPDATE ON public.structured_products FOR EACH ROW EXECUTE FUNCTION public.sync_redemption_target_raise_on_product_change();


--
-- Name: climate_market_data_cache trigger_update_cache_access; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_cache_access BEFORE UPDATE ON public.climate_market_data_cache FOR EACH ROW EXECUTE FUNCTION public.update_cache_access();


--
-- Name: carbon_market_prices trigger_update_carbon_market_prices_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_carbon_market_prices_updated_at BEFORE UPDATE ON public.carbon_market_prices FOR EACH ROW EXECUTE FUNCTION public.update_carbon_market_prices_updated_at();


--
-- Name: climate_risk_calculations trigger_update_climate_risk_calculations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_climate_risk_calculations_updated_at BEFORE UPDATE ON public.climate_risk_calculations FOR EACH ROW EXECUTE FUNCTION public.update_climate_risk_calculations_updated_at();


--
-- Name: investor_groups_investors trigger_update_group_member_count_delete_new; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_group_member_count_delete_new AFTER DELETE ON public.investor_groups_investors FOR EACH ROW EXECUTE FUNCTION public.update_group_member_count();


--
-- Name: investor_groups_investors trigger_update_group_member_count_insert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_group_member_count_insert AFTER INSERT ON public.investor_groups_investors FOR EACH ROW EXECUTE FUNCTION public.update_group_member_count();


--
-- Name: investor_groups_investors trigger_update_group_member_count_insert_new; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_group_member_count_insert_new AFTER INSERT ON public.investor_groups_investors FOR EACH ROW EXECUTE FUNCTION public.update_group_member_count();


--
-- Name: asset_holdings trigger_update_oracle_prices; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_oracle_prices BEFORE INSERT OR UPDATE ON public.asset_holdings FOR EACH ROW EXECUTE FUNCTION public.update_oracle_prices();


--
-- Name: redemption_settlements trigger_update_settlement_status; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_settlement_status BEFORE UPDATE ON public.redemption_settlements FOR EACH ROW EXECUTE FUNCTION public.update_settlement_status();


--
-- Name: proposal_signatures trigger_update_signature_count; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_signature_count AFTER INSERT OR DELETE OR UPDATE ON public.proposal_signatures FOR EACH ROW EXECUTE FUNCTION public.update_proposal_signature_count();


--
-- Name: asset_holdings trigger_update_total_assets; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_total_assets AFTER INSERT OR DELETE OR UPDATE ON public.asset_holdings FOR EACH ROW EXECUTE FUNCTION public.update_total_assets();


--
-- Name: user_operations trigger_user_operations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_user_operations_updated_at BEFORE UPDATE ON public.user_operations FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: trade_finance_user_rewards trigger_user_rewards_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_user_rewards_updated BEFORE UPDATE ON public.trade_finance_user_rewards FOR EACH ROW EXECUTE FUNCTION public.update_trade_finance_rewards_timestamp();


--
-- Name: wallet_facets trigger_wallet_facets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_wallet_facets_updated_at BEFORE UPDATE ON public.wallet_facets FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: wallet_guardians trigger_wallet_guardians_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_wallet_guardians_updated_at BEFORE UPDATE ON public.wallet_guardians FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: wallet_transaction_drafts trigger_wallet_transaction_drafts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_wallet_transaction_drafts_updated_at BEFORE UPDATE ON public.wallet_transaction_drafts FOR EACH ROW EXECUTE FUNCTION public.update_wallet_transaction_drafts_updated_at();


--
-- Name: webauthn_credentials trigger_webauthn_credentials_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_webauthn_credentials_updated_at BEFORE UPDATE ON public.webauthn_credentials FOR EACH ROW EXECUTE FUNCTION public.update_smart_contract_wallet_updated_at();


--
-- Name: asset_backed_products update_asset_backed_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_asset_backed_products_updated_at BEFORE UPDATE ON public.asset_backed_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: authorized_signatories update_authorized_signatories_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_authorized_signatories_updated_at BEFORE UPDATE ON public.authorized_signatories FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_amortization_schedule update_bond_amortization_schedule_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_amortization_schedule_updated_at BEFORE UPDATE ON public.bond_amortization_schedule FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_call_put_schedules update_bond_call_put_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_call_put_schedules_updated_at BEFORE UPDATE ON public.bond_call_put_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_coupon_payments update_bond_coupon_payments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_coupon_payments_updated_at BEFORE UPDATE ON public.bond_coupon_payments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_covenants update_bond_covenants_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_covenants_updated_at BEFORE UPDATE ON public.bond_covenants FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_products update_bond_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_products_updated_at BEFORE UPDATE ON public.bond_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: bond_sinking_fund update_bond_sinking_fund_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_bond_sinking_fund_updated_at BEFORE UPDATE ON public.bond_sinking_fund FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: cap_table_investors update_cap_table_investors_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_cap_table_investors_updated_at BEFORE UPDATE ON public.cap_table_investors FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: climate_pool_energy_assets update_climate_pool_energy_assets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_climate_pool_energy_assets_updated_at BEFORE UPDATE ON public.climate_pool_energy_assets FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: climate_pool_incentives update_climate_pool_incentives_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_climate_pool_incentives_updated_at BEFORE UPDATE ON public.climate_pool_incentives FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: climate_pool_recs update_climate_pool_recs_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_climate_pool_recs_updated_at BEFORE UPDATE ON public.climate_pool_recs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: climate_user_data_sources update_climate_user_data_sources_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_climate_user_data_sources_updated_at BEFORE UPDATE ON public.climate_user_data_sources FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: collectibles_products update_collectibles_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_collectibles_products_updated_at BEFORE UPDATE ON public.collectibles_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: commodities_products update_commodities_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_commodities_products_updated_at BEFORE UPDATE ON public.commodities_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: contract_role_assignments update_contract_role_assignments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_contract_role_assignments_updated_at BEFORE UPDATE ON public.contract_role_assignments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: dfns_policies update_dfns_policies_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_dfns_policies_updated_at BEFORE UPDATE ON public.dfns_policies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: dfns_policy_approval_groups update_dfns_policy_approval_groups_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_dfns_policy_approval_groups_updated_at BEFORE UPDATE ON public.dfns_policy_approval_groups FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: dfns_policy_approvals update_dfns_policy_approvals_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_dfns_policy_approvals_updated_at BEFORE UPDATE ON public.dfns_policy_approvals FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: dfns_policy_change_requests update_dfns_policy_change_requests_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_dfns_policy_change_requests_updated_at BEFORE UPDATE ON public.dfns_policy_change_requests FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: digital_tokenised_funds update_digital_tokenised_funds_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_digital_tokenised_funds_updated_at BEFORE UPDATE ON public.digital_tokenised_funds FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: energy_assets update_energy_assets_updated_at_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_energy_assets_updated_at_trigger BEFORE UPDATE ON public.energy_assets FOR EACH ROW EXECUTE FUNCTION public.update_energy_assets_updated_at();


--
-- Name: energy_products update_energy_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_energy_products_updated_at BEFORE UPDATE ON public.energy_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: equity_products update_equity_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_equity_products_updated_at BEFORE UPDATE ON public.equity_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: fund_products update_fund_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_fund_products_updated_at BEFORE UPDATE ON public.fund_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: individual_documents update_individual_documents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_individual_documents_updated_at BEFORE UPDATE ON public.individual_documents FOR EACH ROW EXECUTE FUNCTION public.update_individual_documents_updated_at();


--
-- Name: infrastructure_products update_infrastructure_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_infrastructure_products_updated_at BEFORE UPDATE ON public.infrastructure_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: investor_approvals update_investor_approvals_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_investor_approvals_timestamp BEFORE UPDATE ON public.investor_approvals FOR EACH ROW EXECUTE FUNCTION public.update_timestamp();


--
-- Name: investors update_investors_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_investors_timestamp BEFORE UPDATE ON public.investors FOR EACH ROW EXECUTE FUNCTION public.update_timestamp();


--
-- Name: ml_baseline_statistics update_ml_baseline_statistics_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_ml_baseline_statistics_updated_at BEFORE UPDATE ON public.ml_baseline_statistics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: multi_sig_proposals update_multi_sig_proposals_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_multi_sig_proposals_updated_at BEFORE UPDATE ON public.multi_sig_proposals FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: onboarding_restrictions update_onboarding_restrictions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_onboarding_restrictions_updated_at BEFORE UPDATE ON public.onboarding_restrictions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: onchain_identities update_onchain_identities_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_onchain_identities_timestamp BEFORE UPDATE ON public.onchain_identities FOR EACH ROW EXECUTE FUNCTION public.update_timestamp();


--
-- Name: onchain_issuers update_onchain_issuers_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_onchain_issuers_timestamp BEFORE UPDATE ON public.onchain_issuers FOR EACH ROW EXECUTE FUNCTION public.update_timestamp();


--
-- Name: operator_status update_operator_status_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_operator_status_updated_at BEFORE UPDATE ON public.operator_status FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organization_details update_organization_details_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_organization_details_updated_at BEFORE UPDATE ON public.organization_details FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organizations update_organizations_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_organizations_timestamp BEFORE UPDATE ON public.organizations FOR EACH ROW EXECUTE FUNCTION public.update_timestamp();


--
-- Name: private_debt_products update_private_debt_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_private_debt_products_updated_at BEFORE UPDATE ON public.private_debt_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: private_equity_products update_private_equity_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_private_equity_products_updated_at BEFORE UPDATE ON public.private_equity_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: product_lifecycle_events update_product_lifecycle_events_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_product_lifecycle_events_updated_at BEFORE UPDATE ON public.product_lifecycle_events FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: profiles update_profiles_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_profiles_updated_at BEFORE UPDATE ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: project_organization_assignments update_project_organization_assignments_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_project_organization_assignments_timestamp BEFORE UPDATE ON public.project_organization_assignments FOR EACH ROW EXECUTE FUNCTION public.update_project_organization_assignments_timestamp();


--
-- Name: project_wallets update_project_wallets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_project_wallets_updated_at BEFORE UPDATE ON public.project_wallets FOR EACH ROW EXECUTE FUNCTION public.update_modified_column();


--
-- Name: psp_api_keys update_psp_api_keys_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_api_keys_updated_at BEFORE UPDATE ON public.psp_api_keys FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_balances update_psp_balances_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_balances_updated_at BEFORE UPDATE ON public.psp_balances FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_external_accounts update_psp_external_accounts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_external_accounts_updated_at BEFORE UPDATE ON public.psp_external_accounts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_fiat_crypto_spreads update_psp_fiat_crypto_spreads_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_fiat_crypto_spreads_updated_at BEFORE UPDATE ON public.psp_fiat_crypto_spreads FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_identity_cases update_psp_identity_cases_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_identity_cases_updated_at BEFORE UPDATE ON public.psp_identity_cases FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_payment_settings update_psp_payment_settings_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_payment_settings_updated_at BEFORE UPDATE ON public.psp_payment_settings FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_payments update_psp_payments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_payments_updated_at BEFORE UPDATE ON public.psp_payments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_trades update_psp_trades_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_trades_updated_at BEFORE UPDATE ON public.psp_trades FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_virtual_accounts update_psp_virtual_accounts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_virtual_accounts_updated_at BEFORE UPDATE ON public.psp_virtual_accounts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_webhook_events update_psp_webhook_events_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_webhook_events_updated_at BEFORE UPDATE ON public.psp_webhook_events FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: psp_webhooks update_psp_webhooks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_psp_webhooks_updated_at BEFORE UPDATE ON public.psp_webhooks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: quantitative_strategies update_quantitative_strategies_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_quantitative_strategies_updated_at BEFORE UPDATE ON public.quantitative_strategies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: ramp_network_config update_ramp_network_config_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_ramp_network_config_updated_at BEFORE UPDATE ON public.ramp_network_config FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: ramp_webhook_events update_ramp_webhook_events_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_ramp_webhook_events_updated_at BEFORE UPDATE ON public.ramp_webhook_events FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: real_estate_products update_real_estate_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_real_estate_products_updated_at BEFORE UPDATE ON public.real_estate_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: regulatory_exemptions update_regulatory_exemptions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_regulatory_exemptions_updated_at BEFORE UPDATE ON public.regulatory_exemptions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: wallet_restriction_rules update_restriction_rules_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_restriction_rules_updated_at BEFORE UPDATE ON public.wallet_restriction_rules FOR EACH ROW EXECUTE FUNCTION public.update_restriction_rules_updated_at();


--
-- Name: ripple_payments update_ripple_payments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_ripple_payments_updated_at BEFORE UPDATE ON public.ripple_payments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: risk_assessments update_risk_assessments_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_risk_assessments_updated_at BEFORE UPDATE ON public.risk_assessments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: risk_thresholds update_risk_thresholds_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_risk_thresholds_updated_at BEFORE UPDATE ON public.risk_thresholds FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: sidebar_configurations update_sidebar_configurations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_sidebar_configurations_updated_at BEFORE UPDATE ON public.sidebar_configurations FOR EACH ROW EXECUTE FUNCTION public.update_sidebar_configurations_updated_at();


--
-- Name: sidebar_items update_sidebar_items_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_sidebar_items_updated_at BEFORE UPDATE ON public.sidebar_items FOR EACH ROW EXECUTE FUNCTION public.update_sidebar_items_updated_at();


--
-- Name: sidebar_sections update_sidebar_sections_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_sidebar_sections_updated_at BEFORE UPDATE ON public.sidebar_sections FOR EACH ROW EXECUTE FUNCTION public.update_sidebar_sections_updated_at();


--
-- Name: signature_migrations update_signature_migrations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_signature_migrations_updated_at BEFORE UPDATE ON public.signature_migrations FOR EACH ROW EXECUTE FUNCTION public.update_signature_migrations_updated_at();


--
-- Name: stablecoin_collateral update_stablecoin_collateral_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_stablecoin_collateral_updated_at BEFORE UPDATE ON public.stablecoin_collateral FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: stablecoin_products update_stablecoin_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_stablecoin_products_updated_at BEFORE UPDATE ON public.stablecoin_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: stripe_conversion_transactions update_stripe_conversion_transactions_updated_at_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_stripe_conversion_transactions_updated_at_trigger BEFORE UPDATE ON public.stripe_conversion_transactions FOR EACH ROW EXECUTE FUNCTION public.update_stripe_conversion_transactions_updated_at();


--
-- Name: stripe_stablecoin_accounts update_stripe_stablecoin_accounts_updated_at_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_stripe_stablecoin_accounts_updated_at_trigger BEFORE UPDATE ON public.stripe_stablecoin_accounts FOR EACH ROW EXECUTE FUNCTION public.update_stripe_stablecoin_accounts_updated_at();


--
-- Name: structured_products update_structured_products_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_structured_products_updated_at BEFORE UPDATE ON public.structured_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: token_erc1155_properties update_token_erc1155_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc1155_properties_timestamp BEFORE UPDATE ON public.token_erc1155_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_erc1400_properties update_token_erc1400_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc1400_properties_timestamp BEFORE UPDATE ON public.token_erc1400_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_erc20_properties update_token_erc20_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc20_properties_timestamp BEFORE UPDATE ON public.token_erc20_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_erc3525_properties update_token_erc3525_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc3525_properties_timestamp BEFORE UPDATE ON public.token_erc3525_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_erc4626_properties update_token_erc4626_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc4626_properties_timestamp BEFORE UPDATE ON public.token_erc4626_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_erc721_properties update_token_erc721_properties_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_erc721_properties_timestamp BEFORE UPDATE ON public.token_erc721_properties FOR EACH ROW EXECUTE FUNCTION public.update_timestamp_column();


--
-- Name: token_templates update_token_templates_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_token_templates_updated_at BEFORE UPDATE ON public.token_templates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: tokens update_tokens_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_tokens_updated_at BEFORE UPDATE ON public.tokens FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: transactions update_transactions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_transactions_updated_at BEFORE UPDATE ON public.transactions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_addresses update_user_addresses_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_addresses_updated_at BEFORE UPDATE ON public.user_addresses FOR EACH ROW EXECUTE FUNCTION public.update_user_addresses_updated_at();


--
-- Name: user_contract_roles update_user_contract_roles_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_contract_roles_updated_at BEFORE UPDATE ON public.user_contract_roles FOR EACH ROW EXECUTE FUNCTION public.update_user_contract_roles_updated_at();


--
-- Name: user_sidebar_preferences update_user_sidebar_preferences_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_sidebar_preferences_updated_at BEFORE UPDATE ON public.user_sidebar_preferences FOR EACH ROW EXECUTE FUNCTION public.update_user_sidebar_preferences_updated_at();


--
-- Name: user_verifications update_user_verifications_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_verifications_updated_at BEFORE UPDATE ON public.user_verifications FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: wallet_locks update_wallet_locks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_wallet_locks_updated_at BEFORE UPDATE ON public.wallet_locks FOR EACH ROW EXECUTE FUNCTION public.update_wallet_locks_updated_at();


--
-- Name: wallet_transactions update_wallet_transactions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_wallet_transactions_updated_at BEFORE UPDATE ON public.wallet_transactions FOR EACH ROW EXECUTE FUNCTION public.update_modified_column();


--
-- Name: tokens validate_token_data_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER validate_token_data_trigger BEFORE INSERT OR UPDATE ON public.tokens FOR EACH ROW EXECUTE FUNCTION public.validate_token_data();


--
-- Name: multi_sig_wallets validate_wallet_address_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER validate_wallet_address_trigger BEFORE INSERT OR UPDATE ON public.multi_sig_wallets FOR EACH ROW EXECUTE FUNCTION public.validate_wallet_address();


--
-- Name: wallet_signatories wallet_signatories_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER wallet_signatories_updated_at BEFORE UPDATE ON public.wallet_signatories FOR EACH ROW EXECUTE FUNCTION public.update_wallet_signatories_updated_at();


--
-- Name: whitelist_entries whitelist_entries_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER whitelist_entries_updated_at BEFORE UPDATE ON public.whitelist_entries FOR EACH ROW EXECUTE FUNCTION public.update_whitelist_entries_updated_at();


--
-- Name: abs_cash_flows abs_cash_flows_abs_tranche_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_cash_flows
    ADD CONSTRAINT abs_cash_flows_abs_tranche_id_fkey FOREIGN KEY (abs_tranche_id) REFERENCES public.abs_tranches(id);


--
-- Name: abs_cash_flows abs_cash_flows_asset_backed_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_cash_flows
    ADD CONSTRAINT abs_cash_flows_asset_backed_product_id_fkey FOREIGN KEY (asset_backed_product_id) REFERENCES public.asset_backed_products(id) ON DELETE CASCADE;


--
-- Name: abs_collateral_pools abs_collateral_pools_asset_backed_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_collateral_pools
    ADD CONSTRAINT abs_collateral_pools_asset_backed_product_id_fkey FOREIGN KEY (asset_backed_product_id) REFERENCES public.asset_backed_products(id) ON DELETE CASCADE;


--
-- Name: abs_loss_projections abs_loss_projections_asset_backed_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_loss_projections
    ADD CONSTRAINT abs_loss_projections_asset_backed_product_id_fkey FOREIGN KEY (asset_backed_product_id) REFERENCES public.asset_backed_products(id) ON DELETE CASCADE;


--
-- Name: abs_prepayment_speeds abs_prepayment_speeds_asset_backed_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_prepayment_speeds
    ADD CONSTRAINT abs_prepayment_speeds_asset_backed_product_id_fkey FOREIGN KEY (asset_backed_product_id) REFERENCES public.asset_backed_products(id) ON DELETE CASCADE;


--
-- Name: abs_tranches abs_tranches_asset_backed_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.abs_tranches
    ADD CONSTRAINT abs_tranches_asset_backed_product_id_fkey FOREIGN KEY (asset_backed_product_id) REFERENCES public.asset_backed_products(id) ON DELETE CASCADE;


--
-- Name: approval_config_approvers approval_config_approvers_approval_config_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT approval_config_approvers_approval_config_id_fkey FOREIGN KEY (approval_config_id) REFERENCES public.approval_configs(id) ON DELETE CASCADE;


--
-- Name: approval_config_approvers approval_config_approvers_approver_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT approval_config_approvers_approver_role_id_fkey FOREIGN KEY (approver_role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: approval_config_approvers approval_config_approvers_approver_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT approval_config_approvers_approver_user_id_fkey FOREIGN KEY (approver_user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: approval_config_approvers approval_config_approvers_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_approvers
    ADD CONSTRAINT approval_config_approvers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: approval_config_history approval_config_history_approval_config_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_history
    ADD CONSTRAINT approval_config_history_approval_config_id_fkey FOREIGN KEY (approval_config_id) REFERENCES public.approval_configs(id) ON DELETE CASCADE;


--
-- Name: approval_config_history approval_config_history_changed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_config_history
    ADD CONSTRAINT approval_config_history_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES public.users(id);


--
-- Name: approval_configs approval_configs_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_configs
    ADD CONSTRAINT approval_configs_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: approval_configs approval_configs_last_modified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_configs
    ADD CONSTRAINT approval_configs_last_modified_by_fkey FOREIGN KEY (last_modified_by) REFERENCES public.users(id);


--
-- Name: approval_delegations approval_delegations_delegate_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_delegations
    ADD CONSTRAINT approval_delegations_delegate_id_fkey FOREIGN KEY (delegate_id) REFERENCES public.users(id);


--
-- Name: approval_delegations approval_delegations_delegator_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_delegations
    ADD CONSTRAINT approval_delegations_delegator_id_fkey FOREIGN KEY (delegator_id) REFERENCES public.users(id);


--
-- Name: approval_processes approval_processes_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_processes
    ADD CONSTRAINT approval_processes_request_id_fkey FOREIGN KEY (request_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: approval_requests approval_requests_requested_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_requests
    ADD CONSTRAINT approval_requests_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: approval_workflows approval_workflows_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approval_workflows
    ADD CONSTRAINT approval_workflows_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: asset_nav_data asset_nav_data_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_nav_data
    ADD CONSTRAINT asset_nav_data_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: asset_nav_data asset_nav_data_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_nav_data
    ADD CONSTRAINT asset_nav_data_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: asset_nav_data asset_nav_data_validated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_nav_data
    ADD CONSTRAINT asset_nav_data_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES auth.users(id);


--
-- Name: audit_logs audit_logs_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_logs
    ADD CONSTRAINT audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: batch_operations batch_operations_user_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.batch_operations
    ADD CONSTRAINT batch_operations_user_operation_id_fkey FOREIGN KEY (user_operation_id) REFERENCES public.user_operations(id) ON DELETE CASCADE;


--
-- Name: blackout_periods blackout_periods_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.blackout_periods
    ADD CONSTRAINT blackout_periods_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: blackout_periods blackout_periods_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.blackout_periods
    ADD CONSTRAINT blackout_periods_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: bond_amortization_schedule bond_amortization_schedule_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_amortization_schedule
    ADD CONSTRAINT bond_amortization_schedule_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_call_put_schedules bond_call_put_schedules_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_call_put_schedules
    ADD CONSTRAINT bond_call_put_schedules_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_coupon_payments bond_coupon_payments_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_coupon_payments
    ADD CONSTRAINT bond_coupon_payments_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_covenants bond_covenants_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_covenants
    ADD CONSTRAINT bond_covenants_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_credit_ratings bond_credit_ratings_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_credit_ratings
    ADD CONSTRAINT bond_credit_ratings_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_events bond_events_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_events
    ADD CONSTRAINT bond_events_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_market_prices bond_market_prices_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_market_prices
    ADD CONSTRAINT bond_market_prices_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: bond_sinking_fund bond_sinking_fund_bond_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_sinking_fund
    ADD CONSTRAINT bond_sinking_fund_bond_product_id_fkey FOREIGN KEY (bond_product_id) REFERENCES public.bond_products(id) ON DELETE CASCADE;


--
-- Name: cap_table_investors cap_table_investors_cap_table_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cap_table_investors
    ADD CONSTRAINT cap_table_investors_cap_table_id_fkey FOREIGN KEY (cap_table_id) REFERENCES public.cap_tables(id) ON DELETE CASCADE;


--
-- Name: cap_table_investors cap_table_investors_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cap_table_investors
    ADD CONSTRAINT cap_table_investors_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE SET NULL;


--
-- Name: cap_tables cap_tables_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cap_tables
    ADD CONSTRAINT cap_tables_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: climate_incentives climate_incentives_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_incentives
    ADD CONSTRAINT climate_incentives_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: climate_incentives climate_incentives_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_incentives
    ADD CONSTRAINT climate_incentives_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: climate_investor_pools climate_investor_pools_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_investor_pools
    ADD CONSTRAINT climate_investor_pools_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id);


--
-- Name: climate_investor_pools climate_investor_pools_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_investor_pools
    ADD CONSTRAINT climate_investor_pools_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id);


--
-- Name: climate_nav_calculations climate_nav_calculations_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_nav_calculations
    ADD CONSTRAINT climate_nav_calculations_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: climate_nav_calculations climate_nav_calculations_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_nav_calculations
    ADD CONSTRAINT climate_nav_calculations_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: climate_policy_impacts climate_policy_impacts_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policy_impacts
    ADD CONSTRAINT climate_policy_impacts_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: climate_policy_impacts climate_policy_impacts_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policy_impacts
    ADD CONSTRAINT climate_policy_impacts_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.climate_policies(policy_id);


--
-- Name: climate_policy_impacts climate_policy_impacts_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_policy_impacts
    ADD CONSTRAINT climate_policy_impacts_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: climate_pool_energy_assets climate_pool_energy_assets_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_energy_assets
    ADD CONSTRAINT climate_pool_energy_assets_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id) ON DELETE CASCADE;


--
-- Name: climate_pool_energy_assets climate_pool_energy_assets_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_energy_assets
    ADD CONSTRAINT climate_pool_energy_assets_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id) ON DELETE CASCADE;


--
-- Name: climate_pool_energy_assets climate_pool_energy_assets_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_energy_assets
    ADD CONSTRAINT climate_pool_energy_assets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: climate_pool_incentives climate_pool_incentives_incentive_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_incentives
    ADD CONSTRAINT climate_pool_incentives_incentive_id_fkey FOREIGN KEY (incentive_id) REFERENCES public.climate_incentives(incentive_id) ON DELETE CASCADE;


--
-- Name: climate_pool_incentives climate_pool_incentives_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_incentives
    ADD CONSTRAINT climate_pool_incentives_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id) ON DELETE CASCADE;


--
-- Name: climate_pool_incentives climate_pool_incentives_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_incentives
    ADD CONSTRAINT climate_pool_incentives_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: climate_pool_receivables climate_pool_receivables_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_receivables
    ADD CONSTRAINT climate_pool_receivables_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id);


--
-- Name: climate_pool_receivables climate_pool_receivables_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_receivables
    ADD CONSTRAINT climate_pool_receivables_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: climate_pool_recs climate_pool_recs_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_recs
    ADD CONSTRAINT climate_pool_recs_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id) ON DELETE CASCADE;


--
-- Name: climate_pool_recs climate_pool_recs_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_recs
    ADD CONSTRAINT climate_pool_recs_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: climate_pool_recs climate_pool_recs_rec_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_pool_recs
    ADD CONSTRAINT climate_pool_recs_rec_id_fkey FOREIGN KEY (rec_id) REFERENCES public.renewable_energy_credits(rec_id) ON DELETE CASCADE;


--
-- Name: climate_receivables climate_receivables_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_receivables
    ADD CONSTRAINT climate_receivables_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: climate_receivables climate_receivables_payer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_receivables
    ADD CONSTRAINT climate_receivables_payer_id_fkey FOREIGN KEY (payer_id) REFERENCES public.climate_payers(payer_id);


--
-- Name: climate_reports climate_reports_generated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_reports
    ADD CONSTRAINT climate_reports_generated_by_fkey FOREIGN KEY (generated_by) REFERENCES auth.users(id);


--
-- Name: climate_risk_calculations climate_risk_calculations_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_risk_calculations
    ADD CONSTRAINT climate_risk_calculations_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id) ON DELETE CASCADE;


--
-- Name: climate_risk_factors climate_risk_factors_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_risk_factors
    ADD CONSTRAINT climate_risk_factors_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: climate_user_data_cache climate_user_data_cache_source_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_user_data_cache
    ADD CONSTRAINT climate_user_data_cache_source_id_fkey FOREIGN KEY (source_id) REFERENCES public.climate_user_data_sources(source_id) ON DELETE CASCADE;


--
-- Name: climate_user_data_sources climate_user_data_sources_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_user_data_sources
    ADD CONSTRAINT climate_user_data_sources_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: collectibles_appraisals collectibles_appraisals_collectibles_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_appraisals
    ADD CONSTRAINT collectibles_appraisals_collectibles_product_id_fkey FOREIGN KEY (collectibles_product_id) REFERENCES public.collectibles_products(id) ON DELETE CASCADE;


--
-- Name: collectibles_condition_reports collectibles_condition_reports_collectibles_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_condition_reports
    ADD CONSTRAINT collectibles_condition_reports_collectibles_product_id_fkey FOREIGN KEY (collectibles_product_id) REFERENCES public.collectibles_products(id) ON DELETE CASCADE;


--
-- Name: collectibles_insurance_valuations collectibles_insurance_valuations_collectibles_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_insurance_valuations
    ADD CONSTRAINT collectibles_insurance_valuations_collectibles_product_id_fkey FOREIGN KEY (collectibles_product_id) REFERENCES public.collectibles_products(id) ON DELETE CASCADE;


--
-- Name: collectibles_market_comparables collectibles_market_comparables_collectibles_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_market_comparables
    ADD CONSTRAINT collectibles_market_comparables_collectibles_product_id_fkey FOREIGN KEY (collectibles_product_id) REFERENCES public.collectibles_products(id) ON DELETE CASCADE;


--
-- Name: collectibles_provenance collectibles_provenance_collectibles_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_provenance
    ADD CONSTRAINT collectibles_provenance_collectibles_product_id_fkey FOREIGN KEY (collectibles_product_id) REFERENCES public.collectibles_products(id) ON DELETE CASCADE;


--
-- Name: commodity_collateral commodity_collateral_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_collateral
    ADD CONSTRAINT commodity_collateral_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.commodity_positions(id) ON DELETE CASCADE;


--
-- Name: commodity_debt commodity_debt_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_debt
    ADD CONSTRAINT commodity_debt_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.commodity_positions(id) ON DELETE CASCADE;


--
-- Name: commodity_pool_config commodity_pool_config_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_pool_config
    ADD CONSTRAINT commodity_pool_config_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: commodity_positions commodity_positions_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_positions
    ADD CONSTRAINT commodity_positions_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: commodity_prices commodity_prices_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_prices
    ADD CONSTRAINT commodity_prices_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: commodity_risk_metrics commodity_risk_metrics_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodity_risk_metrics
    ADD CONSTRAINT commodity_risk_metrics_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: compliance_audit_logs compliance_audit_logs_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_audit_logs
    ADD CONSTRAINT compliance_audit_logs_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: compliance_checks compliance_checks_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_checks
    ADD CONSTRAINT compliance_checks_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: compliance_checks compliance_checks_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_checks
    ADD CONSTRAINT compliance_checks_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: compliance_reports compliance_reports_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_reports
    ADD CONSTRAINT compliance_reports_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: compliance_reports compliance_reports_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_reports
    ADD CONSTRAINT compliance_reports_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id);


--
-- Name: compliance_violations compliance_violations_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: compliance_violations compliance_violations_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(id);


--
-- Name: contract_masters_backup contract_masters_backup_deployed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters_backup
    ADD CONSTRAINT contract_masters_backup_deployed_by_fkey FOREIGN KEY (deployed_by) REFERENCES public.users(id) ON DELETE SET NULL;


--
-- Name: contract_masters contract_masters_deployed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_masters
    ADD CONSTRAINT contract_masters_deployed_by_fkey FOREIGN KEY (deployed_by) REFERENCES public.users(id) ON DELETE SET NULL DEFERRABLE INITIALLY DEFERRED;


--
-- Name: contract_role_assignments contract_role_assignments_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_role_assignments
    ADD CONSTRAINT contract_role_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES auth.users(id);


--
-- Name: contract_role_assignments contract_role_assignments_multi_sig_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_role_assignments
    ADD CONSTRAINT contract_role_assignments_multi_sig_wallet_id_fkey FOREIGN KEY (multi_sig_wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: corporate_actions corporate_actions_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.corporate_actions
    ADD CONSTRAINT corporate_actions_equity_product_id_fkey FOREIGN KEY (equity_product_id) REFERENCES public.equity_products(id) ON DELETE CASCADE;


--
-- Name: credential_usage_logs credential_usage_logs_performed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.credential_usage_logs
    ADD CONSTRAINT credential_usage_logs_performed_by_fkey FOREIGN KEY (performed_by) REFERENCES auth.users(id);


--
-- Name: data_source_mappings data_source_mappings_source_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.data_source_mappings
    ADD CONSTRAINT data_source_mappings_source_id_fkey FOREIGN KEY (source_id) REFERENCES public.climate_user_data_sources(source_id) ON DELETE CASCADE;


--
-- Name: deployment_audit_logs deployment_audit_logs_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.deployment_audit_logs
    ADD CONSTRAINT deployment_audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: dfns_broadcast_transactions dfns_broadcast_transactions_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_broadcast_transactions
    ADD CONSTRAINT dfns_broadcast_transactions_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_credentials dfns_credentials_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_credentials
    ADD CONSTRAINT dfns_credentials_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.dfns_users(id) ON DELETE CASCADE;


--
-- Name: dfns_exchange_accounts dfns_exchange_accounts_exchange_integration_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_accounts
    ADD CONSTRAINT dfns_exchange_accounts_exchange_integration_id_fkey FOREIGN KEY (exchange_integration_id) REFERENCES public.dfns_exchange_integrations(integration_id) ON DELETE CASCADE;


--
-- Name: dfns_exchange_balances dfns_exchange_balances_account_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_exchange_balances
    ADD CONSTRAINT dfns_exchange_balances_account_id_fkey FOREIGN KEY (account_id) REFERENCES public.dfns_exchange_accounts(account_id) ON DELETE CASCADE;


--
-- Name: dfns_fiat_activity_logs dfns_fiat_activity_logs_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_activity_logs
    ADD CONSTRAINT dfns_fiat_activity_logs_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.dfns_fiat_transactions(id) ON DELETE CASCADE;


--
-- Name: dfns_fiat_transactions dfns_fiat_transactions_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_fiat_transactions
    ADD CONSTRAINT dfns_fiat_transactions_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(id);


--
-- Name: dfns_permission_assignments dfns_permission_assignments_permission_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_permission_assignments
    ADD CONSTRAINT dfns_permission_assignments_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES public.dfns_permissions(permission_id) ON DELETE CASCADE;


--
-- Name: dfns_personal_access_tokens dfns_personal_access_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_personal_access_tokens
    ADD CONSTRAINT dfns_personal_access_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.dfns_users(id) ON DELETE CASCADE;


--
-- Name: dfns_policy_approval_decisions dfns_policy_approval_decisions_approval_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approval_decisions
    ADD CONSTRAINT dfns_policy_approval_decisions_approval_id_fkey FOREIGN KEY (approval_id) REFERENCES public.dfns_policy_approvals(id) ON DELETE CASCADE;


--
-- Name: dfns_policy_approval_groups dfns_policy_approval_groups_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approval_groups
    ADD CONSTRAINT dfns_policy_approval_groups_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.dfns_policies(id) ON DELETE CASCADE;


--
-- Name: dfns_policy_approvals dfns_policy_approvals_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_policy_approvals
    ADD CONSTRAINT dfns_policy_approvals_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.dfns_policies(policy_id) ON DELETE CASCADE;


--
-- Name: dfns_signatures dfns_signatures_key_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_signatures
    ADD CONSTRAINT dfns_signatures_key_id_fkey FOREIGN KEY (key_id) REFERENCES public.dfns_signing_keys(key_id) ON DELETE CASCADE;


--
-- Name: dfns_sponsored_fees dfns_sponsored_fees_fee_sponsor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sponsored_fees
    ADD CONSTRAINT dfns_sponsored_fees_fee_sponsor_id_fkey FOREIGN KEY (fee_sponsor_id) REFERENCES public.dfns_fee_sponsors(sponsor_id) ON DELETE CASCADE;


--
-- Name: dfns_sponsored_fees dfns_sponsored_fees_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_sponsored_fees
    ADD CONSTRAINT dfns_sponsored_fees_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_staking_integrations dfns_staking_integrations_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_staking_integrations
    ADD CONSTRAINT dfns_staking_integrations_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_transaction_history dfns_transaction_history_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transaction_history
    ADD CONSTRAINT dfns_transaction_history_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_transfers dfns_transfers_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_transfers
    ADD CONSTRAINT dfns_transfers_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_wallet_balances dfns_wallet_balances_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_balances
    ADD CONSTRAINT dfns_wallet_balances_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_wallet_nfts dfns_wallet_nfts_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallet_nfts
    ADD CONSTRAINT dfns_wallet_nfts_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.dfns_wallets(wallet_id) ON DELETE CASCADE;


--
-- Name: dfns_wallets dfns_wallets_signing_key_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_wallets
    ADD CONSTRAINT dfns_wallets_signing_key_id_fkey FOREIGN KEY (signing_key_id) REFERENCES public.dfns_signing_keys(key_id) ON DELETE RESTRICT;


--
-- Name: dfns_webhook_deliveries dfns_webhook_deliveries_webhook_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dfns_webhook_deliveries
    ADD CONSTRAINT dfns_webhook_deliveries_webhook_id_fkey FOREIGN KEY (webhook_id) REFERENCES public.dfns_webhooks(webhook_id) ON DELETE CASCADE;


--
-- Name: digital_tokenized_fund_products digital_tokenized_fund_products_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenized_fund_products
    ADD CONSTRAINT digital_tokenized_fund_products_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: distribution_redemptions distribution_redemptions_distribution_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distribution_redemptions
    ADD CONSTRAINT distribution_redemptions_distribution_fkey FOREIGN KEY (distribution_id) REFERENCES public.distributions(id) ON DELETE CASCADE;


--
-- Name: distribution_redemptions distribution_redemptions_redemption_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distribution_redemptions
    ADD CONSTRAINT distribution_redemptions_redemption_fkey FOREIGN KEY (redemption_request_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: distributions distributions_investor_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distributions
    ADD CONSTRAINT distributions_investor_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: distributions distributions_project_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distributions
    ADD CONSTRAINT distributions_project_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE SET NULL;


--
-- Name: distributions distributions_subscription_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distributions
    ADD CONSTRAINT distributions_subscription_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id) ON DELETE CASCADE;


--
-- Name: distributions distributions_wallet_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.distributions
    ADD CONSTRAINT distributions_wallet_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE SET NULL;


--
-- Name: document_approvals document_approvals_approver_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_approvals
    ADD CONSTRAINT document_approvals_approver_id_fkey FOREIGN KEY (approver_id) REFERENCES public.users(id);


--
-- Name: document_approvals document_approvals_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_approvals
    ADD CONSTRAINT document_approvals_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id) ON DELETE CASCADE;


--
-- Name: document_versions document_versions_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_versions
    ADD CONSTRAINT document_versions_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id) ON DELETE CASCADE;


--
-- Name: document_versions document_versions_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_versions
    ADD CONSTRAINT document_versions_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(id);


--
-- Name: document_workflows document_workflows_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_workflows
    ADD CONSTRAINT document_workflows_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: document_workflows document_workflows_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_workflows
    ADD CONSTRAINT document_workflows_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.issuer_documents(id) ON DELETE CASCADE;


--
-- Name: document_workflows document_workflows_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_workflows
    ADD CONSTRAINT document_workflows_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id);


--
-- Name: documents documents_workflow_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_workflow_stage_id_fkey FOREIGN KEY (workflow_stage_id) REFERENCES public.workflow_stages(id);


--
-- Name: dtf_blockchain_events dtf_blockchain_events_digital_tokenized_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_blockchain_events
    ADD CONSTRAINT dtf_blockchain_events_digital_tokenized_fund_product_id_fkey FOREIGN KEY (digital_tokenized_fund_product_id) REFERENCES public.digital_tokenized_fund_products(id) ON DELETE CASCADE;


--
-- Name: dtf_blockchain_events dtf_blockchain_events_dtf_token_metadata_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_blockchain_events
    ADD CONSTRAINT dtf_blockchain_events_dtf_token_metadata_id_fkey FOREIGN KEY (dtf_token_metadata_id) REFERENCES public.dtf_token_metadata(id);


--
-- Name: dtf_minting_history dtf_minting_history_digital_tokenized_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_minting_history
    ADD CONSTRAINT dtf_minting_history_digital_tokenized_fund_product_id_fkey FOREIGN KEY (digital_tokenized_fund_product_id) REFERENCES public.digital_tokenized_fund_products(id) ON DELETE CASCADE;


--
-- Name: dtf_minting_history dtf_minting_history_dtf_token_metadata_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_minting_history
    ADD CONSTRAINT dtf_minting_history_dtf_token_metadata_id_fkey FOREIGN KEY (dtf_token_metadata_id) REFERENCES public.dtf_token_metadata(id);


--
-- Name: dtf_nav_snapshots dtf_nav_snapshots_digital_tokenized_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_nav_snapshots
    ADD CONSTRAINT dtf_nav_snapshots_digital_tokenized_fund_product_id_fkey FOREIGN KEY (digital_tokenized_fund_product_id) REFERENCES public.digital_tokenized_fund_products(id) ON DELETE CASCADE;


--
-- Name: dtf_nav_snapshots dtf_nav_snapshots_dtf_token_metadata_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_nav_snapshots
    ADD CONSTRAINT dtf_nav_snapshots_dtf_token_metadata_id_fkey FOREIGN KEY (dtf_token_metadata_id) REFERENCES public.dtf_token_metadata(id);


--
-- Name: dtf_redemption_requests dtf_redemption_requests_digital_tokenized_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_redemption_requests
    ADD CONSTRAINT dtf_redemption_requests_digital_tokenized_fund_product_id_fkey FOREIGN KEY (digital_tokenized_fund_product_id) REFERENCES public.digital_tokenized_fund_products(id) ON DELETE CASCADE;


--
-- Name: dtf_redemption_requests dtf_redemption_requests_dtf_token_metadata_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_redemption_requests
    ADD CONSTRAINT dtf_redemption_requests_dtf_token_metadata_id_fkey FOREIGN KEY (dtf_token_metadata_id) REFERENCES public.dtf_token_metadata(id);


--
-- Name: dtf_token_metadata dtf_token_metadata_digital_tokenized_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dtf_token_metadata
    ADD CONSTRAINT dtf_token_metadata_digital_tokenized_fund_product_id_fkey FOREIGN KEY (digital_tokenized_fund_product_id) REFERENCES public.digital_tokenized_fund_products(id) ON DELETE CASCADE;


--
-- Name: energy_assets energy_assets_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_assets
    ADD CONSTRAINT energy_assets_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES public.users(id);


--
-- Name: environmental_certifications environmental_certifications_real_estate_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.environmental_certifications
    ADD CONSTRAINT environmental_certifications_real_estate_product_id_fkey FOREIGN KEY (real_estate_product_id) REFERENCES public.real_estate_products(id) ON DELETE CASCADE;


--
-- Name: etf_creation_redemption etf_creation_redemption_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_creation_redemption
    ADD CONSTRAINT etf_creation_redemption_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_holdings etf_holdings_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_holdings
    ADD CONSTRAINT etf_holdings_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_metadata etf_metadata_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_metadata
    ADD CONSTRAINT etf_metadata_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_nav_history etf_nav_history_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_nav_history
    ADD CONSTRAINT etf_nav_history_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_rebalancing_history etf_rebalancing_history_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_rebalancing_history
    ADD CONSTRAINT etf_rebalancing_history_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_token_links etf_token_links_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_token_links
    ADD CONSTRAINT etf_token_links_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: etf_token_links etf_token_links_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_token_links
    ADD CONSTRAINT etf_token_links_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: etf_tracking_error_history etf_tracking_error_history_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.etf_tracking_error_history
    ADD CONSTRAINT etf_tracking_error_history_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: exchange_rate_history exchange_rate_history_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.exchange_rate_history
    ADD CONSTRAINT exchange_rate_history_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: fiat_quotes fiat_quotes_converted_to_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fiat_quotes
    ADD CONSTRAINT fiat_quotes_converted_to_transaction_id_fkey FOREIGN KEY (converted_to_transaction_id) REFERENCES public.fiat_transactions(id);


--
-- Name: redemption_analytics fk_analytics_window; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_analytics
    ADD CONSTRAINT fk_analytics_window FOREIGN KEY (redemption_window_id) REFERENCES public.redemption_windows(id) ON DELETE CASCADE;


--
-- Name: asset_backed_products fk_asset_backed_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_backed_products
    ADD CONSTRAINT fk_asset_backed_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: bond_products fk_bond_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.bond_products
    ADD CONSTRAINT fk_bond_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: climate_incentives fk_climate_incentives_project_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.climate_incentives
    ADD CONSTRAINT fk_climate_incentives_project_id FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE SET NULL;


--
-- Name: collectibles_products fk_collectibles_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.collectibles_products
    ADD CONSTRAINT fk_collectibles_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: commodities_products fk_commodities_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commodities_products
    ADD CONSTRAINT fk_commodities_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: digital_tokenised_funds fk_digital_tokenised_funds_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.digital_tokenised_funds
    ADD CONSTRAINT fk_digital_tokenised_funds_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: energy_products fk_energy_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.energy_products
    ADD CONSTRAINT fk_energy_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: equity_products fk_equity_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.equity_products
    ADD CONSTRAINT fk_equity_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: fund_products fk_fund_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_products
    ADD CONSTRAINT fk_fund_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: infrastructure_products fk_infrastructure_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infrastructure_products
    ADD CONSTRAINT fk_infrastructure_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: investor_documents fk_investor_documents_created_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_documents
    ADD CONSTRAINT fk_investor_documents_created_by FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: investor_documents fk_investor_documents_investor_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_documents
    ADD CONSTRAINT fk_investor_documents_investor_id FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: investor_documents fk_investor_documents_reviewed_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_documents
    ADD CONSTRAINT fk_investor_documents_reviewed_by FOREIGN KEY (reviewed_by) REFERENCES auth.users(id);


--
-- Name: investor_documents fk_investor_documents_updated_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_documents
    ADD CONSTRAINT fk_investor_documents_updated_by FOREIGN KEY (updated_by) REFERENCES auth.users(id);


--
-- Name: investors fk_investors_user_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investors
    ADD CONSTRAINT fk_investors_user_id FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE SET NULL;


--
-- Name: key_vault_keys fk_key_vault_keys_investor_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT fk_key_vault_keys_investor_id FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: key_vault_keys fk_key_vault_keys_user_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT fk_key_vault_keys_user_id FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: redemption_notifications fk_notifications_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_notifications
    ADD CONSTRAINT fk_notifications_user FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: redemption_notifications fk_notifications_window; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_notifications
    ADD CONSTRAINT fk_notifications_window FOREIGN KEY (redemption_window_id) REFERENCES public.redemption_windows(id) ON DELETE CASCADE;


--
-- Name: private_debt_products fk_private_debt_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_debt_products
    ADD CONSTRAINT fk_private_debt_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: private_equity_products fk_private_equity_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.private_equity_products
    ADD CONSTRAINT fk_private_equity_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: token_deployment_history fk_project_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_history
    ADD CONSTRAINT fk_project_id FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: projects fk_projects_organization; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT fk_projects_organization FOREIGN KEY (organization_id) REFERENCES public.organizations(id);


--
-- Name: quantitative_strategies fk_quantitative_strategies_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_strategies
    ADD CONSTRAINT fk_quantitative_strategies_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: real_estate_products fk_real_estate_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.real_estate_products
    ADD CONSTRAINT fk_real_estate_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: redemption_approvers fk_redemption_approvers_redemption_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_approvers
    ADD CONSTRAINT fk_redemption_approvers_redemption_id FOREIGN KEY (redemption_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: redemption_requests fk_redemption_requests_approved_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT fk_redemption_requests_approved_by FOREIGN KEY (approved_by) REFERENCES auth.users(id);


--
-- Name: redemption_requests fk_redemption_requests_processed_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT fk_redemption_requests_processed_by FOREIGN KEY (processed_by) REFERENCES auth.users(id);


--
-- Name: redemption_requests fk_redemption_requests_requested_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT fk_redemption_requests_requested_by FOREIGN KEY (requested_by) REFERENCES auth.users(id);


--
-- Name: redemption_requests fk_redemption_requests_window; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT fk_redemption_requests_window FOREIGN KEY (redemption_window_id) REFERENCES public.redemption_windows(id) ON DELETE CASCADE;


--
-- Name: redemption_rules fk_redemption_rules_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_rules
    ADD CONSTRAINT fk_redemption_rules_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: redemption_windows fk_redemption_windows_approved_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT fk_redemption_windows_approved_by FOREIGN KEY (approved_by) REFERENCES auth.users(id);


--
-- Name: redemption_windows fk_redemption_windows_last_modified_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT fk_redemption_windows_last_modified_by FOREIGN KEY (last_modified_by) REFERENCES auth.users(id);


--
-- Name: redemption_windows fk_redemption_windows_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT fk_redemption_windows_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: renewable_energy_credits fk_renewable_energy_credits_incentive_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.renewable_energy_credits
    ADD CONSTRAINT fk_renewable_energy_credits_incentive_id FOREIGN KEY (incentive_id) REFERENCES public.climate_incentives(incentive_id) ON DELETE SET NULL;


--
-- Name: renewable_energy_credits fk_renewable_energy_credits_project_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.renewable_energy_credits
    ADD CONSTRAINT fk_renewable_energy_credits_project_id FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE SET NULL;


--
-- Name: stablecoin_collateral fk_stablecoin_collateral_stablecoin; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stablecoin_collateral
    ADD CONSTRAINT fk_stablecoin_collateral_stablecoin FOREIGN KEY (stablecoin_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: stablecoin_products fk_stablecoin_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stablecoin_products
    ADD CONSTRAINT fk_stablecoin_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: structured_products fk_structured_products_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.structured_products
    ADD CONSTRAINT fk_structured_products_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: redemption_window_templates fk_templates_created_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_window_templates
    ADD CONSTRAINT fk_templates_created_by FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: redemption_window_templates fk_templates_project; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_window_templates
    ADD CONSTRAINT fk_templates_project FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: deployment_rate_limits fk_token; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.deployment_rate_limits
    ADD CONSTRAINT fk_token FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_events fk_token; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_events
    ADD CONSTRAINT fk_token FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_deployment_history fk_token_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_history
    ADD CONSTRAINT fk_token_id FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_whitelists fk_token_whitelists_token_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_whitelists
    ADD CONSTRAINT fk_token_whitelists_token_id FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: wallet_transaction_drafts fk_wallet_transaction_drafts_wallet_id; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_transaction_drafts
    ADD CONSTRAINT fk_wallet_transaction_drafts_wallet_id FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: fund_nav_data fund_nav_data_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_nav_data
    ADD CONSTRAINT fund_nav_data_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: fund_nav_data fund_nav_data_validated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_nav_data
    ADD CONSTRAINT fund_nav_data_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES auth.users(id);


--
-- Name: fund_products fund_products_parent_fund_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fund_products
    ADD CONSTRAINT fund_products_parent_fund_id_fkey FOREIGN KEY (parent_fund_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: guardian_operations guardian_operations_related_test_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_operations
    ADD CONSTRAINT guardian_operations_related_test_id_fkey FOREIGN KEY (related_test_id) REFERENCES public.guardian_api_tests(id);


--
-- Name: guardian_wallets guardian_wallets_creation_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_wallets
    ADD CONSTRAINT guardian_wallets_creation_request_id_fkey FOREIGN KEY (creation_request_id) REFERENCES public.guardian_api_tests(id);


--
-- Name: guardian_wallets guardian_wallets_operation_check_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_wallets
    ADD CONSTRAINT guardian_wallets_operation_check_request_id_fkey FOREIGN KEY (operation_check_request_id) REFERENCES public.guardian_api_tests(id);


--
-- Name: guardian_wallets guardian_wallets_wallet_details_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.guardian_wallets
    ADD CONSTRAINT guardian_wallets_wallet_details_request_id_fkey FOREIGN KEY (wallet_details_request_id) REFERENCES public.guardian_api_tests(id);


--
-- Name: individual_documents individual_documents_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.individual_documents
    ADD CONSTRAINT individual_documents_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES auth.users(id);


--
-- Name: individual_documents individual_documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.individual_documents
    ADD CONSTRAINT individual_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES auth.users(id);


--
-- Name: infra_capex_schedule infra_capex_schedule_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_capex_schedule
    ADD CONSTRAINT infra_capex_schedule_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: infra_concessions infra_concessions_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_concessions
    ADD CONSTRAINT infra_concessions_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: infra_operating_expenses infra_operating_expenses_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_operating_expenses
    ADD CONSTRAINT infra_operating_expenses_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: infra_regulatory_filings infra_regulatory_filings_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_regulatory_filings
    ADD CONSTRAINT infra_regulatory_filings_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: infra_revenue_streams infra_revenue_streams_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_revenue_streams
    ADD CONSTRAINT infra_revenue_streams_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: infra_usage_metrics infra_usage_metrics_infrastructure_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.infra_usage_metrics
    ADD CONSTRAINT infra_usage_metrics_infrastructure_product_id_fkey FOREIGN KEY (infrastructure_product_id) REFERENCES public.infrastructure_products(id) ON DELETE CASCADE;


--
-- Name: investor_approvals investor_approvals_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_approvals
    ADD CONSTRAINT investor_approvals_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id);


--
-- Name: investor_approvals investor_approvals_reviewer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_approvals
    ADD CONSTRAINT investor_approvals_reviewer_id_fkey FOREIGN KEY (reviewer_id) REFERENCES auth.users(id);


--
-- Name: investor_group_members investor_group_members_group_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_group_members
    ADD CONSTRAINT investor_group_members_group_fkey FOREIGN KEY (group_id) REFERENCES public.investor_groups(id) ON DELETE CASCADE;


--
-- Name: investor_group_members investor_group_members_investor_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_group_members
    ADD CONSTRAINT investor_group_members_investor_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: investor_groups_investors investor_groups_investors_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups_investors
    ADD CONSTRAINT investor_groups_investors_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.investor_groups(id) ON DELETE CASCADE;


--
-- Name: investor_groups_investors investor_groups_investors_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups_investors
    ADD CONSTRAINT investor_groups_investors_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: investor_groups investor_groups_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investor_groups
    ADD CONSTRAINT investor_groups_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: investors investors_compliance_checked_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.investors
    ADD CONSTRAINT investors_compliance_checked_by_fkey FOREIGN KEY (compliance_checked_by) REFERENCES auth.users(id);


--
-- Name: invoice_aging_buckets invoice_aging_buckets_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_aging_buckets
    ADD CONSTRAINT invoice_aging_buckets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: invoice_collection_history invoice_collection_history_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_collection_history
    ADD CONSTRAINT invoice_collection_history_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: invoice invoice_payer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice
    ADD CONSTRAINT invoice_payer_id_fkey FOREIGN KEY (payer_id) REFERENCES public.payer(payer_id);


--
-- Name: invoice_payments invoice_payments_invoice_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_payments
    ADD CONSTRAINT invoice_payments_invoice_receivable_id_fkey FOREIGN KEY (invoice_receivable_id) REFERENCES public.invoice_receivables(id) ON DELETE CASCADE;


--
-- Name: invoice invoice_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice
    ADD CONSTRAINT invoice_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool(pool_id);


--
-- Name: invoice invoice_provider_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice
    ADD CONSTRAINT invoice_provider_id_fkey FOREIGN KEY (provider_id) REFERENCES public.provider(provider_id);


--
-- Name: invoice_receivables invoice_receivables_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoice_receivables
    ADD CONSTRAINT invoice_receivables_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: issuer_access_roles issuer_access_roles_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_access_roles
    ADD CONSTRAINT issuer_access_roles_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: issuer_access_roles issuer_access_roles_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_access_roles
    ADD CONSTRAINT issuer_access_roles_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id);


--
-- Name: issuer_access_roles issuer_access_roles_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_access_roles
    ADD CONSTRAINT issuer_access_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id);


--
-- Name: issuer_detail_documents issuer_detail_documents_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_detail_documents
    ADD CONSTRAINT issuer_detail_documents_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: issuer_documents issuer_documents_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_documents
    ADD CONSTRAINT issuer_documents_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: issuer_documents issuer_documents_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_documents
    ADD CONSTRAINT issuer_documents_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES auth.users(id);


--
-- Name: issuer_documents issuer_documents_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.issuer_documents
    ADD CONSTRAINT issuer_documents_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id);


--
-- Name: key_vault_keys key_vault_keys_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT key_vault_keys_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: key_vault_keys key_vault_keys_project_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT key_vault_keys_project_wallet_id_fkey FOREIGN KEY (project_wallet_id) REFERENCES public.project_wallets(id) ON DELETE CASCADE;


--
-- Name: key_vault_keys key_vault_keys_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.key_vault_keys
    ADD CONSTRAINT key_vault_keys_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: kyc_screening_logs kyc_screening_logs_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kyc_screening_logs
    ADD CONSTRAINT kyc_screening_logs_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: lease_agreements lease_agreements_real_estate_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lease_agreements
    ADD CONSTRAINT lease_agreements_real_estate_product_id_fkey FOREIGN KEY (real_estate_product_id) REFERENCES public.real_estate_products(id) ON DELETE CASCADE;


--
-- Name: mmf_allocation_history mmf_allocation_history_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_allocation_history
    ADD CONSTRAINT mmf_allocation_history_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_fees_gates mmf_fees_gates_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_fees_gates
    ADD CONSTRAINT mmf_fees_gates_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_holdings mmf_holdings_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_holdings
    ADD CONSTRAINT mmf_holdings_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_liquidity_buckets mmf_liquidity_buckets_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_liquidity_buckets
    ADD CONSTRAINT mmf_liquidity_buckets_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_nav_history mmf_nav_history_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_nav_history
    ADD CONSTRAINT mmf_nav_history_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_transactions mmf_transactions_fund_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_transactions
    ADD CONSTRAINT mmf_transactions_fund_product_id_fkey FOREIGN KEY (fund_product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: mmf_transactions mmf_transactions_holding_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_transactions
    ADD CONSTRAINT mmf_transactions_holding_id_fkey FOREIGN KEY (holding_id) REFERENCES public.mmf_holdings(id);


--
-- Name: mmf_transactions mmf_transactions_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_transactions
    ADD CONSTRAINT mmf_transactions_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE SET NULL;


--
-- Name: mmf_transactions mmf_transactions_subscription_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.mmf_transactions
    ADD CONSTRAINT mmf_transactions_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id) ON DELETE SET NULL;


--
-- Name: multi_sig_audit_log multi_sig_audit_log_actor_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_audit_log
    ADD CONSTRAINT multi_sig_audit_log_actor_fkey FOREIGN KEY (actor) REFERENCES auth.users(id);


--
-- Name: multi_sig_audit_log multi_sig_audit_log_proposal_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_audit_log
    ADD CONSTRAINT multi_sig_audit_log_proposal_id_fkey FOREIGN KEY (proposal_id) REFERENCES public.multi_sig_proposals(id);


--
-- Name: multi_sig_audit_log multi_sig_audit_log_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_audit_log
    ADD CONSTRAINT multi_sig_audit_log_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id);


--
-- Name: multi_sig_configurations multi_sig_configurations_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_configurations
    ADD CONSTRAINT multi_sig_configurations_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: multi_sig_on_chain_confirmations multi_sig_on_chain_confirmations_on_chain_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_confirmations
    ADD CONSTRAINT multi_sig_on_chain_confirmations_on_chain_transaction_id_fkey FOREIGN KEY (on_chain_transaction_id) REFERENCES public.multi_sig_on_chain_transactions(id) ON DELETE CASCADE;


--
-- Name: multi_sig_on_chain_transactions multi_sig_on_chain_transactions_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_on_chain_transactions
    ADD CONSTRAINT multi_sig_on_chain_transactions_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: multi_sig_proposals multi_sig_proposals_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_proposals
    ADD CONSTRAINT multi_sig_proposals_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: multi_sig_proposals multi_sig_proposals_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_proposals
    ADD CONSTRAINT multi_sig_proposals_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_added_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_added_by_fkey FOREIGN KEY (added_by) REFERENCES auth.users(id);


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_user_address_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_user_address_id_fkey FOREIGN KEY (user_address_id) REFERENCES public.user_addresses(id);


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: multi_sig_wallet_owners multi_sig_wallet_owners_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallet_owners
    ADD CONSTRAINT multi_sig_wallet_owners_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: multi_sig_wallets multi_sig_wallets_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallets
    ADD CONSTRAINT multi_sig_wallets_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: multi_sig_wallets multi_sig_wallets_funded_by_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallets
    ADD CONSTRAINT multi_sig_wallets_funded_by_wallet_id_fkey FOREIGN KEY (funded_by_wallet_id) REFERENCES public.project_wallets(id) ON DELETE SET NULL;


--
-- Name: multi_sig_wallets multi_sig_wallets_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multi_sig_wallets
    ADD CONSTRAINT multi_sig_wallets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: nav_approvals nav_approvals_run_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_approvals
    ADD CONSTRAINT nav_approvals_run_id_fkey FOREIGN KEY (run_id) REFERENCES public.nav_calculation_runs(id) ON DELETE CASCADE;


--
-- Name: nav_calculation_runs nav_calculation_runs_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_calculation_runs
    ADD CONSTRAINT nav_calculation_runs_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: nav_oracle_configs nav_oracle_configs_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_oracle_configs
    ADD CONSTRAINT nav_oracle_configs_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: nav_validation_results nav_validation_results_run_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.nav_validation_results
    ADD CONSTRAINT nav_validation_results_run_id_fkey FOREIGN KEY (run_id) REFERENCES public.nav_calculation_runs(id) ON DELETE CASCADE;


--
-- Name: notification_settings notification_settings_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_settings
    ADD CONSTRAINT notification_settings_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: notification_settings notification_settings_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_settings
    ADD CONSTRAINT notification_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id);


--
-- Name: onchain_claims onchain_claims_identity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_claims
    ADD CONSTRAINT onchain_claims_identity_id_fkey FOREIGN KEY (identity_id) REFERENCES public.onchain_identities(id) ON DELETE CASCADE;


--
-- Name: onchain_claims onchain_claims_issuer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_claims
    ADD CONSTRAINT onchain_claims_issuer_id_fkey FOREIGN KEY (issuer_id) REFERENCES public.onchain_issuers(id) ON DELETE CASCADE;


--
-- Name: onchain_identities onchain_identities_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_identities
    ADD CONSTRAINT onchain_identities_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: onchain_verification_history onchain_verification_history_identity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.onchain_verification_history
    ADD CONSTRAINT onchain_verification_history_identity_id_fkey FOREIGN KEY (identity_id) REFERENCES public.onchain_identities(id) ON DELETE CASCADE;


--
-- Name: operation_metadata operation_metadata_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_metadata
    ADD CONSTRAINT operation_metadata_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id) ON DELETE CASCADE;


--
-- Name: operation_validations operation_validations_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_validations
    ADD CONSTRAINT operation_validations_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: operation_validations operation_validations_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_validations
    ADD CONSTRAINT operation_validations_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.rules(rule_id);


--
-- Name: operation_validations operation_validations_validated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.operation_validations
    ADD CONSTRAINT operation_validations_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id);


--
-- Name: paymaster_operations paymaster_operations_user_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.paymaster_operations
    ADD CONSTRAINT paymaster_operations_user_operation_id_fkey FOREIGN KEY (user_operation_id) REFERENCES public.user_operations(id) ON DELETE CASCADE;


--
-- Name: pd_collateral pd_collateral_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_collateral
    ADD CONSTRAINT pd_collateral_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_covenants pd_covenants_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_covenants
    ADD CONSTRAINT pd_covenants_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_credit_ratings pd_credit_ratings_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_credit_ratings
    ADD CONSTRAINT pd_credit_ratings_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_default_events pd_default_events_covenant_breached_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_default_events
    ADD CONSTRAINT pd_default_events_covenant_breached_id_fkey FOREIGN KEY (covenant_breached_id) REFERENCES public.pd_covenants(id);


--
-- Name: pd_default_events pd_default_events_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_default_events
    ADD CONSTRAINT pd_default_events_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_loan_schedules pd_loan_schedules_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_loan_schedules
    ADD CONSTRAINT pd_loan_schedules_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_payment_history pd_payment_history_private_debt_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_payment_history
    ADD CONSTRAINT pd_payment_history_private_debt_product_id_fkey FOREIGN KEY (private_debt_product_id) REFERENCES public.private_debt_products(id) ON DELETE CASCADE;


--
-- Name: pd_payment_history pd_payment_history_scheduled_payment_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pd_payment_history
    ADD CONSTRAINT pd_payment_history_scheduled_payment_id_fkey FOREIGN KEY (scheduled_payment_id) REFERENCES public.pd_loan_schedules(id);


--
-- Name: pe_capital_calls pe_capital_calls_private_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_capital_calls
    ADD CONSTRAINT pe_capital_calls_private_equity_product_id_fkey FOREIGN KEY (private_equity_product_id) REFERENCES public.private_equity_products(id) ON DELETE CASCADE;


--
-- Name: pe_distributions pe_distributions_private_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_distributions
    ADD CONSTRAINT pe_distributions_private_equity_product_id_fkey FOREIGN KEY (private_equity_product_id) REFERENCES public.private_equity_products(id) ON DELETE CASCADE;


--
-- Name: pe_performance_metrics pe_performance_metrics_private_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_performance_metrics
    ADD CONSTRAINT pe_performance_metrics_private_equity_product_id_fkey FOREIGN KEY (private_equity_product_id) REFERENCES public.private_equity_products(id) ON DELETE CASCADE;


--
-- Name: pe_portfolio_companies pe_portfolio_companies_private_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pe_portfolio_companies
    ADD CONSTRAINT pe_portfolio_companies_private_equity_product_id_fkey FOREIGN KEY (private_equity_product_id) REFERENCES public.private_equity_products(id) ON DELETE CASCADE;


--
-- Name: policy_operation_mappings policy_operation_mappings_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_operation_mappings
    ADD CONSTRAINT policy_operation_mappings_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.rules(rule_id);


--
-- Name: policy_rule_approvers policy_rule_approvers_policy_rule_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_rule_approvers
    ADD CONSTRAINT policy_rule_approvers_policy_rule_id_fkey FOREIGN KEY (policy_rule_id) REFERENCES public.rules(rule_id) ON DELETE CASCADE;


--
-- Name: policy_template_approvers policy_template_approvers_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_template_approvers
    ADD CONSTRAINT policy_template_approvers_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.policy_templates(template_id) ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED;


--
-- Name: CONSTRAINT policy_template_approvers_template_id_fkey ON policy_template_approvers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT policy_template_approvers_template_id_fkey ON public.policy_template_approvers IS 'Foreign key to policy_templates with deferred checking to allow templates and approvers to be created in the same transaction. CASCADE DELETE ensures automatic cleanup.';


--
-- Name: policy_template_approvers policy_template_approvers_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_template_approvers
    ADD CONSTRAINT policy_template_approvers_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- Name: policy_violations policy_violations_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_violations
    ADD CONSTRAINT policy_violations_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: policy_violations policy_violations_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_violations
    ADD CONSTRAINT policy_violations_policy_id_fkey FOREIGN KEY (policy_id) REFERENCES public.rules(rule_id);


--
-- Name: policy_violations policy_violations_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.policy_violations
    ADD CONSTRAINT policy_violations_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(id);


--
-- Name: production_data production_data_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.production_data
    ADD CONSTRAINT production_data_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: production_data production_data_weather_condition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.production_data
    ADD CONSTRAINT production_data_weather_condition_id_fkey FOREIGN KEY (weather_condition_id) REFERENCES public.weather_data(weather_id);


--
-- Name: profiles profiles_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: profiles profiles_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: project_organization_assignments project_organization_assignments_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_organization_assignments
    ADD CONSTRAINT project_organization_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES auth.users(id);


--
-- Name: project_organization_assignments project_organization_assignments_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_organization_assignments
    ADD CONSTRAINT project_organization_assignments_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: project_organization_assignments project_organization_assignments_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_organization_assignments
    ADD CONSTRAINT project_organization_assignments_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: project_wallets project_wallets_mnemonic_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_wallets
    ADD CONSTRAINT project_wallets_mnemonic_vault_id_fkey FOREIGN KEY (mnemonic_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE RESTRICT;


--
-- Name: project_wallets project_wallets_private_key_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_wallets
    ADD CONSTRAINT project_wallets_private_key_vault_id_fkey FOREIGN KEY (private_key_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE RESTRICT;


--
-- Name: project_wallets project_wallets_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_wallets
    ADD CONSTRAINT project_wallets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: property_expenses property_expenses_real_estate_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_expenses
    ADD CONSTRAINT property_expenses_real_estate_product_id_fkey FOREIGN KEY (real_estate_product_id) REFERENCES public.real_estate_products(id) ON DELETE CASCADE;


--
-- Name: property_insurance property_insurance_real_estate_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_insurance
    ADD CONSTRAINT property_insurance_real_estate_product_id_fkey FOREIGN KEY (real_estate_product_id) REFERENCES public.real_estate_products(id) ON DELETE CASCADE;


--
-- Name: property_valuations property_valuations_real_estate_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.property_valuations
    ADD CONSTRAINT property_valuations_real_estate_product_id_fkey FOREIGN KEY (real_estate_product_id) REFERENCES public.real_estate_products(id) ON DELETE CASCADE;


--
-- Name: psp_api_keys psp_api_keys_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_api_keys
    ADD CONSTRAINT psp_api_keys_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: psp_api_keys psp_api_keys_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_api_keys
    ADD CONSTRAINT psp_api_keys_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_api_keys psp_api_keys_warp_api_key_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_api_keys
    ADD CONSTRAINT psp_api_keys_warp_api_key_vault_id_fkey FOREIGN KEY (warp_api_key_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE SET NULL;


--
-- Name: psp_balances psp_balances_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_balances
    ADD CONSTRAINT psp_balances_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_balances psp_balances_virtual_account_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_balances
    ADD CONSTRAINT psp_balances_virtual_account_id_fkey FOREIGN KEY (virtual_account_id) REFERENCES public.psp_virtual_accounts(id);


--
-- Name: psp_external_accounts psp_external_accounts_account_number_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_external_accounts
    ADD CONSTRAINT psp_external_accounts_account_number_vault_id_fkey FOREIGN KEY (account_number_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE SET NULL;


--
-- Name: psp_external_accounts psp_external_accounts_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_external_accounts
    ADD CONSTRAINT psp_external_accounts_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_external_accounts psp_external_accounts_routing_number_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_external_accounts
    ADD CONSTRAINT psp_external_accounts_routing_number_vault_id_fkey FOREIGN KEY (routing_number_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE SET NULL;


--
-- Name: psp_fiat_crypto_spreads psp_fiat_crypto_spreads_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_fiat_crypto_spreads
    ADD CONSTRAINT psp_fiat_crypto_spreads_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: psp_fiat_crypto_spreads psp_fiat_crypto_spreads_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_fiat_crypto_spreads
    ADD CONSTRAINT psp_fiat_crypto_spreads_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_fiat_crypto_spreads psp_fiat_crypto_spreads_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_fiat_crypto_spreads
    ADD CONSTRAINT psp_fiat_crypto_spreads_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id);


--
-- Name: psp_identity_cases psp_identity_cases_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_identity_cases
    ADD CONSTRAINT psp_identity_cases_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_payment_settings psp_payment_settings_offramp_target_account_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payment_settings
    ADD CONSTRAINT psp_payment_settings_offramp_target_account_id_fkey FOREIGN KEY (offramp_target_account_id) REFERENCES public.psp_external_accounts(id);


--
-- Name: psp_payment_settings psp_payment_settings_onramp_target_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payment_settings
    ADD CONSTRAINT psp_payment_settings_onramp_target_wallet_id_fkey FOREIGN KEY (onramp_target_wallet_id) REFERENCES public.psp_external_accounts(id);


--
-- Name: psp_payment_settings psp_payment_settings_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payment_settings
    ADD CONSTRAINT psp_payment_settings_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_payments psp_payments_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_payments
    ADD CONSTRAINT psp_payments_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_trades psp_trades_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_trades
    ADD CONSTRAINT psp_trades_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_trades psp_trades_virtual_account_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_trades
    ADD CONSTRAINT psp_trades_virtual_account_id_fkey FOREIGN KEY (virtual_account_id) REFERENCES public.psp_virtual_accounts(id);


--
-- Name: psp_virtual_accounts psp_virtual_accounts_identity_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_virtual_accounts
    ADD CONSTRAINT psp_virtual_accounts_identity_case_id_fkey FOREIGN KEY (identity_case_id) REFERENCES public.psp_identity_cases(id);


--
-- Name: psp_virtual_accounts psp_virtual_accounts_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_virtual_accounts
    ADD CONSTRAINT psp_virtual_accounts_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: psp_webhook_events psp_webhook_events_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhook_events
    ADD CONSTRAINT psp_webhook_events_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: psp_webhook_events psp_webhook_events_webhook_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhook_events
    ADD CONSTRAINT psp_webhook_events_webhook_id_fkey FOREIGN KEY (webhook_id) REFERENCES public.psp_webhooks(id) ON DELETE CASCADE;


--
-- Name: psp_webhooks psp_webhooks_auth_password_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhooks
    ADD CONSTRAINT psp_webhooks_auth_password_vault_id_fkey FOREIGN KEY (auth_password_vault_id) REFERENCES public.key_vault_keys(id) ON DELETE SET NULL;


--
-- Name: psp_webhooks psp_webhooks_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.psp_webhooks
    ADD CONSTRAINT psp_webhooks_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: quant_backtests quant_backtests_quantitative_investment_strategies_product_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_backtests
    ADD CONSTRAINT quant_backtests_quantitative_investment_strategies_product_fkey FOREIGN KEY (quantitative_investment_strategies_product_id) REFERENCES public.quantitative_investment_strategies_products(id) ON DELETE CASCADE;


--
-- Name: quant_factors quant_factors_quantitative_investment_strategies_product_i_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_factors
    ADD CONSTRAINT quant_factors_quantitative_investment_strategies_product_i_fkey FOREIGN KEY (quantitative_investment_strategies_product_id) REFERENCES public.quantitative_investment_strategies_products(id) ON DELETE CASCADE;


--
-- Name: quant_performance_attribution quant_performance_attribution_quantitative_investment_stra_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_performance_attribution
    ADD CONSTRAINT quant_performance_attribution_quantitative_investment_stra_fkey FOREIGN KEY (quantitative_investment_strategies_product_id) REFERENCES public.quantitative_investment_strategies_products(id) ON DELETE CASCADE;


--
-- Name: quant_risk_metrics quant_risk_metrics_quantitative_investment_strategies_prod_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_risk_metrics
    ADD CONSTRAINT quant_risk_metrics_quantitative_investment_strategies_prod_fkey FOREIGN KEY (quantitative_investment_strategies_product_id) REFERENCES public.quantitative_investment_strategies_products(id) ON DELETE CASCADE;


--
-- Name: quant_signals quant_signals_quantitative_investment_strategies_product_i_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quant_signals
    ADD CONSTRAINT quant_signals_quantitative_investment_strategies_product_i_fkey FOREIGN KEY (quantitative_investment_strategies_product_id) REFERENCES public.quantitative_investment_strategies_products(id) ON DELETE CASCADE;


--
-- Name: quantitative_investment_strategies_products quantitative_investment_strategies_products_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.quantitative_investment_strategies_products
    ADD CONSTRAINT quantitative_investment_strategies_products_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: ramp_transaction_events ramp_transaction_events_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ramp_transaction_events
    ADD CONSTRAINT ramp_transaction_events_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.fiat_transactions(id) ON DELETE CASCADE;


--
-- Name: recent_address_selections recent_address_selections_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.recent_address_selections
    ADD CONSTRAINT recent_address_selections_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: recent_address_selections recent_address_selections_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.recent_address_selections
    ADD CONSTRAINT recent_address_selections_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: redemption_approvers redemption_approvers_redemption_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_approvers
    ADD CONSTRAINT redemption_approvers_redemption_id_fkey FOREIGN KEY (redemption_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: redemption_requests redemption_requests_transfer_execution_triggered_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_requests
    ADD CONSTRAINT redemption_requests_transfer_execution_triggered_by_fkey FOREIGN KEY (transfer_execution_triggered_by) REFERENCES auth.users(id);


--
-- Name: redemption_rules redemption_rules_rule_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_rules
    ADD CONSTRAINT redemption_rules_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES public.rules(rule_id);


--
-- Name: redemption_settlements redemption_settlements_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_settlements
    ADD CONSTRAINT redemption_settlements_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: redemption_settlements redemption_settlements_redemption_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_settlements
    ADD CONSTRAINT redemption_settlements_redemption_request_id_fkey FOREIGN KEY (redemption_request_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: redemption_windows redemption_windows_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT redemption_windows_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: redemption_windows redemption_windows_processed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.redemption_windows
    ADD CONSTRAINT redemption_windows_processed_by_fkey FOREIGN KEY (processed_by) REFERENCES auth.users(id);


--
-- Name: regulatory_equivalence_mapping regulatory_equivalence_mapping_equivalent_jurisdiction_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_equivalence_mapping
    ADD CONSTRAINT regulatory_equivalence_mapping_equivalent_jurisdiction_fkey FOREIGN KEY (equivalent_jurisdiction) REFERENCES public.geographic_jurisdictions(country_code);


--
-- Name: regulatory_equivalence_mapping regulatory_equivalence_mapping_home_jurisdiction_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.regulatory_equivalence_mapping
    ADD CONSTRAINT regulatory_equivalence_mapping_home_jurisdiction_fkey FOREIGN KEY (home_jurisdiction) REFERENCES public.geographic_jurisdictions(country_code);


--
-- Name: renewable_energy_credits renewable_energy_credits_asset_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.renewable_energy_credits
    ADD CONSTRAINT renewable_energy_credits_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES public.energy_assets(asset_id);


--
-- Name: renewable_energy_credits renewable_energy_credits_receivable_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.renewable_energy_credits
    ADD CONSTRAINT renewable_energy_credits_receivable_id_fkey FOREIGN KEY (receivable_id) REFERENCES public.climate_receivables(receivable_id);


--
-- Name: restriction_validation_logs restriction_validation_logs_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.restriction_validation_logs
    ADD CONSTRAINT restriction_validation_logs_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: ripple_dex_orders ripple_dex_orders_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_dex_orders
    ADD CONSTRAINT ripple_dex_orders_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: ripple_escrows ripple_escrows_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_escrows
    ADD CONSTRAINT ripple_escrows_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: ripple_multisig_accounts ripple_multisig_accounts_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_multisig_accounts
    ADD CONSTRAINT ripple_multisig_accounts_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: ripple_multisig_proposals ripple_multisig_proposals_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_multisig_proposals
    ADD CONSTRAINT ripple_multisig_proposals_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: ripple_trust_lines ripple_trust_lines_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ripple_trust_lines
    ADD CONSTRAINT ripple_trust_lines_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: role_addresses role_addresses_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_addresses
    ADD CONSTRAINT role_addresses_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: role_addresses role_addresses_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_addresses
    ADD CONSTRAINT role_addresses_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: role_contracts role_contracts_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_contracts
    ADD CONSTRAINT role_contracts_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: role_permissions role_permissions_permission_name_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_permissions
    ADD CONSTRAINT role_permissions_permission_name_fkey FOREIGN KEY (permission_name) REFERENCES public.permissions(name) ON DELETE CASCADE;


--
-- Name: role_permissions role_permissions_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_permissions
    ADD CONSTRAINT role_permissions_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: rule_conflicts rule_conflicts_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_conflicts
    ADD CONSTRAINT rule_conflicts_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: rule_conflicts rule_conflicts_rule1_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_conflicts
    ADD CONSTRAINT rule_conflicts_rule1_id_fkey FOREIGN KEY (rule1_id) REFERENCES public.rules(rule_id);


--
-- Name: rule_conflicts rule_conflicts_rule2_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_conflicts
    ADD CONSTRAINT rule_conflicts_rule2_id_fkey FOREIGN KEY (rule2_id) REFERENCES public.rules(rule_id);


--
-- Name: rule_evaluations rule_evaluations_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_evaluations
    ADD CONSTRAINT rule_evaluations_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: rule_evaluations rule_evaluations_rule_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rule_evaluations
    ADD CONSTRAINT rule_evaluations_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES public.rules(rule_id);


--
-- Name: sc_algorithm_parameters sc_algorithm_parameters_stablecoin_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_algorithm_parameters
    ADD CONSTRAINT sc_algorithm_parameters_stablecoin_product_id_fkey FOREIGN KEY (stablecoin_product_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: sc_minting_events sc_minting_events_stablecoin_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_minting_events
    ADD CONSTRAINT sc_minting_events_stablecoin_product_id_fkey FOREIGN KEY (stablecoin_product_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: sc_peg_history sc_peg_history_stablecoin_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_peg_history
    ADD CONSTRAINT sc_peg_history_stablecoin_product_id_fkey FOREIGN KEY (stablecoin_product_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: sc_redemptions sc_redemptions_stablecoin_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_redemptions
    ADD CONSTRAINT sc_redemptions_stablecoin_product_id_fkey FOREIGN KEY (stablecoin_product_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: sc_reserve_audits sc_reserve_audits_stablecoin_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sc_reserve_audits
    ADD CONSTRAINT sc_reserve_audits_stablecoin_product_id_fkey FOREIGN KEY (stablecoin_product_id) REFERENCES public.stablecoin_products(id) ON DELETE CASCADE;


--
-- Name: security_events security_events_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.security_events
    ADD CONSTRAINT security_events_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: session_key_usage session_key_usage_session_key_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.session_key_usage
    ADD CONSTRAINT session_key_usage_session_key_id_fkey FOREIGN KEY (session_key_id) REFERENCES public.session_keys(id) ON DELETE CASCADE;


--
-- Name: session_key_usage session_key_usage_user_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.session_key_usage
    ADD CONSTRAINT session_key_usage_user_operation_id_fkey FOREIGN KEY (user_operation_id) REFERENCES public.user_operations(id);


--
-- Name: session_keys session_keys_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.session_keys
    ADD CONSTRAINT session_keys_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: settlement_operations settlement_operations_redemption_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settlement_operations
    ADD CONSTRAINT settlement_operations_redemption_id_fkey FOREIGN KEY (redemption_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: settlement_operations settlement_operations_token_transfer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settlement_operations
    ADD CONSTRAINT settlement_operations_token_transfer_id_fkey FOREIGN KEY (token_transfer_id) REFERENCES public.transfer_operations(id);


--
-- Name: sidebar_configurations sidebar_configurations_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_configurations
    ADD CONSTRAINT sidebar_configurations_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: sidebar_configurations sidebar_configurations_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_configurations
    ADD CONSTRAINT sidebar_configurations_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: sidebar_configurations sidebar_configurations_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_configurations
    ADD CONSTRAINT sidebar_configurations_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: sidebar_items sidebar_items_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT sidebar_items_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: sidebar_items sidebar_items_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT sidebar_items_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: sidebar_items sidebar_items_section_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT sidebar_items_section_id_fkey FOREIGN KEY (section_id) REFERENCES public.sidebar_sections(id) ON DELETE CASCADE;


--
-- Name: sidebar_items sidebar_items_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_items
    ADD CONSTRAINT sidebar_items_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: sidebar_sections sidebar_sections_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_sections
    ADD CONSTRAINT sidebar_sections_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: sidebar_sections sidebar_sections_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_sections
    ADD CONSTRAINT sidebar_sections_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: sidebar_sections sidebar_sections_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sidebar_sections
    ADD CONSTRAINT sidebar_sections_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id) ON DELETE SET NULL;


--
-- Name: signature_migration_approvals signature_migration_approvals_migration_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signature_migration_approvals
    ADD CONSTRAINT signature_migration_approvals_migration_id_fkey FOREIGN KEY (migration_id) REFERENCES public.signature_migrations(id) ON DELETE CASCADE;


--
-- Name: signature_migrations signature_migrations_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signature_migrations
    ADD CONSTRAINT signature_migrations_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: signer_keys signer_keys_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.signer_keys
    ADD CONSTRAINT signer_keys_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: smart_contract_wallets smart_contract_wallets_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.smart_contract_wallets
    ADD CONSTRAINT smart_contract_wallets_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: sp_barrier_events sp_barrier_events_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_barrier_events
    ADD CONSTRAINT sp_barrier_events_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: sp_components sp_components_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_components
    ADD CONSTRAINT sp_components_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: sp_coupon_schedules sp_coupon_schedules_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_coupon_schedules
    ADD CONSTRAINT sp_coupon_schedules_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: sp_payoff_structures sp_payoff_structures_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_payoff_structures
    ADD CONSTRAINT sp_payoff_structures_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: sp_performance_tracking sp_performance_tracking_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_performance_tracking
    ADD CONSTRAINT sp_performance_tracking_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: sp_redemption_features sp_redemption_features_structured_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sp_redemption_features
    ADD CONSTRAINT sp_redemption_features_structured_product_id_fkey FOREIGN KEY (structured_product_id) REFERENCES public.structured_products(id) ON DELETE CASCADE;


--
-- Name: stage_requirements stage_requirements_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stage_requirements
    ADD CONSTRAINT stage_requirements_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.workflow_stages(id) ON DELETE CASCADE;


--
-- Name: stock_dividends stock_dividends_equity_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stock_dividends
    ADD CONSTRAINT stock_dividends_equity_product_id_fkey FOREIGN KEY (equity_product_id) REFERENCES public.equity_products(id) ON DELETE CASCADE;


--
-- Name: stripe_conversion_transactions stripe_conversion_transactions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_conversion_transactions
    ADD CONSTRAINT stripe_conversion_transactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: stripe_stablecoin_accounts stripe_stablecoin_accounts_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.stripe_stablecoin_accounts
    ADD CONSTRAINT stripe_stablecoin_accounts_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: subscriptions subscriptions_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: subscriptions subscriptions_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.fund_products(id) ON DELETE CASCADE;


--
-- Name: subscriptions subscriptions_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: threshold_breaches threshold_breaches_operation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.threshold_breaches
    ADD CONSTRAINT threshold_breaches_operation_id_fkey FOREIGN KEY (operation_id) REFERENCES public.token_operations(id);


--
-- Name: token_allocations token_allocations_investor_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_allocations
    ADD CONSTRAINT token_allocations_investor_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: token_allocations token_allocations_project_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_allocations
    ADD CONSTRAINT token_allocations_project_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE SET NULL;


--
-- Name: token_allocations token_allocations_subscription_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_allocations
    ADD CONSTRAINT token_allocations_subscription_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id) ON DELETE CASCADE;


--
-- Name: token_allocations token_allocations_token_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_allocations
    ADD CONSTRAINT token_allocations_token_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: token_climate_properties token_climate_properties_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_climate_properties
    ADD CONSTRAINT token_climate_properties_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.climate_tokenization_pools(pool_id);


--
-- Name: token_climate_properties token_climate_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_climate_properties
    ADD CONSTRAINT token_climate_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: token_deployment_verifications token_deployment_verifications_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_verifications
    ADD CONSTRAINT token_deployment_verifications_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_deployment_verifications token_deployment_verifications_verified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployment_verifications
    ADD CONSTRAINT token_deployment_verifications_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(id);


--
-- Name: token_deployments token_deployments_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_deployments
    ADD CONSTRAINT token_deployments_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_balances token_erc1155_balances_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_balances
    ADD CONSTRAINT token_erc1155_balances_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_crafting_recipes token_erc1155_crafting_recipes_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_crafting_recipes
    ADD CONSTRAINT token_erc1155_crafting_recipes_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_discount_tiers token_erc1155_discount_tiers_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_discount_tiers
    ADD CONSTRAINT token_erc1155_discount_tiers_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_properties token_erc1155_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_properties
    ADD CONSTRAINT token_erc1155_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_type_configs token_erc1155_type_configs_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_type_configs
    ADD CONSTRAINT token_erc1155_type_configs_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_types token_erc1155_types_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_types
    ADD CONSTRAINT token_erc1155_types_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1155_uri_mappings token_erc1155_uri_mappings_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1155_uri_mappings
    ADD CONSTRAINT token_erc1155_uri_mappings_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_controllers token_erc1400_controllers_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_controllers
    ADD CONSTRAINT token_erc1400_controllers_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_documents token_erc1400_documents_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_documents
    ADD CONSTRAINT token_erc1400_documents_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: token_erc1400_partition_balances token_erc1400_partition_balances_partition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_balances
    ADD CONSTRAINT token_erc1400_partition_balances_partition_id_fkey FOREIGN KEY (partition_id) REFERENCES public.token_erc1400_partitions(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_partition_operators token_erc1400_partition_operators_partition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_operators
    ADD CONSTRAINT token_erc1400_partition_operators_partition_id_fkey FOREIGN KEY (partition_id) REFERENCES public.token_erc1400_partitions(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_partition_transfers token_erc1400_partition_transfers_partition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partition_transfers
    ADD CONSTRAINT token_erc1400_partition_transfers_partition_id_fkey FOREIGN KEY (partition_id) REFERENCES public.token_erc1400_partitions(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_partitions token_erc1400_partitions_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_partitions
    ADD CONSTRAINT token_erc1400_partitions_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc1400_properties token_erc1400_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc1400_properties
    ADD CONSTRAINT token_erc1400_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc20_properties token_erc20_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc20_properties
    ADD CONSTRAINT token_erc20_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_allocations token_erc3525_allocations_linked_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_allocations
    ADD CONSTRAINT token_erc3525_allocations_linked_token_id_fkey FOREIGN KEY (linked_token_id) REFERENCES public.tokens(id);


--
-- Name: token_erc3525_allocations token_erc3525_allocations_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_allocations
    ADD CONSTRAINT token_erc3525_allocations_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_payment_schedules token_erc3525_payment_schedules_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_payment_schedules
    ADD CONSTRAINT token_erc3525_payment_schedules_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_properties token_erc3525_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_properties
    ADD CONSTRAINT token_erc3525_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_slot_configs token_erc3525_slot_configs_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slot_configs
    ADD CONSTRAINT token_erc3525_slot_configs_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_slots token_erc3525_slots_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_slots
    ADD CONSTRAINT token_erc3525_slots_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc3525_value_adjustments token_erc3525_value_adjustments_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc3525_value_adjustments
    ADD CONSTRAINT token_erc3525_value_adjustments_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_asset_allocations token_erc4626_asset_allocations_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_asset_allocations
    ADD CONSTRAINT token_erc4626_asset_allocations_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_fee_tiers token_erc4626_fee_tiers_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_fee_tiers
    ADD CONSTRAINT token_erc4626_fee_tiers_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_performance_metrics token_erc4626_performance_metrics_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_performance_metrics
    ADD CONSTRAINT token_erc4626_performance_metrics_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_properties token_erc4626_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_properties
    ADD CONSTRAINT token_erc4626_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_strategy_params token_erc4626_strategy_params_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_strategy_params
    ADD CONSTRAINT token_erc4626_strategy_params_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc4626_vault_strategies token_erc4626_vault_strategies_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc4626_vault_strategies
    ADD CONSTRAINT token_erc4626_vault_strategies_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc721_attributes token_erc721_attributes_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_attributes
    ADD CONSTRAINT token_erc721_attributes_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc721_mint_phases token_erc721_mint_phases_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_mint_phases
    ADD CONSTRAINT token_erc721_mint_phases_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc721_properties token_erc721_properties_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_properties
    ADD CONSTRAINT token_erc721_properties_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_erc721_trait_definitions token_erc721_trait_definitions_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_erc721_trait_definitions
    ADD CONSTRAINT token_erc721_trait_definitions_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_exchange_configs token_exchange_configs_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_exchange_configs
    ADD CONSTRAINT token_exchange_configs_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: token_exchange_configs token_exchange_configs_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_exchange_configs
    ADD CONSTRAINT token_exchange_configs_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: token_extensions token_extensions_attached_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_extensions
    ADD CONSTRAINT token_extensions_attached_by_fkey FOREIGN KEY (attached_by) REFERENCES public.users(id);


--
-- Name: token_extensions token_extensions_detached_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_extensions
    ADD CONSTRAINT token_extensions_detached_by_fkey FOREIGN KEY (detached_by) REFERENCES public.users(id);


--
-- Name: token_extensions token_extensions_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_extensions
    ADD CONSTRAINT token_extensions_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_geographic_restrictions token_geographic_restrictions_country_code_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_geographic_restrictions
    ADD CONSTRAINT token_geographic_restrictions_country_code_fkey FOREIGN KEY (country_code) REFERENCES public.geographic_jurisdictions(country_code);


--
-- Name: token_geographic_restrictions token_geographic_restrictions_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_geographic_restrictions
    ADD CONSTRAINT token_geographic_restrictions_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_modules token_modules_deployed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_modules
    ADD CONSTRAINT token_modules_deployed_by_fkey FOREIGN KEY (deployed_by) REFERENCES auth.users(id);


--
-- Name: token_modules token_modules_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_modules
    ADD CONSTRAINT token_modules_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_operations token_operations_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_operations
    ADD CONSTRAINT token_operations_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_sanctions_rules token_sanctions_rules_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_sanctions_rules
    ADD CONSTRAINT token_sanctions_rules_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_templates token_templates_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_templates
    ADD CONSTRAINT token_templates_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: token_versions token_versions_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_versions
    ADD CONSTRAINT token_versions_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: token_whitelists token_whitelists_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.token_whitelists
    ADD CONSTRAINT token_whitelists_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id) ON DELETE CASCADE;


--
-- Name: tokens tokens_deployed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tokens
    ADD CONSTRAINT tokens_deployed_by_fkey FOREIGN KEY (deployed_by) REFERENCES auth.users(id);


--
-- Name: tokens tokens_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tokens
    ADD CONSTRAINT tokens_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: trade_finance_auction_executions trade_finance_auction_executions_auction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_auction_executions
    ADD CONSTRAINT trade_finance_auction_executions_auction_id_fkey FOREIGN KEY (auction_id) REFERENCES public.trade_finance_dutch_auctions(auction_id);


--
-- Name: trade_finance_fee_distributions trade_finance_fee_distributions_recipient_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_fee_distributions
    ADD CONSTRAINT trade_finance_fee_distributions_recipient_id_fkey FOREIGN KEY (recipient_id) REFERENCES public.trade_finance_revenue_recipients(recipient_id);


--
-- Name: trade_finance_stream_withdrawals trade_finance_stream_withdrawals_stream_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trade_finance_stream_withdrawals
    ADD CONSTRAINT trade_finance_stream_withdrawals_stream_id_fkey FOREIGN KEY (stream_id) REFERENCES public.trade_finance_payment_streams(stream_id);


--
-- Name: transaction_signatures transaction_signatures_proposal_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_signatures
    ADD CONSTRAINT transaction_signatures_proposal_id_fkey FOREIGN KEY (proposal_id) REFERENCES public.multi_sig_proposals(id) ON DELETE CASCADE;


--
-- Name: CONSTRAINT transaction_signatures_proposal_id_fkey ON transaction_signatures; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT transaction_signatures_proposal_id_fkey ON public.transaction_signatures IS 'Links transaction_signatures to multi_sig_proposals (transaction_proposals table removed in favor of single-layer architecture)';


--
-- Name: transaction_signatures transaction_signatures_signer_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_signatures
    ADD CONSTRAINT transaction_signatures_signer_fkey FOREIGN KEY (signer) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: transaction_validations transaction_validations_override_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction_validations
    ADD CONSTRAINT transaction_validations_override_by_fkey FOREIGN KEY (override_by) REFERENCES public.users(id);


--
-- Name: transfer_operations transfer_operations_redemption_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transfer_operations
    ADD CONSTRAINT transfer_operations_redemption_id_fkey FOREIGN KEY (redemption_id) REFERENCES public.redemption_requests(id) ON DELETE CASCADE;


--
-- Name: user_addresses user_addresses_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_addresses
    ADD CONSTRAINT user_addresses_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: user_contract_roles user_contract_roles_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contract_roles
    ADD CONSTRAINT user_contract_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: user_mfa_settings user_mfa_settings_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_mfa_settings
    ADD CONSTRAINT user_mfa_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: user_operations user_operations_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_operations
    ADD CONSTRAINT user_operations_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: user_organization_roles user_organization_roles_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_organization_roles
    ADD CONSTRAINT user_organization_roles_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: user_organization_roles user_organization_roles_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_organization_roles
    ADD CONSTRAINT user_organization_roles_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: user_organization_roles user_organization_roles_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_organization_roles
    ADD CONSTRAINT user_organization_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: user_roles user_roles_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_roles
    ADD CONSTRAINT user_roles_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id) ON DELETE CASCADE;


--
-- Name: user_roles user_roles_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_roles
    ADD CONSTRAINT user_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: user_sidebar_preferences user_sidebar_preferences_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sidebar_preferences
    ADD CONSTRAINT user_sidebar_preferences_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: user_sidebar_preferences user_sidebar_preferences_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sidebar_preferences
    ADD CONSTRAINT user_sidebar_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: users users_auth_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_auth_id_fkey FOREIGN KEY (auth_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: users users_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: validation_alerts validation_alerts_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.validation_alerts
    ADD CONSTRAINT validation_alerts_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(id);


--
-- Name: valuation_price_history valuation_price_history_token_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.valuation_price_history
    ADD CONSTRAINT valuation_price_history_token_id_fkey FOREIGN KEY (token_id) REFERENCES public.tokens(id);


--
-- Name: wallet_access_logs wallet_access_logs_accessed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_access_logs
    ADD CONSTRAINT wallet_access_logs_accessed_by_fkey FOREIGN KEY (accessed_by) REFERENCES public.users(id) ON DELETE SET NULL;


--
-- Name: wallet_access_logs wallet_access_logs_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_access_logs
    ADD CONSTRAINT wallet_access_logs_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.project_wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_details wallet_details_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_details
    ADD CONSTRAINT wallet_details_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.multi_sig_wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_facets wallet_facets_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_facets
    ADD CONSTRAINT wallet_facets_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_guardians wallet_guardians_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_guardians
    ADD CONSTRAINT wallet_guardians_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_locks wallet_locks_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_locks
    ADD CONSTRAINT wallet_locks_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_restriction_rules wallet_restriction_rules_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_restriction_rules
    ADD CONSTRAINT wallet_restriction_rules_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: wallet_transactions wallet_transactions_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallet_transactions
    ADD CONSTRAINT wallet_transactions_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id);


--
-- Name: wallets wallets_investor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallets
    ADD CONSTRAINT wallets_investor_id_fkey FOREIGN KEY (investor_id) REFERENCES public.investors(investor_id) ON DELETE CASCADE;


--
-- Name: wallets wallets_mnemonic_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallets
    ADD CONSTRAINT wallets_mnemonic_vault_id_fkey FOREIGN KEY (mnemonic_vault_id) REFERENCES public.key_vault_keys(id);


--
-- Name: wallets wallets_private_key_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallets
    ADD CONSTRAINT wallets_private_key_vault_id_fkey FOREIGN KEY (private_key_vault_id) REFERENCES public.key_vault_keys(id);


--
-- Name: wallets wallets_public_key_vault_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.wallets
    ADD CONSTRAINT wallets_public_key_vault_id_fkey FOREIGN KEY (public_key_vault_id) REFERENCES public.key_vault_keys(id);


--
-- Name: webauthn_challenges webauthn_challenges_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webauthn_challenges
    ADD CONSTRAINT webauthn_challenges_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: webauthn_credentials webauthn_credentials_wallet_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webauthn_credentials
    ADD CONSTRAINT webauthn_credentials_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.wallets(id) ON DELETE CASCADE;


--
-- Name: whitelist_settings whitelist_settings_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_settings
    ADD CONSTRAINT whitelist_settings_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: whitelist_settings whitelist_settings_rule_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_settings
    ADD CONSTRAINT whitelist_settings_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES public.rules(rule_id);


--
-- Name: whitelist_signatories whitelist_signatories_whitelist_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.whitelist_signatories
    ADD CONSTRAINT whitelist_signatories_whitelist_id_fkey FOREIGN KEY (whitelist_id) REFERENCES public.whitelist_settings(id) ON DELETE CASCADE;


--
-- Name: multi_sig_proposals Allow authenticated users to create proposals; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Allow authenticated users to create proposals" ON public.multi_sig_proposals FOR INSERT TO authenticated WITH CHECK ((created_by = auth.uid()));


--
-- Name: multi_sig_proposals Allow authenticated users to read proposals; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Allow authenticated users to read proposals" ON public.multi_sig_proposals FOR SELECT TO authenticated USING (true);


--
-- Name: proposal_signatures Allow authenticated users to read signatures; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Allow authenticated users to read signatures" ON public.proposal_signatures FOR SELECT TO authenticated USING (true);


--
-- Name: proposal_signatures Allow authenticated users to sign proposals; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Allow authenticated users to sign proposals" ON public.proposal_signatures FOR INSERT TO authenticated WITH CHECK (true);


--
-- Name: multi_sig_proposals Allow authenticated users to update proposals; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Allow authenticated users to update proposals" ON public.multi_sig_proposals FOR UPDATE TO authenticated USING (((created_by = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.multi_sig_wallet_owners mwo
  WHERE ((mwo.wallet_id = multi_sig_proposals.wallet_id) AND (mwo.user_id = auth.uid()))))));


--
-- Name: multi_sig_proposals Wallet owners can delete non-executed proposals; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Wallet owners can delete non-executed proposals" ON public.multi_sig_proposals FOR DELETE USING (((EXISTS ( SELECT 1
   FROM public.multi_sig_wallet_owners
  WHERE ((multi_sig_wallet_owners.wallet_id = multi_sig_proposals.wallet_id) AND (multi_sig_wallet_owners.user_id = auth.uid())))) AND (executed_at IS NULL) AND (status <> 'executed'::text)));


--
-- Name: multi_sig_proposals; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.multi_sig_proposals ENABLE ROW LEVEL SECURITY;

--
-- Name: proposal_signatures; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.proposal_signatures ENABLE ROW LEVEL SECURITY;

--
-- Name: SCHEMA public; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA public TO postgres;
GRANT USAGE ON SCHEMA public TO anon;
GRANT USAGE ON SCHEMA public TO authenticated;
GRANT USAGE ON SCHEMA public TO service_role;
GRANT ALL ON SCHEMA public TO prisma;


--
-- Name: TYPE individual_document_type; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TYPE public.individual_document_type TO authenticated;


--
-- Name: FUNCTION add_investors_to_group(p_group_id text, p_investor_ids text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_investors_to_group(p_group_id text, p_investor_ids text[]) TO anon;
GRANT ALL ON FUNCTION public.add_investors_to_group(p_group_id text, p_investor_ids text[]) TO authenticated;
GRANT ALL ON FUNCTION public.add_investors_to_group(p_group_id text, p_investor_ids text[]) TO service_role;
GRANT ALL ON FUNCTION public.add_investors_to_group(p_group_id text, p_investor_ids text[]) TO prisma;


--
-- Name: FUNCTION add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO anon;
GRANT ALL ON FUNCTION public.add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO authenticated;
GRANT ALL ON FUNCTION public.add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO service_role;
GRANT ALL ON FUNCTION public.add_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO prisma;


--
-- Name: FUNCTION add_policy_approver(policy_id text, user_id text, created_by text, status_val text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_policy_approver(policy_id text, user_id text, created_by text, status_val text) TO anon;
GRANT ALL ON FUNCTION public.add_policy_approver(policy_id text, user_id text, created_by text, status_val text) TO authenticated;
GRANT ALL ON FUNCTION public.add_policy_approver(policy_id text, user_id text, created_by text, status_val text) TO service_role;
GRANT ALL ON FUNCTION public.add_policy_approver(policy_id text, user_id text, created_by text, status_val text) TO prisma;


--
-- Name: FUNCTION add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text) TO anon;
GRANT ALL ON FUNCTION public.add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text) TO authenticated;
GRANT ALL ON FUNCTION public.add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text) TO service_role;
GRANT ALL ON FUNCTION public.add_policy_approver_with_cast(policy_id text, user_id text, created_by_id text) TO prisma;


--
-- Name: FUNCTION add_rule_to_approval_queue(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_rule_to_approval_queue() TO anon;
GRANT ALL ON FUNCTION public.add_rule_to_approval_queue() TO authenticated;
GRANT ALL ON FUNCTION public.add_rule_to_approval_queue() TO service_role;
GRANT ALL ON FUNCTION public.add_rule_to_approval_queue() TO prisma;


--
-- Name: FUNCTION add_table_to_realtime(table_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_table_to_realtime(table_name text) TO anon;
GRANT ALL ON FUNCTION public.add_table_to_realtime(table_name text) TO authenticated;
GRANT ALL ON FUNCTION public.add_table_to_realtime(table_name text) TO service_role;
GRANT ALL ON FUNCTION public.add_table_to_realtime(table_name text) TO prisma;


--
-- Name: FUNCTION add_template_to_approval_queue(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.add_template_to_approval_queue() TO anon;
GRANT ALL ON FUNCTION public.add_template_to_approval_queue() TO authenticated;
GRANT ALL ON FUNCTION public.add_template_to_approval_queue() TO service_role;
GRANT ALL ON FUNCTION public.add_template_to_approval_queue() TO prisma;


--
-- Name: FUNCTION address_has_contract_role(p_address_id uuid, p_contract_role text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.address_has_contract_role(p_address_id uuid, p_contract_role text) TO anon;
GRANT ALL ON FUNCTION public.address_has_contract_role(p_address_id uuid, p_contract_role text) TO authenticated;
GRANT ALL ON FUNCTION public.address_has_contract_role(p_address_id uuid, p_contract_role text) TO service_role;
GRANT ALL ON FUNCTION public.address_has_contract_role(p_address_id uuid, p_contract_role text) TO prisma;


--
-- Name: FUNCTION admin_set_profile_type(user_auth_id uuid, new_profile_type public.profile_type); Type: ACL; Schema: public; Owner: -
--

REVOKE ALL ON FUNCTION public.admin_set_profile_type(user_auth_id uuid, new_profile_type public.profile_type) FROM PUBLIC;
GRANT ALL ON FUNCTION public.admin_set_profile_type(user_auth_id uuid, new_profile_type public.profile_type) TO service_role;
GRANT ALL ON FUNCTION public.admin_set_profile_type(user_auth_id uuid, new_profile_type public.profile_type) TO prisma;


--
-- Name: FUNCTION analyze_activity_indexes(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.analyze_activity_indexes() TO anon;
GRANT ALL ON FUNCTION public.analyze_activity_indexes() TO authenticated;
GRANT ALL ON FUNCTION public.analyze_activity_indexes() TO service_role;
GRANT ALL ON FUNCTION public.analyze_activity_indexes() TO prisma;


--
-- Name: FUNCTION analyze_table_for_audit(table_name_param text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.analyze_table_for_audit(table_name_param text) TO anon;
GRANT ALL ON FUNCTION public.analyze_table_for_audit(table_name_param text) TO authenticated;
GRANT ALL ON FUNCTION public.analyze_table_for_audit(table_name_param text) TO service_role;
GRANT ALL ON FUNCTION public.analyze_table_for_audit(table_name_param text) TO prisma;


--
-- Name: PROCEDURE apply_audit_trigger_to_table(IN table_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON PROCEDURE public.apply_audit_trigger_to_table(IN table_name text) TO anon;
GRANT ALL ON PROCEDURE public.apply_audit_trigger_to_table(IN table_name text) TO authenticated;
GRANT ALL ON PROCEDURE public.apply_audit_trigger_to_table(IN table_name text) TO service_role;
GRANT ALL ON PROCEDURE public.apply_audit_trigger_to_table(IN table_name text) TO prisma;


--
-- Name: FUNCTION archive_old_moonpay_compliance_alerts(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.archive_old_moonpay_compliance_alerts() TO anon;
GRANT ALL ON FUNCTION public.archive_old_moonpay_compliance_alerts() TO authenticated;
GRANT ALL ON FUNCTION public.archive_old_moonpay_compliance_alerts() TO service_role;
GRANT ALL ON FUNCTION public.archive_old_moonpay_compliance_alerts() TO prisma;


--
-- Name: FUNCTION assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid) TO anon;
GRANT ALL ON FUNCTION public.assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.assign_redemption_approvers(p_redemption_request_id uuid, p_approval_config_id uuid) TO prisma;


--
-- Name: FUNCTION audit_investor_approval_changes(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.audit_investor_approval_changes() TO anon;
GRANT ALL ON FUNCTION public.audit_investor_approval_changes() TO authenticated;
GRANT ALL ON FUNCTION public.audit_investor_approval_changes() TO service_role;
GRANT ALL ON FUNCTION public.audit_investor_approval_changes() TO prisma;


--
-- Name: FUNCTION backup_trigger_definitions(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.backup_trigger_definitions() TO anon;
GRANT ALL ON FUNCTION public.backup_trigger_definitions() TO authenticated;
GRANT ALL ON FUNCTION public.backup_trigger_definitions() TO service_role;
GRANT ALL ON FUNCTION public.backup_trigger_definitions() TO prisma;


--
-- Name: FUNCTION begin_transaction(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.begin_transaction() TO anon;
GRANT ALL ON FUNCTION public.begin_transaction() TO authenticated;
GRANT ALL ON FUNCTION public.begin_transaction() TO service_role;
GRANT ALL ON FUNCTION public.begin_transaction() TO prisma;


--
-- Name: FUNCTION calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb) TO anon;
GRANT ALL ON FUNCTION public.calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb) TO service_role;
GRANT ALL ON FUNCTION public.calculate_batch_climate_risk(p_receivable_ids uuid[], p_calculation_metadata jsonb) TO prisma;


--
-- Name: FUNCTION calculate_daily_compliance_metrics(target_date date); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.calculate_daily_compliance_metrics(target_date date) TO anon;
GRANT ALL ON FUNCTION public.calculate_daily_compliance_metrics(target_date date) TO authenticated;
GRANT ALL ON FUNCTION public.calculate_daily_compliance_metrics(target_date date) TO service_role;
GRANT ALL ON FUNCTION public.calculate_daily_compliance_metrics(target_date date) TO prisma;


--
-- Name: PROCEDURE calculate_daily_nav(IN p_project_id uuid, IN p_date date); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON PROCEDURE public.calculate_daily_nav(IN p_project_id uuid, IN p_date date) TO anon;
GRANT ALL ON PROCEDURE public.calculate_daily_nav(IN p_project_id uuid, IN p_date date) TO authenticated;
GRANT ALL ON PROCEDURE public.calculate_daily_nav(IN p_project_id uuid, IN p_date date) TO service_role;
GRANT ALL ON PROCEDURE public.calculate_daily_nav(IN p_project_id uuid, IN p_date date) TO prisma;


--
-- Name: FUNCTION calculate_nav_change(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.calculate_nav_change() TO anon;
GRANT ALL ON FUNCTION public.calculate_nav_change() TO authenticated;
GRANT ALL ON FUNCTION public.calculate_nav_change() TO service_role;
GRANT ALL ON FUNCTION public.calculate_nav_change() TO prisma;


--
-- Name: FUNCTION calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text) TO anon;
GRANT ALL ON FUNCTION public.calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text) TO authenticated;
GRANT ALL ON FUNCTION public.calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text) TO service_role;
GRANT ALL ON FUNCTION public.calculate_portfolio_climate_valuation(p_receivable_ids uuid[], p_calculation_mode text) TO prisma;


--
-- Name: FUNCTION calculate_project_weighted_nav(p_project_id uuid, p_date date); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) TO anon;
GRANT ALL ON FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) TO authenticated;
GRANT ALL ON FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) TO service_role;
GRANT ALL ON FUNCTION public.calculate_project_weighted_nav(p_project_id uuid, p_date date) TO prisma;


--
-- Name: FUNCTION check_all_approvals(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_all_approvals() TO anon;
GRANT ALL ON FUNCTION public.check_all_approvals() TO authenticated;
GRANT ALL ON FUNCTION public.check_all_approvals() TO service_role;
GRANT ALL ON FUNCTION public.check_all_approvals() TO prisma;


--
-- Name: FUNCTION check_document_expiry(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_document_expiry() TO anon;
GRANT ALL ON FUNCTION public.check_document_expiry() TO authenticated;
GRANT ALL ON FUNCTION public.check_document_expiry() TO service_role;
GRANT ALL ON FUNCTION public.check_document_expiry() TO prisma;


--
-- Name: FUNCTION check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) TO anon;
GRANT ALL ON FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) TO authenticated;
GRANT ALL ON FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) TO service_role;
GRANT ALL ON FUNCTION public.check_duplicate_wallet(p_project_id uuid, p_network character varying, p_credential_type character varying) TO prisma;


--
-- Name: FUNCTION check_existing_signature(p_proposal_id uuid, p_signer_address text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_existing_signature(p_proposal_id uuid, p_signer_address text) TO anon;
GRANT ALL ON FUNCTION public.check_existing_signature(p_proposal_id uuid, p_signer_address text) TO authenticated;
GRANT ALL ON FUNCTION public.check_existing_signature(p_proposal_id uuid, p_signer_address text) TO service_role;
GRANT ALL ON FUNCTION public.check_existing_signature(p_proposal_id uuid, p_signer_address text) TO prisma;


--
-- Name: FUNCTION check_expired_proposals(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_expired_proposals() TO anon;
GRANT ALL ON FUNCTION public.check_expired_proposals() TO authenticated;
GRANT ALL ON FUNCTION public.check_expired_proposals() TO service_role;
GRANT ALL ON FUNCTION public.check_expired_proposals() TO prisma;


--
-- Name: FUNCTION check_issuer_document_duplicates(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_issuer_document_duplicates() TO anon;
GRANT ALL ON FUNCTION public.check_issuer_document_duplicates() TO authenticated;
GRANT ALL ON FUNCTION public.check_issuer_document_duplicates() TO service_role;
GRANT ALL ON FUNCTION public.check_issuer_document_duplicates() TO prisma;


--
-- Name: FUNCTION check_permission(p_role_name text, p_resource text, p_action text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_permission(p_role_name text, p_resource text, p_action text) TO anon;
GRANT ALL ON FUNCTION public.check_permission(p_role_name text, p_resource text, p_action text) TO authenticated;
GRANT ALL ON FUNCTION public.check_permission(p_role_name text, p_resource text, p_action text) TO service_role;
GRANT ALL ON FUNCTION public.check_permission(p_role_name text, p_resource text, p_action text) TO prisma;


--
-- Name: FUNCTION check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text, p_product_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text, p_product_id uuid) TO anon;
GRANT ALL ON FUNCTION public.check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text, p_product_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text, p_product_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.check_redemption_eligibility(p_investor_id uuid, p_project_id uuid, p_requested_amount numeric, p_product_type text, p_product_id uuid) TO prisma;


--
-- Name: FUNCTION check_role_exists(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_role_exists() TO anon;
GRANT ALL ON FUNCTION public.check_role_exists() TO authenticated;
GRANT ALL ON FUNCTION public.check_role_exists() TO service_role;
GRANT ALL ON FUNCTION public.check_role_exists() TO prisma;


--
-- Name: FUNCTION check_user_permission(user_id uuid, permission text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.check_user_permission(user_id uuid, permission text) TO anon;
GRANT ALL ON FUNCTION public.check_user_permission(user_id uuid, permission text) TO authenticated;
GRANT ALL ON FUNCTION public.check_user_permission(user_id uuid, permission text) TO service_role;
GRANT ALL ON FUNCTION public.check_user_permission(user_id uuid, permission text) TO prisma;


--
-- Name: FUNCTION cleanup_expired_asset_cache(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_expired_asset_cache() TO anon;
GRANT ALL ON FUNCTION public.cleanup_expired_asset_cache() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_expired_asset_cache() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_expired_asset_cache() TO prisma;


--
-- Name: FUNCTION cleanup_expired_cache(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_expired_cache() TO anon;
GRANT ALL ON FUNCTION public.cleanup_expired_cache() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_expired_cache() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_expired_cache() TO prisma;


--
-- Name: FUNCTION cleanup_expired_cache_data(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_expired_cache_data() TO anon;
GRANT ALL ON FUNCTION public.cleanup_expired_cache_data() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_expired_cache_data() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_expired_cache_data() TO prisma;


--
-- Name: FUNCTION cleanup_expired_transaction_drafts(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_expired_transaction_drafts() TO anon;
GRANT ALL ON FUNCTION public.cleanup_expired_transaction_drafts() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_expired_transaction_drafts() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_expired_transaction_drafts() TO prisma;


--
-- Name: FUNCTION cleanup_old_moonpay_policy_logs(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_old_moonpay_policy_logs() TO anon;
GRANT ALL ON FUNCTION public.cleanup_old_moonpay_policy_logs() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_old_moonpay_policy_logs() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_old_moonpay_policy_logs() TO prisma;


--
-- Name: FUNCTION cleanup_old_validation_logs(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_old_validation_logs() TO anon;
GRANT ALL ON FUNCTION public.cleanup_old_validation_logs() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_old_validation_logs() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_old_validation_logs() TO prisma;


--
-- Name: FUNCTION cleanup_old_webhook_events(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_old_webhook_events() TO anon;
GRANT ALL ON FUNCTION public.cleanup_old_webhook_events() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_old_webhook_events() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_old_webhook_events() TO prisma;


--
-- Name: FUNCTION cleanup_orphaned_policy_approvers(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.cleanup_orphaned_policy_approvers() TO anon;
GRANT ALL ON FUNCTION public.cleanup_orphaned_policy_approvers() TO authenticated;
GRANT ALL ON FUNCTION public.cleanup_orphaned_policy_approvers() TO service_role;
GRANT ALL ON FUNCTION public.cleanup_orphaned_policy_approvers() TO prisma;


--
-- Name: FUNCTION climate_receivables_health_check(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.climate_receivables_health_check() TO anon;
GRANT ALL ON FUNCTION public.climate_receivables_health_check() TO authenticated;
GRANT ALL ON FUNCTION public.climate_receivables_health_check() TO service_role;
GRANT ALL ON FUNCTION public.climate_receivables_health_check() TO prisma;


--
-- Name: FUNCTION column_exists(p_schema_name text, p_table_name text, p_column_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.column_exists(p_schema_name text, p_table_name text, p_column_name text) TO anon;
GRANT ALL ON FUNCTION public.column_exists(p_schema_name text, p_table_name text, p_column_name text) TO authenticated;
GRANT ALL ON FUNCTION public.column_exists(p_schema_name text, p_table_name text, p_column_name text) TO service_role;
GRANT ALL ON FUNCTION public.column_exists(p_schema_name text, p_table_name text, p_column_name text) TO prisma;


--
-- Name: FUNCTION commit_transaction(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.commit_transaction() TO anon;
GRANT ALL ON FUNCTION public.commit_transaction() TO authenticated;
GRANT ALL ON FUNCTION public.commit_transaction() TO service_role;
GRANT ALL ON FUNCTION public.commit_transaction() TO prisma;


--
-- Name: FUNCTION create_audit_trigger(table_name text, is_high_volume boolean); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_audit_trigger(table_name text, is_high_volume boolean) TO anon;
GRANT ALL ON FUNCTION public.create_audit_trigger(table_name text, is_high_volume boolean) TO authenticated;
GRANT ALL ON FUNCTION public.create_audit_trigger(table_name text, is_high_volume boolean) TO service_role;
GRANT ALL ON FUNCTION public.create_audit_trigger(table_name text, is_high_volume boolean) TO prisma;


--
-- Name: FUNCTION create_document_version(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_document_version() TO anon;
GRANT ALL ON FUNCTION public.create_document_version() TO authenticated;
GRANT ALL ON FUNCTION public.create_document_version() TO service_role;
GRANT ALL ON FUNCTION public.create_document_version() TO prisma;


--
-- Name: FUNCTION create_project_with_cap_table(project_data jsonb, cap_table_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_project_with_cap_table(project_data jsonb, cap_table_name text) TO anon;
GRANT ALL ON FUNCTION public.create_project_with_cap_table(project_data jsonb, cap_table_name text) TO authenticated;
GRANT ALL ON FUNCTION public.create_project_with_cap_table(project_data jsonb, cap_table_name text) TO service_role;
GRANT ALL ON FUNCTION public.create_project_with_cap_table(project_data jsonb, cap_table_name text) TO prisma;


--
-- Name: FUNCTION create_selective_audit_trigger(p_table text, p_condition text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_selective_audit_trigger(p_table text, p_condition text) TO anon;
GRANT ALL ON FUNCTION public.create_selective_audit_trigger(p_table text, p_condition text) TO authenticated;
GRANT ALL ON FUNCTION public.create_selective_audit_trigger(p_table text, p_condition text) TO service_role;
GRANT ALL ON FUNCTION public.create_selective_audit_trigger(p_table text, p_condition text) TO prisma;


--
-- Name: FUNCTION create_token_version(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_token_version() TO anon;
GRANT ALL ON FUNCTION public.create_token_version() TO authenticated;
GRANT ALL ON FUNCTION public.create_token_version() TO service_role;
GRANT ALL ON FUNCTION public.create_token_version() TO prisma;


--
-- Name: FUNCTION create_transaction_events_table(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.create_transaction_events_table() TO anon;
GRANT ALL ON FUNCTION public.create_transaction_events_table() TO authenticated;
GRANT ALL ON FUNCTION public.create_transaction_events_table() TO service_role;
GRANT ALL ON FUNCTION public.create_transaction_events_table() TO prisma;


--
-- Name: FUNCTION decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.decrement_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO prisma;


--
-- Name: FUNCTION delete_project_cascade(project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.delete_project_cascade(project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.delete_project_cascade(project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.delete_project_cascade(project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.delete_project_cascade(project_id uuid) TO prisma;


--
-- Name: FUNCTION delete_user_with_privileges(p_user_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.delete_user_with_privileges(p_user_id uuid) TO anon;
GRANT ALL ON FUNCTION public.delete_user_with_privileges(p_user_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.delete_user_with_privileges(p_user_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.delete_user_with_privileges(p_user_id uuid) TO prisma;


--
-- Name: FUNCTION disable_rls_for_deletion(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.disable_rls_for_deletion() TO anon;
GRANT ALL ON FUNCTION public.disable_rls_for_deletion() TO authenticated;
GRANT ALL ON FUNCTION public.disable_rls_for_deletion() TO service_role;
GRANT ALL ON FUNCTION public.disable_rls_for_deletion() TO prisma;


--
-- Name: FUNCTION enable_rls_after_deletion(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.enable_rls_after_deletion() TO anon;
GRANT ALL ON FUNCTION public.enable_rls_after_deletion() TO authenticated;
GRANT ALL ON FUNCTION public.enable_rls_after_deletion() TO service_role;
GRANT ALL ON FUNCTION public.enable_rls_after_deletion() TO prisma;


--
-- Name: FUNCTION exec(query text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.exec(query text) TO anon;
GRANT ALL ON FUNCTION public.exec(query text) TO authenticated;
GRANT ALL ON FUNCTION public.exec(query text) TO service_role;
GRANT ALL ON FUNCTION public.exec(query text) TO prisma;


--
-- Name: FUNCTION execute_safely(p_statement text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.execute_safely(p_statement text) TO anon;
GRANT ALL ON FUNCTION public.execute_safely(p_statement text) TO authenticated;
GRANT ALL ON FUNCTION public.execute_safely(p_statement text) TO service_role;
GRANT ALL ON FUNCTION public.execute_safely(p_statement text) TO prisma;


--
-- Name: FUNCTION extract_severity_from_metadata(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.extract_severity_from_metadata() TO anon;
GRANT ALL ON FUNCTION public.extract_severity_from_metadata() TO authenticated;
GRANT ALL ON FUNCTION public.extract_severity_from_metadata() TO service_role;
GRANT ALL ON FUNCTION public.extract_severity_from_metadata() TO prisma;


--
-- Name: FUNCTION get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text) TO anon;
GRANT ALL ON FUNCTION public.get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text) TO authenticated;
GRANT ALL ON FUNCTION public.get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text) TO service_role;
GRANT ALL ON FUNCTION public.get_activity_counts_by_timeframe(p_start_time timestamp without time zone, p_end_time timestamp without time zone, p_interval text) TO prisma;


--
-- Name: FUNCTION get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone) TO anon;
GRANT ALL ON FUNCTION public.get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone) TO authenticated;
GRANT ALL ON FUNCTION public.get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone) TO service_role;
GRANT ALL ON FUNCTION public.get_activity_distribution_by_category(p_start_time timestamp without time zone, p_end_time timestamp without time zone) TO prisma;


--
-- Name: FUNCTION get_activity_hierarchy(root_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_activity_hierarchy(root_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_activity_hierarchy(root_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_activity_hierarchy(root_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_activity_hierarchy(root_id uuid) TO prisma;


--
-- Name: FUNCTION get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text) TO anon;
GRANT ALL ON FUNCTION public.get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text) TO authenticated;
GRANT ALL ON FUNCTION public.get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text) TO service_role;
GRANT ALL ON FUNCTION public.get_addresses_for_contract_role(p_role_id uuid, p_contract_role text, p_blockchain text) TO prisma;


--
-- Name: FUNCTION get_all_table_schemas(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_all_table_schemas() TO anon;
GRANT ALL ON FUNCTION public.get_all_table_schemas() TO authenticated;
GRANT ALL ON FUNCTION public.get_all_table_schemas() TO service_role;
GRANT ALL ON FUNCTION public.get_all_table_schemas() TO prisma;


--
-- Name: FUNCTION get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text) TO anon;
GRANT ALL ON FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text) TO authenticated;
GRANT ALL ON FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text) TO service_role;
GRANT ALL ON FUNCTION public.get_applicable_spread(p_project_id uuid, p_crypto_asset text, p_network text, p_amount numeric, p_direction text) TO prisma;


--
-- Name: FUNCTION get_audit_repopulation_summary(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_audit_repopulation_summary() TO anon;
GRANT ALL ON FUNCTION public.get_audit_repopulation_summary() TO authenticated;
GRANT ALL ON FUNCTION public.get_audit_repopulation_summary() TO service_role;
GRANT ALL ON FUNCTION public.get_audit_repopulation_summary() TO prisma;


--
-- Name: FUNCTION get_audit_statistics(p_hours_back integer); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_audit_statistics(p_hours_back integer) TO anon;
GRANT ALL ON FUNCTION public.get_audit_statistics(p_hours_back integer) TO authenticated;
GRANT ALL ON FUNCTION public.get_audit_statistics(p_hours_back integer) TO service_role;
GRANT ALL ON FUNCTION public.get_audit_statistics(p_hours_back integer) TO prisma;


--
-- Name: FUNCTION get_contract_roles_for_address(p_address_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_contract_roles_for_address(p_address_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_contract_roles_for_address(p_address_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_contract_roles_for_address(p_address_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_contract_roles_for_address(p_address_id uuid) TO prisma;


--
-- Name: FUNCTION get_enhanced_risk_assessment(p_receivable_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_enhanced_risk_assessment(p_receivable_id uuid) TO prisma;


--
-- Name: FUNCTION get_factory_address(p_network text, p_environment text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_factory_address(p_network text, p_environment text) TO anon;
GRANT ALL ON FUNCTION public.get_factory_address(p_network text, p_environment text) TO authenticated;
GRANT ALL ON FUNCTION public.get_factory_address(p_network text, p_environment text) TO service_role;
GRANT ALL ON FUNCTION public.get_factory_address(p_network text, p_environment text) TO prisma;


--
-- Name: FUNCTION get_fund_project_id(p_fund_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_fund_project_id(p_fund_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_fund_project_id(p_fund_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_fund_project_id(p_fund_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_fund_project_id(p_fund_id uuid) TO prisma;


--
-- Name: FUNCTION get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares(p_investor_id uuid, p_fund_id uuid) TO prisma;


--
-- Name: FUNCTION get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_investor_mmf_shares_by_project(p_investor_id uuid, p_fund_id uuid, p_project_id uuid) TO prisma;


--
-- Name: FUNCTION get_master_address(p_network text, p_environment text, p_standard text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_master_address(p_network text, p_environment text, p_standard text) TO anon;
GRANT ALL ON FUNCTION public.get_master_address(p_network text, p_environment text, p_standard text) TO authenticated;
GRANT ALL ON FUNCTION public.get_master_address(p_network text, p_environment text, p_standard text) TO service_role;
GRANT ALL ON FUNCTION public.get_master_address(p_network text, p_environment text, p_standard text) TO prisma;


--
-- Name: FUNCTION get_mmf_holdings_summary(p_fund_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_mmf_holdings_summary(p_fund_id uuid) TO prisma;


--
-- Name: FUNCTION get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone) TO anon;
GRANT ALL ON FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone) TO authenticated;
GRANT ALL ON FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone) TO service_role;
GRANT ALL ON FUNCTION public.get_mmf_nav(p_fund_id uuid, p_as_of_date timestamp with time zone) TO prisma;


--
-- Name: FUNCTION get_moonpay_webhook_stats(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_moonpay_webhook_stats() TO anon;
GRANT ALL ON FUNCTION public.get_moonpay_webhook_stats() TO authenticated;
GRANT ALL ON FUNCTION public.get_moonpay_webhook_stats() TO service_role;
GRANT ALL ON FUNCTION public.get_moonpay_webhook_stats() TO prisma;


--
-- Name: FUNCTION get_payer_risk_assessment(p_payer_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment(p_payer_id uuid) TO prisma;


--
-- Name: FUNCTION get_payer_risk_assessment_with_user_data(p_payer_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_payer_risk_assessment_with_user_data(p_payer_id uuid) TO prisma;


--
-- Name: FUNCTION get_product_id_for_project(p_project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_product_id_for_project(p_project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_product_id_for_project(p_project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_product_id_for_project(p_project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_product_id_for_project(p_project_id uuid) TO prisma;


--
-- Name: FUNCTION get_product_table_name(p_product_type text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_product_table_name(p_product_type text) TO anon;
GRANT ALL ON FUNCTION public.get_product_table_name(p_product_type text) TO authenticated;
GRANT ALL ON FUNCTION public.get_product_table_name(p_product_type text) TO service_role;
GRANT ALL ON FUNCTION public.get_product_table_name(p_product_type text) TO prisma;


--
-- Name: FUNCTION get_project_target_raise(p_project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_project_target_raise(p_project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_project_target_raise(p_project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_project_target_raise(p_project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_project_target_raise(p_project_id uuid) TO prisma;


--
-- Name: FUNCTION get_proposal_by_id(proposal_id_param uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_proposal_by_id(proposal_id_param uuid) TO anon;
GRANT ALL ON FUNCTION public.get_proposal_by_id(proposal_id_param uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_proposal_by_id(proposal_id_param uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_proposal_by_id(proposal_id_param uuid) TO prisma;


--
-- Name: FUNCTION get_proposal_signatures(p_proposal_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_proposal_signatures(p_proposal_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_proposal_signatures(p_proposal_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_proposal_signatures(p_proposal_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_proposal_signatures(p_proposal_id uuid) TO prisma;


--
-- Name: FUNCTION get_proposals_for_wallet(p_wallet_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_proposals_for_wallet(p_wallet_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_proposals_for_wallet(p_wallet_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_proposals_for_wallet(p_wallet_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_proposals_for_wallet(p_wallet_id uuid) TO prisma;


--
-- Name: FUNCTION get_recent_activities(days_back integer); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_recent_activities(days_back integer) TO anon;
GRANT ALL ON FUNCTION public.get_recent_activities(days_back integer) TO authenticated;
GRANT ALL ON FUNCTION public.get_recent_activities(days_back integer) TO service_role;
GRANT ALL ON FUNCTION public.get_recent_activities(days_back integer) TO prisma;


--
-- Name: FUNCTION get_redemption_capacity(p_redemption_rule_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_redemption_capacity(p_redemption_rule_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_redemption_capacity(p_redemption_rule_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_redemption_capacity(p_redemption_rule_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_redemption_capacity(p_redemption_rule_id uuid) TO prisma;


--
-- Name: FUNCTION get_redemption_rule_product_details(p_redemption_rule_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_redemption_rule_product_details(p_redemption_rule_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_redemption_rule_product_details(p_redemption_rule_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_redemption_rule_product_details(p_redemption_rule_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_redemption_rule_product_details(p_redemption_rule_id uuid) TO prisma;


--
-- Name: FUNCTION get_redemption_rules_by_product_type(p_product_type text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_redemption_rules_by_product_type(p_product_type text) TO anon;
GRANT ALL ON FUNCTION public.get_redemption_rules_by_product_type(p_product_type text) TO authenticated;
GRANT ALL ON FUNCTION public.get_redemption_rules_by_product_type(p_product_type text) TO service_role;
GRANT ALL ON FUNCTION public.get_redemption_rules_by_product_type(p_product_type text) TO prisma;


--
-- Name: FUNCTION get_redemption_rules_near_capacity(p_threshold_percentage numeric); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_redemption_rules_near_capacity(p_threshold_percentage numeric) TO anon;
GRANT ALL ON FUNCTION public.get_redemption_rules_near_capacity(p_threshold_percentage numeric) TO authenticated;
GRANT ALL ON FUNCTION public.get_redemption_rules_near_capacity(p_threshold_percentage numeric) TO service_role;
GRANT ALL ON FUNCTION public.get_redemption_rules_near_capacity(p_threshold_percentage numeric) TO prisma;


--
-- Name: FUNCTION get_supabase_function_url(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_supabase_function_url() TO anon;
GRANT ALL ON FUNCTION public.get_supabase_function_url() TO authenticated;
GRANT ALL ON FUNCTION public.get_supabase_function_url() TO service_role;
GRANT ALL ON FUNCTION public.get_supabase_function_url() TO prisma;


--
-- Name: FUNCTION get_table_row_counts(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_table_row_counts() TO anon;
GRANT ALL ON FUNCTION public.get_table_row_counts() TO authenticated;
GRANT ALL ON FUNCTION public.get_table_row_counts() TO service_role;
GRANT ALL ON FUNCTION public.get_table_row_counts() TO prisma;


--
-- Name: FUNCTION get_token_extensions(p_token_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_token_extensions(p_token_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_token_extensions(p_token_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_token_extensions(p_token_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_token_extensions(p_token_id uuid) TO prisma;


--
-- Name: FUNCTION get_token_whitelist_addresses(p_token_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_token_whitelist_addresses(p_token_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_token_whitelist_addresses(p_token_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_token_whitelist_addresses(p_token_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_token_whitelist_addresses(p_token_id uuid) TO prisma;


--
-- Name: FUNCTION get_total_redemption_capacity(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_total_redemption_capacity() TO anon;
GRANT ALL ON FUNCTION public.get_total_redemption_capacity() TO authenticated;
GRANT ALL ON FUNCTION public.get_total_redemption_capacity() TO service_role;
GRANT ALL ON FUNCTION public.get_total_redemption_capacity() TO prisma;


--
-- Name: FUNCTION get_unique_group_memberships(investor_ids text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_unique_group_memberships(investor_ids text[]) TO anon;
GRANT ALL ON FUNCTION public.get_unique_group_memberships(investor_ids text[]) TO authenticated;
GRANT ALL ON FUNCTION public.get_unique_group_memberships(investor_ids text[]) TO service_role;
GRANT ALL ON FUNCTION public.get_unique_group_memberships(investor_ids text[]) TO prisma;


--
-- Name: FUNCTION get_unique_member_count(group_id_param text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_unique_member_count(group_id_param text) TO anon;
GRANT ALL ON FUNCTION public.get_unique_member_count(group_id_param text) TO authenticated;
GRANT ALL ON FUNCTION public.get_unique_member_count(group_id_param text) TO service_role;
GRANT ALL ON FUNCTION public.get_unique_member_count(group_id_param text) TO prisma;


--
-- Name: FUNCTION get_user_profile(user_auth_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_user_profile(user_auth_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_user_profile(user_auth_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_user_profile(user_auth_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_user_profile(user_auth_id uuid) TO prisma;


--
-- Name: FUNCTION get_user_project_ids(user_auth_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_user_project_ids(user_auth_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_user_project_ids(user_auth_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_user_project_ids(user_auth_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_user_project_ids(user_auth_id uuid) TO prisma;


--
-- Name: FUNCTION get_users_by_role_for_approval(role_names text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_users_by_role_for_approval(role_names text[]) TO anon;
GRANT ALL ON FUNCTION public.get_users_by_role_for_approval(role_names text[]) TO authenticated;
GRANT ALL ON FUNCTION public.get_users_by_role_for_approval(role_names text[]) TO service_role;
GRANT ALL ON FUNCTION public.get_users_by_role_for_approval(role_names text[]) TO prisma;


--
-- Name: FUNCTION get_users_with_any_permission(permission_names text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_users_with_any_permission(permission_names text[]) TO anon;
GRANT ALL ON FUNCTION public.get_users_with_any_permission(permission_names text[]) TO authenticated;
GRANT ALL ON FUNCTION public.get_users_with_any_permission(permission_names text[]) TO service_role;
GRANT ALL ON FUNCTION public.get_users_with_any_permission(permission_names text[]) TO prisma;


--
-- Name: FUNCTION get_users_with_permission(permission_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_users_with_permission(permission_name text) TO anon;
GRANT ALL ON FUNCTION public.get_users_with_permission(permission_name text) TO authenticated;
GRANT ALL ON FUNCTION public.get_users_with_permission(permission_name text) TO service_role;
GRANT ALL ON FUNCTION public.get_users_with_permission(permission_name text) TO prisma;


--
-- Name: FUNCTION get_users_with_permission_simple(p_permission_id text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_users_with_permission_simple(p_permission_id text) TO anon;
GRANT ALL ON FUNCTION public.get_users_with_permission_simple(p_permission_id text) TO authenticated;
GRANT ALL ON FUNCTION public.get_users_with_permission_simple(p_permission_id text) TO service_role;
GRANT ALL ON FUNCTION public.get_users_with_permission_simple(p_permission_id text) TO prisma;


--
-- Name: FUNCTION get_wallet_signers(p_wallet_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.get_wallet_signers(p_wallet_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_wallet_signers(p_wallet_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_wallet_signers(p_wallet_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.get_wallet_signers(p_wallet_id uuid) TO prisma;


--
-- Name: FUNCTION handle_auth_user_created(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_auth_user_created() TO anon;
GRANT ALL ON FUNCTION public.handle_auth_user_created() TO authenticated;
GRANT ALL ON FUNCTION public.handle_auth_user_created() TO service_role;
GRANT ALL ON FUNCTION public.handle_auth_user_created() TO prisma;


--
-- Name: FUNCTION handle_new_auth_user(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_new_auth_user() TO anon;
GRANT ALL ON FUNCTION public.handle_new_auth_user() TO authenticated;
GRANT ALL ON FUNCTION public.handle_new_auth_user() TO service_role;
GRANT ALL ON FUNCTION public.handle_new_auth_user() TO prisma;


--
-- Name: FUNCTION handle_rule_rejection(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_rule_rejection() TO anon;
GRANT ALL ON FUNCTION public.handle_rule_rejection() TO authenticated;
GRANT ALL ON FUNCTION public.handle_rule_rejection() TO service_role;
GRANT ALL ON FUNCTION public.handle_rule_rejection() TO prisma;


--
-- Name: FUNCTION handle_token_allocation_deletion(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_token_allocation_deletion() TO anon;
GRANT ALL ON FUNCTION public.handle_token_allocation_deletion() TO authenticated;
GRANT ALL ON FUNCTION public.handle_token_allocation_deletion() TO service_role;
GRANT ALL ON FUNCTION public.handle_token_allocation_deletion() TO prisma;


--
-- Name: FUNCTION handle_token_distribution(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_token_distribution() TO anon;
GRANT ALL ON FUNCTION public.handle_token_distribution() TO authenticated;
GRANT ALL ON FUNCTION public.handle_token_distribution() TO service_role;
GRANT ALL ON FUNCTION public.handle_token_distribution() TO prisma;


--
-- Name: FUNCTION handle_user_deletion(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.handle_user_deletion() TO anon;
GRANT ALL ON FUNCTION public.handle_user_deletion() TO authenticated;
GRANT ALL ON FUNCTION public.handle_user_deletion() TO service_role;
GRANT ALL ON FUNCTION public.handle_user_deletion() TO prisma;


--
-- Name: FUNCTION increment_on_chain_confirmations(p_transaction_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.increment_on_chain_confirmations(p_transaction_id uuid) TO anon;
GRANT ALL ON FUNCTION public.increment_on_chain_confirmations(p_transaction_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.increment_on_chain_confirmations(p_transaction_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.increment_on_chain_confirmations(p_transaction_id uuid) TO prisma;


--
-- Name: FUNCTION increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO anon;
GRANT ALL ON FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.increment_shares_outstanding(p_fund_id uuid, p_shares numeric, p_project_id uuid) TO prisma;


--
-- Name: FUNCTION insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid) TO anon;
GRANT ALL ON FUNCTION public.insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.insert_energy_asset_safe(p_name character varying, p_type character varying, p_location character varying, p_capacity numeric, p_owner_id uuid) TO prisma;


--
-- Name: FUNCTION insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO anon;
GRANT ALL ON FUNCTION public.insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO authenticated;
GRANT ALL ON FUNCTION public.insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO service_role;
GRANT ALL ON FUNCTION public.insert_policy_approver(p_policy_id uuid, p_user_id text, p_created_by text) TO prisma;


--
-- Name: FUNCTION insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean) TO anon;
GRANT ALL ON FUNCTION public.insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean) TO authenticated;
GRANT ALL ON FUNCTION public.insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean) TO service_role;
GRANT ALL ON FUNCTION public.insert_proposal_signature(p_proposal_id uuid, p_signer_address text, p_signature text, p_signature_type text, p_is_valid boolean) TO prisma;


--
-- Name: FUNCTION insert_token_properties(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.insert_token_properties() TO anon;
GRANT ALL ON FUNCTION public.insert_token_properties() TO authenticated;
GRANT ALL ON FUNCTION public.insert_token_properties() TO service_role;
GRANT ALL ON FUNCTION public.insert_token_properties() TO prisma;


--
-- Name: FUNCTION is_address_whitelisted(p_token_id uuid, p_address text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.is_address_whitelisted(p_token_id uuid, p_address text) TO anon;
GRANT ALL ON FUNCTION public.is_address_whitelisted(p_token_id uuid, p_address text) TO authenticated;
GRANT ALL ON FUNCTION public.is_address_whitelisted(p_token_id uuid, p_address text) TO service_role;
GRANT ALL ON FUNCTION public.is_address_whitelisted(p_token_id uuid, p_address text) TO prisma;


--
-- Name: FUNCTION link_redemption_request_to_window(request_id uuid, window_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.link_redemption_request_to_window(request_id uuid, window_id uuid) TO anon;
GRANT ALL ON FUNCTION public.link_redemption_request_to_window(request_id uuid, window_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.link_redemption_request_to_window(request_id uuid, window_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.link_redemption_request_to_window(request_id uuid, window_id uuid) TO prisma;


--
-- Name: FUNCTION list_tables(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.list_tables() TO anon;
GRANT ALL ON FUNCTION public.list_tables() TO authenticated;
GRANT ALL ON FUNCTION public.list_tables() TO service_role;
GRANT ALL ON FUNCTION public.list_tables() TO prisma;


--
-- Name: FUNCTION log_approval_config_changes(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_approval_config_changes() TO anon;
GRANT ALL ON FUNCTION public.log_approval_config_changes() TO authenticated;
GRANT ALL ON FUNCTION public.log_approval_config_changes() TO service_role;
GRANT ALL ON FUNCTION public.log_approval_config_changes() TO prisma;


--
-- Name: FUNCTION log_approver_assignment_changes(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_approver_assignment_changes() TO anon;
GRANT ALL ON FUNCTION public.log_approver_assignment_changes() TO authenticated;
GRANT ALL ON FUNCTION public.log_approver_assignment_changes() TO service_role;
GRANT ALL ON FUNCTION public.log_approver_assignment_changes() TO prisma;


--
-- Name: FUNCTION log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text, p_details text, p_status text, p_metadata jsonb, p_old_data jsonb, p_new_data jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text, p_details text, p_status text, p_metadata jsonb, p_old_data jsonb, p_new_data jsonb) TO anon;
GRANT ALL ON FUNCTION public.log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text, p_details text, p_status text, p_metadata jsonb, p_old_data jsonb, p_new_data jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text, p_details text, p_status text, p_metadata jsonb, p_old_data jsonb, p_new_data jsonb) TO service_role;
GRANT ALL ON FUNCTION public.log_audit(p_action text, p_user_id uuid, p_entity_type text, p_entity_id text, p_details text, p_status text, p_metadata jsonb, p_old_data jsonb, p_new_data jsonb) TO prisma;


--
-- Name: FUNCTION log_auth_event(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_auth_event() TO anon;
GRANT ALL ON FUNCTION public.log_auth_event() TO authenticated;
GRANT ALL ON FUNCTION public.log_auth_event() TO service_role;
GRANT ALL ON FUNCTION public.log_auth_event() TO prisma;


--
-- Name: FUNCTION log_database_changes(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_database_changes() TO anon;
GRANT ALL ON FUNCTION public.log_database_changes() TO authenticated;
GRANT ALL ON FUNCTION public.log_database_changes() TO service_role;
GRANT ALL ON FUNCTION public.log_database_changes() TO prisma;


--
-- Name: FUNCTION log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb) TO anon;
GRANT ALL ON FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb) TO service_role;
GRANT ALL ON FUNCTION public.log_database_operation(p_table_name text, p_operation text, p_record_id text, p_user_id uuid, p_old_data jsonb, p_new_data jsonb, p_metadata jsonb) TO prisma;


--
-- Name: FUNCTION log_table_change(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_table_change() TO anon;
GRANT ALL ON FUNCTION public.log_table_change() TO authenticated;
GRANT ALL ON FUNCTION public.log_table_change() TO service_role;
GRANT ALL ON FUNCTION public.log_table_change() TO prisma;


--
-- Name: FUNCTION log_user_action(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_user_action() TO anon;
GRANT ALL ON FUNCTION public.log_user_action() TO authenticated;
GRANT ALL ON FUNCTION public.log_user_action() TO service_role;
GRANT ALL ON FUNCTION public.log_user_action() TO prisma;


--
-- Name: FUNCTION log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb) TO anon;
GRANT ALL ON FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb) TO service_role;
GRANT ALL ON FUNCTION public.log_wallet_access(p_wallet_id uuid, p_accessed_by uuid, p_action text, p_success boolean, p_error_message text, p_ip_address text, p_user_agent text, p_metadata jsonb) TO prisma;


--
-- Name: FUNCTION migrate_token_json_to_tables(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.migrate_token_json_to_tables() TO anon;
GRANT ALL ON FUNCTION public.migrate_token_json_to_tables() TO authenticated;
GRANT ALL ON FUNCTION public.migrate_token_json_to_tables() TO service_role;
GRANT ALL ON FUNCTION public.migrate_token_json_to_tables() TO prisma;


--
-- Name: FUNCTION migrate_wallet_keys_to_vault(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.migrate_wallet_keys_to_vault() TO anon;
GRANT ALL ON FUNCTION public.migrate_wallet_keys_to_vault() TO authenticated;
GRANT ALL ON FUNCTION public.migrate_wallet_keys_to_vault() TO service_role;
GRANT ALL ON FUNCTION public.migrate_wallet_keys_to_vault() TO prisma;


--
-- Name: FUNCTION prevent_duplicate_lifecycle_events(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.prevent_duplicate_lifecycle_events() TO anon;
GRANT ALL ON FUNCTION public.prevent_duplicate_lifecycle_events() TO authenticated;
GRANT ALL ON FUNCTION public.prevent_duplicate_lifecycle_events() TO service_role;
GRANT ALL ON FUNCTION public.prevent_duplicate_lifecycle_events() TO prisma;


--
-- Name: FUNCTION projects_audit_function(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.projects_audit_function() TO anon;
GRANT ALL ON FUNCTION public.projects_audit_function() TO authenticated;
GRANT ALL ON FUNCTION public.projects_audit_function() TO service_role;
GRANT ALL ON FUNCTION public.projects_audit_function() TO prisma;


--
-- Name: FUNCTION projects_audit_trigger(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.projects_audit_trigger() TO anon;
GRANT ALL ON FUNCTION public.projects_audit_trigger() TO authenticated;
GRANT ALL ON FUNCTION public.projects_audit_trigger() TO service_role;
GRANT ALL ON FUNCTION public.projects_audit_trigger() TO prisma;


--
-- Name: FUNCTION purge_duplicate_lifecycle_events(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.purge_duplicate_lifecycle_events() TO anon;
GRANT ALL ON FUNCTION public.purge_duplicate_lifecycle_events() TO authenticated;
GRANT ALL ON FUNCTION public.purge_duplicate_lifecycle_events() TO service_role;
GRANT ALL ON FUNCTION public.purge_duplicate_lifecycle_events() TO prisma;


--
-- Name: FUNCTION reconcile_redemption_statistics(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.reconcile_redemption_statistics() TO anon;
GRANT ALL ON FUNCTION public.reconcile_redemption_statistics() TO authenticated;
GRANT ALL ON FUNCTION public.reconcile_redemption_statistics() TO service_role;
GRANT ALL ON FUNCTION public.reconcile_redemption_statistics() TO prisma;


--
-- Name: FUNCTION refresh_activity_metrics(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.refresh_activity_metrics() TO anon;
GRANT ALL ON FUNCTION public.refresh_activity_metrics() TO authenticated;
GRANT ALL ON FUNCTION public.refresh_activity_metrics() TO service_role;
GRANT ALL ON FUNCTION public.refresh_activity_metrics() TO prisma;


--
-- Name: FUNCTION refresh_all_redemption_window_statistics(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.refresh_all_redemption_window_statistics() TO anon;
GRANT ALL ON FUNCTION public.refresh_all_redemption_window_statistics() TO authenticated;
GRANT ALL ON FUNCTION public.refresh_all_redemption_window_statistics() TO service_role;
GRANT ALL ON FUNCTION public.refresh_all_redemption_window_statistics() TO prisma;


--
-- Name: FUNCTION remove_investors_from_group(p_group_id text, p_investor_ids text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.remove_investors_from_group(p_group_id text, p_investor_ids text[]) TO anon;
GRANT ALL ON FUNCTION public.remove_investors_from_group(p_group_id text, p_investor_ids text[]) TO authenticated;
GRANT ALL ON FUNCTION public.remove_investors_from_group(p_group_id text, p_investor_ids text[]) TO service_role;
GRANT ALL ON FUNCTION public.remove_investors_from_group(p_group_id text, p_investor_ids text[]) TO prisma;


--
-- Name: FUNCTION reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric) TO anon;
GRANT ALL ON FUNCTION public.reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric) TO authenticated;
GRANT ALL ON FUNCTION public.reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric) TO service_role;
GRANT ALL ON FUNCTION public.reserve_redemption_amounts(p_distribution_ids uuid[], p_total_amount numeric) TO prisma;


--
-- Name: FUNCTION rollback_transaction(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.rollback_transaction() TO anon;
GRANT ALL ON FUNCTION public.rollback_transaction() TO authenticated;
GRANT ALL ON FUNCTION public.rollback_transaction() TO service_role;
GRANT ALL ON FUNCTION public.rollback_transaction() TO prisma;


--
-- Name: FUNCTION safe_cast_to_uuid(input text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.safe_cast_to_uuid(input text) TO anon;
GRANT ALL ON FUNCTION public.safe_cast_to_uuid(input text) TO authenticated;
GRANT ALL ON FUNCTION public.safe_cast_to_uuid(input text) TO service_role;
GRANT ALL ON FUNCTION public.safe_cast_to_uuid(input text) TO prisma;


--
-- Name: FUNCTION safe_uuid_cast(text_id text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.safe_uuid_cast(text_id text) TO anon;
GRANT ALL ON FUNCTION public.safe_uuid_cast(text_id text) TO authenticated;
GRANT ALL ON FUNCTION public.safe_uuid_cast(text_id text) TO service_role;
GRANT ALL ON FUNCTION public.safe_uuid_cast(text_id text) TO prisma;


--
-- Name: FUNCTION save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]) TO anon;
GRANT ALL ON FUNCTION public.save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]) TO authenticated;
GRANT ALL ON FUNCTION public.save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]) TO service_role;
GRANT ALL ON FUNCTION public.save_consensus_config(p_consensus_type text, p_required_approvals integer, p_eligible_roles text[]) TO prisma;


--
-- Name: FUNCTION save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb) TO anon;
GRANT ALL ON FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb) TO service_role;
GRANT ALL ON FUNCTION public.save_enhanced_risk_calculation(p_receivable_id uuid, p_risk_score integer, p_discount_rate numeric, p_confidence_level numeric, p_market_adjustments jsonb, p_user_data_sources jsonb, p_data_completeness character varying, p_methodology text, p_factors_considered jsonb, p_policy_impacts jsonb, p_recommendations jsonb) TO prisma;


--
-- Name: FUNCTION set_distribution_standard(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.set_distribution_standard() TO anon;
GRANT ALL ON FUNCTION public.set_distribution_standard() TO authenticated;
GRANT ALL ON FUNCTION public.set_distribution_standard() TO service_role;
GRANT ALL ON FUNCTION public.set_distribution_standard() TO prisma;


--
-- Name: FUNCTION set_redemption_product_type_on_insert(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.set_redemption_product_type_on_insert() TO anon;
GRANT ALL ON FUNCTION public.set_redemption_product_type_on_insert() TO authenticated;
GRANT ALL ON FUNCTION public.set_redemption_product_type_on_insert() TO service_role;
GRANT ALL ON FUNCTION public.set_redemption_product_type_on_insert() TO prisma;


--
-- Name: FUNCTION set_token_allocation_standard(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.set_token_allocation_standard() TO anon;
GRANT ALL ON FUNCTION public.set_token_allocation_standard() TO authenticated;
GRANT ALL ON FUNCTION public.set_token_allocation_standard() TO service_role;
GRANT ALL ON FUNCTION public.set_token_allocation_standard() TO prisma;


--
-- Name: FUNCTION set_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.set_updated_at() TO anon;
GRANT ALL ON FUNCTION public.set_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.set_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.set_updated_at() TO prisma;


--
-- Name: FUNCTION sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type) TO anon;
GRANT ALL ON FUNCTION public.sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type) TO authenticated;
GRANT ALL ON FUNCTION public.sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type) TO service_role;
GRANT ALL ON FUNCTION public.sidebar_config_matches_user(config_role_ids uuid[], config_profile_enums public.profile_type[], user_role_ids uuid[], user_profile_type public.profile_type) TO prisma;


--
-- Name: FUNCTION sync_credential_vault_storage(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_credential_vault_storage() TO anon;
GRANT ALL ON FUNCTION public.sync_credential_vault_storage() TO authenticated;
GRANT ALL ON FUNCTION public.sync_credential_vault_storage() TO service_role;
GRANT ALL ON FUNCTION public.sync_credential_vault_storage() TO prisma;


--
-- Name: FUNCTION sync_group_memberships(group_id_param text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_group_memberships(group_id_param text) TO anon;
GRANT ALL ON FUNCTION public.sync_group_memberships(group_id_param text) TO authenticated;
GRANT ALL ON FUNCTION public.sync_group_memberships(group_id_param text) TO service_role;
GRANT ALL ON FUNCTION public.sync_group_memberships(group_id_param text) TO prisma;


--
-- Name: FUNCTION sync_investor_group_memberships(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_investor_group_memberships() TO anon;
GRANT ALL ON FUNCTION public.sync_investor_group_memberships() TO authenticated;
GRANT ALL ON FUNCTION public.sync_investor_group_memberships() TO service_role;
GRANT ALL ON FUNCTION public.sync_investor_group_memberships() TO prisma;


--
-- Name: FUNCTION sync_redemption_product_type(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_redemption_product_type() TO anon;
GRANT ALL ON FUNCTION public.sync_redemption_product_type() TO authenticated;
GRANT ALL ON FUNCTION public.sync_redemption_product_type() TO service_role;
GRANT ALL ON FUNCTION public.sync_redemption_product_type() TO prisma;


--
-- Name: FUNCTION sync_redemption_rules_on_product_change(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_redemption_rules_on_product_change() TO anon;
GRANT ALL ON FUNCTION public.sync_redemption_rules_on_product_change() TO authenticated;
GRANT ALL ON FUNCTION public.sync_redemption_rules_on_product_change() TO service_role;
GRANT ALL ON FUNCTION public.sync_redemption_rules_on_product_change() TO prisma;


--
-- Name: FUNCTION sync_redemption_target_raise_on_product_change(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_redemption_target_raise_on_product_change() TO anon;
GRANT ALL ON FUNCTION public.sync_redemption_target_raise_on_product_change() TO authenticated;
GRANT ALL ON FUNCTION public.sync_redemption_target_raise_on_product_change() TO service_role;
GRANT ALL ON FUNCTION public.sync_redemption_target_raise_on_product_change() TO prisma;


--
-- Name: FUNCTION sync_user_to_profile(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.sync_user_to_profile() TO anon;
GRANT ALL ON FUNCTION public.sync_user_to_profile() TO authenticated;
GRANT ALL ON FUNCTION public.sync_user_to_profile() TO service_role;
GRANT ALL ON FUNCTION public.sync_user_to_profile() TO prisma;


--
-- Name: FUNCTION table_exists(p_schema_name text, p_table_name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.table_exists(p_schema_name text, p_table_name text) TO anon;
GRANT ALL ON FUNCTION public.table_exists(p_schema_name text, p_table_name text) TO authenticated;
GRANT ALL ON FUNCTION public.table_exists(p_schema_name text, p_table_name text) TO service_role;
GRANT ALL ON FUNCTION public.table_exists(p_schema_name text, p_table_name text) TO prisma;


--
-- Name: FUNCTION track_system_process(process_name text, description text, metadata jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.track_system_process(process_name text, description text, metadata jsonb) TO anon;
GRANT ALL ON FUNCTION public.track_system_process(process_name text, description text, metadata jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.track_system_process(process_name text, description text, metadata jsonb) TO service_role;
GRANT ALL ON FUNCTION public.track_system_process(process_name text, description text, metadata jsonb) TO prisma;


--
-- Name: FUNCTION trigger_set_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.trigger_set_updated_at() TO anon;
GRANT ALL ON FUNCTION public.trigger_set_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.trigger_set_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.trigger_set_updated_at() TO prisma;


--
-- Name: FUNCTION trigger_update_redemption_statistics(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.trigger_update_redemption_statistics() TO anon;
GRANT ALL ON FUNCTION public.trigger_update_redemption_statistics() TO authenticated;
GRANT ALL ON FUNCTION public.trigger_update_redemption_statistics() TO service_role;
GRANT ALL ON FUNCTION public.trigger_update_redemption_statistics() TO prisma;


--
-- Name: FUNCTION universal_update_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.universal_update_timestamp() TO anon;
GRANT ALL ON FUNCTION public.universal_update_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.universal_update_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.universal_update_timestamp() TO prisma;


--
-- Name: FUNCTION update_blackout_periods_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_blackout_periods_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_blackout_periods_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_blackout_periods_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_blackout_periods_updated_at() TO prisma;


--
-- Name: FUNCTION update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer, p_failed_count integer, p_status character varying); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer, p_failed_count integer, p_status character varying) TO anon;
GRANT ALL ON FUNCTION public.update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer, p_failed_count integer, p_status character varying) TO authenticated;
GRANT ALL ON FUNCTION public.update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer, p_failed_count integer, p_status character varying) TO service_role;
GRANT ALL ON FUNCTION public.update_bulk_operation_progress(p_operation_id text, p_progress double precision, p_processed_count integer, p_failed_count integer, p_status character varying) TO prisma;


--
-- Name: FUNCTION update_cache_access(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_cache_access() TO anon;
GRANT ALL ON FUNCTION public.update_cache_access() TO authenticated;
GRANT ALL ON FUNCTION public.update_cache_access() TO service_role;
GRANT ALL ON FUNCTION public.update_cache_access() TO prisma;


--
-- Name: FUNCTION update_carbon_market_prices_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_carbon_market_prices_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_carbon_market_prices_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_carbon_market_prices_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_carbon_market_prices_updated_at() TO prisma;


--
-- Name: FUNCTION update_climate_cash_flow_projections(p_projections jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_climate_cash_flow_projections(p_projections jsonb) TO anon;
GRANT ALL ON FUNCTION public.update_climate_cash_flow_projections(p_projections jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.update_climate_cash_flow_projections(p_projections jsonb) TO service_role;
GRANT ALL ON FUNCTION public.update_climate_cash_flow_projections(p_projections jsonb) TO prisma;


--
-- Name: FUNCTION update_climate_risk_calculations_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_climate_risk_calculations_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_climate_risk_calculations_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_climate_risk_calculations_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_climate_risk_calculations_updated_at() TO prisma;


--
-- Name: FUNCTION update_consensus_settings_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_consensus_settings_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_consensus_settings_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_consensus_settings_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_consensus_settings_updated_at() TO prisma;


--
-- Name: FUNCTION update_credential_vault_storage_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_credential_vault_storage_timestamp() TO anon;
GRANT ALL ON FUNCTION public.update_credential_vault_storage_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.update_credential_vault_storage_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.update_credential_vault_storage_timestamp() TO prisma;


--
-- Name: FUNCTION update_distribution_remaining_amount(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_distribution_remaining_amount() TO anon;
GRANT ALL ON FUNCTION public.update_distribution_remaining_amount() TO authenticated;
GRANT ALL ON FUNCTION public.update_distribution_remaining_amount() TO service_role;
GRANT ALL ON FUNCTION public.update_distribution_remaining_amount() TO prisma;


--
-- Name: FUNCTION update_energy_assets_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_energy_assets_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_energy_assets_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_energy_assets_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_energy_assets_updated_at() TO prisma;


--
-- Name: FUNCTION update_group_member_count(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_group_member_count() TO anon;
GRANT ALL ON FUNCTION public.update_group_member_count() TO authenticated;
GRANT ALL ON FUNCTION public.update_group_member_count() TO service_role;
GRANT ALL ON FUNCTION public.update_group_member_count() TO prisma;


--
-- Name: FUNCTION update_individual_documents_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_individual_documents_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_individual_documents_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_individual_documents_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_individual_documents_updated_at() TO prisma;


--
-- Name: FUNCTION update_modified_column(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_modified_column() TO anon;
GRANT ALL ON FUNCTION public.update_modified_column() TO authenticated;
GRANT ALL ON FUNCTION public.update_modified_column() TO service_role;
GRANT ALL ON FUNCTION public.update_modified_column() TO prisma;


--
-- Name: FUNCTION update_oracle_prices(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_oracle_prices() TO anon;
GRANT ALL ON FUNCTION public.update_oracle_prices() TO authenticated;
GRANT ALL ON FUNCTION public.update_oracle_prices() TO service_role;
GRANT ALL ON FUNCTION public.update_oracle_prices() TO prisma;


--
-- Name: FUNCTION update_project_organization_assignments_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_project_organization_assignments_timestamp() TO anon;
GRANT ALL ON FUNCTION public.update_project_organization_assignments_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.update_project_organization_assignments_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.update_project_organization_assignments_timestamp() TO prisma;


--
-- Name: FUNCTION update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO anon;
GRANT ALL ON FUNCTION public.update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO authenticated;
GRANT ALL ON FUNCTION public.update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO service_role;
GRANT ALL ON FUNCTION public.update_proposal_execution(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO prisma;


--
-- Name: FUNCTION update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean, p_status text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean, p_status text) TO anon;
GRANT ALL ON FUNCTION public.update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean, p_status text) TO authenticated;
GRANT ALL ON FUNCTION public.update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean, p_status text) TO service_role;
GRANT ALL ON FUNCTION public.update_proposal_on_chain_submission(p_proposal_id uuid, p_on_chain_tx_id integer, p_on_chain_tx_hash text, p_submitted_on_chain boolean, p_status text) TO prisma;


--
-- Name: FUNCTION update_proposal_signature_count(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_proposal_signature_count() TO anon;
GRANT ALL ON FUNCTION public.update_proposal_signature_count() TO authenticated;
GRANT ALL ON FUNCTION public.update_proposal_signature_count() TO service_role;
GRANT ALL ON FUNCTION public.update_proposal_signature_count() TO prisma;


--
-- Name: FUNCTION update_proposal_signature_count(proposal_id_param uuid, signature_count integer); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_proposal_signature_count(proposal_id_param uuid, signature_count integer) TO anon;
GRANT ALL ON FUNCTION public.update_proposal_signature_count(proposal_id_param uuid, signature_count integer) TO authenticated;
GRANT ALL ON FUNCTION public.update_proposal_signature_count(proposal_id_param uuid, signature_count integer) TO service_role;
GRANT ALL ON FUNCTION public.update_proposal_signature_count(proposal_id_param uuid, signature_count integer) TO prisma;


--
-- Name: FUNCTION update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO anon;
GRANT ALL ON FUNCTION public.update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO authenticated;
GRANT ALL ON FUNCTION public.update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO service_role;
GRANT ALL ON FUNCTION public.update_proposal_status(p_proposal_id uuid, p_status text, p_executed_at timestamp with time zone, p_execution_hash text) TO prisma;


--
-- Name: FUNCTION update_redemption_approvers_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_redemption_approvers_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_redemption_approvers_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_redemption_approvers_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_redemption_approvers_updated_at() TO prisma;


--
-- Name: FUNCTION update_redemption_window_statistics(window_uuid uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_redemption_window_statistics(window_uuid uuid) TO anon;
GRANT ALL ON FUNCTION public.update_redemption_window_statistics(window_uuid uuid) TO authenticated;
GRANT ALL ON FUNCTION public.update_redemption_window_statistics(window_uuid uuid) TO service_role;
GRANT ALL ON FUNCTION public.update_redemption_window_statistics(window_uuid uuid) TO prisma;


--
-- Name: FUNCTION update_redemption_window_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_redemption_window_timestamp() TO anon;
GRANT ALL ON FUNCTION public.update_redemption_window_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.update_redemption_window_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.update_redemption_window_timestamp() TO prisma;


--
-- Name: FUNCTION update_restriction_rules_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_restriction_rules_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_restriction_rules_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_restriction_rules_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_restriction_rules_updated_at() TO prisma;


--
-- Name: FUNCTION update_ripple_payments_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_ripple_payments_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_ripple_payments_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_ripple_payments_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_ripple_payments_updated_at() TO prisma;


--
-- Name: FUNCTION update_ripple_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_ripple_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_ripple_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_ripple_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_ripple_updated_at() TO prisma;


--
-- Name: FUNCTION update_rules_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_rules_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_rules_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_rules_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_rules_updated_at() TO prisma;


--
-- Name: FUNCTION update_security_events_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_security_events_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_security_events_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_security_events_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_security_events_updated_at() TO prisma;


--
-- Name: FUNCTION update_settlement_operations_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_settlement_operations_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_settlement_operations_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_settlement_operations_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_settlement_operations_updated_at() TO prisma;


--
-- Name: FUNCTION update_settlement_status(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_settlement_status() TO anon;
GRANT ALL ON FUNCTION public.update_settlement_status() TO authenticated;
GRANT ALL ON FUNCTION public.update_settlement_status() TO service_role;
GRANT ALL ON FUNCTION public.update_settlement_status() TO prisma;


--
-- Name: FUNCTION update_sidebar_configurations_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_sidebar_configurations_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_sidebar_configurations_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_sidebar_configurations_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_sidebar_configurations_updated_at() TO prisma;


--
-- Name: FUNCTION update_sidebar_items_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_sidebar_items_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_sidebar_items_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_sidebar_items_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_sidebar_items_updated_at() TO prisma;


--
-- Name: FUNCTION update_sidebar_sections_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_sidebar_sections_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_sidebar_sections_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_sidebar_sections_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_sidebar_sections_updated_at() TO prisma;


--
-- Name: FUNCTION update_signature_migrations_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_signature_migrations_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_signature_migrations_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_signature_migrations_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_signature_migrations_updated_at() TO prisma;


--
-- Name: FUNCTION update_smart_contract_wallet_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_smart_contract_wallet_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_smart_contract_wallet_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_smart_contract_wallet_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_smart_contract_wallet_updated_at() TO prisma;


--
-- Name: FUNCTION update_stripe_conversion_transactions_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_stripe_conversion_transactions_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_stripe_conversion_transactions_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_stripe_conversion_transactions_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_stripe_conversion_transactions_updated_at() TO prisma;


--
-- Name: FUNCTION update_stripe_stablecoin_accounts_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_stripe_stablecoin_accounts_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_stripe_stablecoin_accounts_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_stripe_stablecoin_accounts_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_stripe_stablecoin_accounts_updated_at() TO prisma;


--
-- Name: FUNCTION update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer, p_status character varying); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer, p_status character varying) TO anon;
GRANT ALL ON FUNCTION public.update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer, p_status character varying) TO authenticated;
GRANT ALL ON FUNCTION public.update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer, p_status character varying) TO service_role;
GRANT ALL ON FUNCTION public.update_system_process_progress(p_process_id text, p_progress double precision, p_processed_count integer, p_status character varying) TO prisma;


--
-- Name: FUNCTION update_system_process_status(process_id uuid, new_status text, error_details text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_system_process_status(process_id uuid, new_status text, error_details text) TO anon;
GRANT ALL ON FUNCTION public.update_system_process_status(process_id uuid, new_status text, error_details text) TO authenticated;
GRANT ALL ON FUNCTION public.update_system_process_status(process_id uuid, new_status text, error_details text) TO service_role;
GRANT ALL ON FUNCTION public.update_system_process_status(process_id uuid, new_status text, error_details text) TO prisma;


--
-- Name: FUNCTION update_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_timestamp() TO anon;
GRANT ALL ON FUNCTION public.update_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.update_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.update_timestamp() TO prisma;


--
-- Name: FUNCTION update_timestamp_column(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_timestamp_column() TO anon;
GRANT ALL ON FUNCTION public.update_timestamp_column() TO authenticated;
GRANT ALL ON FUNCTION public.update_timestamp_column() TO service_role;
GRANT ALL ON FUNCTION public.update_timestamp_column() TO prisma;


--
-- Name: FUNCTION update_token_exchange_configs_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_token_exchange_configs_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_token_exchange_configs_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_token_exchange_configs_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_token_exchange_configs_updated_at() TO prisma;


--
-- Name: FUNCTION update_token_modules_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_token_modules_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_token_modules_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_token_modules_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_token_modules_updated_at() TO prisma;


--
-- Name: FUNCTION update_total_assets(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_total_assets() TO anon;
GRANT ALL ON FUNCTION public.update_total_assets() TO authenticated;
GRANT ALL ON FUNCTION public.update_total_assets() TO service_role;
GRANT ALL ON FUNCTION public.update_total_assets() TO prisma;


--
-- Name: FUNCTION update_trade_finance_rewards_timestamp(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_trade_finance_rewards_timestamp() TO anon;
GRANT ALL ON FUNCTION public.update_trade_finance_rewards_timestamp() TO authenticated;
GRANT ALL ON FUNCTION public.update_trade_finance_rewards_timestamp() TO service_role;
GRANT ALL ON FUNCTION public.update_trade_finance_rewards_timestamp() TO prisma;


--
-- Name: FUNCTION update_transfer_operations_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_transfer_operations_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_transfer_operations_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_transfer_operations_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_transfer_operations_updated_at() TO prisma;


--
-- Name: FUNCTION update_updated_at_column(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_updated_at_column() TO anon;
GRANT ALL ON FUNCTION public.update_updated_at_column() TO authenticated;
GRANT ALL ON FUNCTION public.update_updated_at_column() TO service_role;
GRANT ALL ON FUNCTION public.update_updated_at_column() TO prisma;


--
-- Name: FUNCTION update_user_addresses_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_user_addresses_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_user_addresses_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_user_addresses_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_user_addresses_updated_at() TO prisma;


--
-- Name: FUNCTION update_user_contract_roles_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_user_contract_roles_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_user_contract_roles_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_user_contract_roles_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_user_contract_roles_updated_at() TO prisma;


--
-- Name: FUNCTION update_user_role(p_user_id uuid, p_role text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_user_role(p_user_id uuid, p_role text) TO anon;
GRANT ALL ON FUNCTION public.update_user_role(p_user_id uuid, p_role text) TO authenticated;
GRANT ALL ON FUNCTION public.update_user_role(p_user_id uuid, p_role text) TO service_role;
GRANT ALL ON FUNCTION public.update_user_role(p_user_id uuid, p_role text) TO prisma;


--
-- Name: FUNCTION update_user_sidebar_preferences_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_user_sidebar_preferences_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_user_sidebar_preferences_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_user_sidebar_preferences_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_user_sidebar_preferences_updated_at() TO prisma;


--
-- Name: FUNCTION update_wallet_locks_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_wallet_locks_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_wallet_locks_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_wallet_locks_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_wallet_locks_updated_at() TO prisma;


--
-- Name: FUNCTION update_wallet_signatories_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_wallet_signatories_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_wallet_signatories_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_wallet_signatories_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_wallet_signatories_updated_at() TO prisma;


--
-- Name: FUNCTION update_wallet_transaction_drafts_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_wallet_transaction_drafts_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_wallet_transaction_drafts_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_wallet_transaction_drafts_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_wallet_transaction_drafts_updated_at() TO prisma;


--
-- Name: FUNCTION update_whitelist_entries_updated_at(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.update_whitelist_entries_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_whitelist_entries_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_whitelist_entries_updated_at() TO service_role;
GRANT ALL ON FUNCTION public.update_whitelist_entries_updated_at() TO prisma;


--
-- Name: FUNCTION upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text) TO anon;
GRANT ALL ON FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text) TO authenticated;
GRANT ALL ON FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text) TO service_role;
GRANT ALL ON FUNCTION public.upsert_address_selection(p_user_id uuid, p_project_id uuid, p_address text, p_context text) TO prisma;


--
-- Name: FUNCTION upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text) TO anon;
GRANT ALL ON FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text) TO authenticated;
GRANT ALL ON FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text) TO service_role;
GRANT ALL ON FUNCTION public.upsert_policy_template_approver(p_template_id uuid, p_user_id uuid, p_created_by text, p_status text) TO prisma;


--
-- Name: FUNCTION user_has_delete_permission(p_user_id uuid); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.user_has_delete_permission(p_user_id uuid) TO anon;
GRANT ALL ON FUNCTION public.user_has_delete_permission(p_user_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.user_has_delete_permission(p_user_id uuid) TO service_role;
GRANT ALL ON FUNCTION public.user_has_delete_permission(p_user_id uuid) TO prisma;


--
-- Name: FUNCTION validate_blockchain_address(blockchain text, address text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_blockchain_address(blockchain text, address text) TO anon;
GRANT ALL ON FUNCTION public.validate_blockchain_address(blockchain text, address text) TO authenticated;
GRANT ALL ON FUNCTION public.validate_blockchain_address(blockchain text, address text) TO service_role;
GRANT ALL ON FUNCTION public.validate_blockchain_address(blockchain text, address text) TO prisma;


--
-- Name: FUNCTION validate_document_config(config jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_document_config(config jsonb) TO anon;
GRANT ALL ON FUNCTION public.validate_document_config(config jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.validate_document_config(config jsonb) TO service_role;
GRANT ALL ON FUNCTION public.validate_document_config(config jsonb) TO prisma;


--
-- Name: FUNCTION validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric) TO anon;
GRANT ALL ON FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric) TO authenticated;
GRANT ALL ON FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric) TO service_role;
GRANT ALL ON FUNCTION public.validate_geographic_restriction(p_token_id uuid, p_investor_country_code character, p_investment_amount numeric) TO prisma;


--
-- Name: FUNCTION validate_project_type(p_project_type text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_project_type(p_project_type text) TO anon;
GRANT ALL ON FUNCTION public.validate_project_type(p_project_type text) TO authenticated;
GRANT ALL ON FUNCTION public.validate_project_type(p_project_type text) TO service_role;
GRANT ALL ON FUNCTION public.validate_project_type(p_project_type text) TO prisma;


--
-- Name: FUNCTION validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric) TO anon;
GRANT ALL ON FUNCTION public.validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric) TO authenticated;
GRANT ALL ON FUNCTION public.validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric) TO service_role;
GRANT ALL ON FUNCTION public.validate_redemption_amount(p_redemption_rule_id uuid, p_requested_amount numeric) TO prisma;


--
-- Name: FUNCTION validate_subscription_project_consistency(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_subscription_project_consistency() TO anon;
GRANT ALL ON FUNCTION public.validate_subscription_project_consistency() TO authenticated;
GRANT ALL ON FUNCTION public.validate_subscription_project_consistency() TO service_role;
GRANT ALL ON FUNCTION public.validate_subscription_project_consistency() TO prisma;


--
-- Name: FUNCTION validate_token_data(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_token_data() TO anon;
GRANT ALL ON FUNCTION public.validate_token_data() TO authenticated;
GRANT ALL ON FUNCTION public.validate_token_data() TO service_role;
GRANT ALL ON FUNCTION public.validate_token_data() TO prisma;


--
-- Name: FUNCTION validate_token_exists(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_token_exists() TO anon;
GRANT ALL ON FUNCTION public.validate_token_exists() TO authenticated;
GRANT ALL ON FUNCTION public.validate_token_exists() TO service_role;
GRANT ALL ON FUNCTION public.validate_token_exists() TO prisma;


--
-- Name: FUNCTION validate_vesting_config(config jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_vesting_config(config jsonb) TO anon;
GRANT ALL ON FUNCTION public.validate_vesting_config(config jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.validate_vesting_config(config jsonb) TO service_role;
GRANT ALL ON FUNCTION public.validate_vesting_config(config jsonb) TO prisma;


--
-- Name: FUNCTION validate_wallet_address(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_wallet_address() TO anon;
GRANT ALL ON FUNCTION public.validate_wallet_address() TO authenticated;
GRANT ALL ON FUNCTION public.validate_wallet_address() TO service_role;
GRANT ALL ON FUNCTION public.validate_wallet_address() TO prisma;


--
-- Name: FUNCTION validate_whitelist_config_permissive(config jsonb); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.validate_whitelist_config_permissive(config jsonb) TO anon;
GRANT ALL ON FUNCTION public.validate_whitelist_config_permissive(config jsonb) TO authenticated;
GRANT ALL ON FUNCTION public.validate_whitelist_config_permissive(config jsonb) TO service_role;
GRANT ALL ON FUNCTION public.validate_whitelist_config_permissive(config jsonb) TO prisma;


--
-- Name: FUNCTION verify_multi_sig_proposals_access(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.verify_multi_sig_proposals_access() TO anon;
GRANT ALL ON FUNCTION public.verify_multi_sig_proposals_access() TO authenticated;
GRANT ALL ON FUNCTION public.verify_multi_sig_proposals_access() TO service_role;
GRANT ALL ON FUNCTION public.verify_multi_sig_proposals_access() TO prisma;


--
-- Name: TABLE abs_cash_flows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.abs_cash_flows TO anon;
GRANT ALL ON TABLE public.abs_cash_flows TO authenticated;
GRANT ALL ON TABLE public.abs_cash_flows TO service_role;
GRANT ALL ON TABLE public.abs_cash_flows TO prisma;


--
-- Name: TABLE abs_collateral_pools; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.abs_collateral_pools TO anon;
GRANT ALL ON TABLE public.abs_collateral_pools TO authenticated;
GRANT ALL ON TABLE public.abs_collateral_pools TO service_role;
GRANT ALL ON TABLE public.abs_collateral_pools TO prisma;


--
-- Name: TABLE abs_loss_projections; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.abs_loss_projections TO anon;
GRANT ALL ON TABLE public.abs_loss_projections TO authenticated;
GRANT ALL ON TABLE public.abs_loss_projections TO service_role;
GRANT ALL ON TABLE public.abs_loss_projections TO prisma;


--
-- Name: TABLE abs_prepayment_speeds; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.abs_prepayment_speeds TO anon;
GRANT ALL ON TABLE public.abs_prepayment_speeds TO authenticated;
GRANT ALL ON TABLE public.abs_prepayment_speeds TO service_role;
GRANT ALL ON TABLE public.abs_prepayment_speeds TO prisma;


--
-- Name: TABLE abs_tranches; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.abs_tranches TO anon;
GRANT ALL ON TABLE public.abs_tranches TO authenticated;
GRANT ALL ON TABLE public.abs_tranches TO service_role;
GRANT ALL ON TABLE public.abs_tranches TO prisma;


--
-- Name: TABLE distributions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.distributions TO anon;
GRANT ALL ON TABLE public.distributions TO authenticated;
GRANT ALL ON TABLE public.distributions TO service_role;
GRANT ALL ON TABLE public.distributions TO prisma;


--
-- Name: TABLE redemption_rules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_rules TO anon;
GRANT ALL ON TABLE public.redemption_rules TO authenticated;
GRANT ALL ON TABLE public.redemption_rules TO service_role;
GRANT ALL ON TABLE public.redemption_rules TO prisma;


--
-- Name: TABLE redemption_eligibility; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_eligibility TO anon;
GRANT ALL ON TABLE public.redemption_eligibility TO authenticated;
GRANT ALL ON TABLE public.redemption_eligibility TO service_role;
GRANT ALL ON TABLE public.redemption_eligibility TO prisma;


--
-- Name: TABLE active_redemption_opportunities; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.active_redemption_opportunities TO anon;
GRANT ALL ON TABLE public.active_redemption_opportunities TO authenticated;
GRANT ALL ON TABLE public.active_redemption_opportunities TO service_role;
GRANT ALL ON TABLE public.active_redemption_opportunities TO prisma;


--
-- Name: TABLE audit_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.audit_logs TO anon;
GRANT ALL ON TABLE public.audit_logs TO authenticated;
GRANT ALL ON TABLE public.audit_logs TO service_role;
GRANT ALL ON TABLE public.audit_logs TO prisma;


--
-- Name: TABLE activity_analytics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.activity_analytics TO anon;
GRANT ALL ON TABLE public.activity_analytics TO authenticated;
GRANT ALL ON TABLE public.activity_analytics TO service_role;
GRANT ALL ON TABLE public.activity_analytics TO prisma;


--
-- Name: TABLE alerts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.alerts TO anon;
GRANT ALL ON TABLE public.alerts TO authenticated;
GRANT ALL ON TABLE public.alerts TO service_role;
GRANT ALL ON TABLE public.alerts TO prisma;


--
-- Name: TABLE approval_config_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_config_approvers TO anon;
GRANT ALL ON TABLE public.approval_config_approvers TO authenticated;
GRANT ALL ON TABLE public.approval_config_approvers TO service_role;
GRANT ALL ON TABLE public.approval_config_approvers TO prisma;


--
-- Name: TABLE approval_config_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_config_history TO anon;
GRANT ALL ON TABLE public.approval_config_history TO authenticated;
GRANT ALL ON TABLE public.approval_config_history TO service_role;
GRANT ALL ON TABLE public.approval_config_history TO prisma;


--
-- Name: TABLE approval_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_configs TO anon;
GRANT ALL ON TABLE public.approval_configs TO authenticated;
GRANT ALL ON TABLE public.approval_configs TO service_role;
GRANT ALL ON TABLE public.approval_configs TO prisma;


--
-- Name: TABLE roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.roles TO anon;
GRANT ALL ON TABLE public.roles TO authenticated;
GRANT ALL ON TABLE public.roles TO service_role;
GRANT ALL ON TABLE public.roles TO prisma;


--
-- Name: TABLE users; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.users TO anon;
GRANT ALL ON TABLE public.users TO authenticated;
GRANT ALL ON TABLE public.users TO service_role;
GRANT ALL ON TABLE public.users TO prisma;


--
-- Name: TABLE approval_configs_with_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_configs_with_approvers TO anon;
GRANT ALL ON TABLE public.approval_configs_with_approvers TO authenticated;
GRANT ALL ON TABLE public.approval_configs_with_approvers TO service_role;
GRANT ALL ON TABLE public.approval_configs_with_approvers TO prisma;


--
-- Name: TABLE approval_delegations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_delegations TO anon;
GRANT ALL ON TABLE public.approval_delegations TO authenticated;
GRANT ALL ON TABLE public.approval_delegations TO service_role;
GRANT ALL ON TABLE public.approval_delegations TO prisma;


--
-- Name: TABLE approval_notifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_notifications TO anon;
GRANT ALL ON TABLE public.approval_notifications TO authenticated;
GRANT ALL ON TABLE public.approval_notifications TO service_role;
GRANT ALL ON TABLE public.approval_notifications TO prisma;


--
-- Name: TABLE approval_processes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_processes TO anon;
GRANT ALL ON TABLE public.approval_processes TO authenticated;
GRANT ALL ON TABLE public.approval_processes TO service_role;
GRANT ALL ON TABLE public.approval_processes TO prisma;


--
-- Name: TABLE approval_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_requests TO anon;
GRANT ALL ON TABLE public.approval_requests TO authenticated;
GRANT ALL ON TABLE public.approval_requests TO service_role;
GRANT ALL ON TABLE public.approval_requests TO prisma;


--
-- Name: TABLE approval_signatures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_signatures TO anon;
GRANT ALL ON TABLE public.approval_signatures TO authenticated;
GRANT ALL ON TABLE public.approval_signatures TO service_role;
GRANT ALL ON TABLE public.approval_signatures TO prisma;


--
-- Name: TABLE approval_workflows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.approval_workflows TO anon;
GRANT ALL ON TABLE public.approval_workflows TO authenticated;
GRANT ALL ON TABLE public.approval_workflows TO service_role;
GRANT ALL ON TABLE public.approval_workflows TO prisma;


--
-- Name: TABLE asset_backed_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.asset_backed_products TO anon;
GRANT ALL ON TABLE public.asset_backed_products TO authenticated;
GRANT ALL ON TABLE public.asset_backed_products TO service_role;
GRANT ALL ON TABLE public.asset_backed_products TO prisma;


--
-- Name: TABLE asset_holdings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.asset_holdings TO anon;
GRANT ALL ON TABLE public.asset_holdings TO authenticated;
GRANT ALL ON TABLE public.asset_holdings TO service_role;
GRANT ALL ON TABLE public.asset_holdings TO prisma;


--
-- Name: TABLE asset_nav_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.asset_nav_data TO anon;
GRANT ALL ON TABLE public.asset_nav_data TO authenticated;
GRANT ALL ON TABLE public.asset_nav_data TO service_role;
GRANT ALL ON TABLE public.asset_nav_data TO prisma;


--
-- Name: TABLE auction_comparables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.auction_comparables TO anon;
GRANT ALL ON TABLE public.auction_comparables TO authenticated;
GRANT ALL ON TABLE public.auction_comparables TO service_role;
GRANT ALL ON TABLE public.auction_comparables TO prisma;


--
-- Name: TABLE audit_coverage; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.audit_coverage TO anon;
GRANT ALL ON TABLE public.audit_coverage TO authenticated;
GRANT ALL ON TABLE public.audit_coverage TO service_role;
GRANT ALL ON TABLE public.audit_coverage TO prisma;


--
-- Name: TABLE auth_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.auth_events TO anon;
GRANT ALL ON TABLE public.auth_events TO authenticated;
GRANT ALL ON TABLE public.auth_events TO service_role;
GRANT ALL ON TABLE public.auth_events TO prisma;


--
-- Name: TABLE authorized_activities; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.authorized_activities TO anon;
GRANT ALL ON TABLE public.authorized_activities TO authenticated;
GRANT ALL ON TABLE public.authorized_activities TO service_role;
GRANT ALL ON TABLE public.authorized_activities TO prisma;


--
-- Name: TABLE authorized_signatories; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.authorized_signatories TO anon;
GRANT ALL ON TABLE public.authorized_signatories TO authenticated;
GRANT ALL ON TABLE public.authorized_signatories TO service_role;
GRANT ALL ON TABLE public.authorized_signatories TO prisma;


--
-- Name: TABLE batch_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.batch_operations TO anon;
GRANT ALL ON TABLE public.batch_operations TO authenticated;
GRANT ALL ON TABLE public.batch_operations TO service_role;
GRANT ALL ON TABLE public.batch_operations TO prisma;


--
-- Name: TABLE benchmark_index_mappings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.benchmark_index_mappings TO anon;
GRANT ALL ON TABLE public.benchmark_index_mappings TO authenticated;
GRANT ALL ON TABLE public.benchmark_index_mappings TO service_role;
GRANT ALL ON TABLE public.benchmark_index_mappings TO prisma;


--
-- Name: TABLE blacklisted_addresses; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.blacklisted_addresses TO anon;
GRANT ALL ON TABLE public.blacklisted_addresses TO authenticated;
GRANT ALL ON TABLE public.blacklisted_addresses TO service_role;
GRANT ALL ON TABLE public.blacklisted_addresses TO prisma;


--
-- Name: TABLE blackout_periods; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.blackout_periods TO anon;
GRANT ALL ON TABLE public.blackout_periods TO authenticated;
GRANT ALL ON TABLE public.blackout_periods TO service_role;
GRANT ALL ON TABLE public.blackout_periods TO prisma;


--
-- Name: TABLE bond_amortization_schedule; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_amortization_schedule TO anon;
GRANT ALL ON TABLE public.bond_amortization_schedule TO authenticated;
GRANT ALL ON TABLE public.bond_amortization_schedule TO service_role;
GRANT ALL ON TABLE public.bond_amortization_schedule TO prisma;


--
-- Name: TABLE bond_call_put_schedules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_call_put_schedules TO anon;
GRANT ALL ON TABLE public.bond_call_put_schedules TO authenticated;
GRANT ALL ON TABLE public.bond_call_put_schedules TO service_role;
GRANT ALL ON TABLE public.bond_call_put_schedules TO prisma;


--
-- Name: TABLE bond_coupon_payments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_coupon_payments TO anon;
GRANT ALL ON TABLE public.bond_coupon_payments TO authenticated;
GRANT ALL ON TABLE public.bond_coupon_payments TO service_role;
GRANT ALL ON TABLE public.bond_coupon_payments TO prisma;


--
-- Name: TABLE bond_covenants; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_covenants TO anon;
GRANT ALL ON TABLE public.bond_covenants TO authenticated;
GRANT ALL ON TABLE public.bond_covenants TO service_role;
GRANT ALL ON TABLE public.bond_covenants TO prisma;


--
-- Name: TABLE bond_credit_ratings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_credit_ratings TO anon;
GRANT ALL ON TABLE public.bond_credit_ratings TO authenticated;
GRANT ALL ON TABLE public.bond_credit_ratings TO service_role;
GRANT ALL ON TABLE public.bond_credit_ratings TO prisma;


--
-- Name: TABLE bond_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_events TO anon;
GRANT ALL ON TABLE public.bond_events TO authenticated;
GRANT ALL ON TABLE public.bond_events TO service_role;
GRANT ALL ON TABLE public.bond_events TO prisma;


--
-- Name: TABLE bond_market_prices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_market_prices TO anon;
GRANT ALL ON TABLE public.bond_market_prices TO authenticated;
GRANT ALL ON TABLE public.bond_market_prices TO service_role;
GRANT ALL ON TABLE public.bond_market_prices TO prisma;


--
-- Name: TABLE bond_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_products TO anon;
GRANT ALL ON TABLE public.bond_products TO authenticated;
GRANT ALL ON TABLE public.bond_products TO service_role;
GRANT ALL ON TABLE public.bond_products TO prisma;


--
-- Name: TABLE bond_sinking_fund; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bond_sinking_fund TO anon;
GRANT ALL ON TABLE public.bond_sinking_fund TO authenticated;
GRANT ALL ON TABLE public.bond_sinking_fund TO service_role;
GRANT ALL ON TABLE public.bond_sinking_fund TO prisma;


--
-- Name: TABLE bulk_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bulk_operations TO anon;
GRANT ALL ON TABLE public.bulk_operations TO authenticated;
GRANT ALL ON TABLE public.bulk_operations TO service_role;
GRANT ALL ON TABLE public.bulk_operations TO prisma;


--
-- Name: TABLE bundler_configurations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bundler_configurations TO anon;
GRANT ALL ON TABLE public.bundler_configurations TO authenticated;
GRANT ALL ON TABLE public.bundler_configurations TO service_role;
GRANT ALL ON TABLE public.bundler_configurations TO prisma;


--
-- Name: TABLE bundler_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.bundler_operations TO anon;
GRANT ALL ON TABLE public.bundler_operations TO authenticated;
GRANT ALL ON TABLE public.bundler_operations TO service_role;
GRANT ALL ON TABLE public.bundler_operations TO prisma;


--
-- Name: TABLE cap_table_investors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cap_table_investors TO anon;
GRANT ALL ON TABLE public.cap_table_investors TO authenticated;
GRANT ALL ON TABLE public.cap_table_investors TO service_role;
GRANT ALL ON TABLE public.cap_table_investors TO prisma;


--
-- Name: TABLE cap_tables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cap_tables TO anon;
GRANT ALL ON TABLE public.cap_tables TO authenticated;
GRANT ALL ON TABLE public.cap_tables TO service_role;
GRANT ALL ON TABLE public.cap_tables TO prisma;


--
-- Name: TABLE carbon_market_prices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.carbon_market_prices TO anon;
GRANT ALL ON TABLE public.carbon_market_prices TO authenticated;
GRANT ALL ON TABLE public.carbon_market_prices TO service_role;
GRANT ALL ON TABLE public.carbon_market_prices TO prisma;


--
-- Name: TABLE carbon_offsets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.carbon_offsets TO anon;
GRANT ALL ON TABLE public.carbon_offsets TO authenticated;
GRANT ALL ON TABLE public.carbon_offsets TO service_role;
GRANT ALL ON TABLE public.carbon_offsets TO prisma;


--
-- Name: TABLE cf_allocations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cf_allocations TO anon;
GRANT ALL ON TABLE public.cf_allocations TO authenticated;
GRANT ALL ON TABLE public.cf_allocations TO service_role;
GRANT ALL ON TABLE public.cf_allocations TO prisma;


--
-- Name: TABLE cf_cash_flows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cf_cash_flows TO anon;
GRANT ALL ON TABLE public.cf_cash_flows TO authenticated;
GRANT ALL ON TABLE public.cf_cash_flows TO service_role;
GRANT ALL ON TABLE public.cf_cash_flows TO prisma;


--
-- Name: TABLE cf_holdings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cf_holdings TO anon;
GRANT ALL ON TABLE public.cf_holdings TO authenticated;
GRANT ALL ON TABLE public.cf_holdings TO service_role;
GRANT ALL ON TABLE public.cf_holdings TO prisma;


--
-- Name: TABLE cf_performance_attribution; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cf_performance_attribution TO anon;
GRANT ALL ON TABLE public.cf_performance_attribution TO authenticated;
GRANT ALL ON TABLE public.cf_performance_attribution TO service_role;
GRANT ALL ON TABLE public.cf_performance_attribution TO prisma;


--
-- Name: TABLE cf_rebalancing_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.cf_rebalancing_events TO anon;
GRANT ALL ON TABLE public.cf_rebalancing_events TO authenticated;
GRANT ALL ON TABLE public.cf_rebalancing_events TO service_role;
GRANT ALL ON TABLE public.cf_rebalancing_events TO prisma;


--
-- Name: TABLE climate_market_data_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_market_data_cache TO anon;
GRANT ALL ON TABLE public.climate_market_data_cache TO authenticated;
GRANT ALL ON TABLE public.climate_market_data_cache TO service_role;
GRANT ALL ON TABLE public.climate_market_data_cache TO prisma;


--
-- Name: TABLE climate_cache_performance; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_cache_performance TO anon;
GRANT ALL ON TABLE public.climate_cache_performance TO authenticated;
GRANT ALL ON TABLE public.climate_cache_performance TO service_role;
GRANT ALL ON TABLE public.climate_cache_performance TO prisma;


--
-- Name: TABLE climate_cash_flow_projections; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_cash_flow_projections TO anon;
GRANT ALL ON TABLE public.climate_cash_flow_projections TO authenticated;
GRANT ALL ON TABLE public.climate_cash_flow_projections TO service_role;
GRANT ALL ON TABLE public.climate_cash_flow_projections TO prisma;


--
-- Name: TABLE climate_cash_flow_forecast; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_cash_flow_forecast TO anon;
GRANT ALL ON TABLE public.climate_cash_flow_forecast TO authenticated;
GRANT ALL ON TABLE public.climate_cash_flow_forecast TO service_role;
GRANT ALL ON TABLE public.climate_cash_flow_forecast TO prisma;


--
-- Name: TABLE climate_incentives; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_incentives TO anon;
GRANT ALL ON TABLE public.climate_incentives TO authenticated;
GRANT ALL ON TABLE public.climate_incentives TO service_role;
GRANT ALL ON TABLE public.climate_incentives TO prisma;


--
-- Name: TABLE climate_investor_pools; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_investor_pools TO anon;
GRANT ALL ON TABLE public.climate_investor_pools TO authenticated;
GRANT ALL ON TABLE public.climate_investor_pools TO service_role;
GRANT ALL ON TABLE public.climate_investor_pools TO prisma;


--
-- Name: TABLE climate_pool_receivables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_pool_receivables TO anon;
GRANT ALL ON TABLE public.climate_pool_receivables TO authenticated;
GRANT ALL ON TABLE public.climate_pool_receivables TO service_role;
GRANT ALL ON TABLE public.climate_pool_receivables TO prisma;


--
-- Name: TABLE climate_receivables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_receivables TO anon;
GRANT ALL ON TABLE public.climate_receivables TO authenticated;
GRANT ALL ON TABLE public.climate_receivables TO service_role;
GRANT ALL ON TABLE public.climate_receivables TO prisma;


--
-- Name: TABLE climate_tokenization_pools; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_tokenization_pools TO anon;
GRANT ALL ON TABLE public.climate_tokenization_pools TO authenticated;
GRANT ALL ON TABLE public.climate_tokenization_pools TO service_role;
GRANT ALL ON TABLE public.climate_tokenization_pools TO prisma;


--
-- Name: TABLE climate_investor_pool_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_investor_pool_summary TO anon;
GRANT ALL ON TABLE public.climate_investor_pool_summary TO authenticated;
GRANT ALL ON TABLE public.climate_investor_pool_summary TO service_role;
GRANT ALL ON TABLE public.climate_investor_pool_summary TO prisma;


--
-- Name: TABLE climate_nav_calculations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_nav_calculations TO anon;
GRANT ALL ON TABLE public.climate_nav_calculations TO authenticated;
GRANT ALL ON TABLE public.climate_nav_calculations TO service_role;
GRANT ALL ON TABLE public.climate_nav_calculations TO prisma;


--
-- Name: TABLE climate_payers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_payers TO anon;
GRANT ALL ON TABLE public.climate_payers TO authenticated;
GRANT ALL ON TABLE public.climate_payers TO service_role;
GRANT ALL ON TABLE public.climate_payers TO prisma;


--
-- Name: TABLE climate_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_policies TO anon;
GRANT ALL ON TABLE public.climate_policies TO authenticated;
GRANT ALL ON TABLE public.climate_policies TO service_role;
GRANT ALL ON TABLE public.climate_policies TO prisma;


--
-- Name: TABLE climate_policy_impacts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_policy_impacts TO anon;
GRANT ALL ON TABLE public.climate_policy_impacts TO authenticated;
GRANT ALL ON TABLE public.climate_policy_impacts TO service_role;
GRANT ALL ON TABLE public.climate_policy_impacts TO prisma;


--
-- Name: TABLE climate_pool_energy_assets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_pool_energy_assets TO anon;
GRANT ALL ON TABLE public.climate_pool_energy_assets TO authenticated;
GRANT ALL ON TABLE public.climate_pool_energy_assets TO service_role;
GRANT ALL ON TABLE public.climate_pool_energy_assets TO prisma;


--
-- Name: TABLE climate_pool_incentives; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_pool_incentives TO anon;
GRANT ALL ON TABLE public.climate_pool_incentives TO authenticated;
GRANT ALL ON TABLE public.climate_pool_incentives TO service_role;
GRANT ALL ON TABLE public.climate_pool_incentives TO prisma;


--
-- Name: TABLE climate_pool_recs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_pool_recs TO anon;
GRANT ALL ON TABLE public.climate_pool_recs TO authenticated;
GRANT ALL ON TABLE public.climate_pool_recs TO service_role;
GRANT ALL ON TABLE public.climate_pool_recs TO prisma;


--
-- Name: TABLE climate_reports; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_reports TO anon;
GRANT ALL ON TABLE public.climate_reports TO authenticated;
GRANT ALL ON TABLE public.climate_reports TO service_role;
GRANT ALL ON TABLE public.climate_reports TO prisma;


--
-- Name: TABLE climate_risk_calculations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_risk_calculations TO anon;
GRANT ALL ON TABLE public.climate_risk_calculations TO authenticated;
GRANT ALL ON TABLE public.climate_risk_calculations TO service_role;
GRANT ALL ON TABLE public.climate_risk_calculations TO prisma;


--
-- Name: TABLE climate_risk_factors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_risk_factors TO anon;
GRANT ALL ON TABLE public.climate_risk_factors TO authenticated;
GRANT ALL ON TABLE public.climate_risk_factors TO service_role;
GRANT ALL ON TABLE public.climate_risk_factors TO prisma;


--
-- Name: TABLE token_climate_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_climate_properties TO anon;
GRANT ALL ON TABLE public.token_climate_properties TO authenticated;
GRANT ALL ON TABLE public.token_climate_properties TO service_role;
GRANT ALL ON TABLE public.token_climate_properties TO prisma;


--
-- Name: TABLE tokens; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.tokens TO anon;
GRANT ALL ON TABLE public.tokens TO authenticated;
GRANT ALL ON TABLE public.tokens TO service_role;
GRANT ALL ON TABLE public.tokens TO prisma;


--
-- Name: TABLE climate_token_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_token_summary TO anon;
GRANT ALL ON TABLE public.climate_token_summary TO authenticated;
GRANT ALL ON TABLE public.climate_token_summary TO service_role;
GRANT ALL ON TABLE public.climate_token_summary TO prisma;


--
-- Name: TABLE climate_user_data_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_user_data_cache TO anon;
GRANT ALL ON TABLE public.climate_user_data_cache TO authenticated;
GRANT ALL ON TABLE public.climate_user_data_cache TO service_role;
GRANT ALL ON TABLE public.climate_user_data_cache TO prisma;


--
-- Name: TABLE climate_user_data_sources; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.climate_user_data_sources TO anon;
GRANT ALL ON TABLE public.climate_user_data_sources TO authenticated;
GRANT ALL ON TABLE public.climate_user_data_sources TO service_role;
GRANT ALL ON TABLE public.climate_user_data_sources TO prisma;


--
-- Name: TABLE collectibles_appraisals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_appraisals TO anon;
GRANT ALL ON TABLE public.collectibles_appraisals TO authenticated;
GRANT ALL ON TABLE public.collectibles_appraisals TO service_role;
GRANT ALL ON TABLE public.collectibles_appraisals TO prisma;


--
-- Name: TABLE collectibles_authentication_records; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_authentication_records TO anon;
GRANT ALL ON TABLE public.collectibles_authentication_records TO authenticated;
GRANT ALL ON TABLE public.collectibles_authentication_records TO service_role;
GRANT ALL ON TABLE public.collectibles_authentication_records TO prisma;


--
-- Name: TABLE collectibles_condition_reports; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_condition_reports TO anon;
GRANT ALL ON TABLE public.collectibles_condition_reports TO authenticated;
GRANT ALL ON TABLE public.collectibles_condition_reports TO service_role;
GRANT ALL ON TABLE public.collectibles_condition_reports TO prisma;


--
-- Name: TABLE collectibles_insurance_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_insurance_policies TO anon;
GRANT ALL ON TABLE public.collectibles_insurance_policies TO authenticated;
GRANT ALL ON TABLE public.collectibles_insurance_policies TO service_role;
GRANT ALL ON TABLE public.collectibles_insurance_policies TO prisma;


--
-- Name: TABLE collectibles_insurance_valuations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_insurance_valuations TO anon;
GRANT ALL ON TABLE public.collectibles_insurance_valuations TO authenticated;
GRANT ALL ON TABLE public.collectibles_insurance_valuations TO service_role;
GRANT ALL ON TABLE public.collectibles_insurance_valuations TO prisma;


--
-- Name: TABLE collectibles_market_comparables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_market_comparables TO anon;
GRANT ALL ON TABLE public.collectibles_market_comparables TO authenticated;
GRANT ALL ON TABLE public.collectibles_market_comparables TO service_role;
GRANT ALL ON TABLE public.collectibles_market_comparables TO prisma;


--
-- Name: TABLE collectibles_market_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_market_metrics TO anon;
GRANT ALL ON TABLE public.collectibles_market_metrics TO authenticated;
GRANT ALL ON TABLE public.collectibles_market_metrics TO service_role;
GRANT ALL ON TABLE public.collectibles_market_metrics TO prisma;


--
-- Name: TABLE collectibles_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_products TO anon;
GRANT ALL ON TABLE public.collectibles_products TO authenticated;
GRANT ALL ON TABLE public.collectibles_products TO service_role;
GRANT ALL ON TABLE public.collectibles_products TO prisma;


--
-- Name: TABLE collectibles_provenance; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_provenance TO anon;
GRANT ALL ON TABLE public.collectibles_provenance TO authenticated;
GRANT ALL ON TABLE public.collectibles_provenance TO service_role;
GRANT ALL ON TABLE public.collectibles_provenance TO prisma;


--
-- Name: TABLE collectibles_provenance_records; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_provenance_records TO anon;
GRANT ALL ON TABLE public.collectibles_provenance_records TO authenticated;
GRANT ALL ON TABLE public.collectibles_provenance_records TO service_role;
GRANT ALL ON TABLE public.collectibles_provenance_records TO prisma;


--
-- Name: TABLE collectibles_rarity_scores; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_rarity_scores TO anon;
GRANT ALL ON TABLE public.collectibles_rarity_scores TO authenticated;
GRANT ALL ON TABLE public.collectibles_rarity_scores TO service_role;
GRANT ALL ON TABLE public.collectibles_rarity_scores TO prisma;


--
-- Name: TABLE collectibles_risk_assessments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_risk_assessments TO anon;
GRANT ALL ON TABLE public.collectibles_risk_assessments TO authenticated;
GRANT ALL ON TABLE public.collectibles_risk_assessments TO service_role;
GRANT ALL ON TABLE public.collectibles_risk_assessments TO prisma;


--
-- Name: TABLE collectibles_storage_facilities; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.collectibles_storage_facilities TO anon;
GRANT ALL ON TABLE public.collectibles_storage_facilities TO authenticated;
GRANT ALL ON TABLE public.collectibles_storage_facilities TO service_role;
GRANT ALL ON TABLE public.collectibles_storage_facilities TO prisma;


--
-- Name: TABLE commodities_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodities_products TO anon;
GRANT ALL ON TABLE public.commodities_products TO authenticated;
GRANT ALL ON TABLE public.commodities_products TO service_role;
GRANT ALL ON TABLE public.commodities_products TO prisma;


--
-- Name: TABLE commodity_collateral; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_collateral TO anon;
GRANT ALL ON TABLE public.commodity_collateral TO authenticated;
GRANT ALL ON TABLE public.commodity_collateral TO service_role;
GRANT ALL ON TABLE public.commodity_collateral TO prisma;


--
-- Name: TABLE commodity_debt; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_debt TO anon;
GRANT ALL ON TABLE public.commodity_debt TO authenticated;
GRANT ALL ON TABLE public.commodity_debt TO service_role;
GRANT ALL ON TABLE public.commodity_debt TO prisma;


--
-- Name: TABLE commodity_handling_costs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_handling_costs TO anon;
GRANT ALL ON TABLE public.commodity_handling_costs TO authenticated;
GRANT ALL ON TABLE public.commodity_handling_costs TO service_role;
GRANT ALL ON TABLE public.commodity_handling_costs TO prisma;


--
-- Name: TABLE commodity_implied_volatility; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_implied_volatility TO anon;
GRANT ALL ON TABLE public.commodity_implied_volatility TO authenticated;
GRANT ALL ON TABLE public.commodity_implied_volatility TO service_role;
GRANT ALL ON TABLE public.commodity_implied_volatility TO prisma;


--
-- Name: TABLE commodity_insurance_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_insurance_rates TO anon;
GRANT ALL ON TABLE public.commodity_insurance_rates TO authenticated;
GRANT ALL ON TABLE public.commodity_insurance_rates TO service_role;
GRANT ALL ON TABLE public.commodity_insurance_rates TO prisma;


--
-- Name: TABLE commodity_market_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_market_data TO anon;
GRANT ALL ON TABLE public.commodity_market_data TO authenticated;
GRANT ALL ON TABLE public.commodity_market_data TO service_role;
GRANT ALL ON TABLE public.commodity_market_data TO prisma;


--
-- Name: TABLE commodity_pool_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_pool_config TO anon;
GRANT ALL ON TABLE public.commodity_pool_config TO authenticated;
GRANT ALL ON TABLE public.commodity_pool_config TO service_role;
GRANT ALL ON TABLE public.commodity_pool_config TO prisma;


--
-- Name: TABLE commodity_positions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_positions TO anon;
GRANT ALL ON TABLE public.commodity_positions TO authenticated;
GRANT ALL ON TABLE public.commodity_positions TO service_role;
GRANT ALL ON TABLE public.commodity_positions TO prisma;


--
-- Name: TABLE commodity_prices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_prices TO anon;
GRANT ALL ON TABLE public.commodity_prices TO authenticated;
GRANT ALL ON TABLE public.commodity_prices TO service_role;
GRANT ALL ON TABLE public.commodity_prices TO prisma;


--
-- Name: TABLE commodity_quality_multipliers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_quality_multipliers TO anon;
GRANT ALL ON TABLE public.commodity_quality_multipliers TO authenticated;
GRANT ALL ON TABLE public.commodity_quality_multipliers TO service_role;
GRANT ALL ON TABLE public.commodity_quality_multipliers TO prisma;


--
-- Name: TABLE commodity_risk_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_risk_metrics TO anon;
GRANT ALL ON TABLE public.commodity_risk_metrics TO authenticated;
GRANT ALL ON TABLE public.commodity_risk_metrics TO service_role;
GRANT ALL ON TABLE public.commodity_risk_metrics TO prisma;


--
-- Name: TABLE commodity_storage_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.commodity_storage_rates TO anon;
GRANT ALL ON TABLE public.commodity_storage_rates TO authenticated;
GRANT ALL ON TABLE public.commodity_storage_rates TO service_role;
GRANT ALL ON TABLE public.commodity_storage_rates TO prisma;


--
-- Name: TABLE compliance_alerts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_alerts TO anon;
GRANT ALL ON TABLE public.compliance_alerts TO authenticated;
GRANT ALL ON TABLE public.compliance_alerts TO service_role;
GRANT ALL ON TABLE public.compliance_alerts TO prisma;


--
-- Name: TABLE compliance_audit_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_audit_logs TO anon;
GRANT ALL ON TABLE public.compliance_audit_logs TO authenticated;
GRANT ALL ON TABLE public.compliance_audit_logs TO service_role;
GRANT ALL ON TABLE public.compliance_audit_logs TO prisma;


--
-- Name: TABLE compliance_checks; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_checks TO anon;
GRANT ALL ON TABLE public.compliance_checks TO authenticated;
GRANT ALL ON TABLE public.compliance_checks TO service_role;
GRANT ALL ON TABLE public.compliance_checks TO prisma;


--
-- Name: TABLE compliance_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_metrics TO anon;
GRANT ALL ON TABLE public.compliance_metrics TO authenticated;
GRANT ALL ON TABLE public.compliance_metrics TO service_role;
GRANT ALL ON TABLE public.compliance_metrics TO prisma;


--
-- Name: TABLE compliance_reports; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_reports TO anon;
GRANT ALL ON TABLE public.compliance_reports TO authenticated;
GRANT ALL ON TABLE public.compliance_reports TO service_role;
GRANT ALL ON TABLE public.compliance_reports TO prisma;


--
-- Name: TABLE compliance_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_settings TO anon;
GRANT ALL ON TABLE public.compliance_settings TO authenticated;
GRANT ALL ON TABLE public.compliance_settings TO service_role;
GRANT ALL ON TABLE public.compliance_settings TO prisma;


--
-- Name: TABLE compliance_violations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.compliance_violations TO anon;
GRANT ALL ON TABLE public.compliance_violations TO authenticated;
GRANT ALL ON TABLE public.compliance_violations TO service_role;
GRANT ALL ON TABLE public.compliance_violations TO prisma;


--
-- Name: TABLE consensus_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.consensus_settings TO anon;
GRANT ALL ON TABLE public.consensus_settings TO authenticated;
GRANT ALL ON TABLE public.consensus_settings TO service_role;
GRANT ALL ON TABLE public.consensus_settings TO prisma;


--
-- Name: TABLE contract_master_versions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.contract_master_versions TO anon;
GRANT ALL ON TABLE public.contract_master_versions TO authenticated;
GRANT ALL ON TABLE public.contract_master_versions TO service_role;
GRANT ALL ON TABLE public.contract_master_versions TO prisma;


--
-- Name: TABLE contract_masters; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.contract_masters TO anon;
GRANT ALL ON TABLE public.contract_masters TO authenticated;
GRANT ALL ON TABLE public.contract_masters TO service_role;
GRANT ALL ON TABLE public.contract_masters TO prisma;


--
-- Name: TABLE contract_masters_backup; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.contract_masters_backup TO anon;
GRANT ALL ON TABLE public.contract_masters_backup TO authenticated;
GRANT ALL ON TABLE public.contract_masters_backup TO service_role;
GRANT ALL ON TABLE public.contract_masters_backup TO prisma;


--
-- Name: TABLE contract_role_assignments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.contract_role_assignments TO anon;
GRANT ALL ON TABLE public.contract_role_assignments TO authenticated;
GRANT ALL ON TABLE public.contract_role_assignments TO service_role;
GRANT ALL ON TABLE public.contract_role_assignments TO prisma;


--
-- Name: TABLE corporate_actions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.corporate_actions TO anon;
GRANT ALL ON TABLE public.corporate_actions TO authenticated;
GRANT ALL ON TABLE public.corporate_actions TO service_role;
GRANT ALL ON TABLE public.corporate_actions TO prisma;


--
-- Name: TABLE credential_usage_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.credential_usage_logs TO anon;
GRANT ALL ON TABLE public.credential_usage_logs TO authenticated;
GRANT ALL ON TABLE public.credential_usage_logs TO service_role;
GRANT ALL ON TABLE public.credential_usage_logs TO prisma;


--
-- Name: TABLE critical_alerts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.critical_alerts TO anon;
GRANT ALL ON TABLE public.critical_alerts TO authenticated;
GRANT ALL ON TABLE public.critical_alerts TO service_role;
GRANT ALL ON TABLE public.critical_alerts TO prisma;


--
-- Name: TABLE crypto_etf_holdings_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.crypto_etf_holdings_summary TO anon;
GRANT ALL ON TABLE public.crypto_etf_holdings_summary TO authenticated;
GRANT ALL ON TABLE public.crypto_etf_holdings_summary TO service_role;
GRANT ALL ON TABLE public.crypto_etf_holdings_summary TO prisma;


--
-- Name: TABLE crypto_symbol_mappings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.crypto_symbol_mappings TO anon;
GRANT ALL ON TABLE public.crypto_symbol_mappings TO authenticated;
GRANT ALL ON TABLE public.crypto_symbol_mappings TO service_role;
GRANT ALL ON TABLE public.crypto_symbol_mappings TO prisma;


--
-- Name: TABLE dashboard_updates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dashboard_updates TO anon;
GRANT ALL ON TABLE public.dashboard_updates TO authenticated;
GRANT ALL ON TABLE public.dashboard_updates TO service_role;
GRANT ALL ON TABLE public.dashboard_updates TO prisma;


--
-- Name: TABLE data_source_mappings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.data_source_mappings TO anon;
GRANT ALL ON TABLE public.data_source_mappings TO authenticated;
GRANT ALL ON TABLE public.data_source_mappings TO service_role;
GRANT ALL ON TABLE public.data_source_mappings TO prisma;


--
-- Name: TABLE database_audit_coverage; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.database_audit_coverage TO anon;
GRANT ALL ON TABLE public.database_audit_coverage TO authenticated;
GRANT ALL ON TABLE public.database_audit_coverage TO service_role;
GRANT ALL ON TABLE public.database_audit_coverage TO prisma;


--
-- Name: TABLE deployment_audit_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.deployment_audit_logs TO anon;
GRANT ALL ON TABLE public.deployment_audit_logs TO authenticated;
GRANT ALL ON TABLE public.deployment_audit_logs TO service_role;
GRANT ALL ON TABLE public.deployment_audit_logs TO prisma;


--
-- Name: TABLE deployment_rate_limits; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.deployment_rate_limits TO anon;
GRANT ALL ON TABLE public.deployment_rate_limits TO authenticated;
GRANT ALL ON TABLE public.deployment_rate_limits TO service_role;
GRANT ALL ON TABLE public.deployment_rate_limits TO prisma;


--
-- Name: TABLE dfns_activity_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_activity_logs TO anon;
GRANT ALL ON TABLE public.dfns_activity_logs TO authenticated;
GRANT ALL ON TABLE public.dfns_activity_logs TO service_role;
GRANT ALL ON TABLE public.dfns_activity_logs TO prisma;


--
-- Name: TABLE dfns_api_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_api_requests TO anon;
GRANT ALL ON TABLE public.dfns_api_requests TO authenticated;
GRANT ALL ON TABLE public.dfns_api_requests TO service_role;
GRANT ALL ON TABLE public.dfns_api_requests TO prisma;


--
-- Name: TABLE dfns_applications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_applications TO anon;
GRANT ALL ON TABLE public.dfns_applications TO authenticated;
GRANT ALL ON TABLE public.dfns_applications TO service_role;
GRANT ALL ON TABLE public.dfns_applications TO prisma;


--
-- Name: TABLE dfns_authentication_challenges; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_authentication_challenges TO anon;
GRANT ALL ON TABLE public.dfns_authentication_challenges TO authenticated;
GRANT ALL ON TABLE public.dfns_authentication_challenges TO service_role;
GRANT ALL ON TABLE public.dfns_authentication_challenges TO prisma;


--
-- Name: TABLE dfns_broadcast_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_broadcast_transactions TO anon;
GRANT ALL ON TABLE public.dfns_broadcast_transactions TO authenticated;
GRANT ALL ON TABLE public.dfns_broadcast_transactions TO service_role;
GRANT ALL ON TABLE public.dfns_broadcast_transactions TO prisma;


--
-- Name: TABLE dfns_credential_challenges; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_credential_challenges TO anon;
GRANT ALL ON TABLE public.dfns_credential_challenges TO authenticated;
GRANT ALL ON TABLE public.dfns_credential_challenges TO service_role;
GRANT ALL ON TABLE public.dfns_credential_challenges TO prisma;


--
-- Name: TABLE dfns_credentials; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_credentials TO anon;
GRANT ALL ON TABLE public.dfns_credentials TO authenticated;
GRANT ALL ON TABLE public.dfns_credentials TO service_role;
GRANT ALL ON TABLE public.dfns_credentials TO prisma;


--
-- Name: TABLE dfns_exchange_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_exchange_accounts TO anon;
GRANT ALL ON TABLE public.dfns_exchange_accounts TO authenticated;
GRANT ALL ON TABLE public.dfns_exchange_accounts TO service_role;
GRANT ALL ON TABLE public.dfns_exchange_accounts TO prisma;


--
-- Name: TABLE dfns_exchange_balances; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_exchange_balances TO anon;
GRANT ALL ON TABLE public.dfns_exchange_balances TO authenticated;
GRANT ALL ON TABLE public.dfns_exchange_balances TO service_role;
GRANT ALL ON TABLE public.dfns_exchange_balances TO prisma;


--
-- Name: TABLE dfns_exchange_integrations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_exchange_integrations TO anon;
GRANT ALL ON TABLE public.dfns_exchange_integrations TO authenticated;
GRANT ALL ON TABLE public.dfns_exchange_integrations TO service_role;
GRANT ALL ON TABLE public.dfns_exchange_integrations TO prisma;


--
-- Name: TABLE dfns_fee_sponsors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_fee_sponsors TO anon;
GRANT ALL ON TABLE public.dfns_fee_sponsors TO authenticated;
GRANT ALL ON TABLE public.dfns_fee_sponsors TO service_role;
GRANT ALL ON TABLE public.dfns_fee_sponsors TO prisma;


--
-- Name: TABLE dfns_fiat_activity_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_fiat_activity_logs TO anon;
GRANT ALL ON TABLE public.dfns_fiat_activity_logs TO authenticated;
GRANT ALL ON TABLE public.dfns_fiat_activity_logs TO service_role;
GRANT ALL ON TABLE public.dfns_fiat_activity_logs TO prisma;


--
-- Name: TABLE dfns_fiat_provider_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_fiat_provider_configs TO anon;
GRANT ALL ON TABLE public.dfns_fiat_provider_configs TO authenticated;
GRANT ALL ON TABLE public.dfns_fiat_provider_configs TO service_role;
GRANT ALL ON TABLE public.dfns_fiat_provider_configs TO prisma;


--
-- Name: TABLE dfns_fiat_quotes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_fiat_quotes TO anon;
GRANT ALL ON TABLE public.dfns_fiat_quotes TO authenticated;
GRANT ALL ON TABLE public.dfns_fiat_quotes TO service_role;
GRANT ALL ON TABLE public.dfns_fiat_quotes TO prisma;


--
-- Name: TABLE dfns_fiat_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_fiat_transactions TO anon;
GRANT ALL ON TABLE public.dfns_fiat_transactions TO authenticated;
GRANT ALL ON TABLE public.dfns_fiat_transactions TO service_role;
GRANT ALL ON TABLE public.dfns_fiat_transactions TO prisma;


--
-- Name: TABLE dfns_permission_assignments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_permission_assignments TO anon;
GRANT ALL ON TABLE public.dfns_permission_assignments TO authenticated;
GRANT ALL ON TABLE public.dfns_permission_assignments TO service_role;
GRANT ALL ON TABLE public.dfns_permission_assignments TO prisma;


--
-- Name: TABLE dfns_permissions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_permissions TO anon;
GRANT ALL ON TABLE public.dfns_permissions TO authenticated;
GRANT ALL ON TABLE public.dfns_permissions TO service_role;
GRANT ALL ON TABLE public.dfns_permissions TO prisma;


--
-- Name: TABLE dfns_personal_access_tokens; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_personal_access_tokens TO anon;
GRANT ALL ON TABLE public.dfns_personal_access_tokens TO authenticated;
GRANT ALL ON TABLE public.dfns_personal_access_tokens TO service_role;
GRANT ALL ON TABLE public.dfns_personal_access_tokens TO prisma;


--
-- Name: TABLE dfns_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policies TO anon;
GRANT ALL ON TABLE public.dfns_policies TO authenticated;
GRANT ALL ON TABLE public.dfns_policies TO service_role;
GRANT ALL ON TABLE public.dfns_policies TO prisma;


--
-- Name: TABLE dfns_policy_approval_decisions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policy_approval_decisions TO anon;
GRANT ALL ON TABLE public.dfns_policy_approval_decisions TO authenticated;
GRANT ALL ON TABLE public.dfns_policy_approval_decisions TO service_role;
GRANT ALL ON TABLE public.dfns_policy_approval_decisions TO prisma;


--
-- Name: TABLE dfns_policy_approval_groups; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policy_approval_groups TO anon;
GRANT ALL ON TABLE public.dfns_policy_approval_groups TO authenticated;
GRANT ALL ON TABLE public.dfns_policy_approval_groups TO service_role;
GRANT ALL ON TABLE public.dfns_policy_approval_groups TO prisma;


--
-- Name: TABLE dfns_policy_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policy_approvals TO anon;
GRANT ALL ON TABLE public.dfns_policy_approvals TO authenticated;
GRANT ALL ON TABLE public.dfns_policy_approvals TO service_role;
GRANT ALL ON TABLE public.dfns_policy_approvals TO prisma;


--
-- Name: TABLE dfns_policy_change_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policy_change_requests TO anon;
GRANT ALL ON TABLE public.dfns_policy_change_requests TO authenticated;
GRANT ALL ON TABLE public.dfns_policy_change_requests TO service_role;
GRANT ALL ON TABLE public.dfns_policy_change_requests TO prisma;


--
-- Name: TABLE dfns_policy_evaluations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_policy_evaluations TO anon;
GRANT ALL ON TABLE public.dfns_policy_evaluations TO authenticated;
GRANT ALL ON TABLE public.dfns_policy_evaluations TO service_role;
GRANT ALL ON TABLE public.dfns_policy_evaluations TO prisma;


--
-- Name: TABLE dfns_service_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_service_accounts TO anon;
GRANT ALL ON TABLE public.dfns_service_accounts TO authenticated;
GRANT ALL ON TABLE public.dfns_service_accounts TO service_role;
GRANT ALL ON TABLE public.dfns_service_accounts TO prisma;


--
-- Name: TABLE dfns_signatures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_signatures TO anon;
GRANT ALL ON TABLE public.dfns_signatures TO authenticated;
GRANT ALL ON TABLE public.dfns_signatures TO service_role;
GRANT ALL ON TABLE public.dfns_signatures TO prisma;


--
-- Name: TABLE dfns_signing_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_signing_keys TO anon;
GRANT ALL ON TABLE public.dfns_signing_keys TO authenticated;
GRANT ALL ON TABLE public.dfns_signing_keys TO service_role;
GRANT ALL ON TABLE public.dfns_signing_keys TO prisma;


--
-- Name: TABLE dfns_sponsored_fees; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_sponsored_fees TO anon;
GRANT ALL ON TABLE public.dfns_sponsored_fees TO authenticated;
GRANT ALL ON TABLE public.dfns_sponsored_fees TO service_role;
GRANT ALL ON TABLE public.dfns_sponsored_fees TO prisma;


--
-- Name: TABLE dfns_staking_integrations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_staking_integrations TO anon;
GRANT ALL ON TABLE public.dfns_staking_integrations TO authenticated;
GRANT ALL ON TABLE public.dfns_staking_integrations TO service_role;
GRANT ALL ON TABLE public.dfns_staking_integrations TO prisma;


--
-- Name: TABLE dfns_sync_status; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_sync_status TO anon;
GRANT ALL ON TABLE public.dfns_sync_status TO authenticated;
GRANT ALL ON TABLE public.dfns_sync_status TO service_role;
GRANT ALL ON TABLE public.dfns_sync_status TO prisma;


--
-- Name: TABLE dfns_transaction_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_transaction_history TO anon;
GRANT ALL ON TABLE public.dfns_transaction_history TO authenticated;
GRANT ALL ON TABLE public.dfns_transaction_history TO service_role;
GRANT ALL ON TABLE public.dfns_transaction_history TO prisma;


--
-- Name: TABLE dfns_transfers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_transfers TO anon;
GRANT ALL ON TABLE public.dfns_transfers TO authenticated;
GRANT ALL ON TABLE public.dfns_transfers TO service_role;
GRANT ALL ON TABLE public.dfns_transfers TO prisma;


--
-- Name: TABLE dfns_user_action_challenges; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_user_action_challenges TO anon;
GRANT ALL ON TABLE public.dfns_user_action_challenges TO authenticated;
GRANT ALL ON TABLE public.dfns_user_action_challenges TO service_role;
GRANT ALL ON TABLE public.dfns_user_action_challenges TO prisma;


--
-- Name: TABLE dfns_user_sessions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_user_sessions TO anon;
GRANT ALL ON TABLE public.dfns_user_sessions TO authenticated;
GRANT ALL ON TABLE public.dfns_user_sessions TO service_role;
GRANT ALL ON TABLE public.dfns_user_sessions TO prisma;


--
-- Name: TABLE dfns_users; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_users TO anon;
GRANT ALL ON TABLE public.dfns_users TO authenticated;
GRANT ALL ON TABLE public.dfns_users TO service_role;
GRANT ALL ON TABLE public.dfns_users TO prisma;


--
-- Name: TABLE dfns_validators; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_validators TO anon;
GRANT ALL ON TABLE public.dfns_validators TO authenticated;
GRANT ALL ON TABLE public.dfns_validators TO service_role;
GRANT ALL ON TABLE public.dfns_validators TO prisma;


--
-- Name: TABLE dfns_wallet_balances; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_wallet_balances TO anon;
GRANT ALL ON TABLE public.dfns_wallet_balances TO authenticated;
GRANT ALL ON TABLE public.dfns_wallet_balances TO service_role;
GRANT ALL ON TABLE public.dfns_wallet_balances TO prisma;


--
-- Name: TABLE dfns_wallet_nfts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_wallet_nfts TO anon;
GRANT ALL ON TABLE public.dfns_wallet_nfts TO authenticated;
GRANT ALL ON TABLE public.dfns_wallet_nfts TO service_role;
GRANT ALL ON TABLE public.dfns_wallet_nfts TO prisma;


--
-- Name: TABLE dfns_wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_wallets TO anon;
GRANT ALL ON TABLE public.dfns_wallets TO authenticated;
GRANT ALL ON TABLE public.dfns_wallets TO service_role;
GRANT ALL ON TABLE public.dfns_wallets TO prisma;


--
-- Name: TABLE dfns_webhook_deliveries; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_webhook_deliveries TO anon;
GRANT ALL ON TABLE public.dfns_webhook_deliveries TO authenticated;
GRANT ALL ON TABLE public.dfns_webhook_deliveries TO service_role;
GRANT ALL ON TABLE public.dfns_webhook_deliveries TO prisma;


--
-- Name: TABLE dfns_webhooks; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dfns_webhooks TO anon;
GRANT ALL ON TABLE public.dfns_webhooks TO authenticated;
GRANT ALL ON TABLE public.dfns_webhooks TO service_role;
GRANT ALL ON TABLE public.dfns_webhooks TO prisma;


--
-- Name: TABLE digital_tokenised_funds; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.digital_tokenised_funds TO anon;
GRANT ALL ON TABLE public.digital_tokenised_funds TO authenticated;
GRANT ALL ON TABLE public.digital_tokenised_funds TO service_role;
GRANT ALL ON TABLE public.digital_tokenised_funds TO prisma;


--
-- Name: TABLE digital_tokenized_fund_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.digital_tokenized_fund_products TO anon;
GRANT ALL ON TABLE public.digital_tokenized_fund_products TO authenticated;
GRANT ALL ON TABLE public.digital_tokenized_fund_products TO service_role;
GRANT ALL ON TABLE public.digital_tokenized_fund_products TO prisma;


--
-- Name: TABLE distribution_redemptions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.distribution_redemptions TO anon;
GRANT ALL ON TABLE public.distribution_redemptions TO authenticated;
GRANT ALL ON TABLE public.distribution_redemptions TO service_role;
GRANT ALL ON TABLE public.distribution_redemptions TO prisma;


--
-- Name: TABLE document_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.document_approvals TO anon;
GRANT ALL ON TABLE public.document_approvals TO authenticated;
GRANT ALL ON TABLE public.document_approvals TO service_role;
GRANT ALL ON TABLE public.document_approvals TO prisma;


--
-- Name: TABLE document_versions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.document_versions TO anon;
GRANT ALL ON TABLE public.document_versions TO authenticated;
GRANT ALL ON TABLE public.document_versions TO service_role;
GRANT ALL ON TABLE public.document_versions TO prisma;


--
-- Name: TABLE document_workflows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.document_workflows TO anon;
GRANT ALL ON TABLE public.document_workflows TO authenticated;
GRANT ALL ON TABLE public.document_workflows TO service_role;
GRANT ALL ON TABLE public.document_workflows TO prisma;


--
-- Name: TABLE documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.documents TO anon;
GRANT ALL ON TABLE public.documents TO authenticated;
GRANT ALL ON TABLE public.documents TO service_role;
GRANT ALL ON TABLE public.documents TO prisma;


--
-- Name: TABLE dtf_blockchain_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dtf_blockchain_events TO anon;
GRANT ALL ON TABLE public.dtf_blockchain_events TO authenticated;
GRANT ALL ON TABLE public.dtf_blockchain_events TO service_role;
GRANT ALL ON TABLE public.dtf_blockchain_events TO prisma;


--
-- Name: TABLE dtf_minting_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dtf_minting_history TO anon;
GRANT ALL ON TABLE public.dtf_minting_history TO authenticated;
GRANT ALL ON TABLE public.dtf_minting_history TO service_role;
GRANT ALL ON TABLE public.dtf_minting_history TO prisma;


--
-- Name: TABLE dtf_nav_snapshots; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dtf_nav_snapshots TO anon;
GRANT ALL ON TABLE public.dtf_nav_snapshots TO authenticated;
GRANT ALL ON TABLE public.dtf_nav_snapshots TO service_role;
GRANT ALL ON TABLE public.dtf_nav_snapshots TO prisma;


--
-- Name: TABLE dtf_redemption_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dtf_redemption_requests TO anon;
GRANT ALL ON TABLE public.dtf_redemption_requests TO authenticated;
GRANT ALL ON TABLE public.dtf_redemption_requests TO service_role;
GRANT ALL ON TABLE public.dtf_redemption_requests TO prisma;


--
-- Name: TABLE dtf_token_metadata; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.dtf_token_metadata TO anon;
GRANT ALL ON TABLE public.dtf_token_metadata TO authenticated;
GRANT ALL ON TABLE public.dtf_token_metadata TO service_role;
GRANT ALL ON TABLE public.dtf_token_metadata TO prisma;


--
-- Name: TABLE email_log; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.email_log TO anon;
GRANT ALL ON TABLE public.email_log TO authenticated;
GRANT ALL ON TABLE public.email_log TO service_role;
GRANT ALL ON TABLE public.email_log TO prisma;


--
-- Name: TABLE energy_assets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.energy_assets TO anon;
GRANT ALL ON TABLE public.energy_assets TO authenticated;
GRANT ALL ON TABLE public.energy_assets TO service_role;
GRANT ALL ON TABLE public.energy_assets TO prisma;


--
-- Name: TABLE energy_futures_contracts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.energy_futures_contracts TO anon;
GRANT ALL ON TABLE public.energy_futures_contracts TO authenticated;
GRANT ALL ON TABLE public.energy_futures_contracts TO service_role;
GRANT ALL ON TABLE public.energy_futures_contracts TO prisma;


--
-- Name: TABLE energy_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.energy_products TO anon;
GRANT ALL ON TABLE public.energy_products TO authenticated;
GRANT ALL ON TABLE public.energy_products TO service_role;
GRANT ALL ON TABLE public.energy_products TO prisma;


--
-- Name: TABLE environmental_certifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.environmental_certifications TO anon;
GRANT ALL ON TABLE public.environmental_certifications TO authenticated;
GRANT ALL ON TABLE public.environmental_certifications TO service_role;
GRANT ALL ON TABLE public.environmental_certifications TO prisma;


--
-- Name: TABLE equity_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.equity_products TO anon;
GRANT ALL ON TABLE public.equity_products TO authenticated;
GRANT ALL ON TABLE public.equity_products TO service_role;
GRANT ALL ON TABLE public.equity_products TO prisma;


--
-- Name: TABLE escalation_notifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.escalation_notifications TO anon;
GRANT ALL ON TABLE public.escalation_notifications TO authenticated;
GRANT ALL ON TABLE public.escalation_notifications TO service_role;
GRANT ALL ON TABLE public.escalation_notifications TO prisma;


--
-- Name: TABLE escalation_schedule; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.escalation_schedule TO anon;
GRANT ALL ON TABLE public.escalation_schedule TO authenticated;
GRANT ALL ON TABLE public.escalation_schedule TO service_role;
GRANT ALL ON TABLE public.escalation_schedule TO prisma;


--
-- Name: TABLE etf_creation_redemption; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_creation_redemption TO anon;
GRANT ALL ON TABLE public.etf_creation_redemption TO authenticated;
GRANT ALL ON TABLE public.etf_creation_redemption TO service_role;
GRANT ALL ON TABLE public.etf_creation_redemption TO prisma;


--
-- Name: TABLE etf_holdings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_holdings TO anon;
GRANT ALL ON TABLE public.etf_holdings TO authenticated;
GRANT ALL ON TABLE public.etf_holdings TO service_role;
GRANT ALL ON TABLE public.etf_holdings TO prisma;


--
-- Name: TABLE etf_metadata; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_metadata TO anon;
GRANT ALL ON TABLE public.etf_metadata TO authenticated;
GRANT ALL ON TABLE public.etf_metadata TO service_role;
GRANT ALL ON TABLE public.etf_metadata TO prisma;


--
-- Name: TABLE etf_nav_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_nav_history TO anon;
GRANT ALL ON TABLE public.etf_nav_history TO authenticated;
GRANT ALL ON TABLE public.etf_nav_history TO service_role;
GRANT ALL ON TABLE public.etf_nav_history TO prisma;


--
-- Name: TABLE fund_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.fund_products TO anon;
GRANT ALL ON TABLE public.fund_products TO authenticated;
GRANT ALL ON TABLE public.fund_products TO service_role;
GRANT ALL ON TABLE public.fund_products TO prisma;


--
-- Name: TABLE etf_premium_discount_latest; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_premium_discount_latest TO anon;
GRANT ALL ON TABLE public.etf_premium_discount_latest TO authenticated;
GRANT ALL ON TABLE public.etf_premium_discount_latest TO service_role;
GRANT ALL ON TABLE public.etf_premium_discount_latest TO prisma;


--
-- Name: TABLE etf_products_with_latest_nav; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_products_with_latest_nav TO anon;
GRANT ALL ON TABLE public.etf_products_with_latest_nav TO authenticated;
GRANT ALL ON TABLE public.etf_products_with_latest_nav TO service_role;
GRANT ALL ON TABLE public.etf_products_with_latest_nav TO prisma;


--
-- Name: TABLE etf_rebalancing_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_rebalancing_history TO anon;
GRANT ALL ON TABLE public.etf_rebalancing_history TO authenticated;
GRANT ALL ON TABLE public.etf_rebalancing_history TO service_role;
GRANT ALL ON TABLE public.etf_rebalancing_history TO prisma;


--
-- Name: TABLE etf_share_classes_comparison; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_share_classes_comparison TO anon;
GRANT ALL ON TABLE public.etf_share_classes_comparison TO authenticated;
GRANT ALL ON TABLE public.etf_share_classes_comparison TO service_role;
GRANT ALL ON TABLE public.etf_share_classes_comparison TO prisma;


--
-- Name: TABLE etf_token_links; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_token_links TO anon;
GRANT ALL ON TABLE public.etf_token_links TO authenticated;
GRANT ALL ON TABLE public.etf_token_links TO service_role;
GRANT ALL ON TABLE public.etf_token_links TO prisma;


--
-- Name: TABLE etf_tracking_error_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.etf_tracking_error_history TO anon;
GRANT ALL ON TABLE public.etf_tracking_error_history TO authenticated;
GRANT ALL ON TABLE public.etf_tracking_error_history TO service_role;
GRANT ALL ON TABLE public.etf_tracking_error_history TO prisma;


--
-- Name: TABLE exchange_rate_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.exchange_rate_history TO anon;
GRANT ALL ON TABLE public.exchange_rate_history TO authenticated;
GRANT ALL ON TABLE public.exchange_rate_history TO service_role;
GRANT ALL ON TABLE public.exchange_rate_history TO prisma;


--
-- Name: TABLE external_api_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.external_api_cache TO anon;
GRANT ALL ON TABLE public.external_api_cache TO authenticated;
GRANT ALL ON TABLE public.external_api_cache TO service_role;
GRANT ALL ON TABLE public.external_api_cache TO prisma;


--
-- Name: TABLE facet_registry; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.facet_registry TO anon;
GRANT ALL ON TABLE public.facet_registry TO authenticated;
GRANT ALL ON TABLE public.facet_registry TO service_role;
GRANT ALL ON TABLE public.facet_registry TO prisma;


--
-- Name: TABLE faucet_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.faucet_requests TO anon;
GRANT ALL ON TABLE public.faucet_requests TO authenticated;
GRANT ALL ON TABLE public.faucet_requests TO service_role;
GRANT ALL ON TABLE public.faucet_requests TO prisma;


--
-- Name: TABLE fiat_quotes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.fiat_quotes TO anon;
GRANT ALL ON TABLE public.fiat_quotes TO authenticated;
GRANT ALL ON TABLE public.fiat_quotes TO service_role;
GRANT ALL ON TABLE public.fiat_quotes TO prisma;


--
-- Name: TABLE fiat_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.fiat_transactions TO anon;
GRANT ALL ON TABLE public.fiat_transactions TO authenticated;
GRANT ALL ON TABLE public.fiat_transactions TO service_role;
GRANT ALL ON TABLE public.fiat_transactions TO prisma;


--
-- Name: TABLE fund_nav_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.fund_nav_data TO anon;
GRANT ALL ON TABLE public.fund_nav_data TO authenticated;
GRANT ALL ON TABLE public.fund_nav_data TO service_role;
GRANT ALL ON TABLE public.fund_nav_data TO prisma;


--
-- Name: TABLE futures_prices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.futures_prices TO anon;
GRANT ALL ON TABLE public.futures_prices TO authenticated;
GRANT ALL ON TABLE public.futures_prices TO service_role;
GRANT ALL ON TABLE public.futures_prices TO prisma;


--
-- Name: TABLE geographic_jurisdictions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.geographic_jurisdictions TO anon;
GRANT ALL ON TABLE public.geographic_jurisdictions TO authenticated;
GRANT ALL ON TABLE public.geographic_jurisdictions TO service_role;
GRANT ALL ON TABLE public.geographic_jurisdictions TO prisma;


--
-- Name: TABLE guardian_api_tests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.guardian_api_tests TO anon;
GRANT ALL ON TABLE public.guardian_api_tests TO authenticated;
GRANT ALL ON TABLE public.guardian_api_tests TO service_role;
GRANT ALL ON TABLE public.guardian_api_tests TO prisma;


--
-- Name: TABLE guardian_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.guardian_operations TO anon;
GRANT ALL ON TABLE public.guardian_operations TO authenticated;
GRANT ALL ON TABLE public.guardian_operations TO service_role;
GRANT ALL ON TABLE public.guardian_operations TO prisma;


--
-- Name: TABLE guardian_wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.guardian_wallets TO anon;
GRANT ALL ON TABLE public.guardian_wallets TO authenticated;
GRANT ALL ON TABLE public.guardian_wallets TO service_role;
GRANT ALL ON TABLE public.guardian_wallets TO prisma;


--
-- Name: TABLE health_checks; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.health_checks TO anon;
GRANT ALL ON TABLE public.health_checks TO authenticated;
GRANT ALL ON TABLE public.health_checks TO service_role;
GRANT ALL ON TABLE public.health_checks TO prisma;


--
-- Name: TABLE individual_documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.individual_documents TO anon;
GRANT ALL ON TABLE public.individual_documents TO authenticated;
GRANT ALL ON TABLE public.individual_documents TO service_role;
GRANT ALL ON TABLE public.individual_documents TO prisma;


--
-- Name: TABLE infra_capex_schedule; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_capex_schedule TO anon;
GRANT ALL ON TABLE public.infra_capex_schedule TO authenticated;
GRANT ALL ON TABLE public.infra_capex_schedule TO service_role;
GRANT ALL ON TABLE public.infra_capex_schedule TO prisma;


--
-- Name: TABLE infra_concessions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_concessions TO anon;
GRANT ALL ON TABLE public.infra_concessions TO authenticated;
GRANT ALL ON TABLE public.infra_concessions TO service_role;
GRANT ALL ON TABLE public.infra_concessions TO prisma;


--
-- Name: TABLE infra_operating_expenses; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_operating_expenses TO anon;
GRANT ALL ON TABLE public.infra_operating_expenses TO authenticated;
GRANT ALL ON TABLE public.infra_operating_expenses TO service_role;
GRANT ALL ON TABLE public.infra_operating_expenses TO prisma;


--
-- Name: TABLE infra_regulatory_filings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_regulatory_filings TO anon;
GRANT ALL ON TABLE public.infra_regulatory_filings TO authenticated;
GRANT ALL ON TABLE public.infra_regulatory_filings TO service_role;
GRANT ALL ON TABLE public.infra_regulatory_filings TO prisma;


--
-- Name: TABLE infra_revenue_streams; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_revenue_streams TO anon;
GRANT ALL ON TABLE public.infra_revenue_streams TO authenticated;
GRANT ALL ON TABLE public.infra_revenue_streams TO service_role;
GRANT ALL ON TABLE public.infra_revenue_streams TO prisma;


--
-- Name: TABLE infra_usage_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infra_usage_metrics TO anon;
GRANT ALL ON TABLE public.infra_usage_metrics TO authenticated;
GRANT ALL ON TABLE public.infra_usage_metrics TO service_role;
GRANT ALL ON TABLE public.infra_usage_metrics TO prisma;


--
-- Name: TABLE infrastructure_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.infrastructure_products TO anon;
GRANT ALL ON TABLE public.infrastructure_products TO authenticated;
GRANT ALL ON TABLE public.infrastructure_products TO service_role;
GRANT ALL ON TABLE public.infrastructure_products TO prisma;


--
-- Name: TABLE investor_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investor_approvals TO anon;
GRANT ALL ON TABLE public.investor_approvals TO authenticated;
GRANT ALL ON TABLE public.investor_approvals TO service_role;
GRANT ALL ON TABLE public.investor_approvals TO prisma;


--
-- Name: TABLE investor_documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investor_documents TO anon;
GRANT ALL ON TABLE public.investor_documents TO authenticated;
GRANT ALL ON TABLE public.investor_documents TO service_role;
GRANT ALL ON TABLE public.investor_documents TO prisma;


--
-- Name: TABLE investor_group_members; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investor_group_members TO anon;
GRANT ALL ON TABLE public.investor_group_members TO authenticated;
GRANT ALL ON TABLE public.investor_group_members TO service_role;
GRANT ALL ON TABLE public.investor_group_members TO prisma;


--
-- Name: TABLE investor_groups; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investor_groups TO anon;
GRANT ALL ON TABLE public.investor_groups TO authenticated;
GRANT ALL ON TABLE public.investor_groups TO service_role;
GRANT ALL ON TABLE public.investor_groups TO prisma;


--
-- Name: TABLE investor_groups_investors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investor_groups_investors TO anon;
GRANT ALL ON TABLE public.investor_groups_investors TO authenticated;
GRANT ALL ON TABLE public.investor_groups_investors TO service_role;
GRANT ALL ON TABLE public.investor_groups_investors TO prisma;


--
-- Name: TABLE investors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.investors TO anon;
GRANT ALL ON TABLE public.investors TO authenticated;
GRANT ALL ON TABLE public.investors TO service_role;
GRANT ALL ON TABLE public.investors TO prisma;


--
-- Name: TABLE invoice; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice TO anon;
GRANT ALL ON TABLE public.invoice TO authenticated;
GRANT ALL ON TABLE public.invoice TO service_role;
GRANT ALL ON TABLE public.invoice TO prisma;


--
-- Name: TABLE invoice_aging_buckets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice_aging_buckets TO anon;
GRANT ALL ON TABLE public.invoice_aging_buckets TO authenticated;
GRANT ALL ON TABLE public.invoice_aging_buckets TO service_role;
GRANT ALL ON TABLE public.invoice_aging_buckets TO prisma;


--
-- Name: TABLE invoice_collection_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice_collection_history TO anon;
GRANT ALL ON TABLE public.invoice_collection_history TO authenticated;
GRANT ALL ON TABLE public.invoice_collection_history TO service_role;
GRANT ALL ON TABLE public.invoice_collection_history TO prisma;


--
-- Name: TABLE invoice_debtor_ratings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice_debtor_ratings TO anon;
GRANT ALL ON TABLE public.invoice_debtor_ratings TO authenticated;
GRANT ALL ON TABLE public.invoice_debtor_ratings TO service_role;
GRANT ALL ON TABLE public.invoice_debtor_ratings TO prisma;


--
-- Name: SEQUENCE invoice_invoice_id_seq; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON SEQUENCE public.invoice_invoice_id_seq TO anon;
GRANT ALL ON SEQUENCE public.invoice_invoice_id_seq TO authenticated;
GRANT ALL ON SEQUENCE public.invoice_invoice_id_seq TO service_role;
GRANT ALL ON SEQUENCE public.invoice_invoice_id_seq TO prisma;


--
-- Name: TABLE invoice_payments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice_payments TO anon;
GRANT ALL ON TABLE public.invoice_payments TO authenticated;
GRANT ALL ON TABLE public.invoice_payments TO service_role;
GRANT ALL ON TABLE public.invoice_payments TO prisma;


--
-- Name: TABLE invoice_receivables; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoice_receivables TO anon;
GRANT ALL ON TABLE public.invoice_receivables TO authenticated;
GRANT ALL ON TABLE public.invoice_receivables TO service_role;
GRANT ALL ON TABLE public.invoice_receivables TO prisma;


--
-- Name: TABLE invoices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.invoices TO anon;
GRANT ALL ON TABLE public.invoices TO authenticated;
GRANT ALL ON TABLE public.invoices TO service_role;
GRANT ALL ON TABLE public.invoices TO prisma;


--
-- Name: TABLE issuer_access_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.issuer_access_roles TO anon;
GRANT ALL ON TABLE public.issuer_access_roles TO authenticated;
GRANT ALL ON TABLE public.issuer_access_roles TO service_role;
GRANT ALL ON TABLE public.issuer_access_roles TO prisma;


--
-- Name: TABLE issuer_detail_documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.issuer_detail_documents TO anon;
GRANT ALL ON TABLE public.issuer_detail_documents TO authenticated;
GRANT ALL ON TABLE public.issuer_detail_documents TO service_role;
GRANT ALL ON TABLE public.issuer_detail_documents TO prisma;


--
-- Name: TABLE issuer_documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.issuer_documents TO anon;
GRANT ALL ON TABLE public.issuer_documents TO authenticated;
GRANT ALL ON TABLE public.issuer_documents TO service_role;
GRANT ALL ON TABLE public.issuer_documents TO prisma;


--
-- Name: TABLE key_vault_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.key_vault_keys TO anon;
GRANT ALL ON TABLE public.key_vault_keys TO authenticated;
GRANT ALL ON TABLE public.key_vault_keys TO service_role;
GRANT ALL ON TABLE public.key_vault_keys TO prisma;


--
-- Name: TABLE kyc_screening_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.kyc_screening_logs TO anon;
GRANT ALL ON TABLE public.kyc_screening_logs TO authenticated;
GRANT ALL ON TABLE public.kyc_screening_logs TO service_role;
GRANT ALL ON TABLE public.kyc_screening_logs TO prisma;


--
-- Name: TABLE latest_nav_by_fund; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.latest_nav_by_fund TO anon;
GRANT ALL ON TABLE public.latest_nav_by_fund TO authenticated;
GRANT ALL ON TABLE public.latest_nav_by_fund TO service_role;
GRANT ALL ON TABLE public.latest_nav_by_fund TO prisma;


--
-- Name: TABLE lease_agreements; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.lease_agreements TO anon;
GRANT ALL ON TABLE public.lease_agreements TO authenticated;
GRANT ALL ON TABLE public.lease_agreements TO service_role;
GRANT ALL ON TABLE public.lease_agreements TO prisma;


--
-- Name: TABLE market_data_providers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.market_data_providers TO anon;
GRANT ALL ON TABLE public.market_data_providers TO authenticated;
GRANT ALL ON TABLE public.market_data_providers TO service_role;
GRANT ALL ON TABLE public.market_data_providers TO prisma;


--
-- Name: TABLE market_data_snapshots; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.market_data_snapshots TO anon;
GRANT ALL ON TABLE public.market_data_snapshots TO authenticated;
GRANT ALL ON TABLE public.market_data_snapshots TO service_role;
GRANT ALL ON TABLE public.market_data_snapshots TO prisma;


--
-- Name: TABLE market_indices; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.market_indices TO anon;
GRANT ALL ON TABLE public.market_indices TO authenticated;
GRANT ALL ON TABLE public.market_indices TO service_role;
GRANT ALL ON TABLE public.market_indices TO prisma;


--
-- Name: TABLE market_rent_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.market_rent_data TO anon;
GRANT ALL ON TABLE public.market_rent_data TO authenticated;
GRANT ALL ON TABLE public.market_rent_data TO service_role;
GRANT ALL ON TABLE public.market_rent_data TO prisma;


--
-- Name: TABLE mfa_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mfa_policies TO anon;
GRANT ALL ON TABLE public.mfa_policies TO authenticated;
GRANT ALL ON TABLE public.mfa_policies TO service_role;
GRANT ALL ON TABLE public.mfa_policies TO prisma;


--
-- Name: TABLE ml_baseline_statistics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ml_baseline_statistics TO anon;
GRANT ALL ON TABLE public.ml_baseline_statistics TO authenticated;
GRANT ALL ON TABLE public.ml_baseline_statistics TO service_role;
GRANT ALL ON TABLE public.ml_baseline_statistics TO prisma;


--
-- Name: TABLE mmf_allocation_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_allocation_history TO anon;
GRANT ALL ON TABLE public.mmf_allocation_history TO authenticated;
GRANT ALL ON TABLE public.mmf_allocation_history TO service_role;
GRANT ALL ON TABLE public.mmf_allocation_history TO prisma;


--
-- Name: TABLE mmf_credit_ratings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_credit_ratings TO anon;
GRANT ALL ON TABLE public.mmf_credit_ratings TO authenticated;
GRANT ALL ON TABLE public.mmf_credit_ratings TO service_role;
GRANT ALL ON TABLE public.mmf_credit_ratings TO prisma;


--
-- Name: TABLE mmf_fees_gates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_fees_gates TO anon;
GRANT ALL ON TABLE public.mmf_fees_gates TO authenticated;
GRANT ALL ON TABLE public.mmf_fees_gates TO service_role;
GRANT ALL ON TABLE public.mmf_fees_gates TO prisma;


--
-- Name: TABLE mmf_holdings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_holdings TO anon;
GRANT ALL ON TABLE public.mmf_holdings TO authenticated;
GRANT ALL ON TABLE public.mmf_holdings TO service_role;
GRANT ALL ON TABLE public.mmf_holdings TO prisma;


--
-- Name: TABLE subscriptions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.subscriptions TO anon;
GRANT ALL ON TABLE public.subscriptions TO authenticated;
GRANT ALL ON TABLE public.subscriptions TO service_role;
GRANT ALL ON TABLE public.subscriptions TO prisma;


--
-- Name: TABLE mmf_investor_holdings_by_project; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_investor_holdings_by_project TO anon;
GRANT ALL ON TABLE public.mmf_investor_holdings_by_project TO authenticated;
GRANT ALL ON TABLE public.mmf_investor_holdings_by_project TO service_role;
GRANT ALL ON TABLE public.mmf_investor_holdings_by_project TO prisma;


--
-- Name: TABLE mmf_liquidity_buckets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_liquidity_buckets TO anon;
GRANT ALL ON TABLE public.mmf_liquidity_buckets TO authenticated;
GRANT ALL ON TABLE public.mmf_liquidity_buckets TO service_role;
GRANT ALL ON TABLE public.mmf_liquidity_buckets TO prisma;


--
-- Name: TABLE mmf_nav_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_nav_history TO anon;
GRANT ALL ON TABLE public.mmf_nav_history TO authenticated;
GRANT ALL ON TABLE public.mmf_nav_history TO service_role;
GRANT ALL ON TABLE public.mmf_nav_history TO prisma;


--
-- Name: TABLE mmf_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.mmf_transactions TO anon;
GRANT ALL ON TABLE public.mmf_transactions TO authenticated;
GRANT ALL ON TABLE public.mmf_transactions TO service_role;
GRANT ALL ON TABLE public.mmf_transactions TO prisma;


--
-- Name: TABLE monitoring_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.monitoring_metrics TO anon;
GRANT ALL ON TABLE public.monitoring_metrics TO authenticated;
GRANT ALL ON TABLE public.monitoring_metrics TO service_role;
GRANT ALL ON TABLE public.monitoring_metrics TO prisma;


--
-- Name: TABLE moonpay_asset_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_asset_cache TO anon;
GRANT ALL ON TABLE public.moonpay_asset_cache TO authenticated;
GRANT ALL ON TABLE public.moonpay_asset_cache TO service_role;
GRANT ALL ON TABLE public.moonpay_asset_cache TO prisma;


--
-- Name: TABLE moonpay_compliance_alerts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_compliance_alerts TO anon;
GRANT ALL ON TABLE public.moonpay_compliance_alerts TO authenticated;
GRANT ALL ON TABLE public.moonpay_compliance_alerts TO service_role;
GRANT ALL ON TABLE public.moonpay_compliance_alerts TO prisma;


--
-- Name: TABLE moonpay_customers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_customers TO anon;
GRANT ALL ON TABLE public.moonpay_customers TO authenticated;
GRANT ALL ON TABLE public.moonpay_customers TO service_role;
GRANT ALL ON TABLE public.moonpay_customers TO prisma;


--
-- Name: TABLE moonpay_passes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_passes TO anon;
GRANT ALL ON TABLE public.moonpay_passes TO authenticated;
GRANT ALL ON TABLE public.moonpay_passes TO service_role;
GRANT ALL ON TABLE public.moonpay_passes TO prisma;


--
-- Name: TABLE moonpay_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_policies TO anon;
GRANT ALL ON TABLE public.moonpay_policies TO authenticated;
GRANT ALL ON TABLE public.moonpay_policies TO service_role;
GRANT ALL ON TABLE public.moonpay_policies TO prisma;


--
-- Name: TABLE moonpay_policy_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_policy_logs TO anon;
GRANT ALL ON TABLE public.moonpay_policy_logs TO authenticated;
GRANT ALL ON TABLE public.moonpay_policy_logs TO service_role;
GRANT ALL ON TABLE public.moonpay_policy_logs TO prisma;


--
-- Name: TABLE moonpay_projects; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_projects TO anon;
GRANT ALL ON TABLE public.moonpay_projects TO authenticated;
GRANT ALL ON TABLE public.moonpay_projects TO service_role;
GRANT ALL ON TABLE public.moonpay_projects TO prisma;


--
-- Name: TABLE moonpay_swap_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_swap_transactions TO anon;
GRANT ALL ON TABLE public.moonpay_swap_transactions TO authenticated;
GRANT ALL ON TABLE public.moonpay_swap_transactions TO service_role;
GRANT ALL ON TABLE public.moonpay_swap_transactions TO prisma;


--
-- Name: TABLE moonpay_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_transactions TO anon;
GRANT ALL ON TABLE public.moonpay_transactions TO authenticated;
GRANT ALL ON TABLE public.moonpay_transactions TO service_role;
GRANT ALL ON TABLE public.moonpay_transactions TO prisma;


--
-- Name: TABLE moonpay_webhook_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_webhook_config TO anon;
GRANT ALL ON TABLE public.moonpay_webhook_config TO authenticated;
GRANT ALL ON TABLE public.moonpay_webhook_config TO service_role;
GRANT ALL ON TABLE public.moonpay_webhook_config TO prisma;


--
-- Name: TABLE moonpay_webhook_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.moonpay_webhook_events TO anon;
GRANT ALL ON TABLE public.moonpay_webhook_events TO authenticated;
GRANT ALL ON TABLE public.moonpay_webhook_events TO service_role;
GRANT ALL ON TABLE public.moonpay_webhook_events TO prisma;


--
-- Name: TABLE multi_sig_audit_log; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_audit_log TO anon;
GRANT ALL ON TABLE public.multi_sig_audit_log TO authenticated;
GRANT ALL ON TABLE public.multi_sig_audit_log TO service_role;
GRANT ALL ON TABLE public.multi_sig_audit_log TO prisma;


--
-- Name: TABLE multi_sig_configurations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_configurations TO anon;
GRANT ALL ON TABLE public.multi_sig_configurations TO authenticated;
GRANT ALL ON TABLE public.multi_sig_configurations TO service_role;
GRANT ALL ON TABLE public.multi_sig_configurations TO prisma;


--
-- Name: TABLE multi_sig_on_chain_confirmations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_on_chain_confirmations TO anon;
GRANT ALL ON TABLE public.multi_sig_on_chain_confirmations TO authenticated;
GRANT ALL ON TABLE public.multi_sig_on_chain_confirmations TO service_role;
GRANT ALL ON TABLE public.multi_sig_on_chain_confirmations TO prisma;


--
-- Name: TABLE multi_sig_on_chain_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_on_chain_transactions TO anon;
GRANT ALL ON TABLE public.multi_sig_on_chain_transactions TO authenticated;
GRANT ALL ON TABLE public.multi_sig_on_chain_transactions TO service_role;
GRANT ALL ON TABLE public.multi_sig_on_chain_transactions TO prisma;


--
-- Name: TABLE multi_sig_proposals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_proposals TO anon;
GRANT ALL ON TABLE public.multi_sig_proposals TO authenticated;
GRANT ALL ON TABLE public.multi_sig_proposals TO service_role;
GRANT ALL ON TABLE public.multi_sig_proposals TO prisma;


--
-- Name: TABLE multi_sig_wallet_owners; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_wallet_owners TO anon;
GRANT ALL ON TABLE public.multi_sig_wallet_owners TO authenticated;
GRANT ALL ON TABLE public.multi_sig_wallet_owners TO service_role;
GRANT ALL ON TABLE public.multi_sig_wallet_owners TO prisma;


--
-- Name: TABLE multi_sig_wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_wallets TO anon;
GRANT ALL ON TABLE public.multi_sig_wallets TO authenticated;
GRANT ALL ON TABLE public.multi_sig_wallets TO service_role;
GRANT ALL ON TABLE public.multi_sig_wallets TO prisma;


--
-- Name: TABLE role_addresses; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.role_addresses TO anon;
GRANT ALL ON TABLE public.role_addresses TO authenticated;
GRANT ALL ON TABLE public.role_addresses TO service_role;
GRANT ALL ON TABLE public.role_addresses TO prisma;


--
-- Name: TABLE multi_sig_wallet_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.multi_sig_wallet_roles TO anon;
GRANT ALL ON TABLE public.multi_sig_wallet_roles TO authenticated;
GRANT ALL ON TABLE public.multi_sig_wallet_roles TO service_role;
GRANT ALL ON TABLE public.multi_sig_wallet_roles TO prisma;


--
-- Name: TABLE nav_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_approvals TO anon;
GRANT ALL ON TABLE public.nav_approvals TO authenticated;
GRANT ALL ON TABLE public.nav_approvals TO service_role;
GRANT ALL ON TABLE public.nav_approvals TO prisma;


--
-- Name: TABLE nav_asset_type_adjustments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_asset_type_adjustments TO anon;
GRANT ALL ON TABLE public.nav_asset_type_adjustments TO authenticated;
GRANT ALL ON TABLE public.nav_asset_type_adjustments TO service_role;
GRANT ALL ON TABLE public.nav_asset_type_adjustments TO prisma;


--
-- Name: TABLE nav_calculation_default_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_calculation_default_configs TO anon;
GRANT ALL ON TABLE public.nav_calculation_default_configs TO authenticated;
GRANT ALL ON TABLE public.nav_calculation_default_configs TO service_role;
GRANT ALL ON TABLE public.nav_calculation_default_configs TO prisma;


--
-- Name: TABLE nav_calculation_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_calculation_history TO anon;
GRANT ALL ON TABLE public.nav_calculation_history TO authenticated;
GRANT ALL ON TABLE public.nav_calculation_history TO service_role;
GRANT ALL ON TABLE public.nav_calculation_history TO prisma;


--
-- Name: SEQUENCE nav_calculation_history_id_seq; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON SEQUENCE public.nav_calculation_history_id_seq TO anon;
GRANT ALL ON SEQUENCE public.nav_calculation_history_id_seq TO authenticated;
GRANT ALL ON SEQUENCE public.nav_calculation_history_id_seq TO service_role;
GRANT ALL ON SEQUENCE public.nav_calculation_history_id_seq TO prisma;


--
-- Name: TABLE nav_calculation_runs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_calculation_runs TO anon;
GRANT ALL ON TABLE public.nav_calculation_runs TO authenticated;
GRANT ALL ON TABLE public.nav_calculation_runs TO service_role;
GRANT ALL ON TABLE public.nav_calculation_runs TO prisma;


--
-- Name: TABLE nav_calculator_parameters; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_calculator_parameters TO anon;
GRANT ALL ON TABLE public.nav_calculator_parameters TO authenticated;
GRANT ALL ON TABLE public.nav_calculator_parameters TO service_role;
GRANT ALL ON TABLE public.nav_calculator_parameters TO prisma;


--
-- Name: TABLE nav_credit_quality_multipliers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_credit_quality_multipliers TO anon;
GRANT ALL ON TABLE public.nav_credit_quality_multipliers TO authenticated;
GRANT ALL ON TABLE public.nav_credit_quality_multipliers TO service_role;
GRANT ALL ON TABLE public.nav_credit_quality_multipliers TO prisma;


--
-- Name: TABLE nav_credit_spreads; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_credit_spreads TO anon;
GRANT ALL ON TABLE public.nav_credit_spreads TO authenticated;
GRANT ALL ON TABLE public.nav_credit_spreads TO service_role;
GRANT ALL ON TABLE public.nav_credit_spreads TO prisma;


--
-- Name: TABLE nav_validation_results; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_validation_results TO anon;
GRANT ALL ON TABLE public.nav_validation_results TO authenticated;
GRANT ALL ON TABLE public.nav_validation_results TO service_role;
GRANT ALL ON TABLE public.nav_validation_results TO prisma;


--
-- Name: TABLE nav_data_with_status; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_data_with_status TO anon;
GRANT ALL ON TABLE public.nav_data_with_status TO authenticated;
GRANT ALL ON TABLE public.nav_data_with_status TO service_role;
GRANT ALL ON TABLE public.nav_data_with_status TO prisma;


--
-- Name: TABLE nav_default_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_default_rates TO anon;
GRANT ALL ON TABLE public.nav_default_rates TO authenticated;
GRANT ALL ON TABLE public.nav_default_rates TO service_role;
GRANT ALL ON TABLE public.nav_default_rates TO prisma;


--
-- Name: TABLE nav_delinquency_adjustments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_delinquency_adjustments TO anon;
GRANT ALL ON TABLE public.nav_delinquency_adjustments TO authenticated;
GRANT ALL ON TABLE public.nav_delinquency_adjustments TO service_role;
GRANT ALL ON TABLE public.nav_delinquency_adjustments TO prisma;


--
-- Name: TABLE nav_economic_capital; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_economic_capital TO anon;
GRANT ALL ON TABLE public.nav_economic_capital TO authenticated;
GRANT ALL ON TABLE public.nav_economic_capital TO service_role;
GRANT ALL ON TABLE public.nav_economic_capital TO prisma;


--
-- Name: TABLE nav_fx_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_fx_rates TO anon;
GRANT ALL ON TABLE public.nav_fx_rates TO authenticated;
GRANT ALL ON TABLE public.nav_fx_rates TO service_role;
GRANT ALL ON TABLE public.nav_fx_rates TO prisma;


--
-- Name: TABLE nav_fx_rates_latest; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_fx_rates_latest TO anon;
GRANT ALL ON TABLE public.nav_fx_rates_latest TO authenticated;
GRANT ALL ON TABLE public.nav_fx_rates_latest TO service_role;
GRANT ALL ON TABLE public.nav_fx_rates_latest TO prisma;


--
-- Name: TABLE nav_liquidity_discounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_liquidity_discounts TO anon;
GRANT ALL ON TABLE public.nav_liquidity_discounts TO authenticated;
GRANT ALL ON TABLE public.nav_liquidity_discounts TO service_role;
GRANT ALL ON TABLE public.nav_liquidity_discounts TO prisma;


--
-- Name: TABLE nav_loss_given_default; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_loss_given_default TO anon;
GRANT ALL ON TABLE public.nav_loss_given_default TO authenticated;
GRANT ALL ON TABLE public.nav_loss_given_default TO service_role;
GRANT ALL ON TABLE public.nav_loss_given_default TO prisma;


--
-- Name: TABLE nav_oracle_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_oracle_configs TO anon;
GRANT ALL ON TABLE public.nav_oracle_configs TO authenticated;
GRANT ALL ON TABLE public.nav_oracle_configs TO service_role;
GRANT ALL ON TABLE public.nav_oracle_configs TO prisma;


--
-- Name: TABLE nav_prepayment_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_prepayment_rates TO anon;
GRANT ALL ON TABLE public.nav_prepayment_rates TO authenticated;
GRANT ALL ON TABLE public.nav_prepayment_rates TO service_role;
GRANT ALL ON TABLE public.nav_prepayment_rates TO prisma;


--
-- Name: TABLE nav_price_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_price_cache TO anon;
GRANT ALL ON TABLE public.nav_price_cache TO authenticated;
GRANT ALL ON TABLE public.nav_price_cache TO service_role;
GRANT ALL ON TABLE public.nav_price_cache TO prisma;


--
-- Name: TABLE nav_probability_of_default; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_probability_of_default TO anon;
GRANT ALL ON TABLE public.nav_probability_of_default TO authenticated;
GRANT ALL ON TABLE public.nav_probability_of_default TO service_role;
GRANT ALL ON TABLE public.nav_probability_of_default TO prisma;


--
-- Name: TABLE nav_recovery_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_recovery_rates TO anon;
GRANT ALL ON TABLE public.nav_recovery_rates TO authenticated;
GRANT ALL ON TABLE public.nav_recovery_rates TO service_role;
GRANT ALL ON TABLE public.nav_recovery_rates TO prisma;


--
-- Name: TABLE nav_redemptions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_redemptions TO anon;
GRANT ALL ON TABLE public.nav_redemptions TO authenticated;
GRANT ALL ON TABLE public.nav_redemptions TO service_role;
GRANT ALL ON TABLE public.nav_redemptions TO prisma;


--
-- Name: TABLE nav_unexpected_loss; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.nav_unexpected_loss TO anon;
GRANT ALL ON TABLE public.nav_unexpected_loss TO authenticated;
GRANT ALL ON TABLE public.nav_unexpected_loss TO service_role;
GRANT ALL ON TABLE public.nav_unexpected_loss TO prisma;


--
-- Name: TABLE notification_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.notification_settings TO anon;
GRANT ALL ON TABLE public.notification_settings TO authenticated;
GRANT ALL ON TABLE public.notification_settings TO service_role;
GRANT ALL ON TABLE public.notification_settings TO prisma;


--
-- Name: TABLE notifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.notifications TO anon;
GRANT ALL ON TABLE public.notifications TO authenticated;
GRANT ALL ON TABLE public.notifications TO service_role;
GRANT ALL ON TABLE public.notifications TO prisma;


--
-- Name: TABLE onboarding_restrictions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.onboarding_restrictions TO anon;
GRANT ALL ON TABLE public.onboarding_restrictions TO authenticated;
GRANT ALL ON TABLE public.onboarding_restrictions TO service_role;
GRANT ALL ON TABLE public.onboarding_restrictions TO prisma;


--
-- Name: TABLE onchain_claims; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.onchain_claims TO anon;
GRANT ALL ON TABLE public.onchain_claims TO authenticated;
GRANT ALL ON TABLE public.onchain_claims TO service_role;
GRANT ALL ON TABLE public.onchain_claims TO prisma;


--
-- Name: TABLE onchain_identities; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.onchain_identities TO anon;
GRANT ALL ON TABLE public.onchain_identities TO authenticated;
GRANT ALL ON TABLE public.onchain_identities TO service_role;
GRANT ALL ON TABLE public.onchain_identities TO prisma;


--
-- Name: TABLE onchain_issuers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.onchain_issuers TO anon;
GRANT ALL ON TABLE public.onchain_issuers TO authenticated;
GRANT ALL ON TABLE public.onchain_issuers TO service_role;
GRANT ALL ON TABLE public.onchain_issuers TO prisma;


--
-- Name: TABLE onchain_verification_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.onchain_verification_history TO anon;
GRANT ALL ON TABLE public.onchain_verification_history TO authenticated;
GRANT ALL ON TABLE public.onchain_verification_history TO service_role;
GRANT ALL ON TABLE public.onchain_verification_history TO prisma;


--
-- Name: TABLE operation_metadata; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.operation_metadata TO anon;
GRANT ALL ON TABLE public.operation_metadata TO authenticated;
GRANT ALL ON TABLE public.operation_metadata TO service_role;
GRANT ALL ON TABLE public.operation_metadata TO prisma;


--
-- Name: TABLE operation_validations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.operation_validations TO anon;
GRANT ALL ON TABLE public.operation_validations TO authenticated;
GRANT ALL ON TABLE public.operation_validations TO service_role;
GRANT ALL ON TABLE public.operation_validations TO prisma;


--
-- Name: TABLE operator_status; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.operator_status TO anon;
GRANT ALL ON TABLE public.operator_status TO authenticated;
GRANT ALL ON TABLE public.operator_status TO service_role;
GRANT ALL ON TABLE public.operator_status TO prisma;


--
-- Name: TABLE organization_details; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.organization_details TO anon;
GRANT ALL ON TABLE public.organization_details TO authenticated;
GRANT ALL ON TABLE public.organization_details TO service_role;
GRANT ALL ON TABLE public.organization_details TO prisma;


--
-- Name: TABLE organizations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.organizations TO anon;
GRANT ALL ON TABLE public.organizations TO authenticated;
GRANT ALL ON TABLE public.organizations TO service_role;
GRANT ALL ON TABLE public.organizations TO prisma;


--
-- Name: TABLE payer; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.payer TO anon;
GRANT ALL ON TABLE public.payer TO authenticated;
GRANT ALL ON TABLE public.payer TO service_role;
GRANT ALL ON TABLE public.payer TO prisma;


--
-- Name: SEQUENCE payer_payer_id_seq; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON SEQUENCE public.payer_payer_id_seq TO anon;
GRANT ALL ON SEQUENCE public.payer_payer_id_seq TO authenticated;
GRANT ALL ON SEQUENCE public.payer_payer_id_seq TO service_role;
GRANT ALL ON SEQUENCE public.payer_payer_id_seq TO prisma;


--
-- Name: TABLE paymaster_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.paymaster_operations TO anon;
GRANT ALL ON TABLE public.paymaster_operations TO authenticated;
GRANT ALL ON TABLE public.paymaster_operations TO service_role;
GRANT ALL ON TABLE public.paymaster_operations TO prisma;


--
-- Name: TABLE paymaster_policies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.paymaster_policies TO anon;
GRANT ALL ON TABLE public.paymaster_policies TO authenticated;
GRANT ALL ON TABLE public.paymaster_policies TO service_role;
GRANT ALL ON TABLE public.paymaster_policies TO prisma;


--
-- Name: TABLE pd_collateral; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_collateral TO anon;
GRANT ALL ON TABLE public.pd_collateral TO authenticated;
GRANT ALL ON TABLE public.pd_collateral TO service_role;
GRANT ALL ON TABLE public.pd_collateral TO prisma;


--
-- Name: TABLE pd_covenants; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_covenants TO anon;
GRANT ALL ON TABLE public.pd_covenants TO authenticated;
GRANT ALL ON TABLE public.pd_covenants TO service_role;
GRANT ALL ON TABLE public.pd_covenants TO prisma;


--
-- Name: TABLE pd_credit_ratings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_credit_ratings TO anon;
GRANT ALL ON TABLE public.pd_credit_ratings TO authenticated;
GRANT ALL ON TABLE public.pd_credit_ratings TO service_role;
GRANT ALL ON TABLE public.pd_credit_ratings TO prisma;


--
-- Name: TABLE pd_default_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_default_events TO anon;
GRANT ALL ON TABLE public.pd_default_events TO authenticated;
GRANT ALL ON TABLE public.pd_default_events TO service_role;
GRANT ALL ON TABLE public.pd_default_events TO prisma;


--
-- Name: TABLE pd_loan_schedules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_loan_schedules TO anon;
GRANT ALL ON TABLE public.pd_loan_schedules TO authenticated;
GRANT ALL ON TABLE public.pd_loan_schedules TO service_role;
GRANT ALL ON TABLE public.pd_loan_schedules TO prisma;


--
-- Name: TABLE pd_payment_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pd_payment_history TO anon;
GRANT ALL ON TABLE public.pd_payment_history TO authenticated;
GRANT ALL ON TABLE public.pd_payment_history TO service_role;
GRANT ALL ON TABLE public.pd_payment_history TO prisma;


--
-- Name: TABLE pe_capital_calls; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pe_capital_calls TO anon;
GRANT ALL ON TABLE public.pe_capital_calls TO authenticated;
GRANT ALL ON TABLE public.pe_capital_calls TO service_role;
GRANT ALL ON TABLE public.pe_capital_calls TO prisma;


--
-- Name: TABLE pe_distributions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pe_distributions TO anon;
GRANT ALL ON TABLE public.pe_distributions TO authenticated;
GRANT ALL ON TABLE public.pe_distributions TO service_role;
GRANT ALL ON TABLE public.pe_distributions TO prisma;


--
-- Name: TABLE pe_performance_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pe_performance_metrics TO anon;
GRANT ALL ON TABLE public.pe_performance_metrics TO authenticated;
GRANT ALL ON TABLE public.pe_performance_metrics TO service_role;
GRANT ALL ON TABLE public.pe_performance_metrics TO prisma;


--
-- Name: TABLE pe_portfolio_companies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pe_portfolio_companies TO anon;
GRANT ALL ON TABLE public.pe_portfolio_companies TO authenticated;
GRANT ALL ON TABLE public.pe_portfolio_companies TO service_role;
GRANT ALL ON TABLE public.pe_portfolio_companies TO prisma;


--
-- Name: TABLE pe_valuations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pe_valuations TO anon;
GRANT ALL ON TABLE public.pe_valuations TO authenticated;
GRANT ALL ON TABLE public.pe_valuations TO service_role;
GRANT ALL ON TABLE public.pe_valuations TO prisma;


--
-- Name: TABLE permissions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.permissions TO anon;
GRANT ALL ON TABLE public.permissions TO authenticated;
GRANT ALL ON TABLE public.permissions TO service_role;
GRANT ALL ON TABLE public.permissions TO prisma;


--
-- Name: TABLE policy_operation_mappings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_operation_mappings TO anon;
GRANT ALL ON TABLE public.policy_operation_mappings TO authenticated;
GRANT ALL ON TABLE public.policy_operation_mappings TO service_role;
GRANT ALL ON TABLE public.policy_operation_mappings TO prisma;


--
-- Name: TABLE policy_rule_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_rule_approvers TO anon;
GRANT ALL ON TABLE public.policy_rule_approvers TO authenticated;
GRANT ALL ON TABLE public.policy_rule_approvers TO service_role;
GRANT ALL ON TABLE public.policy_rule_approvers TO prisma;


--
-- Name: TABLE policy_rule_approvers_backup; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_rule_approvers_backup TO anon;
GRANT ALL ON TABLE public.policy_rule_approvers_backup TO authenticated;
GRANT ALL ON TABLE public.policy_rule_approvers_backup TO service_role;
GRANT ALL ON TABLE public.policy_rule_approvers_backup TO prisma;


--
-- Name: TABLE policy_template_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_template_approvers TO anon;
GRANT ALL ON TABLE public.policy_template_approvers TO authenticated;
GRANT ALL ON TABLE public.policy_template_approvers TO service_role;
GRANT ALL ON TABLE public.policy_template_approvers TO prisma;


--
-- Name: TABLE policy_templates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_templates TO anon;
GRANT ALL ON TABLE public.policy_templates TO authenticated;
GRANT ALL ON TABLE public.policy_templates TO service_role;
GRANT ALL ON TABLE public.policy_templates TO prisma;


--
-- Name: TABLE policy_violations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.policy_violations TO anon;
GRANT ALL ON TABLE public.policy_violations TO authenticated;
GRANT ALL ON TABLE public.policy_violations TO service_role;
GRANT ALL ON TABLE public.policy_violations TO prisma;


--
-- Name: TABLE pool; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.pool TO anon;
GRANT ALL ON TABLE public.pool TO authenticated;
GRANT ALL ON TABLE public.pool TO service_role;
GRANT ALL ON TABLE public.pool TO prisma;


--
-- Name: SEQUENCE pool_pool_id_seq; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON SEQUENCE public.pool_pool_id_seq TO anon;
GRANT ALL ON SEQUENCE public.pool_pool_id_seq TO authenticated;
GRANT ALL ON SEQUENCE public.pool_pool_id_seq TO service_role;
GRANT ALL ON SEQUENCE public.pool_pool_id_seq TO prisma;


--
-- Name: TABLE private_debt_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.private_debt_products TO anon;
GRANT ALL ON TABLE public.private_debt_products TO authenticated;
GRANT ALL ON TABLE public.private_debt_products TO service_role;
GRANT ALL ON TABLE public.private_debt_products TO prisma;


--
-- Name: TABLE private_equity_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.private_equity_products TO anon;
GRANT ALL ON TABLE public.private_equity_products TO authenticated;
GRANT ALL ON TABLE public.private_equity_products TO service_role;
GRANT ALL ON TABLE public.private_equity_products TO prisma;


--
-- Name: TABLE token_deployments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_deployments TO anon;
GRANT ALL ON TABLE public.token_deployments TO authenticated;
GRANT ALL ON TABLE public.token_deployments TO service_role;
GRANT ALL ON TABLE public.token_deployments TO prisma;


--
-- Name: TABLE problematic_token_deployments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.problematic_token_deployments TO anon;
GRANT ALL ON TABLE public.problematic_token_deployments TO authenticated;
GRANT ALL ON TABLE public.problematic_token_deployments TO service_role;
GRANT ALL ON TABLE public.problematic_token_deployments TO prisma;


--
-- Name: TABLE product_lifecycle_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.product_lifecycle_events TO anon;
GRANT ALL ON TABLE public.product_lifecycle_events TO authenticated;
GRANT ALL ON TABLE public.product_lifecycle_events TO service_role;
GRANT ALL ON TABLE public.product_lifecycle_events TO prisma;


--
-- Name: TABLE production_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.production_data TO anon;
GRANT ALL ON TABLE public.production_data TO authenticated;
GRANT ALL ON TABLE public.production_data TO service_role;
GRANT ALL ON TABLE public.production_data TO prisma;


--
-- Name: TABLE profiles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.profiles TO anon;
GRANT ALL ON TABLE public.profiles TO authenticated;
GRANT ALL ON TABLE public.profiles TO service_role;
GRANT ALL ON TABLE public.profiles TO prisma;


--
-- Name: TABLE project_organization_assignments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.project_organization_assignments TO anon;
GRANT ALL ON TABLE public.project_organization_assignments TO authenticated;
GRANT ALL ON TABLE public.project_organization_assignments TO service_role;
GRANT ALL ON TABLE public.project_organization_assignments TO prisma;


--
-- Name: TABLE projects; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.projects TO anon;
GRANT ALL ON TABLE public.projects TO authenticated;
GRANT ALL ON TABLE public.projects TO service_role;
GRANT ALL ON TABLE public.projects TO prisma;


--
-- Name: TABLE project_type_stats; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.project_type_stats TO anon;
GRANT ALL ON TABLE public.project_type_stats TO authenticated;
GRANT ALL ON TABLE public.project_type_stats TO service_role;
GRANT ALL ON TABLE public.project_type_stats TO prisma;


--
-- Name: TABLE project_wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.project_wallets TO anon;
GRANT ALL ON TABLE public.project_wallets TO authenticated;
GRANT ALL ON TABLE public.project_wallets TO service_role;
GRANT ALL ON TABLE public.project_wallets TO prisma;


--
-- Name: TABLE property_expenses; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.property_expenses TO anon;
GRANT ALL ON TABLE public.property_expenses TO authenticated;
GRANT ALL ON TABLE public.property_expenses TO service_role;
GRANT ALL ON TABLE public.property_expenses TO prisma;


--
-- Name: TABLE property_insurance; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.property_insurance TO anon;
GRANT ALL ON TABLE public.property_insurance TO authenticated;
GRANT ALL ON TABLE public.property_insurance TO service_role;
GRANT ALL ON TABLE public.property_insurance TO prisma;


--
-- Name: TABLE property_tax_rates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.property_tax_rates TO anon;
GRANT ALL ON TABLE public.property_tax_rates TO authenticated;
GRANT ALL ON TABLE public.property_tax_rates TO service_role;
GRANT ALL ON TABLE public.property_tax_rates TO prisma;


--
-- Name: TABLE property_valuations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.property_valuations TO anon;
GRANT ALL ON TABLE public.property_valuations TO authenticated;
GRANT ALL ON TABLE public.property_valuations TO service_role;
GRANT ALL ON TABLE public.property_valuations TO prisma;


--
-- Name: TABLE proposal_signatures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.proposal_signatures TO anon;
GRANT ALL ON TABLE public.proposal_signatures TO authenticated;
GRANT ALL ON TABLE public.proposal_signatures TO service_role;
GRANT ALL ON TABLE public.proposal_signatures TO prisma;


--
-- Name: TABLE provider; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.provider TO anon;
GRANT ALL ON TABLE public.provider TO authenticated;
GRANT ALL ON TABLE public.provider TO service_role;
GRANT ALL ON TABLE public.provider TO prisma;


--
-- Name: SEQUENCE provider_provider_id_seq; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON SEQUENCE public.provider_provider_id_seq TO anon;
GRANT ALL ON SEQUENCE public.provider_provider_id_seq TO authenticated;
GRANT ALL ON SEQUENCE public.provider_provider_id_seq TO service_role;
GRANT ALL ON SEQUENCE public.provider_provider_id_seq TO prisma;


--
-- Name: TABLE proxy_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.proxy_approvals TO anon;
GRANT ALL ON TABLE public.proxy_approvals TO authenticated;
GRANT ALL ON TABLE public.proxy_approvals TO service_role;
GRANT ALL ON TABLE public.proxy_approvals TO prisma;


--
-- Name: TABLE psp_api_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_api_keys TO anon;
GRANT ALL ON TABLE public.psp_api_keys TO authenticated;
GRANT ALL ON TABLE public.psp_api_keys TO service_role;
GRANT ALL ON TABLE public.psp_api_keys TO prisma;


--
-- Name: TABLE psp_balances; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_balances TO anon;
GRANT ALL ON TABLE public.psp_balances TO authenticated;
GRANT ALL ON TABLE public.psp_balances TO service_role;
GRANT ALL ON TABLE public.psp_balances TO prisma;


--
-- Name: TABLE psp_external_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_external_accounts TO anon;
GRANT ALL ON TABLE public.psp_external_accounts TO authenticated;
GRANT ALL ON TABLE public.psp_external_accounts TO service_role;
GRANT ALL ON TABLE public.psp_external_accounts TO prisma;


--
-- Name: TABLE psp_fiat_crypto_spreads; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_fiat_crypto_spreads TO anon;
GRANT ALL ON TABLE public.psp_fiat_crypto_spreads TO authenticated;
GRANT ALL ON TABLE public.psp_fiat_crypto_spreads TO service_role;
GRANT ALL ON TABLE public.psp_fiat_crypto_spreads TO prisma;


--
-- Name: TABLE psp_identity_cases; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_identity_cases TO anon;
GRANT ALL ON TABLE public.psp_identity_cases TO authenticated;
GRANT ALL ON TABLE public.psp_identity_cases TO service_role;
GRANT ALL ON TABLE public.psp_identity_cases TO prisma;


--
-- Name: TABLE psp_payment_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_payment_settings TO anon;
GRANT ALL ON TABLE public.psp_payment_settings TO authenticated;
GRANT ALL ON TABLE public.psp_payment_settings TO service_role;
GRANT ALL ON TABLE public.psp_payment_settings TO prisma;


--
-- Name: TABLE psp_payments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_payments TO anon;
GRANT ALL ON TABLE public.psp_payments TO authenticated;
GRANT ALL ON TABLE public.psp_payments TO service_role;
GRANT ALL ON TABLE public.psp_payments TO prisma;


--
-- Name: TABLE psp_trades; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_trades TO anon;
GRANT ALL ON TABLE public.psp_trades TO authenticated;
GRANT ALL ON TABLE public.psp_trades TO service_role;
GRANT ALL ON TABLE public.psp_trades TO prisma;


--
-- Name: TABLE psp_virtual_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_virtual_accounts TO anon;
GRANT ALL ON TABLE public.psp_virtual_accounts TO authenticated;
GRANT ALL ON TABLE public.psp_virtual_accounts TO service_role;
GRANT ALL ON TABLE public.psp_virtual_accounts TO prisma;


--
-- Name: TABLE psp_webhook_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_webhook_events TO anon;
GRANT ALL ON TABLE public.psp_webhook_events TO authenticated;
GRANT ALL ON TABLE public.psp_webhook_events TO service_role;
GRANT ALL ON TABLE public.psp_webhook_events TO prisma;


--
-- Name: TABLE psp_webhooks; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.psp_webhooks TO anon;
GRANT ALL ON TABLE public.psp_webhooks TO authenticated;
GRANT ALL ON TABLE public.psp_webhooks TO service_role;
GRANT ALL ON TABLE public.psp_webhooks TO prisma;


--
-- Name: TABLE quant_backtests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quant_backtests TO anon;
GRANT ALL ON TABLE public.quant_backtests TO authenticated;
GRANT ALL ON TABLE public.quant_backtests TO service_role;
GRANT ALL ON TABLE public.quant_backtests TO prisma;


--
-- Name: TABLE quant_factors; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quant_factors TO anon;
GRANT ALL ON TABLE public.quant_factors TO authenticated;
GRANT ALL ON TABLE public.quant_factors TO service_role;
GRANT ALL ON TABLE public.quant_factors TO prisma;


--
-- Name: TABLE quant_performance_attribution; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quant_performance_attribution TO anon;
GRANT ALL ON TABLE public.quant_performance_attribution TO authenticated;
GRANT ALL ON TABLE public.quant_performance_attribution TO service_role;
GRANT ALL ON TABLE public.quant_performance_attribution TO prisma;


--
-- Name: TABLE quant_risk_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quant_risk_metrics TO anon;
GRANT ALL ON TABLE public.quant_risk_metrics TO authenticated;
GRANT ALL ON TABLE public.quant_risk_metrics TO service_role;
GRANT ALL ON TABLE public.quant_risk_metrics TO prisma;


--
-- Name: TABLE quant_signals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quant_signals TO anon;
GRANT ALL ON TABLE public.quant_signals TO authenticated;
GRANT ALL ON TABLE public.quant_signals TO service_role;
GRANT ALL ON TABLE public.quant_signals TO prisma;


--
-- Name: TABLE quantitative_investment_strategies_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quantitative_investment_strategies_products TO anon;
GRANT ALL ON TABLE public.quantitative_investment_strategies_products TO authenticated;
GRANT ALL ON TABLE public.quantitative_investment_strategies_products TO service_role;
GRANT ALL ON TABLE public.quantitative_investment_strategies_products TO prisma;


--
-- Name: TABLE quantitative_strategies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.quantitative_strategies TO anon;
GRANT ALL ON TABLE public.quantitative_strategies TO authenticated;
GRANT ALL ON TABLE public.quantitative_strategies TO service_role;
GRANT ALL ON TABLE public.quantitative_strategies TO prisma;


--
-- Name: TABLE ramp_network_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ramp_network_config TO anon;
GRANT ALL ON TABLE public.ramp_network_config TO authenticated;
GRANT ALL ON TABLE public.ramp_network_config TO service_role;
GRANT ALL ON TABLE public.ramp_network_config TO prisma;


--
-- Name: TABLE ramp_supported_assets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ramp_supported_assets TO anon;
GRANT ALL ON TABLE public.ramp_supported_assets TO authenticated;
GRANT ALL ON TABLE public.ramp_supported_assets TO service_role;
GRANT ALL ON TABLE public.ramp_supported_assets TO prisma;


--
-- Name: TABLE ramp_transaction_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ramp_transaction_events TO anon;
GRANT ALL ON TABLE public.ramp_transaction_events TO authenticated;
GRANT ALL ON TABLE public.ramp_transaction_events TO service_role;
GRANT ALL ON TABLE public.ramp_transaction_events TO prisma;


--
-- Name: TABLE ramp_webhook_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ramp_webhook_events TO anon;
GRANT ALL ON TABLE public.ramp_webhook_events TO authenticated;
GRANT ALL ON TABLE public.ramp_webhook_events TO service_role;
GRANT ALL ON TABLE public.ramp_webhook_events TO prisma;


--
-- Name: TABLE real_estate_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.real_estate_products TO anon;
GRANT ALL ON TABLE public.real_estate_products TO authenticated;
GRANT ALL ON TABLE public.real_estate_products TO service_role;
GRANT ALL ON TABLE public.real_estate_products TO prisma;


--
-- Name: TABLE rec_price_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.rec_price_cache TO anon;
GRANT ALL ON TABLE public.rec_price_cache TO authenticated;
GRANT ALL ON TABLE public.rec_price_cache TO service_role;
GRANT ALL ON TABLE public.rec_price_cache TO prisma;


--
-- Name: TABLE recent_address_selections; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.recent_address_selections TO anon;
GRANT ALL ON TABLE public.recent_address_selections TO authenticated;
GRANT ALL ON TABLE public.recent_address_selections TO service_role;
GRANT ALL ON TABLE public.recent_address_selections TO prisma;


--
-- Name: TABLE redemption_analytics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_analytics TO anon;
GRANT ALL ON TABLE public.redemption_analytics TO authenticated;
GRANT ALL ON TABLE public.redemption_analytics TO service_role;
GRANT ALL ON TABLE public.redemption_analytics TO prisma;


--
-- Name: TABLE redemption_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_approvers TO anon;
GRANT ALL ON TABLE public.redemption_approvers TO authenticated;
GRANT ALL ON TABLE public.redemption_approvers TO service_role;
GRANT ALL ON TABLE public.redemption_approvers TO prisma;


--
-- Name: TABLE redemption_notifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_notifications TO anon;
GRANT ALL ON TABLE public.redemption_notifications TO authenticated;
GRANT ALL ON TABLE public.redemption_notifications TO service_role;
GRANT ALL ON TABLE public.redemption_notifications TO prisma;


--
-- Name: TABLE redemption_requests; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_requests TO anon;
GRANT ALL ON TABLE public.redemption_requests TO authenticated;
GRANT ALL ON TABLE public.redemption_requests TO service_role;
GRANT ALL ON TABLE public.redemption_requests TO prisma;


--
-- Name: TABLE stablecoin_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stablecoin_products TO anon;
GRANT ALL ON TABLE public.stablecoin_products TO authenticated;
GRANT ALL ON TABLE public.stablecoin_products TO service_role;
GRANT ALL ON TABLE public.stablecoin_products TO prisma;


--
-- Name: TABLE structured_products; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.structured_products TO anon;
GRANT ALL ON TABLE public.structured_products TO authenticated;
GRANT ALL ON TABLE public.structured_products TO service_role;
GRANT ALL ON TABLE public.structured_products TO prisma;


--
-- Name: TABLE redemption_rules_with_product_details; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_rules_with_product_details TO anon;
GRANT ALL ON TABLE public.redemption_rules_with_product_details TO authenticated;
GRANT ALL ON TABLE public.redemption_rules_with_product_details TO service_role;
GRANT ALL ON TABLE public.redemption_rules_with_product_details TO prisma;


--
-- Name: TABLE redemption_settlements; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_settlements TO anon;
GRANT ALL ON TABLE public.redemption_settlements TO authenticated;
GRANT ALL ON TABLE public.redemption_settlements TO service_role;
GRANT ALL ON TABLE public.redemption_settlements TO prisma;


--
-- Name: TABLE redemption_system_health; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_system_health TO anon;
GRANT ALL ON TABLE public.redemption_system_health TO authenticated;
GRANT ALL ON TABLE public.redemption_system_health TO service_role;
GRANT ALL ON TABLE public.redemption_system_health TO prisma;


--
-- Name: TABLE redemption_window_templates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_window_templates TO anon;
GRANT ALL ON TABLE public.redemption_window_templates TO authenticated;
GRANT ALL ON TABLE public.redemption_window_templates TO service_role;
GRANT ALL ON TABLE public.redemption_window_templates TO prisma;


--
-- Name: TABLE redemption_windows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.redemption_windows TO anon;
GRANT ALL ON TABLE public.redemption_windows TO authenticated;
GRANT ALL ON TABLE public.redemption_windows TO service_role;
GRANT ALL ON TABLE public.redemption_windows TO prisma;


--
-- Name: TABLE regulatory_equivalence_mapping; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.regulatory_equivalence_mapping TO anon;
GRANT ALL ON TABLE public.regulatory_equivalence_mapping TO authenticated;
GRANT ALL ON TABLE public.regulatory_equivalence_mapping TO service_role;
GRANT ALL ON TABLE public.regulatory_equivalence_mapping TO prisma;


--
-- Name: TABLE regulatory_exemptions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.regulatory_exemptions TO anon;
GRANT ALL ON TABLE public.regulatory_exemptions TO authenticated;
GRANT ALL ON TABLE public.regulatory_exemptions TO service_role;
GRANT ALL ON TABLE public.regulatory_exemptions TO prisma;


--
-- Name: TABLE regulatory_registrations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.regulatory_registrations TO anon;
GRANT ALL ON TABLE public.regulatory_registrations TO authenticated;
GRANT ALL ON TABLE public.regulatory_registrations TO service_role;
GRANT ALL ON TABLE public.regulatory_registrations TO prisma;


--
-- Name: TABLE regulatory_reports; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.regulatory_reports TO anon;
GRANT ALL ON TABLE public.regulatory_reports TO authenticated;
GRANT ALL ON TABLE public.regulatory_reports TO service_role;
GRANT ALL ON TABLE public.regulatory_reports TO prisma;


--
-- Name: TABLE remediation_actions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.remediation_actions TO anon;
GRANT ALL ON TABLE public.remediation_actions TO authenticated;
GRANT ALL ON TABLE public.remediation_actions TO service_role;
GRANT ALL ON TABLE public.remediation_actions TO prisma;


--
-- Name: TABLE renewable_energy_credits; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.renewable_energy_credits TO anon;
GRANT ALL ON TABLE public.renewable_energy_credits TO authenticated;
GRANT ALL ON TABLE public.renewable_energy_credits TO service_role;
GRANT ALL ON TABLE public.renewable_energy_credits TO prisma;


--
-- Name: TABLE restriction_statistics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.restriction_statistics TO anon;
GRANT ALL ON TABLE public.restriction_statistics TO authenticated;
GRANT ALL ON TABLE public.restriction_statistics TO service_role;
GRANT ALL ON TABLE public.restriction_statistics TO prisma;


--
-- Name: TABLE restriction_validation_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.restriction_validation_logs TO anon;
GRANT ALL ON TABLE public.restriction_validation_logs TO authenticated;
GRANT ALL ON TABLE public.restriction_validation_logs TO service_role;
GRANT ALL ON TABLE public.restriction_validation_logs TO prisma;


--
-- Name: TABLE ripple_dex_orders; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_dex_orders TO anon;
GRANT ALL ON TABLE public.ripple_dex_orders TO authenticated;
GRANT ALL ON TABLE public.ripple_dex_orders TO service_role;
GRANT ALL ON TABLE public.ripple_dex_orders TO prisma;


--
-- Name: TABLE ripple_escrows; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_escrows TO anon;
GRANT ALL ON TABLE public.ripple_escrows TO authenticated;
GRANT ALL ON TABLE public.ripple_escrows TO service_role;
GRANT ALL ON TABLE public.ripple_escrows TO prisma;


--
-- Name: TABLE ripple_issuers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_issuers TO anon;
GRANT ALL ON TABLE public.ripple_issuers TO authenticated;
GRANT ALL ON TABLE public.ripple_issuers TO service_role;
GRANT ALL ON TABLE public.ripple_issuers TO prisma;


--
-- Name: TABLE ripple_multisig_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_multisig_accounts TO anon;
GRANT ALL ON TABLE public.ripple_multisig_accounts TO authenticated;
GRANT ALL ON TABLE public.ripple_multisig_accounts TO service_role;
GRANT ALL ON TABLE public.ripple_multisig_accounts TO prisma;


--
-- Name: TABLE ripple_multisig_proposals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_multisig_proposals TO anon;
GRANT ALL ON TABLE public.ripple_multisig_proposals TO authenticated;
GRANT ALL ON TABLE public.ripple_multisig_proposals TO service_role;
GRANT ALL ON TABLE public.ripple_multisig_proposals TO prisma;


--
-- Name: TABLE ripple_payments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_payments TO anon;
GRANT ALL ON TABLE public.ripple_payments TO authenticated;
GRANT ALL ON TABLE public.ripple_payments TO service_role;
GRANT ALL ON TABLE public.ripple_payments TO prisma;


--
-- Name: TABLE ripple_tokens; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_tokens TO anon;
GRANT ALL ON TABLE public.ripple_tokens TO authenticated;
GRANT ALL ON TABLE public.ripple_tokens TO service_role;
GRANT ALL ON TABLE public.ripple_tokens TO prisma;


--
-- Name: TABLE ripple_trust_lines; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.ripple_trust_lines TO anon;
GRANT ALL ON TABLE public.ripple_trust_lines TO authenticated;
GRANT ALL ON TABLE public.ripple_trust_lines TO service_role;
GRANT ALL ON TABLE public.ripple_trust_lines TO prisma;


--
-- Name: TABLE risk_assessments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.risk_assessments TO anon;
GRANT ALL ON TABLE public.risk_assessments TO authenticated;
GRANT ALL ON TABLE public.risk_assessments TO service_role;
GRANT ALL ON TABLE public.risk_assessments TO prisma;


--
-- Name: TABLE risk_thresholds; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.risk_thresholds TO anon;
GRANT ALL ON TABLE public.risk_thresholds TO authenticated;
GRANT ALL ON TABLE public.risk_thresholds TO service_role;
GRANT ALL ON TABLE public.risk_thresholds TO prisma;


--
-- Name: TABLE role_contracts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.role_contracts TO anon;
GRANT ALL ON TABLE public.role_contracts TO authenticated;
GRANT ALL ON TABLE public.role_contracts TO service_role;
GRANT ALL ON TABLE public.role_contracts TO prisma;


--
-- Name: TABLE role_addresses_with_resolved_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.role_addresses_with_resolved_roles TO anon;
GRANT ALL ON TABLE public.role_addresses_with_resolved_roles TO authenticated;
GRANT ALL ON TABLE public.role_addresses_with_resolved_roles TO service_role;
GRANT ALL ON TABLE public.role_addresses_with_resolved_roles TO prisma;


--
-- Name: TABLE role_permissions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.role_permissions TO anon;
GRANT ALL ON TABLE public.role_permissions TO authenticated;
GRANT ALL ON TABLE public.role_permissions TO service_role;
GRANT ALL ON TABLE public.role_permissions TO prisma;


--
-- Name: TABLE rule_conflicts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.rule_conflicts TO anon;
GRANT ALL ON TABLE public.rule_conflicts TO authenticated;
GRANT ALL ON TABLE public.rule_conflicts TO service_role;
GRANT ALL ON TABLE public.rule_conflicts TO prisma;


--
-- Name: TABLE rule_evaluations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.rule_evaluations TO anon;
GRANT ALL ON TABLE public.rule_evaluations TO authenticated;
GRANT ALL ON TABLE public.rule_evaluations TO service_role;
GRANT ALL ON TABLE public.rule_evaluations TO prisma;


--
-- Name: TABLE rules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.rules TO anon;
GRANT ALL ON TABLE public.rules TO authenticated;
GRANT ALL ON TABLE public.rules TO service_role;
GRANT ALL ON TABLE public.rules TO prisma;


--
-- Name: TABLE sc_algorithm_parameters; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sc_algorithm_parameters TO anon;
GRANT ALL ON TABLE public.sc_algorithm_parameters TO authenticated;
GRANT ALL ON TABLE public.sc_algorithm_parameters TO service_role;
GRANT ALL ON TABLE public.sc_algorithm_parameters TO prisma;


--
-- Name: TABLE sc_minting_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sc_minting_events TO anon;
GRANT ALL ON TABLE public.sc_minting_events TO authenticated;
GRANT ALL ON TABLE public.sc_minting_events TO service_role;
GRANT ALL ON TABLE public.sc_minting_events TO prisma;


--
-- Name: TABLE sc_peg_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sc_peg_history TO anon;
GRANT ALL ON TABLE public.sc_peg_history TO authenticated;
GRANT ALL ON TABLE public.sc_peg_history TO service_role;
GRANT ALL ON TABLE public.sc_peg_history TO prisma;


--
-- Name: TABLE sc_redemptions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sc_redemptions TO anon;
GRANT ALL ON TABLE public.sc_redemptions TO authenticated;
GRANT ALL ON TABLE public.sc_redemptions TO service_role;
GRANT ALL ON TABLE public.sc_redemptions TO prisma;


--
-- Name: TABLE sc_reserve_audits; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sc_reserve_audits TO anon;
GRANT ALL ON TABLE public.sc_reserve_audits TO authenticated;
GRANT ALL ON TABLE public.sc_reserve_audits TO service_role;
GRANT ALL ON TABLE public.sc_reserve_audits TO prisma;


--
-- Name: TABLE security_audit_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.security_audit_logs TO anon;
GRANT ALL ON TABLE public.security_audit_logs TO authenticated;
GRANT ALL ON TABLE public.security_audit_logs TO service_role;
GRANT ALL ON TABLE public.security_audit_logs TO prisma;


--
-- Name: TABLE security_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.security_events TO anon;
GRANT ALL ON TABLE public.security_events TO authenticated;
GRANT ALL ON TABLE public.security_events TO service_role;
GRANT ALL ON TABLE public.security_events TO prisma;


--
-- Name: TABLE session_key_usage; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.session_key_usage TO anon;
GRANT ALL ON TABLE public.session_key_usage TO authenticated;
GRANT ALL ON TABLE public.session_key_usage TO service_role;
GRANT ALL ON TABLE public.session_key_usage TO prisma;


--
-- Name: TABLE session_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.session_keys TO anon;
GRANT ALL ON TABLE public.session_keys TO authenticated;
GRANT ALL ON TABLE public.session_keys TO service_role;
GRANT ALL ON TABLE public.session_keys TO prisma;


--
-- Name: TABLE settlement_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.settlement_metrics TO anon;
GRANT ALL ON TABLE public.settlement_metrics TO authenticated;
GRANT ALL ON TABLE public.settlement_metrics TO service_role;
GRANT ALL ON TABLE public.settlement_metrics TO prisma;


--
-- Name: TABLE settlement_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.settlement_operations TO anon;
GRANT ALL ON TABLE public.settlement_operations TO authenticated;
GRANT ALL ON TABLE public.settlement_operations TO service_role;
GRANT ALL ON TABLE public.settlement_operations TO prisma;


--
-- Name: TABLE settlement_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.settlement_summary TO anon;
GRANT ALL ON TABLE public.settlement_summary TO authenticated;
GRANT ALL ON TABLE public.settlement_summary TO service_role;
GRANT ALL ON TABLE public.settlement_summary TO prisma;


--
-- Name: TABLE sidebar_configurations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sidebar_configurations TO anon;
GRANT ALL ON TABLE public.sidebar_configurations TO authenticated;
GRANT ALL ON TABLE public.sidebar_configurations TO service_role;
GRANT ALL ON TABLE public.sidebar_configurations TO prisma;


--
-- Name: TABLE sidebar_configurations_with_names; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sidebar_configurations_with_names TO anon;
GRANT ALL ON TABLE public.sidebar_configurations_with_names TO authenticated;
GRANT ALL ON TABLE public.sidebar_configurations_with_names TO service_role;
GRANT ALL ON TABLE public.sidebar_configurations_with_names TO prisma;


--
-- Name: TABLE sidebar_items; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sidebar_items TO anon;
GRANT ALL ON TABLE public.sidebar_items TO authenticated;
GRANT ALL ON TABLE public.sidebar_items TO service_role;
GRANT ALL ON TABLE public.sidebar_items TO prisma;


--
-- Name: TABLE sidebar_sections; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sidebar_sections TO anon;
GRANT ALL ON TABLE public.sidebar_sections TO authenticated;
GRANT ALL ON TABLE public.sidebar_sections TO service_role;
GRANT ALL ON TABLE public.sidebar_sections TO prisma;


--
-- Name: TABLE signature_migration_approvals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.signature_migration_approvals TO anon;
GRANT ALL ON TABLE public.signature_migration_approvals TO authenticated;
GRANT ALL ON TABLE public.signature_migration_approvals TO service_role;
GRANT ALL ON TABLE public.signature_migration_approvals TO prisma;


--
-- Name: TABLE signature_migrations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.signature_migrations TO anon;
GRANT ALL ON TABLE public.signature_migrations TO authenticated;
GRANT ALL ON TABLE public.signature_migrations TO service_role;
GRANT ALL ON TABLE public.signature_migrations TO prisma;


--
-- Name: TABLE signatures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.signatures TO anon;
GRANT ALL ON TABLE public.signatures TO authenticated;
GRANT ALL ON TABLE public.signatures TO service_role;
GRANT ALL ON TABLE public.signatures TO prisma;


--
-- Name: TABLE signer_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.signer_keys TO anon;
GRANT ALL ON TABLE public.signer_keys TO authenticated;
GRANT ALL ON TABLE public.signer_keys TO service_role;
GRANT ALL ON TABLE public.signer_keys TO prisma;


--
-- Name: TABLE smart_contract_wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.smart_contract_wallets TO anon;
GRANT ALL ON TABLE public.smart_contract_wallets TO authenticated;
GRANT ALL ON TABLE public.smart_contract_wallets TO service_role;
GRANT ALL ON TABLE public.smart_contract_wallets TO prisma;


--
-- Name: TABLE sp_barrier_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_barrier_events TO anon;
GRANT ALL ON TABLE public.sp_barrier_events TO authenticated;
GRANT ALL ON TABLE public.sp_barrier_events TO service_role;
GRANT ALL ON TABLE public.sp_barrier_events TO prisma;


--
-- Name: TABLE sp_components; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_components TO anon;
GRANT ALL ON TABLE public.sp_components TO authenticated;
GRANT ALL ON TABLE public.sp_components TO service_role;
GRANT ALL ON TABLE public.sp_components TO prisma;


--
-- Name: TABLE sp_coupon_schedules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_coupon_schedules TO anon;
GRANT ALL ON TABLE public.sp_coupon_schedules TO authenticated;
GRANT ALL ON TABLE public.sp_coupon_schedules TO service_role;
GRANT ALL ON TABLE public.sp_coupon_schedules TO prisma;


--
-- Name: TABLE sp_payoff_structures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_payoff_structures TO anon;
GRANT ALL ON TABLE public.sp_payoff_structures TO authenticated;
GRANT ALL ON TABLE public.sp_payoff_structures TO service_role;
GRANT ALL ON TABLE public.sp_payoff_structures TO prisma;


--
-- Name: TABLE sp_performance_tracking; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_performance_tracking TO anon;
GRANT ALL ON TABLE public.sp_performance_tracking TO authenticated;
GRANT ALL ON TABLE public.sp_performance_tracking TO service_role;
GRANT ALL ON TABLE public.sp_performance_tracking TO prisma;


--
-- Name: TABLE sp_redemption_features; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.sp_redemption_features TO anon;
GRANT ALL ON TABLE public.sp_redemption_features TO authenticated;
GRANT ALL ON TABLE public.sp_redemption_features TO service_role;
GRANT ALL ON TABLE public.sp_redemption_features TO prisma;


--
-- Name: TABLE stablecoin_collateral; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stablecoin_collateral TO anon;
GRANT ALL ON TABLE public.stablecoin_collateral TO authenticated;
GRANT ALL ON TABLE public.stablecoin_collateral TO service_role;
GRANT ALL ON TABLE public.stablecoin_collateral TO prisma;


--
-- Name: TABLE stage_requirements; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stage_requirements TO anon;
GRANT ALL ON TABLE public.stage_requirements TO authenticated;
GRANT ALL ON TABLE public.stage_requirements TO service_role;
GRANT ALL ON TABLE public.stage_requirements TO prisma;


--
-- Name: TABLE staking_apr_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.staking_apr_config TO anon;
GRANT ALL ON TABLE public.staking_apr_config TO authenticated;
GRANT ALL ON TABLE public.staking_apr_config TO service_role;
GRANT ALL ON TABLE public.staking_apr_config TO prisma;


--
-- Name: TABLE stock_dividends; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stock_dividends TO anon;
GRANT ALL ON TABLE public.stock_dividends TO authenticated;
GRANT ALL ON TABLE public.stock_dividends TO service_role;
GRANT ALL ON TABLE public.stock_dividends TO prisma;


--
-- Name: TABLE stock_exchanges; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stock_exchanges TO anon;
GRANT ALL ON TABLE public.stock_exchanges TO authenticated;
GRANT ALL ON TABLE public.stock_exchanges TO service_role;
GRANT ALL ON TABLE public.stock_exchanges TO prisma;


--
-- Name: TABLE stripe_conversion_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stripe_conversion_transactions TO anon;
GRANT ALL ON TABLE public.stripe_conversion_transactions TO authenticated;
GRANT ALL ON TABLE public.stripe_conversion_transactions TO service_role;
GRANT ALL ON TABLE public.stripe_conversion_transactions TO prisma;


--
-- Name: TABLE stripe_stablecoin_accounts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stripe_stablecoin_accounts TO anon;
GRANT ALL ON TABLE public.stripe_stablecoin_accounts TO authenticated;
GRANT ALL ON TABLE public.stripe_stablecoin_accounts TO service_role;
GRANT ALL ON TABLE public.stripe_stablecoin_accounts TO prisma;


--
-- Name: TABLE stripe_webhook_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.stripe_webhook_events TO anon;
GRANT ALL ON TABLE public.stripe_webhook_events TO authenticated;
GRANT ALL ON TABLE public.stripe_webhook_events TO service_role;
GRANT ALL ON TABLE public.stripe_webhook_events TO prisma;


--
-- Name: TABLE suspicious_activity_reports; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.suspicious_activity_reports TO anon;
GRANT ALL ON TABLE public.suspicious_activity_reports TO authenticated;
GRANT ALL ON TABLE public.suspicious_activity_reports TO service_role;
GRANT ALL ON TABLE public.suspicious_activity_reports TO prisma;


--
-- Name: TABLE wallet_access_logs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_access_logs TO anon;
GRANT ALL ON TABLE public.wallet_access_logs TO authenticated;
GRANT ALL ON TABLE public.wallet_access_logs TO service_role;
GRANT ALL ON TABLE public.wallet_access_logs TO prisma;


--
-- Name: TABLE suspicious_wallet_activity; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.suspicious_wallet_activity TO anon;
GRANT ALL ON TABLE public.suspicious_wallet_activity TO authenticated;
GRANT ALL ON TABLE public.suspicious_wallet_activity TO service_role;
GRANT ALL ON TABLE public.suspicious_wallet_activity TO prisma;


--
-- Name: TABLE system_processes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.system_processes TO anon;
GRANT ALL ON TABLE public.system_processes TO authenticated;
GRANT ALL ON TABLE public.system_processes TO service_role;
GRANT ALL ON TABLE public.system_processes TO prisma;


--
-- Name: TABLE system_process_activities; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.system_process_activities TO anon;
GRANT ALL ON TABLE public.system_process_activities TO authenticated;
GRANT ALL ON TABLE public.system_process_activities TO service_role;
GRANT ALL ON TABLE public.system_process_activities TO prisma;


--
-- Name: TABLE system_process_activity; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.system_process_activity TO anon;
GRANT ALL ON TABLE public.system_process_activity TO authenticated;
GRANT ALL ON TABLE public.system_process_activity TO service_role;
GRANT ALL ON TABLE public.system_process_activity TO prisma;


--
-- Name: TABLE system_process_performance; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.system_process_performance TO anon;
GRANT ALL ON TABLE public.system_process_performance TO authenticated;
GRANT ALL ON TABLE public.system_process_performance TO service_role;
GRANT ALL ON TABLE public.system_process_performance TO prisma;


--
-- Name: TABLE system_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.system_settings TO anon;
GRANT ALL ON TABLE public.system_settings TO authenticated;
GRANT ALL ON TABLE public.system_settings TO service_role;
GRANT ALL ON TABLE public.system_settings TO prisma;


--
-- Name: TABLE threshold_breaches; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.threshold_breaches TO anon;
GRANT ALL ON TABLE public.threshold_breaches TO authenticated;
GRANT ALL ON TABLE public.threshold_breaches TO service_role;
GRANT ALL ON TABLE public.threshold_breaches TO prisma;


--
-- Name: TABLE token_allocations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_allocations TO anon;
GRANT ALL ON TABLE public.token_allocations TO authenticated;
GRANT ALL ON TABLE public.token_allocations TO service_role;
GRANT ALL ON TABLE public.token_allocations TO prisma;


--
-- Name: TABLE token_deployment_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_deployment_history TO anon;
GRANT ALL ON TABLE public.token_deployment_history TO authenticated;
GRANT ALL ON TABLE public.token_deployment_history TO service_role;
GRANT ALL ON TABLE public.token_deployment_history TO prisma;


--
-- Name: TABLE token_deployment_verifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_deployment_verifications TO anon;
GRANT ALL ON TABLE public.token_deployment_verifications TO authenticated;
GRANT ALL ON TABLE public.token_deployment_verifications TO service_role;
GRANT ALL ON TABLE public.token_deployment_verifications TO prisma;


--
-- Name: TABLE token_designs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_designs TO anon;
GRANT ALL ON TABLE public.token_designs TO authenticated;
GRANT ALL ON TABLE public.token_designs TO service_role;
GRANT ALL ON TABLE public.token_designs TO prisma;


--
-- Name: TABLE token_erc1155_balances; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_balances TO anon;
GRANT ALL ON TABLE public.token_erc1155_balances TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_balances TO service_role;
GRANT ALL ON TABLE public.token_erc1155_balances TO prisma;


--
-- Name: TABLE token_erc1155_crafting_recipes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_crafting_recipes TO anon;
GRANT ALL ON TABLE public.token_erc1155_crafting_recipes TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_crafting_recipes TO service_role;
GRANT ALL ON TABLE public.token_erc1155_crafting_recipes TO prisma;


--
-- Name: TABLE token_erc1155_discount_tiers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_discount_tiers TO anon;
GRANT ALL ON TABLE public.token_erc1155_discount_tiers TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_discount_tiers TO service_role;
GRANT ALL ON TABLE public.token_erc1155_discount_tiers TO prisma;


--
-- Name: TABLE token_erc1155_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_properties TO anon;
GRANT ALL ON TABLE public.token_erc1155_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_properties TO service_role;
GRANT ALL ON TABLE public.token_erc1155_properties TO prisma;


--
-- Name: TABLE token_erc1155_type_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_type_configs TO anon;
GRANT ALL ON TABLE public.token_erc1155_type_configs TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_type_configs TO service_role;
GRANT ALL ON TABLE public.token_erc1155_type_configs TO prisma;


--
-- Name: TABLE token_erc1155_types; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_types TO anon;
GRANT ALL ON TABLE public.token_erc1155_types TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_types TO service_role;
GRANT ALL ON TABLE public.token_erc1155_types TO prisma;


--
-- Name: TABLE token_erc1155_uri_mappings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_uri_mappings TO anon;
GRANT ALL ON TABLE public.token_erc1155_uri_mappings TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_uri_mappings TO service_role;
GRANT ALL ON TABLE public.token_erc1155_uri_mappings TO prisma;


--
-- Name: TABLE token_erc1155_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1155_view TO anon;
GRANT ALL ON TABLE public.token_erc1155_view TO authenticated;
GRANT ALL ON TABLE public.token_erc1155_view TO service_role;
GRANT ALL ON TABLE public.token_erc1155_view TO prisma;


--
-- Name: TABLE token_erc1400_controllers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_controllers TO anon;
GRANT ALL ON TABLE public.token_erc1400_controllers TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_controllers TO service_role;
GRANT ALL ON TABLE public.token_erc1400_controllers TO prisma;


--
-- Name: TABLE token_erc1400_documents; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_documents TO anon;
GRANT ALL ON TABLE public.token_erc1400_documents TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_documents TO service_role;
GRANT ALL ON TABLE public.token_erc1400_documents TO prisma;


--
-- Name: TABLE token_erc1400_partition_balances; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_partition_balances TO anon;
GRANT ALL ON TABLE public.token_erc1400_partition_balances TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_partition_balances TO service_role;
GRANT ALL ON TABLE public.token_erc1400_partition_balances TO prisma;


--
-- Name: TABLE token_erc1400_partition_operators; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_partition_operators TO anon;
GRANT ALL ON TABLE public.token_erc1400_partition_operators TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_partition_operators TO service_role;
GRANT ALL ON TABLE public.token_erc1400_partition_operators TO prisma;


--
-- Name: TABLE token_erc1400_partition_transfers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_partition_transfers TO anon;
GRANT ALL ON TABLE public.token_erc1400_partition_transfers TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_partition_transfers TO service_role;
GRANT ALL ON TABLE public.token_erc1400_partition_transfers TO prisma;


--
-- Name: TABLE token_erc1400_partitions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_partitions TO anon;
GRANT ALL ON TABLE public.token_erc1400_partitions TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_partitions TO service_role;
GRANT ALL ON TABLE public.token_erc1400_partitions TO prisma;


--
-- Name: TABLE token_erc1400_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc1400_properties TO anon;
GRANT ALL ON TABLE public.token_erc1400_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc1400_properties TO service_role;
GRANT ALL ON TABLE public.token_erc1400_properties TO prisma;


--
-- Name: TABLE token_erc20_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc20_properties TO anon;
GRANT ALL ON TABLE public.token_erc20_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc20_properties TO service_role;
GRANT ALL ON TABLE public.token_erc20_properties TO prisma;


--
-- Name: TABLE token_erc20_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc20_view TO anon;
GRANT ALL ON TABLE public.token_erc20_view TO authenticated;
GRANT ALL ON TABLE public.token_erc20_view TO service_role;
GRANT ALL ON TABLE public.token_erc20_view TO prisma;


--
-- Name: TABLE token_erc3525_allocations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_allocations TO anon;
GRANT ALL ON TABLE public.token_erc3525_allocations TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_allocations TO service_role;
GRANT ALL ON TABLE public.token_erc3525_allocations TO prisma;


--
-- Name: TABLE token_erc3525_payment_schedules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_payment_schedules TO anon;
GRANT ALL ON TABLE public.token_erc3525_payment_schedules TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_payment_schedules TO service_role;
GRANT ALL ON TABLE public.token_erc3525_payment_schedules TO prisma;


--
-- Name: TABLE token_erc3525_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_properties TO anon;
GRANT ALL ON TABLE public.token_erc3525_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_properties TO service_role;
GRANT ALL ON TABLE public.token_erc3525_properties TO prisma;


--
-- Name: TABLE token_erc3525_slot_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_slot_configs TO anon;
GRANT ALL ON TABLE public.token_erc3525_slot_configs TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_slot_configs TO service_role;
GRANT ALL ON TABLE public.token_erc3525_slot_configs TO prisma;


--
-- Name: TABLE token_erc3525_slots; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_slots TO anon;
GRANT ALL ON TABLE public.token_erc3525_slots TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_slots TO service_role;
GRANT ALL ON TABLE public.token_erc3525_slots TO prisma;


--
-- Name: TABLE token_erc3525_value_adjustments; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_value_adjustments TO anon;
GRANT ALL ON TABLE public.token_erc3525_value_adjustments TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_value_adjustments TO service_role;
GRANT ALL ON TABLE public.token_erc3525_value_adjustments TO prisma;


--
-- Name: TABLE token_erc3525_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc3525_view TO anon;
GRANT ALL ON TABLE public.token_erc3525_view TO authenticated;
GRANT ALL ON TABLE public.token_erc3525_view TO service_role;
GRANT ALL ON TABLE public.token_erc3525_view TO prisma;


--
-- Name: TABLE token_erc4626_asset_allocations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_asset_allocations TO anon;
GRANT ALL ON TABLE public.token_erc4626_asset_allocations TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_asset_allocations TO service_role;
GRANT ALL ON TABLE public.token_erc4626_asset_allocations TO prisma;


--
-- Name: TABLE token_erc4626_fee_tiers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_fee_tiers TO anon;
GRANT ALL ON TABLE public.token_erc4626_fee_tiers TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_fee_tiers TO service_role;
GRANT ALL ON TABLE public.token_erc4626_fee_tiers TO prisma;


--
-- Name: TABLE token_erc4626_performance_metrics; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_performance_metrics TO anon;
GRANT ALL ON TABLE public.token_erc4626_performance_metrics TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_performance_metrics TO service_role;
GRANT ALL ON TABLE public.token_erc4626_performance_metrics TO prisma;


--
-- Name: TABLE token_erc4626_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_properties TO anon;
GRANT ALL ON TABLE public.token_erc4626_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_properties TO service_role;
GRANT ALL ON TABLE public.token_erc4626_properties TO prisma;


--
-- Name: TABLE token_erc4626_strategy_params; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_strategy_params TO anon;
GRANT ALL ON TABLE public.token_erc4626_strategy_params TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_strategy_params TO service_role;
GRANT ALL ON TABLE public.token_erc4626_strategy_params TO prisma;


--
-- Name: TABLE token_erc4626_vault_strategies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc4626_vault_strategies TO anon;
GRANT ALL ON TABLE public.token_erc4626_vault_strategies TO authenticated;
GRANT ALL ON TABLE public.token_erc4626_vault_strategies TO service_role;
GRANT ALL ON TABLE public.token_erc4626_vault_strategies TO prisma;


--
-- Name: TABLE token_erc721_attributes; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc721_attributes TO anon;
GRANT ALL ON TABLE public.token_erc721_attributes TO authenticated;
GRANT ALL ON TABLE public.token_erc721_attributes TO service_role;
GRANT ALL ON TABLE public.token_erc721_attributes TO prisma;


--
-- Name: TABLE token_erc721_mint_phases; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc721_mint_phases TO anon;
GRANT ALL ON TABLE public.token_erc721_mint_phases TO authenticated;
GRANT ALL ON TABLE public.token_erc721_mint_phases TO service_role;
GRANT ALL ON TABLE public.token_erc721_mint_phases TO prisma;


--
-- Name: TABLE token_erc721_properties; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc721_properties TO anon;
GRANT ALL ON TABLE public.token_erc721_properties TO authenticated;
GRANT ALL ON TABLE public.token_erc721_properties TO service_role;
GRANT ALL ON TABLE public.token_erc721_properties TO prisma;


--
-- Name: TABLE token_erc721_trait_definitions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc721_trait_definitions TO anon;
GRANT ALL ON TABLE public.token_erc721_trait_definitions TO authenticated;
GRANT ALL ON TABLE public.token_erc721_trait_definitions TO service_role;
GRANT ALL ON TABLE public.token_erc721_trait_definitions TO prisma;


--
-- Name: TABLE token_erc721_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_erc721_view TO anon;
GRANT ALL ON TABLE public.token_erc721_view TO authenticated;
GRANT ALL ON TABLE public.token_erc721_view TO service_role;
GRANT ALL ON TABLE public.token_erc721_view TO prisma;


--
-- Name: TABLE token_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_events TO anon;
GRANT ALL ON TABLE public.token_events TO authenticated;
GRANT ALL ON TABLE public.token_events TO service_role;
GRANT ALL ON TABLE public.token_events TO prisma;


--
-- Name: TABLE token_exchange_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_exchange_configs TO anon;
GRANT ALL ON TABLE public.token_exchange_configs TO authenticated;
GRANT ALL ON TABLE public.token_exchange_configs TO service_role;
GRANT ALL ON TABLE public.token_exchange_configs TO prisma;


--
-- Name: TABLE token_extensions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_extensions TO anon;
GRANT ALL ON TABLE public.token_extensions TO authenticated;
GRANT ALL ON TABLE public.token_extensions TO service_role;
GRANT ALL ON TABLE public.token_extensions TO prisma;


--
-- Name: TABLE token_geographic_restrictions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_geographic_restrictions TO anon;
GRANT ALL ON TABLE public.token_geographic_restrictions TO authenticated;
GRANT ALL ON TABLE public.token_geographic_restrictions TO service_role;
GRANT ALL ON TABLE public.token_geographic_restrictions TO prisma;


--
-- Name: TABLE token_geographic_restrictions_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_geographic_restrictions_view TO anon;
GRANT ALL ON TABLE public.token_geographic_restrictions_view TO authenticated;
GRANT ALL ON TABLE public.token_geographic_restrictions_view TO service_role;
GRANT ALL ON TABLE public.token_geographic_restrictions_view TO prisma;


--
-- Name: TABLE token_modules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_modules TO anon;
GRANT ALL ON TABLE public.token_modules TO authenticated;
GRANT ALL ON TABLE public.token_modules TO service_role;
GRANT ALL ON TABLE public.token_modules TO prisma;


--
-- Name: TABLE token_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_operations TO anon;
GRANT ALL ON TABLE public.token_operations TO authenticated;
GRANT ALL ON TABLE public.token_operations TO service_role;
GRANT ALL ON TABLE public.token_operations TO prisma;


--
-- Name: TABLE token_sanctions_rules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_sanctions_rules TO anon;
GRANT ALL ON TABLE public.token_sanctions_rules TO authenticated;
GRANT ALL ON TABLE public.token_sanctions_rules TO service_role;
GRANT ALL ON TABLE public.token_sanctions_rules TO prisma;


--
-- Name: TABLE token_templates; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_templates TO anon;
GRANT ALL ON TABLE public.token_templates TO authenticated;
GRANT ALL ON TABLE public.token_templates TO service_role;
GRANT ALL ON TABLE public.token_templates TO prisma;


--
-- Name: TABLE token_versions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_versions TO anon;
GRANT ALL ON TABLE public.token_versions TO authenticated;
GRANT ALL ON TABLE public.token_versions TO service_role;
GRANT ALL ON TABLE public.token_versions TO prisma;


--
-- Name: TABLE token_whitelists; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_whitelists TO anon;
GRANT ALL ON TABLE public.token_whitelists TO authenticated;
GRANT ALL ON TABLE public.token_whitelists TO service_role;
GRANT ALL ON TABLE public.token_whitelists TO prisma;


--
-- Name: TABLE token_whitelist_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.token_whitelist_summary TO anon;
GRANT ALL ON TABLE public.token_whitelist_summary TO authenticated;
GRANT ALL ON TABLE public.token_whitelist_summary TO service_role;
GRANT ALL ON TABLE public.token_whitelist_summary TO prisma;


--
-- Name: TABLE trade_finance_auction_executions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_auction_executions TO anon;
GRANT ALL ON TABLE public.trade_finance_auction_executions TO authenticated;
GRANT ALL ON TABLE public.trade_finance_auction_executions TO service_role;
GRANT ALL ON TABLE public.trade_finance_auction_executions TO prisma;


--
-- Name: TABLE trade_finance_authorized_claimers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_authorized_claimers TO anon;
GRANT ALL ON TABLE public.trade_finance_authorized_claimers TO authenticated;
GRANT ALL ON TABLE public.trade_finance_authorized_claimers TO service_role;
GRANT ALL ON TABLE public.trade_finance_authorized_claimers TO prisma;


--
-- Name: TABLE trade_finance_commodity_emission_configs; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_commodity_emission_configs TO anon;
GRANT ALL ON TABLE public.trade_finance_commodity_emission_configs TO authenticated;
GRANT ALL ON TABLE public.trade_finance_commodity_emission_configs TO service_role;
GRANT ALL ON TABLE public.trade_finance_commodity_emission_configs TO prisma;


--
-- Name: TABLE trade_finance_dutch_auctions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_dutch_auctions TO anon;
GRANT ALL ON TABLE public.trade_finance_dutch_auctions TO authenticated;
GRANT ALL ON TABLE public.trade_finance_dutch_auctions TO service_role;
GRANT ALL ON TABLE public.trade_finance_dutch_auctions TO prisma;


--
-- Name: TABLE trade_finance_emission_admins; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_emission_admins TO anon;
GRANT ALL ON TABLE public.trade_finance_emission_admins TO authenticated;
GRANT ALL ON TABLE public.trade_finance_emission_admins TO service_role;
GRANT ALL ON TABLE public.trade_finance_emission_admins TO prisma;


--
-- Name: TABLE trade_finance_fee_accumulations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_fee_accumulations TO anon;
GRANT ALL ON TABLE public.trade_finance_fee_accumulations TO authenticated;
GRANT ALL ON TABLE public.trade_finance_fee_accumulations TO service_role;
GRANT ALL ON TABLE public.trade_finance_fee_accumulations TO prisma;


--
-- Name: TABLE trade_finance_fee_collections; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_fee_collections TO anon;
GRANT ALL ON TABLE public.trade_finance_fee_collections TO authenticated;
GRANT ALL ON TABLE public.trade_finance_fee_collections TO service_role;
GRANT ALL ON TABLE public.trade_finance_fee_collections TO prisma;


--
-- Name: TABLE trade_finance_fee_distributions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_fee_distributions TO anon;
GRANT ALL ON TABLE public.trade_finance_fee_distributions TO authenticated;
GRANT ALL ON TABLE public.trade_finance_fee_distributions TO service_role;
GRANT ALL ON TABLE public.trade_finance_fee_distributions TO prisma;


--
-- Name: TABLE trade_finance_flash_liquidations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_flash_liquidations TO anon;
GRANT ALL ON TABLE public.trade_finance_flash_liquidations TO authenticated;
GRANT ALL ON TABLE public.trade_finance_flash_liquidations TO service_role;
GRANT ALL ON TABLE public.trade_finance_flash_liquidations TO prisma;


--
-- Name: TABLE trade_finance_health_warnings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_health_warnings TO anon;
GRANT ALL ON TABLE public.trade_finance_health_warnings TO authenticated;
GRANT ALL ON TABLE public.trade_finance_health_warnings TO service_role;
GRANT ALL ON TABLE public.trade_finance_health_warnings TO prisma;


--
-- Name: TABLE trade_finance_insurance_claims; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_insurance_claims TO anon;
GRANT ALL ON TABLE public.trade_finance_insurance_claims TO authenticated;
GRANT ALL ON TABLE public.trade_finance_insurance_claims TO service_role;
GRANT ALL ON TABLE public.trade_finance_insurance_claims TO prisma;


--
-- Name: TABLE trade_finance_interest_rate_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_interest_rate_config TO anon;
GRANT ALL ON TABLE public.trade_finance_interest_rate_config TO authenticated;
GRANT ALL ON TABLE public.trade_finance_interest_rate_config TO service_role;
GRANT ALL ON TABLE public.trade_finance_interest_rate_config TO prisma;


--
-- Name: TABLE trade_finance_margin_calls; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_margin_calls TO anon;
GRANT ALL ON TABLE public.trade_finance_margin_calls TO authenticated;
GRANT ALL ON TABLE public.trade_finance_margin_calls TO service_role;
GRANT ALL ON TABLE public.trade_finance_margin_calls TO prisma;


--
-- Name: TABLE trade_finance_partial_liquidations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_partial_liquidations TO anon;
GRANT ALL ON TABLE public.trade_finance_partial_liquidations TO authenticated;
GRANT ALL ON TABLE public.trade_finance_partial_liquidations TO service_role;
GRANT ALL ON TABLE public.trade_finance_partial_liquidations TO prisma;


--
-- Name: TABLE trade_finance_payment_streams; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_payment_streams TO anon;
GRANT ALL ON TABLE public.trade_finance_payment_streams TO authenticated;
GRANT ALL ON TABLE public.trade_finance_payment_streams TO service_role;
GRANT ALL ON TABLE public.trade_finance_payment_streams TO prisma;


--
-- Name: TABLE trade_finance_protocol_reserve; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_protocol_reserve TO anon;
GRANT ALL ON TABLE public.trade_finance_protocol_reserve TO authenticated;
GRANT ALL ON TABLE public.trade_finance_protocol_reserve TO service_role;
GRANT ALL ON TABLE public.trade_finance_protocol_reserve TO prisma;


--
-- Name: TABLE trade_finance_rate_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_rate_history TO anon;
GRANT ALL ON TABLE public.trade_finance_rate_history TO authenticated;
GRANT ALL ON TABLE public.trade_finance_rate_history TO service_role;
GRANT ALL ON TABLE public.trade_finance_rate_history TO prisma;


--
-- Name: TABLE trade_finance_rate_simulations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_rate_simulations TO anon;
GRANT ALL ON TABLE public.trade_finance_rate_simulations TO authenticated;
GRANT ALL ON TABLE public.trade_finance_rate_simulations TO service_role;
GRANT ALL ON TABLE public.trade_finance_rate_simulations TO prisma;


--
-- Name: TABLE trade_finance_reserve_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_reserve_transactions TO anon;
GRANT ALL ON TABLE public.trade_finance_reserve_transactions TO authenticated;
GRANT ALL ON TABLE public.trade_finance_reserve_transactions TO service_role;
GRANT ALL ON TABLE public.trade_finance_reserve_transactions TO prisma;


--
-- Name: TABLE trade_finance_revenue_recipients; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_revenue_recipients TO anon;
GRANT ALL ON TABLE public.trade_finance_revenue_recipients TO authenticated;
GRANT ALL ON TABLE public.trade_finance_revenue_recipients TO service_role;
GRANT ALL ON TABLE public.trade_finance_revenue_recipients TO prisma;


--
-- Name: TABLE trade_finance_rewards_claims; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_rewards_claims TO anon;
GRANT ALL ON TABLE public.trade_finance_rewards_claims TO authenticated;
GRANT ALL ON TABLE public.trade_finance_rewards_claims TO service_role;
GRANT ALL ON TABLE public.trade_finance_rewards_claims TO prisma;


--
-- Name: TABLE trade_finance_rewards_config; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_rewards_config TO anon;
GRANT ALL ON TABLE public.trade_finance_rewards_config TO authenticated;
GRANT ALL ON TABLE public.trade_finance_rewards_config TO service_role;
GRANT ALL ON TABLE public.trade_finance_rewards_config TO prisma;


--
-- Name: TABLE trade_finance_rewards_snapshots; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_rewards_snapshots TO anon;
GRANT ALL ON TABLE public.trade_finance_rewards_snapshots TO authenticated;
GRANT ALL ON TABLE public.trade_finance_rewards_snapshots TO service_role;
GRANT ALL ON TABLE public.trade_finance_rewards_snapshots TO prisma;


--
-- Name: TABLE trade_finance_seasonal_multipliers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_seasonal_multipliers TO anon;
GRANT ALL ON TABLE public.trade_finance_seasonal_multipliers TO authenticated;
GRANT ALL ON TABLE public.trade_finance_seasonal_multipliers TO service_role;
GRANT ALL ON TABLE public.trade_finance_seasonal_multipliers TO prisma;


--
-- Name: TABLE trade_finance_stata_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_stata_operations TO anon;
GRANT ALL ON TABLE public.trade_finance_stata_operations TO authenticated;
GRANT ALL ON TABLE public.trade_finance_stata_operations TO service_role;
GRANT ALL ON TABLE public.trade_finance_stata_operations TO prisma;


--
-- Name: TABLE trade_finance_stata_tokens; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_stata_tokens TO anon;
GRANT ALL ON TABLE public.trade_finance_stata_tokens TO authenticated;
GRANT ALL ON TABLE public.trade_finance_stata_tokens TO service_role;
GRANT ALL ON TABLE public.trade_finance_stata_tokens TO prisma;


--
-- Name: TABLE trade_finance_stream_withdrawals; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_stream_withdrawals TO anon;
GRANT ALL ON TABLE public.trade_finance_stream_withdrawals TO authenticated;
GRANT ALL ON TABLE public.trade_finance_stream_withdrawals TO service_role;
GRANT ALL ON TABLE public.trade_finance_stream_withdrawals TO prisma;


--
-- Name: TABLE trade_finance_transfer_strategies; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_transfer_strategies TO anon;
GRANT ALL ON TABLE public.trade_finance_transfer_strategies TO authenticated;
GRANT ALL ON TABLE public.trade_finance_transfer_strategies TO service_role;
GRANT ALL ON TABLE public.trade_finance_transfer_strategies TO prisma;


--
-- Name: TABLE trade_finance_treasury_snapshots; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_treasury_snapshots TO anon;
GRANT ALL ON TABLE public.trade_finance_treasury_snapshots TO authenticated;
GRANT ALL ON TABLE public.trade_finance_treasury_snapshots TO service_role;
GRANT ALL ON TABLE public.trade_finance_treasury_snapshots TO prisma;


--
-- Name: TABLE trade_finance_user_rewards; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.trade_finance_user_rewards TO anon;
GRANT ALL ON TABLE public.trade_finance_user_rewards TO authenticated;
GRANT ALL ON TABLE public.trade_finance_user_rewards TO service_role;
GRANT ALL ON TABLE public.trade_finance_user_rewards TO prisma;


--
-- Name: TABLE transaction_events; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transaction_events TO anon;
GRANT ALL ON TABLE public.transaction_events TO authenticated;
GRANT ALL ON TABLE public.transaction_events TO service_role;
GRANT ALL ON TABLE public.transaction_events TO prisma;


--
-- Name: TABLE transaction_notifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transaction_notifications TO anon;
GRANT ALL ON TABLE public.transaction_notifications TO authenticated;
GRANT ALL ON TABLE public.transaction_notifications TO service_role;
GRANT ALL ON TABLE public.transaction_notifications TO prisma;


--
-- Name: TABLE transaction_signatures; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transaction_signatures TO anon;
GRANT ALL ON TABLE public.transaction_signatures TO authenticated;
GRANT ALL ON TABLE public.transaction_signatures TO service_role;
GRANT ALL ON TABLE public.transaction_signatures TO prisma;


--
-- Name: TABLE transaction_validations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transaction_validations TO anon;
GRANT ALL ON TABLE public.transaction_validations TO authenticated;
GRANT ALL ON TABLE public.transaction_validations TO service_role;
GRANT ALL ON TABLE public.transaction_validations TO prisma;


--
-- Name: TABLE transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transactions TO anon;
GRANT ALL ON TABLE public.transactions TO authenticated;
GRANT ALL ON TABLE public.transactions TO service_role;
GRANT ALL ON TABLE public.transactions TO prisma;


--
-- Name: TABLE transfer_batches; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transfer_batches TO anon;
GRANT ALL ON TABLE public.transfer_batches TO authenticated;
GRANT ALL ON TABLE public.transfer_batches TO service_role;
GRANT ALL ON TABLE public.transfer_batches TO prisma;


--
-- Name: TABLE transfer_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transfer_history TO anon;
GRANT ALL ON TABLE public.transfer_history TO authenticated;
GRANT ALL ON TABLE public.transfer_history TO service_role;
GRANT ALL ON TABLE public.transfer_history TO prisma;


--
-- Name: TABLE transfer_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.transfer_operations TO anon;
GRANT ALL ON TABLE public.transfer_operations TO authenticated;
GRANT ALL ON TABLE public.transfer_operations TO service_role;
GRANT ALL ON TABLE public.transfer_operations TO prisma;


--
-- Name: TABLE user_activity_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_activity_summary TO anon;
GRANT ALL ON TABLE public.user_activity_summary TO authenticated;
GRANT ALL ON TABLE public.user_activity_summary TO service_role;
GRANT ALL ON TABLE public.user_activity_summary TO prisma;


--
-- Name: TABLE user_addresses; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_addresses TO anon;
GRANT ALL ON TABLE public.user_addresses TO authenticated;
GRANT ALL ON TABLE public.user_addresses TO service_role;
GRANT ALL ON TABLE public.user_addresses TO prisma;


--
-- Name: TABLE user_approval_conditions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_approval_conditions TO anon;
GRANT ALL ON TABLE public.user_approval_conditions TO authenticated;
GRANT ALL ON TABLE public.user_approval_conditions TO service_role;
GRANT ALL ON TABLE public.user_approval_conditions TO prisma;


--
-- Name: TABLE user_contract_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_contract_roles TO anon;
GRANT ALL ON TABLE public.user_contract_roles TO authenticated;
GRANT ALL ON TABLE public.user_contract_roles TO service_role;
GRANT ALL ON TABLE public.user_contract_roles TO prisma;


--
-- Name: TABLE user_mfa_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_mfa_settings TO anon;
GRANT ALL ON TABLE public.user_mfa_settings TO authenticated;
GRANT ALL ON TABLE public.user_mfa_settings TO service_role;
GRANT ALL ON TABLE public.user_mfa_settings TO prisma;


--
-- Name: TABLE user_operations; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_operations TO anon;
GRANT ALL ON TABLE public.user_operations TO authenticated;
GRANT ALL ON TABLE public.user_operations TO service_role;
GRANT ALL ON TABLE public.user_operations TO prisma;


--
-- Name: TABLE user_organization_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_organization_roles TO anon;
GRANT ALL ON TABLE public.user_organization_roles TO authenticated;
GRANT ALL ON TABLE public.user_organization_roles TO service_role;
GRANT ALL ON TABLE public.user_organization_roles TO prisma;


--
-- Name: TABLE user_roles; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_roles TO anon;
GRANT ALL ON TABLE public.user_roles TO authenticated;
GRANT ALL ON TABLE public.user_roles TO service_role;
GRANT ALL ON TABLE public.user_roles TO prisma;


--
-- Name: TABLE user_permissions_view; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_permissions_view TO anon;
GRANT ALL ON TABLE public.user_permissions_view TO authenticated;
GRANT ALL ON TABLE public.user_permissions_view TO service_role;
GRANT ALL ON TABLE public.user_permissions_view TO prisma;


--
-- Name: TABLE user_preferences; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_preferences TO anon;
GRANT ALL ON TABLE public.user_preferences TO authenticated;
GRANT ALL ON TABLE public.user_preferences TO service_role;
GRANT ALL ON TABLE public.user_preferences TO prisma;


--
-- Name: TABLE user_sessions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_sessions TO anon;
GRANT ALL ON TABLE public.user_sessions TO authenticated;
GRANT ALL ON TABLE public.user_sessions TO service_role;
GRANT ALL ON TABLE public.user_sessions TO prisma;


--
-- Name: TABLE user_sidebar_preferences; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_sidebar_preferences TO anon;
GRANT ALL ON TABLE public.user_sidebar_preferences TO authenticated;
GRANT ALL ON TABLE public.user_sidebar_preferences TO service_role;
GRANT ALL ON TABLE public.user_sidebar_preferences TO prisma;


--
-- Name: TABLE user_token_access; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_token_access TO anon;
GRANT ALL ON TABLE public.user_token_access TO authenticated;
GRANT ALL ON TABLE public.user_token_access TO service_role;
GRANT ALL ON TABLE public.user_token_access TO prisma;


--
-- Name: TABLE user_verifications; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.user_verifications TO anon;
GRANT ALL ON TABLE public.user_verifications TO authenticated;
GRANT ALL ON TABLE public.user_verifications TO service_role;
GRANT ALL ON TABLE public.user_verifications TO prisma;


--
-- Name: TABLE valid_policy_approvers; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.valid_policy_approvers TO anon;
GRANT ALL ON TABLE public.valid_policy_approvers TO authenticated;
GRANT ALL ON TABLE public.valid_policy_approvers TO service_role;
GRANT ALL ON TABLE public.valid_policy_approvers TO prisma;


--
-- Name: TABLE validation_alerts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.validation_alerts TO anon;
GRANT ALL ON TABLE public.validation_alerts TO authenticated;
GRANT ALL ON TABLE public.validation_alerts TO service_role;
GRANT ALL ON TABLE public.validation_alerts TO prisma;


--
-- Name: TABLE validation_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.validation_cache TO anon;
GRANT ALL ON TABLE public.validation_cache TO authenticated;
GRANT ALL ON TABLE public.validation_cache TO service_role;
GRANT ALL ON TABLE public.validation_cache TO prisma;


--
-- Name: TABLE valuation_price_history; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.valuation_price_history TO anon;
GRANT ALL ON TABLE public.valuation_price_history TO authenticated;
GRANT ALL ON TABLE public.valuation_price_history TO service_role;
GRANT ALL ON TABLE public.valuation_price_history TO prisma;


--
-- Name: TABLE violation_patterns; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.violation_patterns TO anon;
GRANT ALL ON TABLE public.violation_patterns TO authenticated;
GRANT ALL ON TABLE public.violation_patterns TO service_role;
GRANT ALL ON TABLE public.violation_patterns TO prisma;


--
-- Name: TABLE wallet_access_summary; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_access_summary TO anon;
GRANT ALL ON TABLE public.wallet_access_summary TO authenticated;
GRANT ALL ON TABLE public.wallet_access_summary TO service_role;
GRANT ALL ON TABLE public.wallet_access_summary TO prisma;


--
-- Name: TABLE wallet_details; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_details TO anon;
GRANT ALL ON TABLE public.wallet_details TO authenticated;
GRANT ALL ON TABLE public.wallet_details TO service_role;
GRANT ALL ON TABLE public.wallet_details TO prisma;


--
-- Name: TABLE wallet_facets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_facets TO anon;
GRANT ALL ON TABLE public.wallet_facets TO authenticated;
GRANT ALL ON TABLE public.wallet_facets TO service_role;
GRANT ALL ON TABLE public.wallet_facets TO prisma;


--
-- Name: TABLE wallet_guardians; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_guardians TO anon;
GRANT ALL ON TABLE public.wallet_guardians TO authenticated;
GRANT ALL ON TABLE public.wallet_guardians TO service_role;
GRANT ALL ON TABLE public.wallet_guardians TO prisma;


--
-- Name: TABLE wallet_locks; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_locks TO anon;
GRANT ALL ON TABLE public.wallet_locks TO authenticated;
GRANT ALL ON TABLE public.wallet_locks TO service_role;
GRANT ALL ON TABLE public.wallet_locks TO prisma;


--
-- Name: TABLE wallet_restriction_rules; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_restriction_rules TO anon;
GRANT ALL ON TABLE public.wallet_restriction_rules TO authenticated;
GRANT ALL ON TABLE public.wallet_restriction_rules TO service_role;
GRANT ALL ON TABLE public.wallet_restriction_rules TO prisma;


--
-- Name: TABLE wallet_signatories; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_signatories TO anon;
GRANT ALL ON TABLE public.wallet_signatories TO authenticated;
GRANT ALL ON TABLE public.wallet_signatories TO service_role;
GRANT ALL ON TABLE public.wallet_signatories TO prisma;


--
-- Name: TABLE wallet_transaction_drafts; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_transaction_drafts TO anon;
GRANT ALL ON TABLE public.wallet_transaction_drafts TO authenticated;
GRANT ALL ON TABLE public.wallet_transaction_drafts TO service_role;
GRANT ALL ON TABLE public.wallet_transaction_drafts TO prisma;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.wallet_transaction_drafts TO PUBLIC;


--
-- Name: TABLE wallet_transactions; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_transactions TO anon;
GRANT ALL ON TABLE public.wallet_transactions TO authenticated;
GRANT ALL ON TABLE public.wallet_transactions TO service_role;
GRANT ALL ON TABLE public.wallet_transactions TO prisma;


--
-- Name: TABLE wallets; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallets TO anon;
GRANT ALL ON TABLE public.wallets TO authenticated;
GRANT ALL ON TABLE public.wallets TO service_role;
GRANT ALL ON TABLE public.wallets TO prisma;


--
-- Name: TABLE wallet_with_keys; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.wallet_with_keys TO anon;
GRANT ALL ON TABLE public.wallet_with_keys TO authenticated;
GRANT ALL ON TABLE public.wallet_with_keys TO service_role;
GRANT ALL ON TABLE public.wallet_with_keys TO prisma;


--
-- Name: TABLE weather_cache; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.weather_cache TO anon;
GRANT ALL ON TABLE public.weather_cache TO authenticated;
GRANT ALL ON TABLE public.weather_cache TO service_role;
GRANT ALL ON TABLE public.weather_cache TO prisma;


--
-- Name: TABLE weather_data; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.weather_data TO anon;
GRANT ALL ON TABLE public.weather_data TO authenticated;
GRANT ALL ON TABLE public.weather_data TO service_role;
GRANT ALL ON TABLE public.weather_data TO prisma;


--
-- Name: TABLE webauthn_challenges; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.webauthn_challenges TO anon;
GRANT ALL ON TABLE public.webauthn_challenges TO authenticated;
GRANT ALL ON TABLE public.webauthn_challenges TO service_role;
GRANT ALL ON TABLE public.webauthn_challenges TO prisma;


--
-- Name: TABLE webauthn_credentials; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.webauthn_credentials TO anon;
GRANT ALL ON TABLE public.webauthn_credentials TO authenticated;
GRANT ALL ON TABLE public.webauthn_credentials TO service_role;
GRANT ALL ON TABLE public.webauthn_credentials TO prisma;


--
-- Name: TABLE whitelist_entries; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.whitelist_entries TO anon;
GRANT ALL ON TABLE public.whitelist_entries TO authenticated;
GRANT ALL ON TABLE public.whitelist_entries TO service_role;
GRANT ALL ON TABLE public.whitelist_entries TO prisma;


--
-- Name: TABLE whitelist_settings; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.whitelist_settings TO anon;
GRANT ALL ON TABLE public.whitelist_settings TO authenticated;
GRANT ALL ON TABLE public.whitelist_settings TO service_role;
GRANT ALL ON TABLE public.whitelist_settings TO prisma;


--
-- Name: TABLE whitelist_signatories; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.whitelist_signatories TO anon;
GRANT ALL ON TABLE public.whitelist_signatories TO authenticated;
GRANT ALL ON TABLE public.whitelist_signatories TO service_role;
GRANT ALL ON TABLE public.whitelist_signatories TO prisma;


--
-- Name: TABLE workflow_stages; Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON TABLE public.workflow_stages TO anon;
GRANT ALL ON TABLE public.workflow_stages TO authenticated;
GRANT ALL ON TABLE public.workflow_stages TO service_role;
GRANT ALL ON TABLE public.workflow_stages TO prisma;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES  TO service_role;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES  TO prisma;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES  TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS  TO service_role;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS  TO prisma;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS  TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES  TO service_role;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES  TO prisma;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: public; Owner: -
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES  TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES  TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES  TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES  TO service_role;


--
-- PostgreSQL database dump complete
--

